nf.Client=(function(){var a=null;return{init:function(){return $.ajax({type:"GET",url:"../nifi-api/flow/client-id",}).done(function(b){a=b})},getRevision:function(b){return{clientId:a,version:b.revision.version}}}}());
$(document).ready(function(){var a="images/bg-error.png";$("<img/>").attr("src",a).on("load",function(){$("div.message-pane").css("background-image",a)});$(document).on("mouseenter","span.link",function(){$(this).addClass("link-over")}).on("mouseleave","span.link",function(){$(this).removeClass("link-over")});$(document).on("click","div.nf-checkbox",function(){var b=$(this);if(b.hasClass("checkbox-unchecked")){b.removeClass("checkbox-unchecked").addClass("checkbox-checked")}else{b.removeClass("checkbox-checked").addClass("checkbox-unchecked")}});$(document).ajaxStart(function(){$("div.loading-container").addClass("ajax-loading")}).ajaxStop(function(){$("div.loading-container").removeClass("ajax-loading")});if(nf.Storage.getItem("jwt")!==null){$("#user-logout-container").css("display","block");nf.Common.scheduleTokenRefresh()}$("#user-logout").on("click",function(){nf.Storage.removeItem("jwt");window.location="/nifi/login"});$("#user-home").on("click",function(){if(top!==window){parent.window.location="/nifi"}else{window.location="/nifi"}})});nf.Common=(function(){var a=null;return{ANONYMOUS_USER_TEXT:"Anonymous user",config:{sensitiveText:"Sensitive value set",tooltipConfig:{style:{classes:"nifi-tooltip"},show:{solo:true,effect:function(b){$(this).slideDown(100)}},hide:{effect:function(b){$(this).slideUp(100)}},position:{at:"bottom center",my:"top center",adjust:{y:5}}}},SUPPORTS_SVG:!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,currentUser:undefined,setCurrentUser:function(b){nf.Common.currentUser=b},scheduleTokenRefresh:function(){if(a!==null){clearInterval(a)}var b=nf.Common.MILLIS_PER_MINUTE;var c=function(){var e=nf.Storage.getItemExpiration("jwt");if(e!==null){var g=new Date(e);var f=new Date();var d=g.valueOf()-f.valueOf()-(30*nf.Common.MILLIS_PER_SECOND);if(d<b){if($("#current-user").text()!==nf.Common.ANONYMOUS_USER_TEXT&&!$("#anonymous-user-alert").is(":visible")){$("#anonymous-user-alert").show().qtip($.extend({},nf.Common.config.tooltipConfig,{content:"Your session will expire soon. Please log in again to avoid being automatically logged out.",position:{my:"top right",at:"bottom left"}}))}}}};c();a=setInterval(c,b)},setAnonymousUserLabel:function(){var b=$("#anonymous-user-alert");if(b.data("qtip")){b.qtip("api").destroy(true)}b.show().qtip($.extend({},nf.Common.config.tooltipConfig,{content:"You are accessing with limited authority. Log in or request an account to access with additional authority granted to you by an administrator.",position:{my:"top right",at:"bottom left"}}));$("#current-user").text(nf.Common.ANONYMOUS_USER_TEXT).show()},getJwtPayload:function(c){if(nf.Common.isDefinedAndNotNull(c)){var b=c.split(/\./);if(b.length!==3){return""}var e=$.base64.atob(b[1]);var d=JSON.parse(e);if(nf.Common.isDefinedAndNotNull(d)){return d}else{return null}}return null},canAccessProvenance:function(){if(nf.Common.isDefinedAndNotNull(nf.Common.currentUser)){return nf.Common.currentUser.provenancePermissions.canRead===true}else{return false}},canAccessCounters:function(){if(nf.Common.isDefinedAndNotNull(nf.Common.currentUser)){return nf.Common.currentUser.countersPermissions.canRead===true}else{return false}},canModifyCounters:function(){if(nf.Common.isDefinedAndNotNull(nf.Common.currentUser)){return nf.Common.currentUser.countersPermissions.canRead===true&&nf.Common.currentUser.countersPermissions.canWrite===true}else{return false}},canAccessTenants:function(){if(nf.Common.isDefinedAndNotNull(nf.Common.currentUser)){return nf.Common.currentUser.tenantsPermissions.canRead===true}else{return false}},canModifyTenants:function(){if(nf.Common.isDefinedAndNotNull(nf.Common.currentUser)){return nf.Common.currentUser.tenantsPermissions.canRead===true&&nf.Common.currentUser.tenantsPermissions.canWrite===true}else{return false}},canAccessPolicies:function(){if(nf.Common.isDefinedAndNotNull(nf.Common.currentUser)){return nf.Common.currentUser.policiesPermissions.canRead===true}else{return false}},canModifyPolicies:function(){if(nf.Common.isDefinedAndNotNull(nf.Common.currentUser)){return nf.Common.currentUser.policiesPermissions.canRead===true&&nf.Common.currentUser.policiesPermissions.canWrite===true}else{return false}},canAccessController:function(){if(nf.Common.isDefinedAndNotNull(nf.Common.currentUser)){return nf.Common.currentUser.controllerPermissions.canRead===true}else{return false}},canModifyController:function(){if(nf.Common.isDefinedAndNotNull(nf.Common.currentUser)){return nf.Common.currentUser.controllerPermissions.canRead===true&&nf.Common.currentUser.controllerPermissions.canWrite===true}else{return false}},addHoverEffect:function(b,d,c){$(document).on("mouseenter",b,function(){$(this).removeClass(d).addClass(c)}).on("mouseleave",b,function(){$(this).removeClass(c).addClass(d)});return $(b).addClass(d)},toggleScrollable:function(b){if($(b).is(":visible")){if(b.offsetHeight<b.scrollHeight||b.offsetWidth<b.scrollWidth){$(b).addClass("scrollable")}else{$(b).removeClass("scrollable")}}},handleAjaxError:function(e,b,c){if(b==="canceled"){if($("#splash").is(":visible")){$("#message-title").text("Session Expired");$("#message-content").text("Your session has expired. Please reload to log in again.");$("#message-pane").show()}else{nf.Dialog.showOkDialog({headerText:"Session Expired",dialogContent:"Your session has expired. Please press Ok to log in again.",okHandler:function(){window.location="/nifi"}})}nf.Common.closeCanvas();return}if($("#splash").is(":visible")){if(e.status===401){$("#message-title").text("Unauthorized")}else{if(e.status===403){$("#message-title").text("Access Denied")}else{$("#message-title").text("An unexpected error has occurred")}}if($.trim(e.responseText)===""){$("#message-content").text("Please check the logs.")}else{$("#message-content").text(e.responseText)}$("#message-pane").show();nf.Common.closeCanvas();return}if(e.status===400||e.status===403||e.status===404||e.status===409||e.status===503){nf.Dialog.showOkDialog({headerText:"Error",dialogContent:nf.Common.escapeHtml(e.responseText)})}else{if(e.status<99||e.status===12007||e.status===12029){var d="Please ensure the application is running and check the logs for any errors.";if(nf.Common.isDefinedAndNotNull(b)){if(b==="timeout"){d="Request has timed out. Please ensure the application is running and check the logs for any errors."}else{if(b==="abort"){d="Request has been aborted."}else{if(b==="No Transport"){d="Request transport mechanism failed. Please ensure the host where the application is running is accessible."}}}}$("#message-title").text("Unable to communicate with NiFi");$("#message-content").text(d)}else{if(e.status===401){$("#message-title").text("Unauthorized");if($.trim(e.responseText)===""){$("#message-content").text("Authentication is required to use this NiFi.")}else{$("#message-content").text(e.responseText)}}else{if(e.status===500){$("#message-title").text("An unexpected error has occurred");if($.trim(e.responseText)===""){$("#message-content").text("An error occurred communicating with the application core. Please check the logs and fix any configuration issues before restarting.")}else{$("#message-content").text(e.responseText)}}else{if(e.status===200||e.status===201){$("#message-title").text("Parse Error");if($.trim(e.responseText)===""){$("#message-content").text("Unable to interpret response from NiFi.")}else{$("#message-content").text(e.responseText)}}else{$("#message-title").text(e.status+": Unexpected Response");$("#message-content").text("An unexpected error has occurred. Please check the logs.")}}}}$("#message-pane").show();nf.Common.closeCanvas()}},closeCanvas:function(){nf.Common.showLogoutLink();if(nf.Common.isDefinedAndNotNull(nf.Canvas)){if($("#splash").is(":visible")){nf.Canvas.hideSplash()}nf.ContextMenu.hide();nf.Canvas.stopPolling()}},showLogoutLink:function(){if(nf.Storage.getItem("jwt")===null){$("#user-logout-container").css("display","none")}else{$("#user-logout-container").css("display","block")}},isContentViewConfigured:function(){var b=$("#nifi-content-viewer-url").text();return !nf.Common.isBlank(b)},populateField:function(c,b){if(nf.Common.isUndefined(b)||nf.Common.isNull(b)){return $("#"+c).addClass("unset").text("No value previously set")}else{if(b===""){return $("#"+c).addClass("blank").text("Empty string previously set")}else{return $("#"+c).text(b)}}},clearField:function(b){return $("#"+b).removeClass("unset blank").text("")},cleanUpTooltips:function(b,c){b.find(c).each(function(){var e=$(this);if(e.data("qtip")){var d=e.qtip("api");d.destroy(true)}})},formatPropertyTooltip:function(b,c){var d=[];if(nf.Common.isDefinedAndNotNull(b)){if(!nf.Common.isBlank(b.description)){d.push(nf.Common.escapeHtml(b.description))}if(!nf.Common.isBlank(b.defaultValue)){d.push("<b>Default value:</b> "+nf.Common.escapeHtml(b.defaultValue))}if(!nf.Common.isBlank(b.supportsEl)){d.push("<b>Supports expression language:</b> "+nf.Common.escapeHtml(b.supportsEl))}}if(nf.Common.isDefinedAndNotNull(c)){if(!nf.Common.isEmpty(c.previousValues)){var e=[];$.each(c.previousValues,function(g,f){e.push("<li>"+nf.Common.escapeHtml(f.previousValue)+" - "+nf.Common.escapeHtml(f.timestamp)+" ("+nf.Common.escapeHtml(f.userIdentity)+")</li>")});d.push('<b>History:</b><ul class="property-info">'+e.join("")+"</ul>")}}if(d.length>0){return d.join("<br/><br/>")}else{return null}},formatProperty:function(b,c){return'<div><span class="label">'+nf.Common.formatValue(b)+": </span>"+nf.Common.formatValue(c)+"</div>"},formatValue:function(b){if(nf.Common.isDefinedAndNotNull(b)){if(b===""){return'<span class="blank" style="font-size: 13px; padding-top: 2px;">Empty string previously set</span>'}else{return nf.Common.escapeHtml(b)}}else{return'<span class="unset" style="font-size: 13px; padding-top: 2px;">No value previously set</span>'}},escapeHtml:(function(){var b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2f;"};return function(c){if(nf.Common.isDefinedAndNotNull(c)){return String(c).replace(/[&<>"'\/]/g,function(d){return b[d]})}else{return""}}}()),isSensitiveProperty:function(b){if(nf.Common.isDefinedAndNotNull(b)){return b.sensitive===true}else{return false}},isRequiredProperty:function(b){if(nf.Common.isDefinedAndNotNull(b)){return b.required===true}else{return false}},isDynamicProperty:function(b){if(nf.Common.isDefinedAndNotNull(b)){return b.dynamic===true}else{return false}},getAllowableValues:function(b){if(nf.Common.isDefinedAndNotNull(b)){return b.allowableValues}else{return null}},supportsEl:function(b){if(nf.Common.isDefinedAndNotNull(b)){return b.supportsEl===true}else{return false}},formatUnorderedList:function(c){if($.isArray(c)){var b=$('<ul class="result"></ul>');$.each(c,function(e,f){var d=$("<li></li>").appendTo(b);if(f instanceof jQuery){d.append(f)}else{d.text(f)}});return b}else{return null}},substringAfterLast:function(f,e){var c="";var d=f.lastIndexOf(e);if(d>=0){var b=d+e.length;if(b<f.length){c=f.substr(b)}}return c},substringAfterFirst:function(f,e){var c="";var d=f.indexOf(e);if(d>=0){var b=d+e.length;if(b<f.length){c=f.substr(b)}}return c},substringBeforeFirst:function(e,d){var b="";var c=e.indexOf(d);if(c>=0){b=e.substr(0,c)}return b},setCursor:function(c,b){if(b){$("#"+c).addClass("pointer")}else{$("#"+c).removeClass("pointer")}},getAccessToken:function(b){return $.Deferred(function(c){if(nf.Storage.hasItem("jwt")){$.ajax({type:"POST",url:b}).done(function(d){c.resolve(d)}).fail(function(){c.reject()})}else{c.resolve("")}}).promise()},MILLIS_PER_DAY:86400000,MILLIS_PER_HOUR:3600000,MILLIS_PER_MINUTE:60000,MILLIS_PER_SECOND:1000,formatDuration:function(e){e=e<1?0:e;var g=e/nf.Common.MILLIS_PER_DAY;g=g>=1?parseInt(g,10):0;e%=nf.Common.MILLIS_PER_DAY;var b=e/nf.Common.MILLIS_PER_HOUR;b=b>=1?parseInt(b,10):0;e%=nf.Common.MILLIS_PER_HOUR;var c=e/nf.Common.MILLIS_PER_MINUTE;c=c>=1?parseInt(c,10):0;e%=nf.Common.MILLIS_PER_MINUTE;var f=e/nf.Common.MILLIS_PER_SECOND;f=f>=1?parseInt(f,10):0;e=Math.floor(e%nf.Common.MILLIS_PER_SECOND);var d=nf.Common.pad(b,2,"0")+":"+nf.Common.pad(c,2,"0")+":"+nf.Common.pad(f,2,"0")+"."+nf.Common.pad(e,3,"0");if(g>0){return g+" days and "+d}else{return d}},BYTES_IN_KILOBYTE:1024,BYTES_IN_MEGABYTE:1048576,BYTES_IN_GIGABYTE:1073741824,BYTES_IN_TERABYTE:1099511627776,formatDataSize:function(c){var b=parseFloat(c/nf.Common.BYTES_IN_TERABYTE);if(b>1){return b.toFixed(2)+" TB"}b=parseFloat(c/nf.Common.BYTES_IN_GIGABYTE);if(b>1){return b.toFixed(2)+" GB"}b=parseFloat(c/nf.Common.BYTES_IN_MEGABYTE);if(b>1){return b.toFixed(2)+" MB"}b=parseFloat(c/nf.Common.BYTES_IN_KILOBYTE);if(b>1){return b.toFixed(2)+" KB"}return parseFloat(c).toFixed(2)+" bytes"},formatInteger:function(c){var b=c+"";var d=/(\d+)(\d{3})/;while(d.test(b)){b=b.replace(d,"$1,$2")}return b},formatFloat:function(b){if(nf.Common.isUndefinedOrNull(b)){return 0+""}return b.toFixed(2)+""},pad:function(e,c,d){var b=e+"";while(b.length<c){b=d+b}return b},formatDateTime:function(b){return nf.Common.pad(b.getMonth()+1,2,"0")+"/"+nf.Common.pad(b.getDate(),2,"0")+"/"+nf.Common.pad(b.getFullYear(),2,"0")+" "+nf.Common.pad(b.getHours(),2,"0")+":"+nf.Common.pad(b.getMinutes(),2,"0")+":"+nf.Common.pad(b.getSeconds(),2,"0")+"."+nf.Common.pad(b.getMilliseconds(),3,"0")},parseDateTime:function(b){if(!nf.Common.isDefinedAndNotNull(b)){return new Date()}if(b==="No value previously set"){return new Date()}if(b==="Empty string previously set"){return new Date()}var d=b.split(/ /);if(d.length!==3){return new Date()}var c=d[0].split(/\//);var e=d[1].split(/:/);if(c.length!==3||e.length!==3){return new Date()}var f=e[2].split(/\./);if(f.length===2){return new Date(parseInt(c[2],10),parseInt(c[0],10),parseInt(c[1],10),parseInt(e[0],10),parseInt(e[1],10),parseInt(f[0],10),parseInt(f[1],10))}else{return new Date(parseInt(c[2],10),parseInt(c[0],10),parseInt(c[1],10),parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10),0)}},parseDuration:function(b){var c=b.split(/:/);if(c.length!==3){return 0}var d=c[2].split(/\./);if(d.length===2){return new Date(1970,0,1,parseInt(c[0],10),parseInt(c[1],10),parseInt(d[0],10),parseInt(d[1],10)).getTime()}else{return new Date(1970,0,1,parseInt(c[0],10),parseInt(c[1],10),parseInt(c[2],10),0).getTime()}},parseSize:function(d){var e=d.split(/ /);var c=parseFloat(e[0].replace(/,/g,""));var b=e[1];if(b==="KB"){return c*1024}else{if(b==="MB"){return c*1024*1024}else{if(b==="GB"){return c*1024*1024*1024}else{if(b==="TB"){return c*1024*1024*1024*1024}else{return c}}}}},parseCount:function(d){var c=d.split(/ /,1);if(c.length!==1){return 0}var b=parseInt(c[0].replace(/,/g,""),10);if(isNaN(b)){return 0}return b},isDefinedAndNotNull:function(b){return !nf.Common.isUndefined(b)&&!nf.Common.isNull(b)},isUndefinedOrNull:function(b){return nf.Common.isUndefined(b)||nf.Common.isNull(b)},isUndefined:function(b){return typeof b==="undefined"},isBlank:function(b){return nf.Common.isUndefined(b)||nf.Common.isNull(b)||$.trim(b)===""},isNull:function(b){return b===null},isEmpty:function(b){return $.isArray(b)?b.length===0:true},doBulletinsDiffer:function(c,d){if($.isArray(c)&&$.isArray(d)){if(c.length===d.length){for(var b=0;b<c.length;b++){if(c[b].id!==d[b].id||c[b].canRead!==d[b].canRead){return true}}}else{return true}}else{if($.isArray(c)||$.isArray(d)){return true}}return false},getFormattedBulletins:function(c){var b=[];$.each(c,function(e,f){if(f.canRead===true){var d=f.bulletin;var i="";if(nf.Common.isDefinedAndNotNull(d.nodeAddress)){i="-&nbsp"+nf.Common.escapeHtml(d.nodeAddress)+"&nbsp;-&nbsp;"}var h=$("<pre></pre>").css({"white-space":"pre-wrap"}).text(d.message);var g=$("<div>"+nf.Common.escapeHtml(d.timestamp)+"&nbsp;"+i+"&nbsp;<b>"+nf.Common.escapeHtml(d.level)+"</b>&nbsp;</div>").append(h);b.push(g)}});return b}}}());
$(document).ready(function(a){a(window).on("keydown",function(b){var g=b.ctrlKey||b.metaKey;if(!g&&b.keyCode===27){var e=a("div.value-combo");if(e.is(":visible")&&e.parent().hasClass("combo-editor")){return}if(a("div.property-detail").is(":visible")){nf.UniversalCapture.removeAllPropertyDetailDialogs();b.stopImmediatePropagation();b.preventDefault()}else{var f=a(b.target);if(f.length){var h=a(".cancellable");if(h.length){var c=null;var d=null;a.each(h,function(i,k){var j=a(k);var l=j.css("zIndex");if(j.is(":visible")&&(l!==null&&typeof l!=="undefined")){l=parseInt(l,10);if(c===null||l>c){c=l;d=j}}});if(d!==null){if(d.hasClass("modal")){d.modal("hide")}else{d.hide()}b.stopImmediatePropagation();b.preventDefault();return}}if(top!==window){if(typeof parent.nf!=="undefined"&&typeof parent.nf.Shell!=="undefined"){parent.$("#shell-close-button").click();b.stopImmediatePropagation();b.preventDefault();return}}}}}else{if(g){if(b.keyCode===82){b.preventDefault()}}else{if(!a("input, textarea").is(":focus")&&(b.keyCode==8||b.keyCode===46)){b.preventDefault()}}}})});nf.UniversalCapture=(function(){return{removeAllPropertyDetailDialogs:function(){var a=$("body").find("div.property-detail");a.find("div.nfel-editor").nfeditor("destroy");a.find("div.value-combo").combo("destroy");a.hide().remove()}}}());
nf.CanvasUtils=(function(){var b={storage:{namePrefix:"nifi-view-"},urls:{controller:"../nifi-api/controller"}};var c=2*Math.PI;var d=function(i,g){var f=0;var j=i-1;var h;var e=0;while(f<=j){h=~~((f+j)/2);e=g(h);if(e<0){j=h-1}else{if(e>0){f=h+1}else{break}}}return h};var a=function(f,e){return $.Deferred(function(g){var h=nf.Snippet.marshal(f);nf.Snippet.create(h).done(function(i){nf.Snippet.move(i.snippet.id,e).done(function(){var k=d3.map();var j=function(l,m){if(!k.has(l)){k.set(l,[])}k.get(l).push(m)};f.each(function(l){j(l.type,l.id)});k.forEach(function(m,l){nf[m].remove(l)});nf.Birdseye.refresh();g.resolve()}).fail(nf.Common.handleAjaxError).fail(function(){g.reject()})}).fail(nf.Common.handleAjaxError).fail(function(){g.reject()})}).promise()};return{config:{systemTooltipConfig:{style:{classes:"nifi-tooltip"},show:{solo:true,effect:false},hide:{effect:false},position:{at:"bottom right",my:"top left"}}},getPerimeterPoint:function(e,n){var f=Math.atan2(n.height,n.width);var k=n.width/2;var j=n.height/2;var i=n.x+k;var g=n.y+j;var o=e.x-i;var m=e.y-g;var h=Math.atan2(m,o);h=h%c;if(h<0){h+=c}var l=(Math.PI/2)-h;if((h>=0&&h<f)||(h>=(c-f)&&h<c)){return{x:n.x+n.width,y:g+Math.tan(h)*k}}else{if(h>=f&&h<(Math.PI-f)){return{x:i+Math.tan(l)*j,y:n.y+n.height}}else{if(h>=(Math.PI-f)&&h<(Math.PI+f)){return{x:n.x,y:g-Math.tan(h)*k}}else{return{x:i-Math.tan(l)*j,y:n.y}}}}},showComponent:function(f,e){if(nf.Common.isDefinedAndNotNull(f)){var g=$.Deferred(function(h){if(f!==nf.Canvas.getGroupId()){nf.Canvas.setGroupId(f);nf.Canvas.reload().done(function(){h.resolve()}).fail(function(){nf.Dialog.showOkDialog({headerText:"Process Group",dialogContent:"Unable to load the group for the specified component."});h.reject()})}else{h.resolve()}}).promise();g.done(function(){var h=d3.select("#id-"+e);if(!h.empty()){nf.Actions.show(h)}else{nf.Dialog.showOkDialog({headerText:"Process Group",dialogContent:"Unable to find the specified component."})}})}},getSelection:function(){return d3.selectAll("g.component.selected, g.connection.selected")},centerBoundingBox:function(f){var h=nf.Canvas.View.scale();var j=$("#canvas-container");var g=j.width()/h;var i=j.height()/h;var e=[(g/2)-(f.width/2),(i/2)-(f.height/2)];nf.Canvas.View.translate([(e[0]-f.x)*h,(e[1]-f.y)*h])},editable:function(e){if(nf.CanvasUtils.canModify(e)){if(!e.classed("connectable")){e.call(nf.Connectable.activate)}if(!e.classed("moveable")){e.call(nf.Draggable.activate)}}else{if(e.classed("connectable")){e.call(nf.Connectable.deactivate)}if(e.classed("moveable")){e.call(nf.Draggable.deactivate)}}},transition:function(e,f){if(f&&!e.empty()){return e.transition().duration(400)}else{return e}},position:function(e,f){if(e.empty()){return}return nf.CanvasUtils.transition(e,f).attr("transform",function(g){return"translate("+g.position.x+", "+g.position.y+")"})},ellipsis:function(g,j){var f=parseInt(g.attr("width"),10);var h=g.node();g.text(j);if(j.length>0&&h.getSubStringLength(0,j.length-1)>f){f-=5;var e=d(j.length,function(i){var k=h.getSubStringLength(0,i);if(k>f){return -1}else{if(k<f){return 1}}return 0});g.text(j.substring(0,e)+String.fromCharCode(8230))}},multilineEllipsis:function(m,p,o){var g=1;var h=o.split(/\s+/).reverse();var l=parseInt(m.attr("x"),10);var k=parseInt(m.attr("y"),10);var f=parseInt(m.attr("width"),10);var q=[];var j=m.append("tspan").attr({x:l,y:k,width:f});var e=h.pop();while(nf.Common.isDefinedAndNotNull(e)){q.push(e);j.text(q.join(" "));if(j.node().getComputedTextLength()>f){q.pop();j.text(q.join(" "));j=m.append("tspan").attr({x:l,dy:"1.2em",width:f});if(++g>=p){var n=[e].concat(h.reverse());nf.CanvasUtils.ellipsis(j,n.join(" "));break}else{j.text(e);q=[e]}}e=h.pop()}},activeThreadCount:function(e,g,h){if(g.status.aggregateSnapshot.activeThreadCount>0){var f=e.select("text.active-thread-count").text(function(){return g.status.aggregateSnapshot.activeThreadCount}).style("display","block").each(function(){var i=this.getBBox();d3.select(this).attr("x",function(){return g.dimensions.width-i.width-15})});e.select("text.active-thread-count-icon").attr("x",function(){var i=f.node().getBBox();if(typeof h==="function"){h(i.width+6)}return g.dimensions.width-i.width-20}).style("display","block")}else{e.selectAll("text.active-thread-count, text.active-thread-count-icon").style("display","none")}},disableImageHref:function(e){e.on("click.disableImageHref",function(){if(d3.event.ctrlKey||d3.event.shiftKey){d3.event.preventDefault()}})},bulletins:function(e,k,l,j){j=nf.Common.isDefinedAndNotNull(j)?j:0;var h=d3.select("#bulletin-tip-"+k.id);var g=false;if(!nf.Common.isEmpty(k.bulletins)){var i=nf.Common.getFormattedBulletins(k.bulletins);g=i.length>0;if(g){var f=nf.Common.formatUnorderedList(i)}}if(g){e.select("text.bulletin-icon").each(function(){if(h.empty()){h=l().append("div").attr("id",function(){return"bulletin-tip-"+k.id}).attr("class","tooltip nifi-tooltip")}h.html(function(){return $("<div></div>").append(f).html()});nf.CanvasUtils.canvasTooltip(h,d3.select(this))});e.select("text.bulletin-icon").style("visibility","visible");e.select("rect.bulletin-background").style("visibility","visible")}else{if(!h.empty()){h.remove()}e.select("text.bulletin-icon").style("visibility","hidden");e.select("rect.bulletin-background").style("visibility","hidden")}},canvasTooltip:function(e,f){f.on("mouseenter",function(){e.style("top",(d3.event.pageY+15)+"px").style("left",(d3.event.pageX+15)+"px").style("display","block")}).on("mousemove",function(){e.style("top",(d3.event.pageY+15)+"px").style("left",(d3.event.pageX+15)+"px")}).on("mouseleave",function(){e.style("display","none")})},isColorable:function(g){if(g.empty()){return false}if(nf.CanvasUtils.canRead(g)===false||nf.CanvasUtils.canModify(g)===false){return false}var f=g.filter(function(k){var j=d3.select(this);return nf.CanvasUtils.isProcessor(j)&&nf.CanvasUtils.canModify(j)});var i=g.filter(function(k){var j=d3.select(this);return nf.CanvasUtils.isLabel(j)&&nf.CanvasUtils.canModify(j)});var e=f.size()===g.size();var h=i.size()===g.size();return e||h},isConnection:function(e){return e.classed("connection")},isRemoteProcessGroup:function(e){return e.classed("remote-process-group")},isProcessor:function(e){return e.classed("processor")},isLabel:function(e){return e.classed("label")},isInputPort:function(e){return e.classed("input-port")},isOutputPort:function(e){return e.classed("output-port")},isProcessGroup:function(e){return e.classed("process-group")},isFunnel:function(e){return e.classed("funnel")},areRunnable:function(e){if(e.empty()){return false}var f=true;e.each(function(){if(!nf.CanvasUtils.isRunnable(d3.select(this))){f=false;return false}});return f},isRunnable:function(e){if(e.size()!==1){return false}if(nf.CanvasUtils.isProcessGroup(e)){return true}if(nf.CanvasUtils.canModify(e)===false){return false}var g=false;var f=e.datum();if(nf.CanvasUtils.isProcessor(e)||nf.CanvasUtils.isInputPort(e)||nf.CanvasUtils.isOutputPort(e)){g=nf.CanvasUtils.supportsModification(e)&&f.status.aggregateSnapshot.runStatus==="Stopped"}return g},areStoppable:function(e){if(e.empty()){return false}var f=true;e.each(function(){if(!nf.CanvasUtils.isStoppable(d3.select(this))){f=false;return false}});return f},isStoppable:function(e){if(e.size()!==1){return false}if(nf.CanvasUtils.isProcessGroup(e)){return true}if(nf.CanvasUtils.canModify(e)===false){return false}var g=false;var f=e.datum();if(nf.CanvasUtils.isProcessor(e)||nf.CanvasUtils.isInputPort(e)||nf.CanvasUtils.isOutputPort(e)){g=f.status.aggregateSnapshot.runStatus==="Running"}return g},filterEnable:function(e){return e.filter(function(h){var f=d3.select(this);var g=f.datum();return((nf.CanvasUtils.isProcessor(f)||nf.CanvasUtils.isInputPort(f)||nf.CanvasUtils.isOutputPort(f))&&nf.CanvasUtils.supportsModification(f)&&g.status.aggregateSnapshot.runStatus==="Disabled")})},canEnable:function(e){if(e.empty()){return false}if(nf.CanvasUtils.canModify(e)===false){return false}return nf.CanvasUtils.filterEnable(e).size()===e.size()},filterDisable:function(e){return e.filter(function(h){var f=d3.select(this);var g=f.datum();return((nf.CanvasUtils.isProcessor(f)||nf.CanvasUtils.isInputPort(f)||nf.CanvasUtils.isOutputPort(f))&&nf.CanvasUtils.supportsModification(f)&&g.status.aggregateSnapshot.runStatus==="Stopped")})},canDisable:function(e){if(e.empty()){return false}if(nf.CanvasUtils.canModify(e)===false){return false}return nf.CanvasUtils.filterDisable(e).size()===e.size()},canAllStartTransmitting:function(e){if(e.empty()){return false}var f=true;e.each(function(){if(!nf.CanvasUtils.canStartTransmitting(d3.select(this))){f=false}});return f},canStartTransmitting:function(e){if(e.size()!==1){return false}if(nf.CanvasUtils.canModify(e)===false||nf.CanvasUtils.canRead(e)===false){return false}return nf.CanvasUtils.isRemoteProcessGroup(e)},canAllStopTransmitting:function(e){if(e.empty()){return false}var f=true;e.each(function(){if(!nf.CanvasUtils.canStopTransmitting(d3.select(this))){f=false}});return f},canStopTransmitting:function(e){if(e.size()!==1){return false}if(nf.CanvasUtils.canModify(e)===false||nf.CanvasUtils.canRead(e)===false){return false}return nf.CanvasUtils.isRemoteProcessGroup(e)},areDeletable:function(e){if(e.empty()){return false}var f=true;e.each(function(){if(!nf.CanvasUtils.isDeletable(d3.select(this))){f=false}});return f},isDeletable:function(e){if(e.size()!==1){return false}if(nf.CanvasUtils.canModify(e)===false){return false}return nf.CanvasUtils.supportsModification(e)},isConfigurable:function(e){if(e.size()!==1){return false}if(nf.CanvasUtils.isProcessGroup(e)){return true}if(nf.CanvasUtils.canRead(e)===false||nf.CanvasUtils.canModify(e)===false){return false}if(nf.CanvasUtils.isFunnel(e)){return false}return nf.CanvasUtils.supportsModification(e)},hasDetails:function(e){if(e.size()!==1){return false}if(nf.CanvasUtils.isProcessGroup(e)){return true}if(nf.CanvasUtils.canRead(e)===false){return false}if(nf.CanvasUtils.canModify(e)){if(nf.CanvasUtils.isProcessor(e)||nf.CanvasUtils.isInputPort(e)||nf.CanvasUtils.isOutputPort(e)||nf.CanvasUtils.isRemoteProcessGroup(e)||nf.CanvasUtils.isConnection(e)){return !nf.CanvasUtils.isConfigurable(e)}}else{return nf.CanvasUtils.isProcessor(e)||nf.CanvasUtils.isConnection(e)||nf.CanvasUtils.isInputPort(e)||nf.CanvasUtils.isOutputPort(e)||nf.CanvasUtils.isRemoteProcessGroup(e)}return false},canModify:function(g){var f=g.size();var e=g.filter(function(h){return h.permissions.canWrite}).size();return f===e},canRead:function(f){var e=f.size();var g=f.filter(function(h){return h.permissions.canRead}).size();return e===g},supportsModification:function(l){if(l.size()!==1){return false}var j=l.datum();var h=false;if(nf.CanvasUtils.isProcessor(l)||nf.CanvasUtils.isInputPort(l)||nf.CanvasUtils.isOutputPort(l)){h=!(j.status.aggregateSnapshot.runStatus==="Running"||j.status.aggregateSnapshot.activeThreadCount>0)}else{if(nf.CanvasUtils.isRemoteProcessGroup(l)){h=!(j.status.transmissionStatus==="Transmitting"||j.status.aggregateSnapshot.activeThreadCount>0)}else{if(nf.CanvasUtils.isProcessGroup(l)){h=true}else{if(nf.CanvasUtils.isFunnel(l)){h=true}else{if(nf.CanvasUtils.isLabel(l)){h=true}else{if(nf.CanvasUtils.isConnection(l)){var k=false;var f=false;var m=nf.CanvasUtils.getConnectionSourceComponentId(j);var e=d3.select("#id-"+m);if(!e.empty()){if(nf.CanvasUtils.isRemoteProcessGroup(e)||nf.CanvasUtils.isProcessGroup(e)){k=true}else{k=nf.CanvasUtils.supportsModification(e)}}var g=nf.CanvasUtils.getConnectionDestinationComponentId(j);var i=d3.select("#id-"+g);if(!i.empty()){if(nf.CanvasUtils.isRemoteProcessGroup(i)||nf.CanvasUtils.isProcessGroup(i)){f=true}else{f=nf.CanvasUtils.supportsModification(i)}}h=k&&f}}}}}}return h},getConnectableTypeForSource:function(f){var e;if(nf.CanvasUtils.isProcessor(f)){e="PROCESSOR"}else{if(nf.CanvasUtils.isRemoteProcessGroup(f)){e="REMOTE_OUTPUT_PORT"}else{if(nf.CanvasUtils.isProcessGroup(f)){e="OUTPUT_PORT"}else{if(nf.CanvasUtils.isInputPort(f)){e="INPUT_PORT"}else{if(nf.CanvasUtils.isFunnel(f)){e="FUNNEL"}}}}}return e},getConnectableTypeForDestination:function(f){var e;if(nf.CanvasUtils.isProcessor(f)){e="PROCESSOR"}else{if(nf.CanvasUtils.isRemoteProcessGroup(f)){e="REMOTE_INPUT_PORT"}else{if(nf.CanvasUtils.isProcessGroup(f)){e="INPUT_PORT"}else{if(nf.CanvasUtils.isOutputPort(f)){e="OUTPUT_PORT"}else{if(nf.CanvasUtils.isFunnel(f)){e="FUNNEL"}}}}}return e},isCopyable:function(f){if(f.empty()){return false}if(nf.CanvasUtils.canRead(f)===false){return false}var e=f.filter(function(j){var h=d3.select(this);if(nf.CanvasUtils.isConnection(h)){var g=!f.filter(function(k){var l=nf.CanvasUtils.getConnectionSourceComponentId(j);return l===k.id}).empty();var i=!f.filter(function(k){var l=nf.CanvasUtils.getConnectionDestinationComponentId(j);return l===k.id}).empty();return g&&i}else{return nf.CanvasUtils.isProcessor(h)||nf.CanvasUtils.isFunnel(h)||nf.CanvasUtils.isLabel(h)||nf.CanvasUtils.isProcessGroup(h)||nf.CanvasUtils.isRemoteProcessGroup(h)||nf.CanvasUtils.isInputPort(h)||nf.CanvasUtils.isOutputPort(h)}});return f.size()===e.size()},isPastable:function(){return nf.Canvas.canWrite()&&nf.Clipboard.isCopied()},persistUserView:function(){var e=b.storage.namePrefix+nf.Canvas.getGroupId();var g=nf.Canvas.View.translate();var f={scale:nf.Canvas.View.scale(),translateX:g[0],translateY:g[1]};nf.Storage.setItem(e,f)},formatConnectionName:function(e){if(!nf.Common.isBlank(e.name)){return e.name}else{if(nf.Common.isDefinedAndNotNull(e.selectedRelationships)){return e.selectedRelationships.join(", ")}}return""},reloadConnectionSourceAndDestination:function(j,i){if(nf.Common.isBlank(j)===false){var h=d3.select("#id-"+j);if(h.empty()===false){var g=h.datum();if(g.permissions.canRead){if(nf.CanvasUtils.isProcessor(h)){nf.Processor.reload(g.id)}else{if(nf.CanvasUtils.isInputPort(h)){nf.Port.reload(g.id)}else{if(nf.CanvasUtils.isRemoteProcessGroup(h)){nf.RemoteProcessGroup.reload(g.id)}}}}}}if(nf.Common.isBlank(i)===false){var e=d3.select("#id-"+i);if(e.empty()===false){var f=e.datum();if(f.permissions.canRead){if(nf.CanvasUtils.isProcessor(e)){nf.Processor.reload(f.id)}else{if(nf.CanvasUtils.isRemoteProcessGroup(e)){nf.RemoteProcessGroup.reload(f.id)}}}}}},getConnectionSourceComponentId:function(e){var f=e.sourceId;if(e.sourceGroupId!==nf.Canvas.getGroupId()){f=e.sourceGroupId}return f},getConnectionDestinationComponentId:function(e){var f=e.destinationId;if(e.destinationGroupId!==nf.Canvas.getGroupId()){f=e.destinationGroupId}return f},restoreUserView:function(){var h=false;try{var f=b.storage.namePrefix+nf.Canvas.getGroupId();var g=nf.Storage.getItem(f);if(nf.Common.isDefinedAndNotNull(g)){if(isFinite(g.scale)&&isFinite(g.translateX)&&isFinite(g.translateY)){nf.Canvas.View.translate([g.translateX,g.translateY]);nf.Canvas.View.scale(g.scale);nf.Canvas.View.refresh({transition:true});h=true}}}catch(i){}return h},enterGroup:function(e){nf.ContextMenu.hide();nf.Canvas.setGroupId(e);return nf.Canvas.reload().done(function(){var f=nf.CanvasUtils.restoreUserView();if(f===false){nf.Canvas.View.fit();nf.Canvas.View.refresh({transition:true})}}).fail(function(){nf.Dialog.showOkDialog({headerText:"Process Group",dialogContent:"Unable to enter the selected group."})})},getOrigin:function(f){var e={};f.each(function(h){var g=d3.select(this);if(!nf.CanvasUtils.isConnection(g)){if(nf.Common.isUndefined(e.x)||h.position.x<e.x){e.x=h.position.x}if(nf.Common.isUndefined(e.y)||h.position.y<e.y){e.y=h.position.y}}});return e},moveComponentsToParent:function(f){var e=nf.Canvas.getParentGroupId();if(e===null){nf.Dialog.showOkDialog({headerText:"Process Group",dialogContent:"Components are already in the topmost group."})}else{a(f,e)}},moveComponents:function(f,g){var e=g.datum();a(f,e.id).done(function(){nf.ProcessGroup.reload(e.id)})},trimDanglingEdges:function(e){var f=function(g){var k=nf.CanvasUtils.getConnectionSourceComponentId(g);var j=nf.CanvasUtils.getConnectionDestinationComponentId(g);var i=false;var h=false;e.each(function(l){if(l.id===k){i=true}if(l.id===j){h=true}});return i&&h};return e.filter(function(g){if(g.type==="Connection"){return f(g)}else{return true}})},isDisconnected:function(g){if(g.empty()){return false}var f=d3.map();var h=d3.map();var e=true;g.filter(function(i){return i.type==="Connection"}).each(function(i){f.set(i.id,i)});g.filter(function(i){return i.type!=="Connection"}).each(function(i){h.set(i.id,i.component);$.each(nf.Connection.getComponentConnections(i.id),function(k,j){if(!f.has(j.id)){e=false;return false}})});if(e){f.forEach(function(j,i){if(e){e=h.has(nf.CanvasUtils.getConnectionSourceComponentId(i))&&h.has(nf.CanvasUtils.getConnectionDestinationComponentId(i))}})}return e},isValidConnectionSource:function(e){if(e.size()!==1){return false}if(nf.CanvasUtils.isProcessGroup(e)){return true}if(nf.CanvasUtils.canRead(e)===false||nf.CanvasUtils.canModify(e)===false){return false}return nf.CanvasUtils.isProcessor(e)||nf.CanvasUtils.isRemoteProcessGroup(e)||nf.CanvasUtils.isInputPort(e)||nf.CanvasUtils.isFunnel(e)},isValidConnectionDestination:function(f){if(f.size()!==1){return false}if(nf.CanvasUtils.isProcessGroup(f)){return true}if(nf.CanvasUtils.canModify(f)===false){return false}if(nf.CanvasUtils.isRemoteProcessGroup(f)||nf.CanvasUtils.isOutputPort(f)||nf.CanvasUtils.isFunnel(f)){return true}if(nf.CanvasUtils.isProcessor(f)){var e=f.datum();return e.inputRequirement!=="INPUT_FORBIDDEN"}}}}());
$(document).ready(function(){$("#nf-ok-dialog").modal({scrollableContentStyle:"scrollable",handler:{close:function(){$("#nf-ok-dialog-content").empty()}}});$("#nf-yes-no-dialog").modal({scrollableContentStyle:"scrollable",handler:{close:function(){$("#nf-yes-no-dialog-content").empty();$("#nf-yes-no-dialog").modal("setButtonModel",[])}}})});nf.Dialog=(function(){return{showOkDialog:function(a){a=$.extend({headerText:"",dialogContent:""},a);var b=$("<p></p>").append(a.dialogContent);$("#nf-ok-dialog-content").append(b);$("#nf-ok-dialog").modal("setButtonModel",[{buttonText:"Ok",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){$("#nf-ok-dialog").modal("hide");if(typeof a.okHandler==="function"){a.okHandler.call(this)}}}}]);$("#nf-ok-dialog").modal("setHeaderText",a.headerText).modal("show")},showYesNoDialog:function(a){a=$.extend({headerText:"",dialogContent:"",overlayBackgrond:true,yesText:"Yes",noText:"No"},a);var b=$("<p></p>").append(a.dialogContent);$("#nf-yes-no-dialog-content").append(b);$("#nf-yes-no-dialog").modal("setButtonModel",[{buttonText:a.yesText,color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){$("#nf-yes-no-dialog").modal("hide");if(typeof a.yesHandler==="function"){a.yesHandler.call(this)}}}},{buttonText:a.noText,color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){$("#nf-yes-no-dialog").modal("hide");if(typeof a.noHandler==="function"){a.noHandler.call(this)}}}}]);$("#nf-yes-no-dialog").modal("setHeaderText",a.headerText).modal("show")}}}());
$(document).ready(function(){$("#shell-dialog").modal({scrollableContentStyle:"scrollable",header:false,footer:false,responsive:{x:false,y:false}});$("#shell-close-button").click(function(){$("#shell-dialog").modal("hide")});$("#shell-undock-button").click(function(){var a=$("#shell-iframe").attr("src");if(!nf.Common.isBlank(a)){window.open(a);$("#shell-dialog").modal("hide")}})});nf.Shell=(function(){var b=null;var a=null;return{resizeContent:function(c){var d=c.find(".shell-content-container");d.css({width:c.width(),height:c.height()-28-40});c.trigger("shell:content:resize")},resizeIframe:function(c){var d=c.find("#shell-iframe");d.css({width:c.width(),height:c.height()-28-40});c.trigger("shell:iframe:resize")},showPage:function(c,d){if(nf.Common.isDefinedAndNotNull(nf.ContextMenu)){nf.ContextMenu.hide()}return $.Deferred(function(e){var f=$("#shell");if(nf.Common.isNull(d)||nf.Common.isUndefined(d)){d=true}f.empty();$("#shell-dialog").modal("setCloseHandler",function(){e.resolve()});$("#shell-dialog").modal("setOpenHandler",function(){nf.Common.toggleScrollable($("#"+this.find(".tab-container").attr("id")+"-content").get(0))});$("#shell-dialog").modal("show");if(d){$("#shell-undock-button").show()}else{$("#shell-undock-button").hide()}var g=$("<iframe/>",{id:"shell-iframe",frameBorder:"0",src:c}).css({width:f.width(),height:f.height()-28}).appendTo(f)}).promise()},showContent:function(c){if(nf.Common.isDefinedAndNotNull(nf.ContextMenu)){nf.ContextMenu.hide()}return $.Deferred(function(d){var h=$(c);if(h.length){var e=$("#shell");e.empty();var g=h.parent();h.detach();$("#shell-dialog").modal("setCloseHandler",function(){var k=$(".combo");for(var l=0,j=k.length;l<j;l++){if($(k[l]).is(":visible")){$(k[l]).combo("close")}}d.resolve();h.hide().detach().appendTo(g)});$("#shell-undock-button").hide();$("#shell-dialog").modal("show");var f=$("<div>").addClass("shell-content-container").css({width:e.width(),height:e.height()}).append(h).appendTo(e);h.show()}}).promise()}}}());
nf.Storage=(function(){var g=86400000;var f=g*2;var b=function(h){return typeof h==="undefined"};var e=function(h){return h===null};var d=function(h){return !b(h)&&!e(h)};var c=function(j){if(d(j.expires)){var h=new Date(j.expires);var i=new Date();return h.valueOf()<i.valueOf()}else{return false}};var a=function(h){try{var i=JSON.parse(localStorage.getItem(h));if(d(i)){return i}else{return null}}catch(j){return null}};return{init:function(){for(var j=0;j<localStorage.length;j++){try{var h=localStorage.key(j);nf.Storage.getItem(h)}catch(k){}}},setItem:function(i,k,h){h=d(h)?h:new Date().valueOf()+f;var j={expires:h,item:k};localStorage.setItem(i,JSON.stringify(j))},hasItem:function(h){return a(h)!==null},getItem:function(h){var i=a(h);if(i===null){return null}if(c(i)){nf.Storage.removeItem(h);return null}if(d(i.item)){return i.item}else{return null}},getItemExpiration:function(h){var i=a(h);if(i===null){return null}if(d(i.expires)){return i.expires}else{return null}},removeItem:function(h){localStorage.removeItem(h)}}}());
$(document).ready(function(a){a.ajaxSetup({beforeSend:function(d){var b=nf.Storage.hasItem("jwt");var c=nf.Storage.getItem("jwt");if(c!==null){d.setRequestHeader("Authorization","Bearer "+c)}else{if(b===true){return false}}}})});
nf.Snippet=(function(){var a={urls:{snippets:"../nifi-api/snippets",processGroups:"../nifi-api/process-groups"}};return{marshal:function(b){var c={parentGroupId:nf.Canvas.getGroupId(),processors:{},funnels:{},inputPorts:{},outputPorts:{},remoteProcessGroups:{},processGroups:{},connections:{},labels:{}};b.each(function(f){var e=d3.select(this);if(nf.CanvasUtils.isProcessor(e)){c.processors[f.id]=nf.Client.getRevision(e.datum())}else{if(nf.CanvasUtils.isFunnel(e)){c.funnels[f.id]=nf.Client.getRevision(e.datum())}else{if(nf.CanvasUtils.isLabel(e)){c.labels[f.id]=nf.Client.getRevision(e.datum())}else{if(nf.CanvasUtils.isInputPort(e)){c.inputPorts[f.id]=nf.Client.getRevision(e.datum())}else{if(nf.CanvasUtils.isOutputPort(e)){c.outputPorts[f.id]=nf.Client.getRevision(e.datum())}else{if(nf.CanvasUtils.isProcessGroup(e)){c.processGroups[f.id]=nf.Client.getRevision(e.datum())}else{if(nf.CanvasUtils.isRemoteProcessGroup(e)){c.remoteProcessGroups[f.id]=nf.Client.getRevision(e.datum())}else{if(nf.CanvasUtils.isConnection(e)){c.connections[f.id]=nf.Client.getRevision(e.datum())}}}}}}}}});return c},create:function(c){var b={snippet:c};return $.ajax({type:"POST",url:a.urls.snippets,data:JSON.stringify(b),dataType:"json",contentType:"application/json"})},copy:function(d,b){var c={snippetId:d,originX:b.x,originY:b.y};return $.ajax({type:"POST",url:a.urls.processGroups+"/"+encodeURIComponent(nf.Canvas.getGroupId())+"/snippet-instance",data:JSON.stringify(c),dataType:"json",contentType:"application/json"})},remove:function(b){return $.ajax({type:"DELETE",url:a.urls.snippets+"/"+encodeURIComponent(b)})},move:function(c,d){var b={snippet:{id:c,parentGroupId:d}};return $.ajax({type:"PUT",url:a.urls.snippets+"/"+encodeURIComponent(c),data:JSON.stringify(b),dataType:"json",contentType:"application/json"})}}}());
nf.CustomUi={showCustomUi:function(a,c,b){return $.Deferred(function(d){nf.Common.getAccessToken("../nifi-api/access/ui-extension-token").done(function(f){$("#shell-close-button");var e=nf.Client.getRevision(a);var g={id:a.id,revision:e.version,clientId:e.clientId,editable:b};if(!nf.Common.isBlank(f)){g.access_token=f}nf.Shell.showPage(".."+c+"?"+$.param(g),false).done(function(){d.resolve()})}).fail(function(){nf.Dialog.showOkDialog({headerText:"Advanced Configuration",dialogContent:"Unable to generate access token for accessing the advanced configuration dialog."});d.resolve()})}).promise()}};
nf.QueueListing=(function(){var b={urls:{uiExtensionToken:"../nifi-api/access/ui-extension-token",downloadToken:"../nifi-api/access/download-token"}};var f=function(){$("#listing-request-status-dialog").modal({scrollableContentStyle:"scrollable",headerText:"Queue Listing",handler:{close:function(){$("#listing-request-status-dialog").modal("setButtonModel",[])}}})};var a=function(){var g=$("#flowfile-uri").text()+"/content";nf.Common.getAccessToken(b.urls.downloadToken).done(function(i){var j={};if(!nf.Common.isBlank(i)){j.access_token=i}var h=$("#flowfile-cluster-node-id").text();if(!nf.Common.isBlank(h)){j.clusterNodeId=h}if($.isEmptyObject(j)){window.open(g)}else{window.open(g+"?"+$.param(j))}}).fail(function(){nf.Dialog.showOkDialog({headerText:"Queue Listing",dialogContent:"Unable to generate access token for downloading content."})})};var c=function(){var g=$("#flowfile-uri").text()+"/content";var h=$.Deferred(function(i){if(nf.Storage.hasItem("jwt")){var k=$.ajax({type:"POST",url:b.urls.uiExtensionToken});var j=$.ajax({type:"POST",url:b.urls.downloadToken});$.when(k,j).done(function(o,n){var m=o[0];var l=n[0];i.resolve(m,l)}).fail(function(){nf.Dialog.showOkDialog({headerText:"Queue Listing",dialogContent:"Unable to generate access token for viewing content."});i.reject()})}else{i.resolve("","")}}).promise();h.done(function(k,j){var m={};var i=$("#flowfile-cluster-node-id").text();if(!nf.Common.isBlank(i)){m.clusterNodeId=i}if(!nf.Common.isBlank(j)){m.access_token=j}if($.isEmptyObject(m)===false){g=g+"?"+$.param(m)}var l=$("#nifi-content-viewer-url").text();if(l.indexOf("?")===-1){l+="?"}else{l+="&"}var n={ref:g};if(!nf.Common.isBlank(k)){n.access_token=k}window.open(l+$.param(n))})};var d=function(h){var i=4;var k=false;var j=null;var g=null;return $.Deferred(function(m){var p=function(r){var s=$("#listing-request-percent-complete");s.find("div.progress-label").remove();s.find("md-progress-linear").remove();var q=$('<div class="progress-label"></div>').text(r+"%");(nf.ng.Bridge.injector.get("$compile")($('<md-progress-linear ng-cloak ng-value="'+r+'" class="md-hue-2" md-mode="determinate" aria-label="Searching Queue"></md-progress-linear>'))(nf.ng.Bridge.rootScope)).appendTo(s);s.append(q)};$("#listing-request-status-dialog").modal("setButtonModel",[{headerText:"Queue Listing",buttonText:"Stop",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){k=true;if(g!==null){clearTimeout(g);l()}}}}]);var l=function(){$("#listing-request-status-dialog").modal("hide");var s=k;if(nf.Common.isDefinedAndNotNull(j)){$.ajax({type:"DELETE",url:j.uri,dataType:"json"});if(nf.Common.isEmpty(j.flowFileSummaries)){if(k===false){s=true;nf.Dialog.showOkDialog({headerText:"Queue Listing",dialogContent:"The queue has no FlowFiles."})}}else{$("#total-flowfiles-count").text(nf.Common.formatInteger(j.queueSize.objectCount));$("#total-flowfiles-size").text(nf.Common.formatDataSize(j.queueSize.byteCount));$("#queue-listing-last-refreshed").text(j.lastUpdated);var r=$("#queue-listing-table");var u=$("#queue-listing-message");if(j.sourceRunning===true||j.destinationRunning===true){if(j.souceRunning===true&&j.destinationRunning===true){u.text("The source and destination of this queue are currently running. This listing may no longer be accurate.").show()}else{if(j.sourceRunning===true){u.text("The source of this queue is currently running. This listing may no longer be accurate.").show()}else{if(j.destinationRunning===true){u.text("The destination of this queue is currently running. This listing may no longer be accurate.").show()}}}}else{u.text("").hide()}var t=$("#queue-listing-table").data("gridInstance");var q=t.getData();q.beginUpdate();q.setItems(j.flowFileSummaries,"uuid");q.endUpdate()}}else{s=true}if(s){m.reject()}else{m.resolve()}};var o=function(q){p(j.percentCompleted);$("#listing-request-status-message").text(j.state);if(j.finished===true||k===true){l()}else{g=setTimeout(function(){g=null;n(Math.min(i,q*2))},q*1000)}};var n=function(q){$.ajax({type:"GET",url:j.uri,dataType:"json"}).done(function(r){j=r.listingRequest;o(q)}).fail(l).fail(nf.Common.handleAjaxError)};$.ajax({type:"POST",url:"../nifi-api/flowfile-queues/"+h.id+"/listing-requests",dataType:"json",contentType:"application/json"}).done(function(q){p(0);$("#listing-request-status-dialog").modal("show");j=q.listingRequest;o(1)}).fail(l).fail(nf.Common.handleAjaxError)}).promise()};var e=function(g){var h=function(k,l){$('<div class="flowfile-detail"></div>').append($('<div class="detail-name"></div>').text(k)).append($('<div class="detail-value">'+nf.Common.formatValue(l)+"</div>").ellipsis()).append($('<div class="clear"></div>')).appendTo("#additional-flowfile-details")};var i=function(k,l){if(nf.Common.isDefinedAndNotNull(l)){k.removeClass("unset").text(l)}else{k.addClass("unset").text("No value set")}};var j={};if(nf.Common.isDefinedAndNotNull(g.clusterNodeId)){j.clusterNodeId=g.clusterNodeId}$.ajax({type:"GET",url:g.uri,data:j,dataType:"json"}).done(function(k){var m=k.flowFile;$("#flowfile-uri").text(m.uri);$("#flowfile-uuid").html(nf.Common.formatValue(m.uuid));$("#flowfile-filename").html(nf.Common.formatValue(m.filename));$("#flowfile-queue-position").html(nf.Common.formatValue(m.position));$("#flowfile-file-size").html(nf.Common.formatValue(m.contentClaimFileSize));$("#flowfile-queued-duration").text(nf.Common.formatDuration(m.queuedDuration));$("#flowfile-lineage-duration").text(nf.Common.formatDuration(m.lineageDuration));$("#flowfile-penalized").text(m.penalized===true?"Yes":"No");if(nf.Common.isDefinedAndNotNull(g.clusterNodeId)){$("#flowfile-cluster-node-id").text(g.clusterNodeId);h("Node Address",g.clusterNodeAddress)}if(nf.Common.isDefinedAndNotNull(m.contentClaimContainer)){i($("#content-container"),m.contentClaimContainer);i($("#content-section"),m.contentClaimSection);i($("#content-identifier"),m.contentClaimIdentifier);i($("#content-offset"),m.contentClaimOffset);i($("#content-bytes"),m.contentClaimFileSizeBytes);var n=$("#content-size");i(n,m.contentClaimFileSize);if(nf.Common.isDefinedAndNotNull(m.contentClaimFileSize)){n.attr("title",nf.Common.formatInteger(m.contentClaimFileSizeBytes)+" bytes")}$("#flowfile-content-details").show()}else{$("#flowfile-content-details").hide()}var l=$("#flowfile-attributes-container");$.each(m.attributes,function(o,p){var q=$('<div class="attribute-detail"></div>').append($('<div class="attribute-name">'+nf.Common.formatValue(o)+"</div>").ellipsis()).appendTo(l);q.append($('<div class="attribute-value">'+nf.Common.formatValue(p)+"</div>").ellipsis()).append('<div class="clear"></div>')});$("#flowfile-details-dialog").modal("show")}).fail(nf.Common.handleAjaxError)};return{init:function(){f();$("#queue-listing-refresh-button").click(function(){var p=$("#queue-listing-table").data("connection");d(p)});var o=function(t,q,s,r,p){return'<div class="pointer show-flowfile-details fa fa-info-circle" title="View Details" style="margin-top: 5px; float: left;"></div>'};var i=function(t,q,s,r,p){return nf.Common.formatDataSize(s)};var g=function(t,q,s,r,p){return nf.Common.formatDuration(s)};var k=function(u,q,t,s,p){var r="";if(t===true){r+="Yes"}return r};var l=[{id:"moreDetails",field:"moreDetails",name:"&nbsp;",sortable:false,resizable:false,formatter:o,width:50,maxWidth:50},{id:"position",name:"Position",field:"position",sortable:false,resizable:false,width:75,maxWidth:75},{id:"uuid",name:"UUID",field:"uuid",sortable:false,resizable:true},{id:"filename",name:"Filename",field:"filename",sortable:false,resizable:true},{id:"size",name:"File Size",field:"size",sortable:false,resizable:true,defaultSortAsc:false,formatter:i},{id:"queuedDuration",name:"Queued Duration",field:"queuedDuration",sortable:false,resizable:true,formatter:g},{id:"lineageDuration",name:"Lineage Duration",field:"lineageDuration",sortable:false,resizable:true,formatter:g},{id:"penalized",name:"Penalized",field:"penalized",sortable:false,resizable:false,width:100,maxWidth:100,formatter:k}];if(nf.Canvas.isClustered()){l.push({id:"clusterNodeAddress",name:"Node",field:"clusterNodeAddress",sortable:false,resizable:true})}if(nf.Common.canAccessProvenance()){var n=function(){return'<div title="Provenance" class="pointer icon icon-provenance view-provenance"></div>'};l.push({id:"actions",name:"&nbsp;",resizable:false,formatter:n,sortable:false,width:50,maxWidth:50})}var j={forceFitColumns:true,enableTextSelectionOnCells:true,enableCellNavigation:false,enableColumnReorder:false,autoEdit:false,rowHeight:24};var h=new Slick.Data.DataView({inlineFilters:false});h.setItems([]);var m=new Slick.Grid("#queue-listing-table",h,l,j);m.setSelectionModel(new Slick.RowSelectionModel());m.registerPlugin(new Slick.AutoTooltips());m.onClick.subscribe(function(s,p){var r=$(s.target);var q=h.getItem(p.row);if(m.getColumns()[p.cell].id==="moreDetails"){if(r.hasClass("show-flowfile-details")){e(q)}}else{if(m.getColumns()[p.cell].id==="actions"){if(r.hasClass("view-provenance")){$("#shell-close-button").click();nf.Shell.showPage("provenance?"+$.param({flowFileUuid:q.uuid}))}}}});h.onRowCountChanged.subscribe(function(q,p){m.updateRowCount();m.render();$("#displayed-flowfiles").text(p.current)});h.onRowsChanged.subscribe(function(q,p){m.invalidateRows(p.rows);m.render()});$("#queue-listing-table").data("gridInstance",m);$("#displayed-flowfiles").text("0")},initFlowFileDetailsDialog:function(){$("#content-download").on("click",a);if(nf.Common.isContentViewConfigured()){$("#content-view").show();$("#content-view").on("click",c)}$("#flowfile-details-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",scrollableTabContentStyle:"scrollable",tabs:[{name:"Details",tabContentId:"flowfile-details-tab-content"},{name:"Attributes",tabContentId:"flowfile-attributes-tab-content"}]});$("#flowfile-details-dialog").modal({scrollableContentStyle:"scrollable",headerText:"FlowFile",buttons:[{buttonText:"Ok",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){$("#flowfile-details-dialog").modal("hide")}}}],handler:{close:function(){$("#flowfile-attributes-container").empty();$("#flowfile-cluster-node-id").text("");$("#additional-flowfile-details").empty()},open:function(){nf.Common.toggleScrollable($("#"+this.find(".tab-container").attr("id")+"-content").get(0))}}})},resetTableSize:function(){var g=$("#queue-listing-table").data("gridInstance");if(nf.Common.isDefinedAndNotNull(g)){g.resizeCanvas()}},listQueue:function(g){d(g).done(function(){var h="";if(g.permissions.canRead){h=nf.CanvasUtils.formatConnectionName(g.component)}if(h===""){h="Connection"}$("#queue-listing-header-text").text(h);nf.Shell.showContent("#queue-listing-container").done(function(){$("#queue-listing-table").removeData("connection");var j=$("#queue-listing-table").data("gridInstance");var i=j.getData();i.beginUpdate();i.setItems([],"uuid");i.endUpdate();$("#displayed-flowfiles, #total-flowfiles-count").text("0");$("#total-flowfiles-size").text(nf.Common.formatDataSize(0))});nf.QueueListing.resetTableSize();$("#queue-listing-table").data("connection",g)})}}}());
nf.ComponentState=(function(){var c=function(){var h=$("#component-state-table").data("gridInstance");if(nf.Common.isDefinedAndNotNull(h)){var i=h.getData();i.setFilterArgs({searchString:f()});i.refresh()}};var g=function(j,i){if(i.searchString===""){return true}try{var n=new RegExp(i.searchString,"i")}catch(k){return false}var m=j.key.search(n)>=0;var h=j.value.search(n)>=0;var l=false;if(nf.Common.isDefinedAndNotNull(j.scope)){l=j.scope.search(n)>=0}return m||h||l};var e=function(h,j){var i=function(m,k){var l=nf.Common.isDefinedAndNotNull(m[h.columnId])?m[h.columnId]:"";var n=nf.Common.isDefinedAndNotNull(k[h.columnId])?k[h.columnId]:"";return l===n?0:l>n?1:-1};j.sort(i,h.sortAsc)};var f=function(){return $("#component-state-filter").val()};var a=function(){var h=$("#component-state-table").data("gridInstance");var i=h.getData();i.setItems([]);$("#component-state-partial-results-container").hide();$("#displayed-component-state-entries").text("0");$("#total-component-state-entries").text("0")};var b=function(h,i){var j=0;var l=0;var m=false;var k=$("#component-state-table").data("gridInstance");var n=k.getData();n.beginUpdate();if(nf.Common.isDefinedAndNotNull(h)){$.each(h.state,function(o,p){n.addItem($.extend({id:j++,scope:p.clusterNodeAddress},p))});l+=h.totalEntryCount;if(nf.Common.isDefinedAndNotNull(h.state)&&h.totalEntryCount!==h.state.length){m=true}}if(nf.Common.isDefinedAndNotNull(i)){$.each(i.state,function(o,p){n.addItem($.extend({id:j++,scope:"Cluster"},p))});l+=i.totalEntryCount;if(nf.Common.isDefinedAndNotNull(i.state)&&i.totalEntryCount!==i.state.length){m=true}}n.endUpdate();n.reSort();if(m){$("#component-state-partial-results-container").show()}$("#total-component-state-entries").text(nf.Common.formatInteger(l))};var d=function(){$("#component-state-name").text("");$("#component-state-description").text("");$("#component-state-filter").val("");$("#clear-link").removeClass("disabled").attr("title","");a();$("#component-state-table").removeData("component")};return{init:function(){$("#component-state-filter").on("keyup",function(){c()});$("#component-state-dialog").modal({scrollableContentStyle:"scrollable",headerText:"Component State",buttons:[{buttonText:"Close",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){$(this).modal("hide")}}}],handler:{close:function(){d()}}});$("#clear-link").on("click",function(){if($(this).hasClass("disabled")===false){var m=$("#component-state-table");var o=m.data("gridInstance");var n=o.getDataLength();if(n>0){var l=m.data("component");$.ajax({type:"POST",url:l.uri+"/state/clear-requests",dataType:"json"}).done(function(p){a();b()}).fail(nf.Common.handleAjaxError)}else{nf.Dialog.showOkDialog({headerText:"Component State",dialogContent:"This component has no state to clear."})}}});var i=[{id:"key",field:"key",name:"Key",sortable:true,resizable:true},{id:"value",field:"value",name:"Value",sortable:true,resizable:true}];if(nf.Canvas.isClustered()){i.push({id:"scope",field:"scope",name:"Scope",sortable:true,resizable:true})}var h={forceFitColumns:true,enableTextSelectionOnCells:true,enableCellNavigation:false,enableColumnReorder:false,autoEdit:false,rowHeight:24};var k=new Slick.Data.DataView({inlineFilters:false});k.setItems([]);k.setFilterArgs({searchString:"",property:"key"});k.setFilter(g);e({columnId:"key",sortAsc:true},k);var j=new Slick.Grid("#component-state-table",k,i,h);j.setSelectionModel(new Slick.RowSelectionModel());j.registerPlugin(new Slick.AutoTooltips());j.setSortColumn("key",true);j.onSort.subscribe(function(m,l){e({columnId:l.sortCol.field,sortAsc:l.sortAsc},k)});k.onRowCountChanged.subscribe(function(m,l){j.updateRowCount();j.render();$("#displayed-component-state-entries").text(l.current)});k.onRowsChanged.subscribe(function(m,l){j.invalidateRows(l.rows);j.render()});$("#component-state-table").data("gridInstance",j);$("#displayed-component-state-entries").text("0");$("#total-component-state-entries").text("0")},showState:function(h,i){return $.ajax({type:"GET",url:h.uri+"/state",dataType:"json"}).done(function(k){var l=k.componentState;var j=$("#component-state-table");b(l.localState,l.clusterState);$("#component-state-name").text(h.component.name);$("#component-state-description").text(l.stateDescription).ellipsis();j.data("component",h);$("#component-state-dialog").modal("show");if(i===false){$("#clear-link").addClass("disabled").attr("title","Component state can only be cleared when the component is not actively running")}var m=j.data("gridInstance");m.resizeCanvas()}).fail(nf.Common.handleAjaxError)}}}());
nf.ControllerService=(function(){var B={edit:"edit",readOnly:"read-only",serviceOnly:"SERVICE_ONLY",serviceAndReferencingComponents:"SERVICE_AND_REFERENCING_COMPONENTS"};var p=function(N,K,L){if(N.status===400){var O=N.responseText.split("\n");var M;if(O.length===1){M=$("<span></span>").text(O[0])}else{M=nf.Common.formatUnorderedList(O)}nf.Dialog.showOkDialog({dialogContent:M,headerText:"Controller Service"})}else{nf.Common.handleAjaxError(N,K,L)}};var x=function(){var K=$("#controller-service-configuration").data("controllerServiceDetails");if($("#controller-service-name").val()!==K.component.name){return true}if($("#controller-service-comments").val()!==K.component.comments){return true}return $("#controller-service-properties").propertytable("isSaveRequired")};var j=function(){var L=$("#controller-service-properties").propertytable("marshalProperties");var M={};M.id=$("#controller-service-id").text();M.name=$("#controller-service-name").val();M.comments=$("#controller-service-comments").val();if($.isEmptyObject(L)===false){M.properties=L}var K={};K.component=M;return K};var b=function(K){return true};var I=function(N,O){var L=N.data("gridInstance");var M=L.getData();var K=M.getItemById(O);if(nf.Common.isUndefined(K)||K.permissions.canRead===false){return $.Deferred(function(P){P.reject()}).promise()}return $.ajax({type:"GET",url:K.uri,dataType:"json"}).done(function(P){D(N,P)}).fail(nf.Common.handleAjaxError)};var D=function(O,K){var L=O.data("gridInstance");var N=L.getData();var M=N.getItemById(K.id);N.updateItem(K.id,$.extend({bulletins:M.bulletins},K))};var e=function(L,K){I(L,K.id).done(function(M){d(L,M.component)})};var d=function(L,K){$.each(K.referencingComponents,function(N,P){if(P.permissions.canRead===false){return}var M=P.component;if(M.referenceType==="Processor"){if(nf.Canvas.getGroupId()===M.groupId){nf.Processor.reload(M.id)}$("div."+M.id+"-active-threads").text(M.activeThreadCount);var O=$("div."+M.id+"-state");if(O.length){h(O,M)}}else{if(M.referenceType==="ReportingTask"){nf.ReportingTask.reload(M.id);$("div."+M.id+"-active-threads").text(M.activeThreadCount);var O=$("div."+M.id+"-state");if(O.length){h(O,M)}}else{I(L,M.id);var O=$("div."+M.id+"-state");if(O.length){y(O,M)}if(M.referenceCycle===false){d(L,M)}}}});nf.ControllerService.reloadReferencedServices(L,K)};var H=function(K){var L=K.get(0).scrollHeight>K.innerHeight()||K.get(0).scrollWidth>K.innerWidth();if(K.is(":visible")&&L){K.css("border-width","1px")}else{K.css("border-width","0px")}};var g=function(N,L){var O=L.data("bulletins");if(nf.Common.doBulletinsDiffer(O,N)){L.data("bulletins",N);var K=nf.Common.getFormattedBulletins(N);if(N.length>0){var M=nf.Common.formatUnorderedList(K);if(L.data("qtip")){L.qtip("option","content.text",M)}else{L.addClass("has-bulletins").show().qtip($.extend({},nf.CanvasUtils.config.systemTooltipConfig,{content:M}))}}else{if(L.data("qtip")){L.removeClass("has-bulletins").removeData("bulletins").hide().qtip("api").destroy(true)}}}};var h=function(K,L){K.removeClass("disabled stopped running invalid").addClass(function(){var M=$(this);var O=L.state.toLowerCase();if(O==="stopped"&&!nf.Common.isEmpty(L.validationErrors)){O="invalid";var N=nf.Common.formatUnorderedList(L.validationErrors);if(M.data("qtip")){M.qtip("option","content.text",N)}else{M.qtip($.extend({},nf.CanvasUtils.config.systemTooltipConfig,{content:N}))}}else{if(M.data("qtip")){M.qtip("api").destroy(true)}}return O})};var y=function(L,K){L.removeClass("disabled enabled invalid").addClass(function(){var M=$(this);var O=K.state==="ENABLED"?"enabled":"disabled";if(O==="disabled"&&!nf.Common.isEmpty(K.validationErrors)){O="invalid";var N=nf.Common.formatUnorderedList(K.validationErrors);if(M.data("qtip")){M.qtip("option","content.text",N)}else{M.qtip($.extend({},nf.CanvasUtils.config.systemTooltipConfig,{content:N}))}}else{if(M.data("qtip")){M.qtip("api").destroy(true)}}return O})};var i=function(L){var K=d3.nest().key(function(M){return M.sourceId}).map(L,d3.map);K.forEach(function(N,M){$("div."+N+"-bulletins").each(function(){g(M,$(this))})})};var z=function(S,T,N){if(nf.Common.isEmpty(N)){T.append('<div class="unset">No referencing components.</div>');return}var L=function(V,U){if(V.hasClass("expanded")){V.removeClass("expanded").addClass("collapsed");U.hide()}else{V.removeClass("collapsed").addClass("expanded");U.show()}};var M=[];var O=$('<ul class="referencing-component-listing clear"></ul>');var R=$('<ul class="referencing-component-listing clear"></ul>');var K=$('<ul class="referencing-component-listing clear"></ul>');var P=$('<ul class="referencing-component-listing clear"></ul>');$.each(N,function(aq,aa){if(aa.permissions.canRead===false||aa.permissions.canWrite===false){var X=$('<div class="unset"></div>').text(aa.id);P.append(X)}else{var aj=aa.component;M.push(aj.id);if(aj.referenceType==="Processor"){var ap=$('<span class="referencing-component-name link"></span>').text(aj.name).on("click",function(){nf.CanvasUtils.showComponent(aj.groupId,aj.id);T.closest(".dialog").modal("hide");$("#shell-close-button").click()});var af=$('<div class="referencing-component-state"></div>').addClass(aj.id+"-state");h(af,aj);var ah=$('<div class="referencing-component-bulletins"></div>').addClass(aj.id+"-bulletins");var ak=$('<span class="referencing-component-type"></span>').text(nf.Common.substringAfterLast(aj.type,"."));var W=$('<span class="referencing-component-active-thread-count"></span>').addClass(aj.id+"-active-threads");if(nf.Common.isDefinedAndNotNull(aj.activeThreadCount)&&aj.activeThreadCount>0){W.text("("+aj.activeThreadCount+")")}var ac=$("<li></li>").append(af).append(ah).append(ap).append(ak).append(W);O.append(ac)}else{if(aj.referenceType==="ControllerService"){var am=$('<span class="referencing-component-name link"></span>').text(aj.name).on("click",function(){var ar=S.data("gridInstance");var at=ar.getData();var au=at.getRowById(aj.id);ar.setSelectedRows([au]);ar.scrollRowIntoView(au);T.closest(".dialog").modal("hide")});var an=$('<div class="referencing-component-references hidden"></div>');var Z=$('<div class="service expansion-button collapsed pointer"></div>').on("click",function(){if(Z.hasClass("collapsed")){var at=S.data("gridInstance");var av=at.getData();var ar=av.getItemById(aj.id);var au=ar.component;z(S,an,au.referencingComponents)}else{an.empty()}L(Z,an);H(T)});var ad=$('<div class="referencing-component-state"></div>').addClass(aj.id+"-state");y(ad,aj);var ao=$('<div class="referencing-component-bulletins"></div>').addClass(aj.id+"-bulletins");var ai=$('<span class="referencing-component-type"></span>').text(nf.Common.substringAfterLast(aj.type,"."));var ab=$("<li></li>").append(Z).append(ad).append(ao).append(am).append(ai).append(an);R.append(ab)}else{if(aj.referenceType==="ReportingTask"){var Y=$('<span class="referencing-component-name link"></span>').text(aj.name).on("click",function(){var au=$("#reporting-tasks-table").data("gridInstance");var ar=au.getData();var at=ar.getRowById(aj.id);au.setSelectedRows([at]);au.scrollRowIntoView(at);$("#settings-tabs").find("li:last").click();T.closest(".dialog").modal("hide")});var ag=$('<div class="referencing-component-state"></div>').addClass(aj.id+"-state");h(ag,aj);var U=$('<div class="referencing-component-bulletins"></div>').addClass(aj.id+"-bulletins");var V=$('<span class="referencing-component-type"></span>').text(nf.Common.substringAfterLast(aj.type,"."));var ae=$('<span class="referencing-component-active-thread-count"></span>').addClass(aj.id+"-active-threads");if(nf.Common.isDefinedAndNotNull(aj.activeThreadCount)&&aj.activeThreadCount>0){ae.text("("+aj.activeThreadCount+")")}var al=$("<li></li>").append(ag).append(U).append(Y).append(V).append(ae);K.append(al)}}}}});E(M).done(function(U){var V=U.bulletinBoard.bulletins;i(V)});var Q=function(U,W){if(W.is(":empty")){W.remove();return}var Y=$('<div class="expansion-button expanded"></div>');var X=$('<span class="referencing-component-title"></span>').text(U);var V=$('<span class="referencing-component-count"></span>').text("("+W.children().length+")");$('<div class="referencing-component-block pointer unselectable"></div>').on("click",function(){L(Y,W);H(T)}).append(Y).append(X).append(V).appendTo(T);W.appendTo(T)};Q("Processors",O);Q("Reporting Tasks",K);Q("Controller Services",R);Q("Unauthorized",P)};var E=function(L){var K=L.join("|");return $.ajax({type:"GET",url:"../nifi-api/flow/bulletin-board",data:{sourceId:K},dataType:"json"}).fail(nf.Common.handleAjaxError)};var c=function(P,L,N,O){var K={revision:nf.Client.getRevision(L),component:{id:L.id,state:N?"ENABLED":"DISABLED"}};var M=$.ajax({type:"PUT",url:L.uri,data:JSON.stringify(K),dataType:"json",contentType:"application/json"}).done(function(Q){D(P,Q)}).fail(nf.Common.handleAjaxError);return $.Deferred(function(Q){M.done(function(){var R=n(L,function(S,T){if($.isArray(T)){if(N){g(T,$("#enable-controller-service-bulletins"))}else{g(T,$("#disable-controller-service-bulletins"))}}if(N){return S.state==="ENABLING"||S.state==="ENABLED"}else{return S.state==="DISABLED"}},function(S){return E([S.id])},O);R.done(function(){Q.resolve()}).fail(function(){Q.reject()})}).fail(function(){Q.reject()})}).promise()};var l=function(K){var L=d3.set();L.add(K.id);var M=function(N){$.each(N,function(O,Q){var P=Q.component;if(P.referenceType==="ControllerService"){L.add(P.id);if(P.referenceCycle===false){M(P.referencingComponents)}}})};M(K.referencingComponents);return L};var a=function(L,K,M){$.each(L,function(N,P){var O=P.component;if(M){if(O.referenceType==="ControllerService"){K[P.id]=nf.Client.getRevision(P)}}else{if(O.referenceType!=="ControllerService"){K[P.id]=nf.Client.getRevision(P)}}a(O.referencingComponents,K,M)})};var v=function(P,K,M,O){var Q={};a(K.component.referencingComponents,Q,false);var N={id:K.id,state:M?"RUNNING":"STOPPED",referencingComponentRevisions:Q};var L=$.ajax({type:"PUT",url:K.uri+"/references",data:JSON.stringify(N),dataType:"json",contentType:"application/json"}).fail(nf.Common.handleAjaxError);return $.Deferred(function(R){L.done(function(S){K.component.referencingComponents=S.controllerServiceReferencingComponents;if(M){R.resolve()}else{var T=l(K.component);var U=P.data("gridInstance");var W=U.getData();var V=[];T.forEach(function(X){var Y=W.getItemById(X);V.push(q(Y,O))});$.when.apply(window,V).done(function(){R.resolve()}).fail(function(){R.reject()})}}).fail(function(){R.reject()})}).promise()};var n=function(K,N,M,O){var L=K.component;return $.Deferred(function(P){var S=2;var R=function(){var U=S;S=Math.min(S*2,4);return U*1000};var T=function(){var V=M(L);var U=$.ajax({type:"GET",url:K.uri,dataType:"json"});$.when(V,U).done(function(Z,Y){var X=Z[0];var W=Y[0];Q(W.component,X.bulletinBoard.bulletins)}).fail(function(Y,W,X){P.reject();nf.Common.handleAjaxError(Y,W,X)})};var Q=function(U,V){if(N(U,V)){P.resolve()}else{if(typeof O==="function"&&O()){setTimeout(T,R())}else{P.reject()}}};M(L).done(function(U){Q(L,U.bulletinBoard.bulletins)}).fail(function(W,U,V){P.reject();nf.Common.handleAjaxError(W,U,V)})}).promise()};var q=function(K,L){return n(K,function(M,P){var N=M.referencingComponents;var O=false;$.each(N,function(Q,T){var S=T.component;if(S.referenceType==="Processor"||S.referenceType==="ReportingTask"){if(S.state==="RUNNING"||S.activeThreadCount>0){O=true}$("div."+S.id+"-active-threads").text(S.activeThreadCount);var R=$("div."+S.id+"-state");h(R,S)}});i(P);return O===false},function(M){var O=[];var N=M.referencingComponents;$.each(N,function(P,R){var Q=R.component;if(Q.referenceType==="Processor"||Q.referenceType==="ReportingTask"){O.push(Q.id)}});return E(O)},L)};var J=function(K,L){return n(K,function(M,P){var N=M.referencingComponents;var O=false;$.each(N,function(Q,T){var R=T.component;if(R.referenceType==="ControllerService"){if(R.state!=="ENABLING"&&R.state!=="ENABLED"){O=true}var S=$("div."+R.id+"-state");y(S,R)}});i(P);return O===false},function(M){var O=[];var N=M.referencingComponents;$.each(N,function(P,R){var Q=R.component;if(Q.referenceType==="ControllerService"){O.push(Q.id)}});return E(O)},L)};var A=function(K,L){return n(K,function(M,O){var N=M.referencingComponents;var P=false;$.each(N,function(Q,T){var R=T.component;if(R.referenceType==="ControllerService"){if(R.state!=="DISABLED"){P=true}var S=$("div."+R.id+"-state");y(S,R)}});i(O);return P===false},function(M){var O=[];var N=M.referencingComponents;$.each(N,function(P,R){var Q=R.component;if(Q.referenceType==="ControllerService"){O.push(Q.id)}});return E(O)},L)};var m=function(P,K,M,O){var Q={};a(K.component.referencingComponents,Q,true);var N={id:K.id,state:M?"ENABLED":"DISABLED",referencingComponentRevisions:Q};var L=$.ajax({type:"PUT",url:K.uri+"/references",data:JSON.stringify(N),dataType:"json",contentType:"application/json"}).fail(nf.Common.handleAjaxError);return $.Deferred(function(R){L.done(function(S){K.component.referencingComponents=S.controllerServiceReferencingComponents;var T=l(K.component);var U=P.data("gridInstance");var W=U.getData();var V=[];T.forEach(function(X){var Y=W.getItemById(X);if(M){V.push(J(Y,O))}else{V.push(A(Y,O))}});$.when.apply(window,V).done(function(){R.resolve()}).fail(function(){R.reject()})}).fail(function(){R.reject()})}).promise()};var s=function(N,L){$("#disable-controller-service-id").text(L.id);$("#disable-controller-service-name").text(L.name);var K=$("#disable-controller-service-referencing-components");z(N,K,L.referencingComponents);var M=[{buttonText:"Disable",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){w(N)}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:G}}];$("#disable-controller-service-dialog").modal("setButtonModel",M).modal("show");E([L.id]).done(function(O){g(O.bulletinBoard.bulletins,$("#disable-controller-service-bulletins"))});H(K)};var u=function(N,L){$("#enable-controller-service-id").text(L.id);$("#enable-controller-service-name").text(L.name);var K=$("#enable-controller-service-referencing-components");z(N,K,L.referencingComponents);var M=[{buttonText:"Enable",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){f(N)}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:G}}];$("#enable-controller-service-dialog").modal("setButtonModel",M).modal("show");E([L.id]).done(function(O){g(O.bulletinBoard.bulletins,$("#enable-controller-service-bulletins"))});H(K)};var G=function(){$(this).modal("hide")};var w=function(T){var N=$("#disable-controller-service-dialog");var M=false;N.modal("setButtonModel",[{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){M=true;N.modal("setButtonModel",[]);$("#disable-controller-service-dialog div.controller-service-canceling").show()}}}]);$("#disable-controller-service-scope-container").hide();$("#disable-controller-service-progress-container").show();var S=$("#disable-controller-service-id").text();var K=T.data("gridInstance");var O=K.getData();var L=O.getItemById(S);var P=L.component;var U=function(){return M===false};var R=function(){$("#disable-controller-service-dialog div.controller-service-canceling").hide();N.modal("setButtonModel",[{buttonText:"Close",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:G}}])};if(t(P.referencingComponents)){R();nf.Dialog.showOkDialog({headerText:"Controller Service",dialogContent:"Unable to disable due to unauthorized referencing components."});return}$("#disable-progress-label").text("Steps to disable "+P.name);var Q=$("#disable-referencing-schedulable").addClass("ajax-loading");$.Deferred(function(V){var W=v(T,L,false,U);W.done(function(){Q.removeClass("ajax-loading").addClass("ajax-complete");var X=$("#disable-referencing-services").addClass("ajax-loading");var Y=m(T,L,false,U);Y.done(function(){X.removeClass("ajax-loading").addClass("ajax-complete");var Z=$("#disable-controller-service").addClass("ajax-loading");c(T,L,false,U).done(function(){V.resolve();Z.removeClass("ajax-loading").addClass("ajax-complete")}).fail(function(){V.reject();Z.removeClass("ajax-loading").addClass("ajax-error")})}).fail(function(){V.reject();X.removeClass("ajax-loading").addClass("ajax-error")})}).fail(function(){V.reject();Q.removeClass("ajax-loading").addClass("ajax-error")})}).always(function(){e(T,P);R();if(M===true&&$("#nf-ok-dialog").not(":visible")){nf.Dialog.showOkDialog({headerText:"Controller Service",dialogContent:"The request to disable has been canceled. Parts of this request may have already completed. Please verify the state of this service and all referencing components."})}})};var t=function(K){var L=false;$.each(K,function(M,O){if(O.permissions.canRead===false||O.permissions.canWrite===false){L=true;return false}var N=O.component;if(t(N.referencingComponents)){L=true;return false}});return L};var f=function(T){var K=$("#enable-controller-service-dialog");var N=false;var S=$("#enable-controller-service-id").text();var L=T.data("gridInstance");var O=L.getData();var M=O.getItemById(S);var P=M.component;var V=$("#enable-controller-service-scope").combo("getSelectedOption").value;if(V===B.serviceOnly){$("#enable-controller-service-progress li.referencing-component").hide()}K.modal("setButtonModel",[{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){N=true;K.modal("setButtonModel",[]);$("#enable-controller-service-dialog div.controller-service-canceling").show()}}}]);$("#enable-controller-service-scope-container").hide();$("#enable-controller-service-progress-container").show();var U=function(){return N===false};var R=function(){$("#enable-controller-service-dialog div.controller-service-canceling").hide();K.modal("setButtonModel",[{buttonText:"Close",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:G}}])};if(V===B.serviceAndReferencingComponents&&t(P.referencingComponents)){R();nf.Dialog.showOkDialog({headerText:"Controller Service",dialogContent:"Unable to enable due to unauthorized referencing components."});return}$("#enable-progress-label").text("Steps to enable "+P.name);var Q=$("#enable-controller-service").addClass("ajax-loading");$.Deferred(function(W){var X=c(T,M,true,U);if(V===B.serviceAndReferencingComponents){X.done(function(){Q.removeClass("ajax-loading").addClass("ajax-complete");var Y=$("#enable-referencing-services").addClass("ajax-loading");var Z=m(T,M,true,U);Z.done(function(){Y.removeClass("ajax-loading").addClass("ajax-complete");var aa=$("#enable-referencing-schedulable").addClass("ajax-loading");v(T,M,true,U).done(function(){W.resolve();aa.removeClass("ajax-loading").addClass("ajax-complete")}).fail(function(){W.reject();aa.removeClass("ajax-loading").addClass("ajax-error")})}).fail(function(){W.reject();Y.removeClass("ajax-loading").addClass("ajax-error")})}).fail(function(){W.reject();Q.removeClass("ajax-loading").addClass("ajax-error")})}else{X.done(function(){W.resolve();Q.removeClass("ajax-loading").addClass("ajax-complete")}).fail(function(){W.reject();Q.removeClass("ajax-loading").addClass("ajax-error")})}}).always(function(){e(T,P);R();if(N===true&&$("#nf-ok-dialog").not(":visible")){nf.Dialog.showOkDialog({headerText:"Controller Service",dialogContent:"The request to enable has been canceled. Parts of this request may have already completed. Please verify the state of this service and all referencing components."})}})};var C=function(L){var K=$("#controller-service-configuration").data("controllerServiceDetails");return $.ajax({type:"GET",url:K.uri+"/descriptors",data:{propertyName:L},dataType:"json"}).fail(nf.Common.handleAjaxError)};var F=function(K){return $.Deferred(function(L){$("#controller-service-properties").propertytable("saveRow");if(x()){nf.Dialog.showYesNoDialog({headerText:"Save",dialogContent:"Save changes before going to this Controller Service?",noHandler:function(){L.resolve()},yesHandler:function(){var M=$("#controller-service-configuration").data("controllerServiceDetails");r(K,M).done(function(){L.resolve()}).fail(function(){L.reject()})}})}else{L.resolve()}}).promise()};var r=function(M,K){var N=j();if(b(N)){N.revision=nf.Client.getRevision(K);var L=[];$.each(k(K.component),function(P,R){var O=!nf.Common.isUndefined(N.component.properties)&&!nf.Common.isUndefined(N.component.properties[R.name]);var Q=nf.Common.isDefinedAndNotNull(K.component.properties[R.name]);if(O&&Q){L.push(K.component.properties[R.name])}});return $.ajax({type:"PUT",data:JSON.stringify(N),url:K.uri,dataType:"json",contentType:"application/json"}).done(function(O){D(M,O);$.each(L,function(P,Q){I(M,Q)})}).fail(p)}else{return $.Deferred(function(O){O.reject()}).promise()}};var k=function(L){var K=[];$.each(L.descriptors,function(M,N){if(nf.Common.isDefinedAndNotNull(N.identifiesControllerService)){K.push(N)}});return K};var o=function(L){var K=[];$.each(k(L),function(M,N){var O=L.properties[N.name];if(nf.Common.isDefinedAndNotNull(O)&&$.trim(O).length>0){K.push(O)}});return K};return{init:function(){$("#controller-service-configuration-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",scrollableTabContentStyle:"scrollable",tabs:[{name:"Settings",tabContentId:"controller-service-standard-settings-tab-content"},{name:"Properties",tabContentId:"controller-service-properties-tab-content"},{name:"Comments",tabContentId:"controller-service-comments-tab-content"}],select:function(){nf.UniversalCapture.removeAllPropertyDetailDialogs();if($(this).text()==="Properties"){$("#controller-service-properties").propertytable("resetTableSize")}$("#controller-service-properties").propertytable("saveRow");var K=$("#controller-service-referencing-components");H(K)}});$("#controller-service-configuration").modal({headerText:"Configure Controller Service",scrollableContentStyle:"scrollable",handler:{close:function(){var K=$("#controller-service-referencing-components");nf.Common.cleanUpTooltips(K,"div.referencing-component-state");nf.Common.cleanUpTooltips(K,"div.referencing-component-bulletins");K.css("border-width","0").empty();$("#controller-service-properties").propertytable("cancelEdit");$("#controller-service-properties").propertytable("clear");nf.Common.clearField("read-only-controller-service-comments");$("#controller-service-configuration").removeData("controllerServiceDetails")},open:function(){nf.Common.toggleScrollable($("#"+this.find(".tab-container").attr("id")+"-content").get(0))}}});$("#disable-controller-service-dialog").modal({headerText:"Disable Controller Service",scrollableContentStyle:"scrollable",handler:{close:function(){var L=$(this);$("#disable-controller-service-scope-container").show();$("#disable-controller-service-progress-container").hide();$("#disable-controller-service-id").text("");$("#disable-controller-service-name").text("");$("#disable-controller-service-bulletins").removeClass("has-bulletins").removeData("bulletins").hide();nf.Common.cleanUpTooltips($("#disable-controller-service-service-container"),"#disable-controller-service-bulletins");$("div.disable-referencing-components").removeClass("ajax-loading ajax-complete ajax-error");var K=$("#disable-controller-service-referencing-components");nf.Common.cleanUpTooltips(K,"div.referencing-component-state");nf.Common.cleanUpTooltips(K,"div.referencing-component-bulletins");K.css("border-width","0").empty()}}});$("#enable-controller-service-scope").combo({options:[{text:"Service only",value:B.serviceOnly,description:"Enable only this controller service"},{text:"Service and referencing components",value:B.serviceAndReferencingComponents,description:"Enable this controller service and enable/start all referencing components"}]});$("#enable-controller-service-dialog").modal({headerText:"Enable Controller Service",scrollableContentStyle:"scrollable",handler:{close:function(){var L=$(this);$("#enable-controller-service-scope-container").show();$("#enable-controller-service-progress-container").hide();$("#enable-controller-service-progress li.referencing-component").show();$("#enable-controller-service-id").text("");$("#enable-controller-service-name").text("");$("#enable-controller-service-bulletins").removeClass("has-bulletins").removeData("bulletins").hide();nf.Common.cleanUpTooltips($("#enable-controller-service-service-container"),"#enable-controller-service-bulletins");$("div.enable-referencing-components").removeClass("ajax-loading ajax-complete ajax-error");var K=$("#enable-controller-service-referencing-components");nf.Common.cleanUpTooltips(K,"div.referencing-component-state");nf.Common.cleanUpTooltips(K,"div.referencing-component-bulletins");K.css("border-width","0").empty()}}})},showConfiguration:function(N,L){var M=$("#controller-service-configuration");if(M.data("mode")!==B.edit){$("#controller-service-configuration .controller-service-read-only").hide();$("#controller-service-configuration .controller-service-editable").show();$("#controller-service-properties").propertytable("destroy").propertytable({readOnly:false,dialogContainer:"#new-controller-service-property-container",descriptorDeferred:C,goToServiceDeferred:function(){return F(N)}});M.data("mode",B.edit)}var O=$.ajax({type:"GET",url:L.uri,dataType:"json"});var K=$.ajax({type:"GET",url:"../nifi-api/flow/history/components/"+encodeURIComponent(L.id),dataType:"json"});$.when(O,K).done(function(S,R){L=S[0];var P=L.component;var T=R[0].componentHistory;M.data("controllerServiceDetails",L);nf.Common.populateField("controller-service-id",P.id);nf.Common.populateField("controller-service-type",nf.Common.substringAfterLast(P.type,"."));$("#controller-service-name").val(P.name);$("#controller-service-comments").val(P.comments);var Q=$("#controller-service-referencing-components");z(N,Q,P.referencingComponents);var U=[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){$("#controller-service-properties").propertytable("saveRow");r(N,L).done(function(V){d(N,V.component);M.modal("hide")})}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){M.modal("hide")}}}];if(nf.Common.isDefinedAndNotNull(P.customUiUrl)&&P.customUiUrl!==""){U.push({buttonText:"Advanced",clazz:"fa fa-cog button-icon",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){var V=function(){M.modal("hide");$("#shell-close-button").click();nf.CustomUi.showCustomUi(L,P.customUiUrl,true).done(function(){e(N,P);nf.Settings.showSettings()})};$("#controller-service-properties").propertytable("saveRow");if(x()){nf.Dialog.showYesNoDialog({headerText:"Save",dialogContent:"Save changes before opening the advanced configuration?",noHandler:V,yesHandler:function(){r(N,L).done(function(){V()})}})}else{V()}}}})}M.modal("setButtonModel",U);$("#controller-service-properties").propertytable("setGroupId",P.parentGroupId).propertytable("loadProperties",P.properties,P.descriptors,T.propertyHistory);M.modal("show");H(Q);$("#controller-service-properties").propertytable("resetTableSize")}).fail(nf.Common.handleAjaxError)},showDetails:function(N,L){var M=$("#controller-service-configuration");if(M.data("mode")!==B.readOnly){$("#controller-service-configuration .controller-service-read-only").show();$("#controller-service-configuration .controller-service-editable").hide();$("#controller-service-properties").propertytable("destroy").propertytable({readOnly:true});M.data("mode",B.readOnly)}var O=$.ajax({type:"GET",url:L.uri,dataType:"json"});var K=$.ajax({type:"GET",url:"../nifi-api/flow/history/components/"+encodeURIComponent(L.id),dataType:"json"});$.when(O,K).done(function(S,R){L=S[0];var P=L.component;var T=R[0].componentHistory;M.data("controllerServiceDetails",L);nf.Common.populateField("controller-service-id",P.id);nf.Common.populateField("controller-service-type",nf.Common.substringAfterLast(P.type,"."));nf.Common.populateField("read-only-controller-service-name",P.name);nf.Common.populateField("read-only-controller-service-comments",P.comments);var Q=$("#controller-service-referencing-components");z(N,Q,P.referencingComponents);var U=[{buttonText:"Ok",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){M.modal("hide")}}}];if(nf.Common.isDefinedAndNotNull(nf.CustomUi)&&nf.Common.isDefinedAndNotNull(P.customUiUrl)&&P.customUiUrl!==""){U.push({buttonText:"Advanced",clazz:"fa fa-cog button-icon",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){M.modal("hide");$("#shell-close-button").click();nf.CustomUi.showCustomUi(L,P.customUiUrl,false).done(function(){nf.Settings.showSettings()})}}})}M.modal("setButtonModel",U);$("#controller-service-properties").propertytable("loadProperties",P.properties,P.descriptors,T.propertyHistory);M.modal("show");H(Q);$("#controller-service-properties").propertytable("resetTableSize")})},enable:function(L,K){u(L,K.component)},disable:function(L,K){s(L,K.component)},reloadReferencedServices:function(L,K){$.each(o(K),function(M,N){I(L,N)})},remove:function(M,K){var L=nf.Client.getRevision(K);$.ajax({type:"DELETE",url:K.uri+"?"+$.param({version:L.version,clientId:L.clientId}),dataType:"json"}).done(function(N){var O=M.data("gridInstance");var P=O.getData();P.deleteItem(K.id);if(K.permissions.canRead){d(M,K.component)}}).fail(nf.Common.handleAjaxError)}}}());
nf.ControllerServices=(function(){var n=null;var c=false;var s={urls:{api:"../nifi-api",controllerServiceTypes:"../nifi-api/flow/controller-service-types"}};var k={forceFitColumns:true,enableTextSelectionOnCells:true,enableCellNavigation:true,enableColumnReorder:false,autoEdit:false,multiSelect:false,rowHeight:24};var m=function(){return $("#controller-service-type-filter").val()};var a=function(){var u=$("#controller-service-types-table").data("gridInstance");if(nf.Common.isDefinedAndNotNull(u)){var v=u.getData();v.setFilterArgs({searchString:m()});v.refresh();if(v.getLength()>0){u.setSelectedRows([0])}}};var i=function(){$("#controller-service-type-description").text("");$("#controller-service-type-name").text("");$("#selected-controller-service-name").text("");$("#selected-controller-service-type").text("");$("#controller-service-description-container").hide()};var h=function(){i();var u=$("#controller-service-types-table").data("gridInstance");u.resetActiveCell()};var d=function(z,w){var v=t(z,w);var u=true;if(v){var x=$("#controller-service-tag-cloud").tagcloud("getSelectedTags");var y=x.length>0;if(y){u=g(x,z.tags)}}var A=v&&u;if(A===false&&$("#selected-controller-service-type").text()===z.type){h()}return A};var t=function(w,v){if(v.searchString===""){return true}try{var z=new RegExp(v.searchString,"i")}catch(y){return false}var x=w.label.search(z)>=0;var u=w.tags.search(z)>=0;return x||u};var g=function(w,u){var v=[];$.each(w,function(z,A){v.push(A)});var x=u.toLowerCase();var y=true;$.each(v,function(z,A){if(x.indexOf(A)===-1){y=false;return false}});return y};var l=function(u,w){var v=$("#selected-controller-service-type").text();if(v===""){nf.Dialog.showOkDialog({headerText:"Controller Service",dialogContent:"The type of controller service to create must be selected."})}else{b(u,w,v)}};var b=function(v,y,x){var u={revision:nf.Client.getRevision({revision:{version:0}}),component:{type:x}};var w=$.ajax({type:"POST",url:v,data:JSON.stringify(u),dataType:"json",contentType:"application/json"}).done(function(z){var A=y.data("gridInstance");var C=A.getData();C.addItem(z);C.reSort();A.invalidate();var B=C.getRowById(z.id);A.setSelectedRows([B]);A.scrollRowIntoView(B)}).fail(nf.Common.handleAjaxError);$("#new-controller-service-dialog").modal("hide");return w};var j=function(){var w=[{id:"type",name:"Type",field:"label",sortable:false,resizable:true},{id:"tags",name:"Tags",field:"tags",sortable:false,resizable:true}];var v=new Slick.Data.DataView({inlineFilters:false});v.setItems([]);v.setFilterArgs({searchString:m()});v.setFilter(d);var u=new Slick.Grid("#controller-service-types-table",v,w,k);u.setSelectionModel(new Slick.RowSelectionModel());u.registerPlugin(new Slick.AutoTooltips());u.setSortColumn("type",true);u.onSelectedRowsChanged.subscribe(function(A,y){if($.isArray(y.rows)&&y.rows.length===1){var x=y.rows[0];var z=u.getDataItem(x);if(nf.Common.isDefinedAndNotNull(z)){if(nf.Common.isBlank(z.description)){$("#controller-service-type-description").attr("title","").html('<span class="unset">No description specified</span>')}else{$("#controller-service-type-description").html(z.description).ellipsis()}$("#controller-service-type-name").text(z.label).ellipsis();$("#selected-controller-service-name").text(z.label);$("#selected-controller-service-type").text(z.type);$("#controller-service-description-container").show()}}});v.onRowCountChanged.subscribe(function(y,x){u.updateRowCount();u.render();$("#displayed-controller-service-types").text(x.current)});v.onRowsChanged.subscribe(function(y,x){u.invalidateRows(x.rows);u.render()});v.syncGridSelection(u,true);$("#controller-service-types-table").data("gridInstance",u);$.ajax({type:"GET",url:s.urls.controllerServiceTypes,dataType:"json"}).done(function(x){var z=0;var y=[];v.beginUpdate();$.each(x.controllerServiceTypes,function(A,B){v.addItem({id:z++,label:nf.Common.substringAfterLast(B.type,"."),type:B.type,description:nf.Common.escapeHtml(B.description),tags:B.tags.join(", ")});$.each(B.tags,function(D,C){y.push(C.toLowerCase())})});v.endUpdate();$("#total-controller-service-types, #displayed-controller-service-types").text(x.controllerServiceTypes.length);$("#controller-service-tag-cloud").tagcloud({tags:y,select:a,remove:a})}).fail(nf.Common.handleAjaxError);$("#new-controller-service-dialog").modal({headerText:"Add Controller Service",scrollableContentStyle:"scrollable",handler:{close:function(){i();$("#controller-service-type-filter").val("");$("#controller-service-tag-cloud").tagcloud("clearSelectedTags");a();var x=$("#controller-service-types-table").data("gridInstance");x.setSelectedRows([]);x.resetActiveCell()}}})};var p=function(y,v,x,w,u){if(!u.permissions.canRead){return'<span class="blank">'+u.id+"</span>"}return u.component.name};var r=function(y,v,x,w,u){if(!u.permissions.canRead){return""}return nf.Common.substringAfterLast(u.component.type,".")};var f=function(y,v,x,w,u){if(!u.permissions.canRead){return""}if(nf.Common.isDefinedAndNotNull(u.component.parentGroupId)){return u.component.parentGroupId}else{return"Controller"}};var q=function(u,w){var v=function(E,D){if(E.permissions.canRead&&D.permissions.canRead){if(u.columnId==="moreDetails"){var A=0;if(!nf.Common.isEmpty(E.bulletins)){A=E.bulletins.length}var x=0;if(!nf.Common.isEmpty(D.bulletins)){x=D.bulletins.length}return A-x}else{if(u.columnId==="type"){var B=nf.Common.isDefinedAndNotNull(E.component[u.columnId])?nf.Common.substringAfterLast(E.component[u.columnId],"."):"";var z=nf.Common.isDefinedAndNotNull(D.component[u.columnId])?nf.Common.substringAfterLast(D.component[u.columnId],"."):"";return B===z?0:B>z?1:-1}else{if(u.columnId==="state"){var C="Invalid";if(nf.Common.isEmpty(E.component.validationErrors)){C=nf.Common.isDefinedAndNotNull(E.component[u.columnId])?E.component[u.columnId]:""}var G="Invalid";if(nf.Common.isEmpty(D.component.validationErrors)){G=nf.Common.isDefinedAndNotNull(D.component[u.columnId])?D.component[u.columnId]:""}return C===G?0:C>G?1:-1}else{var y=nf.Common.isDefinedAndNotNull(E.component[u.columnId])?E.component[u.columnId]:"";var F=nf.Common.isDefinedAndNotNull(D.component[u.columnId])?D.component[u.columnId]:"";return y===F?0:y>F?1:-1}}}}else{if(!E.permissions.canRead&&!D.permissions.canRead){return 0}if(E.permissions.canRead){return 1}else{return -1}}};w.sort(v,u.sortAsc)};var o=function(z){var y=function(I,C,H,E,B){if(!B.permissions.canRead){return""}var D='<div class="pointer view-controller-service fa fa-info-circle" title="View Details" style="margin-top: 5px; margin-right: 3px;" ></div>';D+='<div title="Usage" class="pointer controller-service-usage fa fa-book" style="margin-top: 5px; margin-right: 3px;" ></div>';var F=!nf.Common.isEmpty(B.component.validationErrors);var G=!nf.Common.isEmpty(B.bulletins);if(F){D+='<div class="pointer has-errors fa fa-warning" style="margin-top: 4px; margin-right: 3px; float: left;" ></div>'}if(G){D+='<div class="has-bulletins fa fa-sticky-note-o" style="margin-top: 5px; margin-right: 3px; float: left;"></div>'}if(F||G){D+='<span class="hidden row-id">'+nf.Common.escapeHtml(B.id)+"</span>"}return D};var u=function(I,C,H,D,B){if(!B.permissions.canRead){return""}var G="",E="";if(!nf.Common.isEmpty(B.component.validationErrors)){G="invalid fa fa-warning";E="Invalid"}else{if(B.component.state==="DISABLED"){G='disabled icon icon-enable-false"';E="Disabled"}else{if(B.component.state==="DISABLING"){G='disabled icon icon-enable-false"';E="Disabling"}else{if(B.component.state==="ENABLED"){G="enabled fa fa-flash";E="Enabled"}else{if(B.component.state==="ENABLING"){G="enabled fa fa-flash";E="Enabling"}}}}}var F='<div layout="row"><div class="'+G+'" style="margin-top: 5px;"></div>';return F+'<div class="status-text" style="margin-top: 4px;">'+E+"</div></div>"};var x=function(G,C,F,E,B){var D="";if(B.permissions.canRead&&B.permissions.canWrite){if(B.component.state==="ENABLED"||B.component.state==="ENABLING"){D+='<div class="pointer disable-controller-service icon icon-enable-false" title="Disable" style="margin-top: 2px; margin-right: 3px;" ></div>'}else{if(B.component.state==="DISABLED"){D+='<div class="pointer edit-controller-service fa fa-pencil" title="Edit" style="margin-top: 2px; margin-right: 3px;" ></div>';if(nf.Common.isEmpty(B.component.validationErrors)){D+='<div class="pointer enable-controller-service fa fa-flash" title="Enable" style="margin-top: 2px; margin-right: 3px;"></div>'}}}if(B.component.persistsState===true){D+='<div title="View State" class="pointer view-state-controller-service fa fa-tasks" style="margin-top: 2px; margin-right: 3px;" ></div>'}}if(B.permissions.canWrite){D+='<div class="pointer delete-controller-service fa fa-trash" title="Remove" style="margin-top: 2px; margin-right: 3px;" ></div>'}if(nf.Canvas.isConfigurableAuthorizer()&&nf.Common.canAccessTenants()){D+='<div title="Access Policies" class="pointer edit-access-policies fa fa-key" style="margin-top: 2px;"></div>'}return D};var w=[{id:"moreDetails",name:"&nbsp;",resizable:false,formatter:y,sortable:true,width:90,maxWidth:90,toolTip:"Sorts based on presence of bulletins"},{id:"name",name:"Name",formatter:p,sortable:true,resizable:true},{id:"type",name:"Type",formatter:r,sortable:true,resizable:true},{id:"state",name:"State",formatter:u,sortable:true,resizeable:true},{id:"parentGroupId",name:"Process Group",formatter:f,sortable:true,resizeable:true}];w.push({id:"actions",name:"&nbsp;",resizable:false,formatter:x,sortable:false,width:90,maxWidth:90});var A=new Slick.Data.DataView({inlineFilters:false});A.setItems([]);q({columnId:"name",sortAsc:true},A);var v=new Slick.Grid(z,A,w,k);v.setSelectionModel(new Slick.RowSelectionModel());v.registerPlugin(new Slick.AutoTooltips());v.setSortColumn("name",true);v.onSort.subscribe(function(C,B){q({columnId:B.sortCol.id,sortAsc:B.sortAsc},A)});v.onClick.subscribe(function(E,C){var D=$(E.target);var B=A.getItem(C.row);if(v.getColumns()[C.cell].id==="actions"){if(D.hasClass("edit-controller-service")){nf.ControllerService.showConfiguration(z,B)}else{if(D.hasClass("enable-controller-service")){nf.ControllerService.enable(z,B)}else{if(D.hasClass("disable-controller-service")){nf.ControllerService.disable(z,B)}else{if(D.hasClass("delete-controller-service")){nf.ControllerService.remove(z,B)}else{if(D.hasClass("view-state-controller-service")){nf.ComponentState.showState(B,B.state==="DISABLED")}else{if(D.hasClass("edit-access-policies")){nf.PolicyManagement.showControllerServicePolicy(B);$("#shell-close-button").click()}}}}}}}else{if(v.getColumns()[C.cell].id==="moreDetails"){if(D.hasClass("view-controller-service")){nf.ControllerService.showDetails(z,B)}else{if(D.hasClass("controller-service-usage")){$("#shell-close-button").click();nf.Shell.showPage("../nifi-docs/documentation?"+$.param({select:nf.Common.substringAfterLast(B.component.type,".")})).done(function(){if(nf.Common.isDefinedAndNotNull(B.component.parentGroupId)){var F;var G=nf.ProcessGroup.get(B.component.parentGroupId);if(nf.Common.isDefinedAndNotNull(G)){F=G.id}else{F=nf.Canvas.getGroupId()}nf.ProcessGroupConfiguration.showConfiguration(F)}else{nf.Settings.showSettings()}})}}}}});A.onRowCountChanged.subscribe(function(C,B){v.updateRowCount();v.render()});A.onRowsChanged.subscribe(function(C,B){v.invalidateRows(B.rows);v.render()});A.syncGridSelection(v,true);z.data("gridInstance",v).on("mouseenter","div.slick-cell",function(I){var F=$(this).find("div.has-errors");if(F.length&&!F.data("qtip")){var H=$(this).find("span.row-id").text();var B=A.getItemById(H);var E=nf.Common.formatUnorderedList(B.component.validationErrors);if(nf.Common.isDefinedAndNotNull(E)){F.qtip($.extend({},nf.Common.config.tooltipConfig,{content:E,position:{target:"mouse",viewport:$(window),adjust:{x:8,y:8,method:"flipinvert flipinvert"}}}))}}var D=$(this).find("div.has-bulletins");if(D.length&&!D.data("qtip")){var C=$(this).find("span.row-id").text();var B=A.getItemById(C);var G=nf.Common.getFormattedBulletins(B.bulletins);var E=nf.Common.formatUnorderedList(G);if(nf.Common.isDefinedAndNotNull(E)){D.qtip($.extend({},nf.Common.config.tooltipConfig,{content:E,position:{target:"mouse",viewport:$(window),adjust:{x:8,y:8,method:"flipinvert flipinvert"}}}))}}})};var e=function(u,v){return $.ajax({type:"GET",url:u,dataType:"json"}).done(function(w){var x=[];$.each(w.controllerServices,function(B,A){x.push($.extend({bulletins:[]},A))});nf.Common.cleanUpTooltips(v,"div.has-errors");nf.Common.cleanUpTooltips(v,"div.has-bulletins");var y=v.data("gridInstance");var z=y.getData();z.setItems(x);z.reSort();y.invalidate()})};return{init:function(u){if(!c){j();c=true}o(u)},promptNewControllerService:function(v,w){$("#controller-service-type-filter").off("keyup").on("keyup",function(y){var x=y.keyCode?y.keyCode:y.which;if(x===$.ui.keyCode.ENTER){l(v,w)}else{a()}});$("#new-controller-service-dialog").modal("setButtonModel",[{buttonText:"Add",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){l(v,w)}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){$(this).modal("hide")}}}]).modal("show");var u=$("#controller-service-types-table").data("gridInstance");if(n!==null){u.onDblClick.unsubscribe(n)}n=function(z,x){var y=u.getDataItem(x.row);b(v,w,y.type)};u.onDblClick.subscribe(n);if(nf.Common.isDefinedAndNotNull(u)){u.setSelectedRows([0]);u.resizeCanvas()}$("#controller-service-type-filter").focus()},resetTableSize:function(v){var u=v.data("gridInstance");if(nf.Common.isDefinedAndNotNull(u)){u.resizeCanvas()}},loadControllerServices:function(u,v){return e(u,v)},setBulletins:function(y,v){var x=y.data("gridInstance");var z=x.getData();z.beginUpdate();if(!nf.Common.isEmpty(v)){var w=d3.nest().key(function(A){return A.sourceId}).map(v,d3.map);w.forEach(function(C,A){var B=z.getItemById(C);if(nf.Common.isDefinedAndNotNull(B)){z.updateItem(C,$.extend(B,{bulletins:A}))}})}else{var u=z.getItems();$.each(u,function(B,A){z.updateItem(A.id,$.extend(A,{bulletins:[]}))})}z.endUpdate()}}}());
nf.ReportingTask=(function(){var c={edit:"edit",readOnly:"read-only"};var k=function(){return $("#controller-services-table")};var j=function(o,l,m){if(o.status===400){var p=o.responseText.split("\n");var n;if(p.length===1){n=$("<span></span>").text(p[0])}else{n=nf.Common.formatUnorderedList(p)}nf.Dialog.showOkDialog({dialogContent:n,headerText:"Reporting Task"})}else{nf.Common.handleAjaxError(o,l,m)}};var f=function(){var m=$("#reporting-task-configuration").data("reportingTaskDetails");if($("#reporting-task-name").val()!==m.component.name){return true}if($("#reporting-task-comments").val()!==m.component.comments){return true}if($("#reporting-task-enabled").hasClass("checkbox-checked")&&m.component.state==="DISABLED"){return true}else{if($("#reporting-task-enabled").hasClass("checkbox-unchecked")&&(m.component.state==="RUNNING"||m.component.state==="STOPPED")){return true}}var n=$("#reporting-task-scheduling-strategy-combo").combo("getSelectedOption").value;if(n!==(m.component.schedulingStrategy+"")){return true}var l;if(n==="CRON_DRIVEN"){l=$("#reporting-task-cron-driven-scheduling-period")}else{l=$("#reporting-task-timer-driven-scheduling-period")}if(nf.Common.isDefinedAndNotNull(l)&&l.val()!==(m.component.schedulingPeriod+"")){return true}return $("#reporting-task-properties").propertytable("isSaveRequired")};var e=function(){var m=$("#reporting-task-properties").propertytable("marshalProperties");var p=$("#reporting-task-scheduling-strategy-combo").combo("getSelectedOption").value;var l;if(p==="CRON_DRIVEN"){l=$("#reporting-task-cron-driven-scheduling-period")}else{l=$("#reporting-task-timer-driven-scheduling-period")}var o={};o.id=$("#reporting-task-id").text();o.name=$("#reporting-task-name").val();o.schedulingStrategy=p;o.schedulingPeriod=l.val();o.comments=$("#reporting-task-comments").val();if($("#reporting-task-enabled").hasClass("checkbox-unchecked")){o.state="DISABLED"}else{if($("#reporting-task-enabled").hasClass("checkbox-checked")){o.state="STOPPED"}}if($.isEmptyObject(m)===false){o.properties=m}var n={};n.component=o;return n};var b=function(l){var n=[];var m=l.component;if(nf.Common.isBlank(m.schedulingPeriod)){n.push("Run schedule must be specified")}if(n.length>0){nf.Dialog.showOkDialog({dialogContent:nf.Common.formatUnorderedList(n),headerText:"Reporting Task"});return false}else{return true}};var h=function(m){var o=$("#reporting-tasks-table").data("gridInstance");var l=o.getData();var n=l.getItemById(m.id);l.updateItem(m.id,$.extend({bulletins:n.bulletins},m))};var g=function(n,m){var l={revision:nf.Client.getRevision(n),component:{id:n.id,state:m===true?"RUNNING":"STOPPED"}};return $.ajax({type:"PUT",url:n.uri,data:JSON.stringify(l),dataType:"json",contentType:"application/json"}).done(function(o){h(o);nf.ControllerService.reloadReferencedServices(k(),o.component)}).fail(nf.Common.handleAjaxError)};var i=function(){return $.Deferred(function(l){$("#reporting-task-properties").propertytable("saveRow");if(f()){nf.Dialog.showYesNoDialog({headerText:"Save",dialogContent:"Save changes before going to this Controller Service?",noHandler:function(){l.resolve()},yesHandler:function(){var m=$("#reporting-task-configuration").data("reportingTaskDetails");d(m).done(function(){l.resolve()}).fail(function(){l.reject()})}})}else{l.resolve()}}).promise()};var d=function(m){var l=e();if(b(l)){l.revision=nf.Client.getRevision(m);return $.ajax({type:"PUT",data:JSON.stringify(l),url:m.uri,dataType:"json",contentType:"application/json"}).done(function(n){h(n)}).fail(j)}else{return $.Deferred(function(n){n.reject()}).promise()}};var a=function(l){var m=$("#reporting-task-configuration").data("reportingTaskDetails");return $.ajax({type:"GET",url:m.uri+"/descriptors",data:{propertyName:l},dataType:"json"}).fail(nf.Common.handleAjaxError)};return{init:function(){$("#reporting-task-configuration-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",scrollableTabContentStyle:"scrollable",tabs:[{name:"Settings",tabContentId:"reporting-task-standard-settings-tab-content"},{name:"Properties",tabContentId:"reporting-task-properties-tab-content"},{name:"Comments",tabContentId:"reporting-task-comments-tab-content"}],select:function(){nf.UniversalCapture.removeAllPropertyDetailDialogs();if($(this).text()==="Properties"){$("#reporting-task-properties").propertytable("resetTableSize")}$("#reporting-task-properties").propertytable("saveRow")}});$("#reporting-task-configuration").data("mode",c.edit).modal({scrollableContentStyle:"scrollable",headerText:"Configure Reporting Task",handler:{close:function(){$("#reporting-task-properties").propertytable("cancelEdit");$("#reporting-task-properties").propertytable("clear");nf.Common.clearField("read-only-reporting-task-comments");$("#reporting-task-configuration").removeData("reportingTaskDetails")},open:function(){nf.Common.toggleScrollable($("#"+this.find(".tab-container").attr("id")+"-content").get(0))}}});$("#reporting-task-properties").propertytable({readOnly:false,dialogContainer:"#new-reporting-task-property-container",descriptorDeferred:a,goToServiceDeferred:i})},showConfiguration:function(m){var n=$("#reporting-task-configuration");if(n.data("mode")===c.readOnly){$("#reporting-task-configuration .reporting-task-read-only").hide();$("#reporting-task-configuration .reporting-task-editable").show();$("#reporting-task-properties").propertytable("destroy").propertytable({readOnly:false,dialogContainer:"#new-reporting-task-property-container",descriptorDeferred:a,goToServiceDeferred:i});n.data("mode",c.edit)}var o=$.ajax({type:"GET",url:m.uri,dataType:"json"});var l=$.ajax({type:"GET",url:"../nifi-api/flow/history/components/"+encodeURIComponent(m.id),dataType:"json"});$.when(o,l).done(function(r,w){m=r[0];var x=m.component;var q=w[0].componentHistory;$("#reporting-task-configuration").data("reportingTaskDetails",m);var u="checkbox-checked";if(x.state==="DISABLED"){u="checkbox-unchecked"}nf.Common.populateField("reporting-task-id",x.id);nf.Common.populateField("reporting-task-type",nf.Common.substringAfterLast(x.type,"."));$("#reporting-task-name").val(x.name);$("#reporting-task-enabled").removeClass("checkbox-unchecked checkbox-checked").addClass(u);$("#reporting-task-comments").val(x.comments);var s=x.defaultSchedulingPeriod;var p=$("#reporting-task-cron-driven-scheduling-period").val(s.CRON_DRIVEN);var t=$("#reporting-task-timer-driven-scheduling-period").val(s.TIMER_DRIVEN);if(x.schedulingStrategy==="CRON_DRIVEN"){p.val(x.schedulingPeriod)}else{t.val(x.schedulingPeriod)}$("#reporting-task-scheduling-strategy-combo").combo({options:[{text:"Timer driven",value:"TIMER_DRIVEN",description:"Reporting task will be scheduled to run on an interval defined by the run schedule."},{text:"CRON driven",value:"CRON_DRIVEN",description:"Reporting task will be scheduled to run on at specific times based on the specified CRON string."}],selectedOption:{value:x.schedulingStrategy},select:function(y){if(y.value==="CRON_DRIVEN"){t.hide();p.show()}else{t.show();p.hide()}}});var v=[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){$("#reporting-task-properties").propertytable("saveRow");d(m).done(function(y){nf.ControllerService.reloadReferencedServices(k(),y.component);$("#reporting-task-configuration").modal("hide")})}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){$("#reporting-task-configuration").modal("hide")}}}];if(nf.Common.isDefinedAndNotNull(x.customUiUrl)&&x.customUiUrl!==""){v.push({buttonText:"Advanced",clazz:"fa fa-cog button-icon",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){var y=function(){$("#reporting-task-configuration").modal("hide");$("#shell-close-button").click();nf.CustomUi.showCustomUi(m,x.customUiUrl,true).done(function(){nf.ReportingTask.reload(m.id).done(function(z){nf.ControllerService.reloadReferencedServices(k(),z.reportingTask)});nf.Settings.showSettings()})};$("#reporting-task-properties").propertytable("saveRow");if(f()){nf.Dialog.showYesNoDialog({headerText:"Save",dialogContent:"Save changes before opening the advanced configuration?",noHandler:y,yesHandler:function(){d(m).done(function(){y()})}})}else{y()}}}})}$("#reporting-task-configuration").modal("setButtonModel",v);$("#reporting-task-properties").propertytable("setGroupId",x.parentGroupId).propertytable("loadProperties",x.properties,x.descriptors,q.propertyHistory);$("#reporting-task-configuration").modal("show");$("#reporting-task-properties").propertytable("resetTableSize")}).fail(nf.Common.handleAjaxError)},showDetails:function(m){var n=$("#reporting-task-configuration");if(n.data("mode")===c.edit){$("#reporting-task-configuration .reporting-task-read-only").show();$("#reporting-task-configuration .reporting-task-editable").hide();$("#reporting-task-properties").propertytable("destroy").propertytable({readOnly:true});n.data("mode",c.readOnly)}var o=$.ajax({type:"GET",url:m.uri,dataType:"json"});var l=$.ajax({type:"GET",url:"../nifi-api/flow/history/components/"+encodeURIComponent(m.id),dataType:"json"});$.when(o,l).done(function(p,q){m=p[0];var u=m.component;var r=q[0].componentHistory;nf.Common.populateField("reporting-task-id",u.id);nf.Common.populateField("reporting-task-type",nf.Common.substringAfterLast(u.type,"."));nf.Common.populateField("read-only-reporting-task-name",u.name);nf.Common.populateField("read-only-reporting-task-comments",u.comments);var t=u.schedulingStrategy;if(t==="CRON_DRIVEN"){t="CRON driven"}else{t="Timer driven"}nf.Common.populateField("read-only-reporting-task-scheduling-strategy",t);nf.Common.populateField("read-only-reporting-task-scheduling-period",u.schedulingPeriod);var s=[{buttonText:"Ok",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){n.modal("hide")}}}];if(nf.Common.isDefinedAndNotNull(nf.CustomUi)&&nf.Common.isDefinedAndNotNull(u.customUiUrl)&&u.customUiUrl!==""){s.push({buttonText:"Advanced",clazz:"fa fa-cog button-icon",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){n.modal("hide");$("#shell-close-button").click();nf.CustomUi.showCustomUi(m,u.customUiUrl,false).done(function(){nf.Settings.showSettings()})}}})}n.modal("setButtonModel",s).modal("show");$("#reporting-task-properties").propertytable("loadProperties",u.properties,u.descriptors,r.propertyHistory);n.modal("show");$("#reporting-task-properties").propertytable("resetTableSize")})},start:function(l){g(l,true)},stop:function(l){g(l,false)},reload:function(o){var n=$("#reporting-tasks-table").data("gridInstance");var l=n.getData();var m=l.getItemById(o);return $.ajax({type:"GET",url:m.uri,dataType:"json"}).done(function(p){h(p)}).fail(nf.Common.handleAjaxError)},remove:function(m){var l=nf.Client.getRevision(m);$.ajax({type:"DELETE",url:m.uri+"?"+$.param({version:l.version,clientId:l.clientId}),dataType:"json"}).done(function(o){var p=$("#reporting-tasks-table").data("gridInstance");var n=p.getData();n.deleteItem(m.id)}).fail(nf.Common.handleAjaxError)}}}());
nf.ProcessorConfiguration=(function(){var k=[0,25,50,100,250,500,1000,2000];var j=function(l){var m=[{text:"Timer driven",value:"TIMER_DRIVEN",description:"Processor will be scheduled to run on an interval defined by the run schedule."}];if(l.supportsEventDriven===true){m.push({text:"Event driven",value:"EVENT_DRIVEN",description:"Processor will be scheduled to run when triggered by an event (e.g. a FlowFile enters an incoming queue). This scheduling strategy is experimental."})}else{if(l.config.schedulingStrategy==="EVENT_DRIVEN"){m.push({text:"Event driven",value:"EVENT_DRIVEN",description:"Processor will be scheduled to run when triggered by an event (e.g. a FlowFile enters an incoming queue). This scheduling strategy is experimental.",disabled:true})}}if(nf.Canvas.isClustered()){m.push({text:"On primary node",value:"PRIMARY_NODE_ONLY",description:"Processor will be scheduled on the primary node on an interval defined by the run schedule."})}else{if(l.config.schedulingStrategy==="PRIMARY_NODE_ONLY"){m.push({text:"On primary node",value:"PRIMARY_NODE_ONLY",description:"Processor will be scheduled on the primary node on an interval defined by the run schedule.",disabled:true})}}m.push({text:"CRON driven",value:"CRON_DRIVEN",description:"Processor will be scheduled to run on at specific times based on the specified CRON string."});return m};var b=function(o,l,m){if(o.status===400){var p=o.responseText.split("\n");var n;if(p.length===1){n=$("<span></span>").text(p[0])}else{n=nf.Common.formatUnorderedList(p)}nf.Dialog.showOkDialog({dialogContent:n,headerText:"Processor Configuration"})}else{nf.Common.handleAjaxError(o,l,m)}};var g=function(q){var l=$('<div class="relationship-name ellipsis"></div>').text(q.name);var n=$('<span class="relationship-name-value hidden"></span>').text(q.name);var o=$('<div class="processor-relationship nf-checkbox"></div>');if(q.autoTerminate===true){o.addClass("checkbox-checked")}else{o.addClass("checkbox-unchecked")}var p=$('<div class="processor-relationship-container"></div>').append(o).append(l).append(n).appendTo("#auto-terminate-relationship-names");if(!nf.Common.isBlank(q.description)){var m=$('<div class="relationship-description"></div>').text(q.description);p.append(m)}return p};var d=function(){var n=$("#processor-configuration").data("processorDetails");var o=false;var p=f();$.each(n.relationships,function(r,s){if(s.autoTerminate===true){if($.inArray(s.name,p)===-1){o=true;return false}}else{if(s.autoTerminate===false){if($.inArray(s.name,p)>=0){o=true;return false}}}});if(o){return true}var q=$("#scheduling-strategy-combo").combo("getSelectedOption").value;if(q!==(n.config.schedulingStrategy+"")){return true}if(n.supportsParallelProcessing===true){var l;if(q==="EVENT_DRIVEN"){l=$("#event-driven-concurrently-schedulable-tasks")}else{if(q==="CRON_DRIVEN"){l=$("#cron-driven-concurrently-schedulable-tasks")}else{l=$("#timer-driven-concurrently-schedulable-tasks")}}if(l.val()!==(n.config.concurrentlySchedulableTaskCount+"")){return true}}var m;if(q==="CRON_DRIVEN"){m=$("#cron-driven-scheduling-period")}else{if(q!=="EVENT_DRIVEN"){m=$("#timer-driven-scheduling-period")}}if(nf.Common.isDefinedAndNotNull(m)&&m.val()!==(n.config.schedulingPeriod+"")){return true}if($("#processor-name").val()!==n.name){return true}if($("#processor-enabled").hasClass("checkbox-checked")&&n.state==="DISABLED"){return true}else{if($("#processor-enabled").hasClass("checkbox-unchecked")&&(n.state==="RUNNING"||n.state==="STOPPED")){return true}}if($("#penalty-duration").val()!==(n.config.penaltyDuration+"")){return true}if($("#yield-duration").val()!==(n.config.yieldDuration+"")){return true}if($("#bulletin-level-combo").combo("getSelectedOption").value!==(n.config.bulletinLevel+"")){return true}if($("#processor-comments").val()!==n.config.comments){return true}return $("#processor-properties").propertytable("isSaveRequired")};var c=function(){var n={};var r=$("#scheduling-strategy-combo").combo("getSelectedOption").value;var l;if(r==="EVENT_DRIVEN"){l=$("#event-driven-concurrently-schedulable-tasks")}else{if(r==="CRON_DRIVEN"){l=$("#cron-driven-concurrently-schedulable-tasks")}else{l=$("#timer-driven-concurrently-schedulable-tasks")}}if(!l.is(":disabled")){n.concurrentlySchedulableTaskCount=l.val()}var m;if(r==="CRON_DRIVEN"){m=$("#cron-driven-scheduling-period")}else{if(r!=="EVENT_DRIVEN"){m=$("#timer-driven-scheduling-period")}}if(nf.Common.isDefinedAndNotNull(m)){n.schedulingPeriod=m.val()}n.penaltyDuration=$("#penalty-duration").val();n.yieldDuration=$("#yield-duration").val();n.bulletinLevel=$("#bulletin-level-combo").combo("getSelectedOption").value;n.schedulingStrategy=r;n.comments=$("#processor-comments").val();if($("#run-duration-setting-container").is(":visible")){var p=$("#run-duration-slider").slider("value");n.runDurationMillis=k[p]}n.autoTerminatedRelationships=f();var o=$("#processor-properties").propertytable("marshalProperties");if($.isEmptyObject(o)===false){n.properties=o}var s={};s.id=$("#processor-id").text();s.name=$("#processor-name").val();s.config=n;if($("#processor-enabled").hasClass("checkbox-unchecked")){s.state="DISABLED"}else{if($("#processor-enabled").hasClass("checkbox-checked")){s.state="STOPPED"}}var q={};q.component=s;return q};var f=function(){var m=$("#auto-terminate-relationship-names");var l=[];$.each(m.children(),function(n,q){var p=$(q);var o=p.children("div.processor-relationship");if(o.hasClass("checkbox-checked")){l.push(p.children("span.relationship-name-value").text())}});return l};var a=function(m){var o=[];var n=m.component;var l=n.config;if(nf.Common.isDefinedAndNotNull(l.concurrentlySchedulableTaskCount)&&!$.isNumeric(l.concurrentlySchedulableTaskCount)){o.push("Concurrent tasks must be an integer value")}if(nf.Common.isDefinedAndNotNull(l.schedulingPeriod)&&nf.Common.isBlank(l.schedulingPeriod)){o.push("Run schedule must be specified")}if(nf.Common.isBlank(l.penaltyDuration)){o.push("Penalty duration must be specified")}if(nf.Common.isBlank(l.yieldDuration)){o.push("Yield duration must be specified")}if(o.length>0){nf.Dialog.showOkDialog({dialogContent:nf.Common.formatUnorderedList(o),headerText:"Processor Configuration"});return false}else{return true}};var e=function(m){var l=nf.Connection.getComponentConnections(m.id);$.each(l,function(o,n){if(n.permissions.canRead){if(n.sourceId===m.id){nf.Connection.reload(n.id)}}})};var h=function(){return $.Deferred(function(l){$("#processor-properties").propertytable("saveRow");if(d()){nf.Dialog.showYesNoDialog({headerText:"Processor Configuration",dialogContent:"Save changes before going to this Controller Service?",noHandler:function(){l.resolve()},yesHandler:function(){var m=$("#processor-configuration").data("processorDetails");i(m).done(function(){l.resolve()}).fail(function(){l.reject()})}})}else{l.resolve()}}).promise()};var i=function(l){var m=c();if(a(m)){var n=nf.Processor.get(l.id);m.revision=nf.Client.getRevision(n);return $.ajax({type:"PUT",data:JSON.stringify(m),url:n.uri,dataType:"json",contentType:"application/json"}).done(function(o){nf.Processor.set(o)}).fail(b)}else{return $.Deferred(function(o){o.reject()}).promise()}};return{init:function(){$("#processor-configuration-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",scrollableTabContentStyle:"scrollable",tabs:[{name:"Settings",tabContentId:"processor-standard-settings-tab-content"},{name:"Scheduling",tabContentId:"processor-scheduling-tab-content"},{name:"Properties",tabContentId:"processor-properties-tab-content"},{name:"Comments",tabContentId:"processor-comments-tab-content"}],select:function(){nf.UniversalCapture.removeAllPropertyDetailDialogs();if($(this).text()==="Properties"){$("#processor-properties").propertytable("resetTableSize")}$("#processor-properties").propertytable("saveRow");var l=$("#auto-terminate-relationship-names");if(l.is(":visible")&&l.get(0).scrollHeight>l.innerHeight()){l.css("border-width","1px")}}});$("#processor-configuration").modal({scrollableContentStyle:"scrollable",headerText:"Configure Processor",handler:{close:function(){$("#auto-terminate-relationship-names").css("border-width","0").empty();$("#processor-properties").propertytable("cancelEdit").propertytable("clear");$("#processor-configuration").removeData("processorDetails")},open:function(){nf.Common.toggleScrollable($("#"+this.find(".tab-container").attr("id")+"-content").get(0))}}});$("#bulletin-level-combo").combo({options:[{text:"DEBUG",value:"DEBUG"},{text:"INFO",value:"INFO"},{text:"WARN",value:"WARN"},{text:"ERROR",value:"ERROR"}]});$("#run-duration-slider").slider({min:0,max:k.length-1,change:function(m,n){var l=$("#processor-configuration").data("processorDetails");if(n.value>0&&(l.inputRequirement==="INPUT_FORBIDDEN"||l.inputRequirement==="INPUT_ALLOWED")){$("#run-duration-data-loss").show()}else{$("#run-duration-data-loss").hide()}}});$("#processor-properties").propertytable({readOnly:false,dialogContainer:"#new-processor-property-container",descriptorDeferred:function(l){var m=$("#processor-configuration").data("processorDetails");var n=nf.Processor.get(m.id);return $.ajax({type:"GET",url:n.uri+"/descriptors",data:{propertyName:l},dataType:"json"}).fail(nf.Common.handleAjaxError)},goToServiceDeferred:h})},showConfiguration:function(m){if(nf.CanvasUtils.isProcessor(m)){var n=m.datum();var l=n.component;var o=[];o.push(nf.Processor.reload(l.id));o.push($.ajax({type:"GET",url:"../nifi-api/flow/history/components/"+encodeURIComponent(l.id),dataType:"json"}));$.when.apply(window,o).done(function(v,y){var w=v[0];l=w.component;var s=y[0].componentHistory;$("#processor-configuration").data("processorDetails",l);var r="checkbox-checked";if(l.state==="DISABLED"){r="checkbox-unchecked"}$("#processor-id").text(l.id);$("#processor-type").text(nf.Common.substringAfterLast(l.type,"."));$("#processor-name").val(l.name);$("#processor-enabled").removeClass("checkbox-unchecked checkbox-checked").addClass(r);$("#penalty-duration").val(l.config.penaltyDuration);$("#yield-duration").val(l.config.yieldDuration);$("#processor-comments").val(l.config.comments);if(l.supportsBatching===true){$("#run-duration-setting-container").show();var x=k.indexOf(l.config.runDurationMillis);$("#run-duration-slider").slider("value",x)}else{$("#run-duration-setting-container").hide()}$("#bulletin-level-combo").combo("setSelectedOption",{value:l.config.bulletinLevel});$("#scheduling-strategy-combo").combo({options:j(l),selectedOption:{value:l.config.schedulingStrategy},select:function(A){if(A.value==="EVENT_DRIVEN"){$("#event-driven-warning").show();$("#timer-driven-options").hide();$("#event-driven-options").show();$("#cron-driven-options").hide()}else{$("#event-driven-warning").hide();if(A.value==="CRON_DRIVEN"){$("#timer-driven-options").hide();$("#event-driven-options").hide();$("#cron-driven-options").show()}else{$("#timer-driven-options").show();$("#event-driven-options").hide();$("#cron-driven-options").hide()}}}});var z=l.config.defaultConcurrentTasks;$("#timer-driven-concurrently-schedulable-tasks").val(z.TIMER_DRIVEN);$("#event-driven-concurrently-schedulable-tasks").val(z.EVENT_DRIVEN);$("#cron-driven-concurrently-schedulable-tasks").val(z.CRON_DRIVEN);var u;if(l.config.schedulingStrategy==="EVENT_DRIVEN"){u=$("#event-driven-concurrently-schedulable-tasks").val(l.config.concurrentlySchedulableTaskCount)}else{if(l.config.schedulingStrategy==="CRON_DRIVEN"){u=$("#cron-driven-concurrently-schedulable-tasks").val(l.config.concurrentlySchedulableTaskCount)}else{u=$("#timer-driven-concurrently-schedulable-tasks").val(l.config.concurrentlySchedulableTaskCount)}}if(nf.Common.isDefinedAndNotNull(u)){if(l.supportsParallelProcessing===true){u.prop("disabled",false)}else{u.prop("disabled",true)}}var q=l.config.defaultSchedulingPeriod;$("#cron-driven-scheduling-period").val(q.CRON_DRIVEN);$("#timer-driven-scheduling-period").val(q.TIMER_DRIVEN);if(l.config.schedulingStrategy==="CRON_DRIVEN"){$("#cron-driven-scheduling-period").val(l.config.schedulingPeriod)}else{if(l.config.schedulingStrategy!=="EVENT_DRIVEN"){$("#timer-driven-scheduling-period").val(l.config.schedulingPeriod)}}if(!nf.Common.isEmpty(l.relationships)){$.each(l.relationships,function(A,B){g(B)})}else{$("#auto-terminate-relationship-names").append('<div class="unset">This processor has no relationships.</div>')}var t=[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){$("#processor-properties").propertytable("saveRow");i(l).done(function(A){e(l);$("#processor-configuration").modal("hide");nf.ng.Bridge.digest()})}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){$("#processor-configuration").modal("hide")}}}];if(nf.Common.isDefinedAndNotNull(l.config.customUiUrl)&&l.config.customUiUrl!==""){t.push({buttonText:"Advanced",clazz:"fa fa-cog button-icon",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){var A=function(){$("#processor-configuration").modal("hide");nf.CustomUi.showCustomUi(w,l.config.customUiUrl,true).done(function(){nf.Processor.reload(l.id);e(l)})};$("#processor-properties").propertytable("saveRow");if(d()){nf.Dialog.showYesNoDialog({headerText:"Save",dialogContent:"Save changes before opening the advanced configuration?",noHandler:A,yesHandler:function(){i(l).done(function(B){A()})}})}else{A()}}}})}$("#processor-configuration").modal("setButtonModel",t);$("#processor-properties").propertytable("setGroupId",l.parentGroupId).propertytable("loadProperties",l.config.properties,l.config.descriptors,s.propertyHistory);$("#processor-configuration").modal("show");$("#processor-configuration div.relationship-name").ellipsis();var p=$("#auto-terminate-relationship-names");if(p.is(":visible")&&p.get(0).scrollHeight>p.innerHeight()){p.css("border-width","1px")}}).fail(nf.Common.handleAjaxError)}}}}());
nf.ProcessorDetails=(function(){var a=function(e){var b=$('<div class="relationship-name ellipsis"></div>').text(e.name);if(e.autoTerminate===true){b.css("font-weight","bold")}var d=$('<div class="processor-relationship-container"></div>').append(b).appendTo("#read-only-auto-terminate-relationship-names");if(!nf.Common.isBlank(e.description)){var c=$('<div class="relationship-description"></div>').text(e.description);d.append(c)}return d};return{init:function(){$("#processor-details-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",scrollableTabContentStyle:"scrollable",tabs:[{name:"Settings",tabContentId:"details-standard-settings-tab-content"},{name:"Scheduling",tabContentId:"details-scheduling-tab-content"},{name:"Properties",tabContentId:"details-processor-properties-tab-content"},{name:"Comments",tabContentId:"details-processor-comments-tab-content"}],select:function(){nf.UniversalCapture.removeAllPropertyDetailDialogs();if($(this).text()==="Properties"){$("#read-only-processor-properties").propertytable("resetTableSize")}var b=$("#read-only-auto-terminate-relationship-names");if(b.is(":visible")&&b.get(0).scrollHeight>b.innerHeight()){b.css("border-width","1px")}}});$("#processor-details").modal({headerText:"Processor Details",scrollableContentStyle:"scrollable",handler:{close:function(){$("#read-only-auto-terminate-relationship-names").css("border-width","0").empty();$("#read-only-processor-properties").propertytable("clear");nf.Common.clearField("read-only-processor-id");nf.Common.clearField("read-only-processor-type");nf.Common.clearField("read-only-processor-name");nf.Common.clearField("read-only-concurrently-schedulable-tasks");nf.Common.clearField("read-only-scheduling-period");nf.Common.clearField("read-only-penalty-duration");nf.Common.clearField("read-only-yield-duration");nf.Common.clearField("read-only-run-duration");nf.Common.clearField("read-only-bulletin-level");nf.Common.clearField("read-only-execution-status");nf.Common.clearField("read-only-processor-comments");$("#processor-details").removeData("processorDetails");$("#processor-details").removeData("processorHistory")},open:function(){nf.Common.toggleScrollable($("#"+this.find(".tab-container").attr("id")+"-content").get(0))}}});$("#read-only-processor-properties").propertytable({readOnly:true})},showDetails:function(d,e){var c=$.ajax({type:"GET",url:"../nifi-api/processors/"+encodeURIComponent(e),dataType:"json"}).done(function(g){if(nf.Common.isDefinedAndNotNull(g.component)){var h=g.component;$("#processor-details").data("processorDetails",h);nf.Common.populateField("read-only-processor-id",h.id);nf.Common.populateField("read-only-processor-type",nf.Common.substringAfterLast(h.type,"."));nf.Common.populateField("read-only-processor-name",h.name);nf.Common.populateField("read-only-concurrently-schedulable-tasks",h.config.concurrentlySchedulableTaskCount);nf.Common.populateField("read-only-scheduling-period",h.config.schedulingPeriod);nf.Common.populateField("read-only-penalty-duration",h.config.penaltyDuration);nf.Common.populateField("read-only-yield-duration",h.config.yieldDuration);nf.Common.populateField("read-only-run-duration",nf.Common.formatDuration(h.config.runDurationMillis));nf.Common.populateField("read-only-bulletin-level",h.config.bulletinLevel);nf.Common.populateField("read-only-processor-comments",h.config.comments);var f=true;var i=h.config.schedulingStrategy;if(i==="EVENT_DRIVEN"){f=false;i="Event driven"}else{if(i==="CRON_DRIVEN"){i="CRON driven"}else{if(i==="TIMER_DRIVEN"){i="Timer driven"}else{i="On primary node"}}}nf.Common.populateField("read-only-scheduling-strategy",i);if(f===true){$("#read-only-run-schedule").show()}else{$("#read-only-run-schedule").hide()}if(!nf.Common.isEmpty(h.relationships)){$.each(h.relationships,function(j,k){a(k)})}else{$("#read-only-auto-terminate-relationship-names").append('<div class="unset">This processor has no relationships.</div>')}}});var b=$.ajax({type:"GET",url:"../nifi-api/flow/history/components/"+encodeURIComponent(e),dataType:"json"}).done(function(f){var g=f.componentHistory;$("#processor-details").data("processorHistory",g)});$.when(c,b).done(function(m,h){var j=m[0];var g=j.component;var f=h[0];var l=f.componentHistory;$("#read-only-processor-properties").propertytable("loadProperties",g.config.properties,g.config.descriptors,l.propertyHistory);var i=[{buttonText:"Ok",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){$("#processor-details").modal("hide")}}}];if(nf.Common.isDefinedAndNotNull(nf.CustomUi)&&nf.Common.isDefinedAndNotNull(g.config.customUiUrl)&&g.config.customUiUrl!==""){i.push({buttonText:"Advanced",clazz:"fa fa-cog button-icon",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){$("#processor-details").modal("hide");nf.CustomUi.showCustomUi(j,g.config.customUiUrl,false)}}})}$("#processor-details").modal("setButtonModel",i).modal("show");$("#processor-details div.relationship-name").ellipsis();var k=$("#read-only-auto-terminate-relationship-names");if(k.is(":visible")&&k.get(0).scrollHeight>k.innerHeight()){k.css("border-width","1px")}}).fail(function(h,f,g){if(h.status===400||h.status===404||h.status===409){nf.Dialog.showOkDialog({headerText:"Error",dialogContent:nf.Common.escapeHtml(h.responseText)})}else{nf.Common.handleAjaxError(h,f,g)}})}}}());
nf.ProcessGroupConfiguration=(function(){var c={urls:{api:"../nifi-api"}};var d=function(){};var a=function(){return $("#process-group-controller-services-table")};var b=function(h,j){var i={revision:nf.Client.getRevision({revision:{version:h}}),component:{id:j,name:$("#process-group-name").val(),comments:$("#process-group-comments").val()}};$.ajax({type:"PUT",data:JSON.stringify(i),url:c.urls.api+"/process-groups/"+encodeURIComponent(j),dataType:"json",contentType:"application/json"}).done(function(k){if(k.permissions.canRead&&k.component.parentGroupId===nf.Canvas.getGroupId()){nf.ProcessGroup.set(k)}nf.Dialog.showOkDialog({headerText:"Process Group Configuration",dialogContent:"Process group configuration successfully saved."});$("#process-group-configuration-save").off("click").on("click",function(){b(k.revision.version,j)});nf.ng.Bridge.digest()}).fail(nf.Common.handleAjaxError)};var e=function(j){var m=function(){$("#read-only-process-group-name").addClass("unset").text("Unauthorized");$("#read-only-process-group-comments").addClass("unset").text("Unauthorized")};var l=function(n){if(n){$("#process-group-configuration div.editable").show();$("#process-group-configuration div.read-only").hide();$("#process-group-configuration-save").show()}else{$("#process-group-configuration div.editable").hide();$("#process-group-configuration div.read-only").show();$("#process-group-configuration-save").hide()}};var k=$.Deferred(function(n){$.ajax({type:"GET",url:c.urls.api+"/process-groups/"+encodeURIComponent(j),dataType:"json"}).done(function(o){$("#process-group-configuration").data("process-group",o);if(o.permissions.canWrite){var p=o.component;$("#process-group-id").text(p.id);$("#process-group-name").removeClass("unset").val(p.name);$("#process-group-comments").removeClass("unset").val(p.comments);l(true);$("#process-group-configuration-save").off("click").on("click",function(){b(o.revision.version,o.id)})}else{if(o.permissions.canRead){$("#read-only-process-group-name").removeClass("unset").text(o.component.name);$("#read-only-process-group-comments").removeClass("unset").text(o.component.comments)}else{m()}l(false)}n.resolve()}).fail(function(q,o,p){if(q.status===403){if(j===nf.Canvas.getGroupId()){$("#process-group-configuration").data("process-group",{permissions:{canRead:false,canWrite:nf.Canvas.canWrite()}})}else{$("#process-group-configuration").data("process-group",nf.ProcessGroup.get(j))}m();l(false);n.resolve()}else{n.reject(q,o,p)}})}).promise();var h=c.urls.api+"/flow/process-groups/"+encodeURIComponent(j)+"/controller-services";var i=nf.ControllerServices.loadControllerServices(h,a());return $.when(k,i).done(function(p,o){var n=o[0];$("#process-group-configuration-last-refreshed").text(n.currentTime)}).fail(nf.Common.handleAjaxError)};var g=function(){nf.Shell.showContent("#process-group-configuration").done(function(){f()});$("#process-group-configuration-tabs").find(".selected-tab").click();nf.ProcessGroupConfiguration.resetTableSize()};var f=function(){$("#process-group-configuration").removeData("process-group");$("#process-group-configuration-save").mouseout();$("#process-group-name").val("");$("#process-group-comments").val("")};return{init:function(){$("#process-group-configuration-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",scrollableTabContentStyle:"scrollable",tabs:[{name:"General",tabContentId:"general-process-group-configuration-tab-content"},{name:"Controller Services",tabContentId:"process-group-controller-services-tab-content"}],select:function(){var i=$("#process-group-configuration").data("process-group");var j=nf.Common.isDefinedAndNotNull(i)?i.permissions.canWrite:false;var h=$(this).text();if(h==="General"){$("#add-process-group-configuration-controller-service").hide();if(j){$("#process-group-configuration-save").show()}else{$("#process-group-configuration-save").hide()}}else{$("#process-group-configuration-save").hide();if(j){$("#add-process-group-configuration-controller-service").show();$("#process-group-controller-services-tab-content").css("top","32px")}else{$("#add-process-group-configuration-controller-service").hide();$("#process-group-controller-services-tab-content").css("top","0")}nf.ProcessGroupConfiguration.resetTableSize()}}});d();nf.ControllerServices.init(a())},resetTableSize:function(){nf.ControllerServices.resetTableSize(a())},showConfiguration:function(h){$("#process-group-configuration-refresh-button").off("click").on("click",function(){e(h)});$("#add-process-group-configuration-controller-service").off("click").on("click",function(){var j=$("#process-group-configuration-tabs li.selected-tab").text();if(j==="Controller Services"){var i=c.urls.api+"/process-groups/"+encodeURIComponent(h)+"/controller-services";nf.ControllerServices.promptNewControllerService(i,a())}});return e(h).done(g)},loadConfiguration:function(h){return e(h)},selectControllerService:function(h){var i=a().data("gridInstance");var j=i.getData();var k=j.getRowById(h);i.setSelectedRows([k]);i.scrollRowIntoView(k);$("#process-group-configuration-tabs").find("li:eq(1)").click()}}}());
nf.PolicyManagement=(function(){var s={urls:{api:"../nifi-api",searchTenants:"../nifi-api/tenants/search-results"}};var f=false;var c=function(){$("#new-policy-user-button").on("click",function(){$("#search-users-dialog").modal("show");$("#search-users-field").focus()});$("#delete-policy-button").on("click",function(){k()});$("#search-users-dialog").modal({scrollableContentStyle:"scrollable",headerText:"Search users",buttons:[{buttonText:"Ok",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){var u=$("#search-users-field").val();$.ajax({type:"GET",data:{q:u},dataType:"json",url:s.urls.searchTenants}).done(function(w){var A=$.map(w.users,function(B){return $.extend({type:"user"},B)});var v=$.map(w.userGroups,function(B){return $.extend({type:"group"},B)});var x=[];x=x.concat(A,v);var y=function(C){var D=$("#policy-table").data("gridInstance");var B=D.getData();B.beginUpdate();B.addItem(C);B.endUpdate();t()};if(!$.isArray(x)||x.length===0){nf.Dialog.showOkDialog({headerText:"User Search",dialogContent:"No users match '"+nf.Common.escapeHtml(u)+"'."})}else{if(x.length>1){var z=false;$.each(x,function(B,C){if(C.component.identity===u){y(C);z=true;return false}});if(z){$("#search-users-dialog").modal("hide")}else{nf.Dialog.showOkDialog({headerText:"User Search",dialogContent:"More than one user matches '"+nf.Common.escapeHtml(u)+"'."})}}else{if(x.length===1){y(x[0]);$("#search-users-dialog").modal("hide")}}}})}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){$("#search-users-dialog").modal("hide")}}}],handler:{close:function(){$("#search-users-field").userSearchAutocomplete("reset").val("");$("#selected-user-id").text("")}}});$.widget("nf.userSearchAutocomplete",$.ui.autocomplete,{reset:function(){this.term=null},_normalize:function(v){var u=[];u.push(v);return u},_renderMenu:function(w,v){var x=v[0];var u=this;$.each(x.userGroups,function(y,z){u._renderGroup(w,{label:z.component.identity,value:z.component.identity})});$.each(x.users,function(y,z){u._renderUser(w,{label:z.component.identity,value:z.component.identity})});if(w.children().length===0){w.append('<li class="unset search-no-matches">No users matched the search terms</li>')}},_resizeMenu:function(){var u=this.menu.element;u.width($("#search-users-field").width()+6)},_renderUser:function(w,v){var u=$("<a></a>").text(v.label);return $("<li></li>").data("ui-autocomplete-item",v).append(u).appendTo(w)},_renderGroup:function(v,u){var x=$("<span></span>").text(u.label);var w=$("<a></a>").append('<div class="fa fa-users" style="margin-right: 5px;"></div>').append(x);return $("<li></li>").data("ui-autocomplete-item",u).append(w).appendTo(v)}});$("#search-users-field").userSearchAutocomplete({minLength:0,appendTo:"#search-users-results",position:{my:"left top",at:"left bottom",offset:"0 1"},source:function(v,u){$.ajax({type:"GET",data:{q:v.term},dataType:"json",url:s.urls.searchTenants}).done(function(w){u(w)})}})};var o=function(){$("#create-policy-link, #override-policy-link, #add-local-admin-link").on("click",function(){g()});$("#policy-type-list").combo({options:[{text:"view the user interface",value:"flow",description:"Allows users to view the user interface"},{text:"access the controller",value:"controller",description:"Allows users to view/modify the controller including Reporting Tasks, Controller Services, and Nodes in the Cluster"},{text:"query provenance",value:"provenance",description:"Allows users to submit a Provenance Search and request Event Lineage"},{text:"access all policies",value:"policies",description:"Allows users to view/modify the policies for all components"},{text:"access users/user groups",value:"tenants",description:"Allows users to view/modify the users and user groups"},{text:"retrieve site-to-site details",value:"site-to-site",description:"Allows other NiFi instances to retrieve Site-To-Site details of this NiFi"},{text:"view system diagnostics",value:"system",description:"Allows users to view System Diagnostics"},{text:"proxy user requests",value:"proxy",description:"Allows proxy machines to send requests on the behalf of others"},{text:"access counters",value:"counters",description:"Allows users to view/modify Counters"}],select:function(A){if(f){$("#selected-policy-type").text(A.value);if(A.value==="controller"||A.value==="counters"||A.value==="policies"||A.value==="tenants"){$("#controller-policy-target").combo("setSelectedOption",{value:"read"}).show()}else{$("#controller-policy-target").hide();if(A.value==="proxy"){$("#selected-policy-action").text("write")}else{$("#selected-policy-action").text("read")}a()}}}});$("#controller-policy-target").combo({options:[{text:"view",value:"read"},{text:"modify",value:"write"}],select:function(A){if(f){$("#selected-policy-action").text(A.value);a()}}});$("#component-policy-target").combo({options:[{text:"view the component",value:"read-component",description:"Allows users to view component configuration details"},{text:"modify the component",value:"write-component",description:"Allows users to modify component configuration details"},{text:"view the data",value:"read-data",description:"Allows users to view metadata and content for this component through provenance data and flowfile queues in outbound connections"},{text:"modify the data",value:"write-data",description:"Allows users to empty flowfile queues in outbound connections and submit replays"},{text:"receive data via site-to-site",value:"write-receive-data",description:"Allows this port to receive data from these NiFi instances",disabled:true},{text:"send data via site-to-site",value:"write-send-data",description:"Allows this port to send data to these NiFi instances",disabled:true},{text:"view the policies",value:"read-policies",description:"Allows users to view the list of users who can view/modify this component"},{text:"modify the policies",value:"write-policies",description:"Allows users to modify the list of users who can view/modify this component"}],select:function(A){if(f){var B=$("#selected-policy-component-type").text();if(A.value==="read-component"){$("#selected-policy-action").text("read")}else{if(A.value==="write-component"){$("#selected-policy-action").text("write")}else{if(A.value==="read-data"){$("#selected-policy-action").text("read");B=("data/"+B)}else{if(A.value==="write-data"){$("#selected-policy-action").text("write");B=("data/"+B)}else{if(A.value==="read-policies"){$("#selected-policy-action").text("read");B=("policies/"+B)}else{if(A.value==="write-policies"){$("#selected-policy-action").text("write");B=("policies/"+B)}else{if(A.value==="write-receive-data"){$("#selected-policy-action").text("write");B="data-transfer/input-ports"}else{if(A.value==="write-send-data"){$("#selected-policy-action").text("write");B="data-transfer/output-ports"}}}}}}}}$("#selected-policy-type").text(B);a()}}});var u=function(F,B,E,D,A){var C="";if(A.type==="group"){C+='<div class="fa fa-users" style="margin-right: 5px;"></div>'}C+=A.component.identity;return C};var y=function(G,C,F,E,B){var D="";var A=$("#policy-table").data("policy");if(A.permissions.canWrite===true){D+='<div title="Remove" class="pointer delete-user fa fa-trash"></div>'}return D};var x=[{id:"identity",name:"User",sortable:true,resizable:true,formatter:u},{id:"actions",name:"&nbsp;",sortable:false,resizable:false,formatter:y,width:100,maxWidth:100}];var w={forceFitColumns:true,enableTextSelectionOnCells:true,enableCellNavigation:true,enableColumnReorder:false,autoEdit:false};var v=new Slick.Data.DataView({inlineFilters:false});v.setItems([]);p({columnId:"identity",sortAsc:true},v);var z=new Slick.Grid("#policy-table",v,x,w);z.setSelectionModel(new Slick.RowSelectionModel());z.registerPlugin(new Slick.AutoTooltips());z.setSortColumn("identity",true);z.onSort.subscribe(function(B,A){p({columnId:A.sortCol.id,sortAsc:A.sortAsc},v)});z.onClick.subscribe(function(D,A){var C=$(D.target);var B=v.getItem(A.row);if(z.getColumns()[A.cell].id==="actions"){if(C.hasClass("delete-user")){e(B)}}});v.onRowCountChanged.subscribe(function(B,A){z.updateRowCount();z.render();$("#displayed-policy-users").text(A.current)});v.onRowsChanged.subscribe(function(B,A){z.invalidateRows(A.rows);z.render()});$("#policy-table").data("gridInstance",z);$("#displayed-policy-users").text("0")};var p=function(u,w){var v=function(z,x){if(z.permissions.canRead&&x.permissions.canRead){var y=nf.Common.isDefinedAndNotNull(z.component[u.columnId])?z.component[u.columnId]:"";var A=nf.Common.isDefinedAndNotNull(x.component[u.columnId])?x.component[u.columnId]:"";return y===A?0:y>A?1:-1}else{if(!z.permissions.canRead&&!x.permissions.canRead){return 0}if(z.permissions.canRead){return 1}else{return -1}}};w.sort(v,u.sortAsc)};var e=function(u){nf.Dialog.showYesNoDialog({headerText:"Update Policy",dialogContent:"Remove '"+nf.Common.escapeHtml(u.component.identity)+"' from this policy?",yesHandler:function(){j(u)}})};var j=function(v){var w=$("#policy-table").data("gridInstance");var u=w.getData();u.beginUpdate();u.deleteItem(v.id);u.endUpdate();t()};var k=function(){nf.Dialog.showYesNoDialog({headerText:"Update Policy",dialogContent:"Are you sure you want to delete this policy?",yesHandler:function(){n()}})};var n=function(){var u=$("#policy-table").data("policy");if(nf.Common.isDefinedAndNotNull(u)){$.ajax({type:"DELETE",url:u.uri+"?"+$.param(nf.Client.getRevision(u)),dataType:"json"}).done(function(){a()}).fail(function(x,v,w){nf.Common.handleAjaxError(x,v,w);q();a()})}else{nf.Dialog.showOkDialog({headerText:"Update Policy",dialogContent:"No policy selected"})}};var l=function(){var u=$("#selected-policy-component-id").text();var v=$("#selected-policy-type").text();if(u!==""){v+=("/"+u)}return{action:$("#selected-policy-action").text(),resource:"/"+v}};var d=function(y,w){var x=$("#policy-table").data("gridInstance");var v=x.getData();v.beginUpdate();var u=[];$.each(y,function(A,z){u.push($.extend({type:"user"},z))});$.each(w,function(z,A){u.push($.extend({type:"group"},A))});v.setItems(u);v.endUpdate();v.reSort();x.invalidate();x.getSelectionModel().setSelectedRows([])};var m=function(u){if(u==="/policies"){return"all policies"}else{if(u==="/controller"){return"the controller"}else{return"Process Group "+nf.Common.substringAfterLast(u,"/")}}};var h=function(v){var w=v.component;var u=l();b();$("#policy-table").data("policy",v);$("#new-policy-user-button").prop("disabled",v.permissions.canWrite===false);if(u.resource===w.resource){$("#delete-policy-button").prop("disabled",v.permissions.canWrite===false)}else{$("#policy-message").text("Showing effective policy inherited from "+m(w.resource)+". ");$("#override-policy-message").show();$("#delete-policy-button").prop("disabled",true)}d(w.users,w.userGroups)};var a=function(){var u=l();var v;if(u.resource.startsWith("/policies")){$("#admin-policy-message").show();v=$.Deferred(function(w){$.ajax({type:"GET",url:"../nifi-api/policies/"+u.action+u.resource,dataType:"json"}).done(function(x){$("#policy-last-refreshed").text(x.generated);if(x.permissions.canRead===true){var y=x.component;if(u.resource===y.resource){$("#policy-message").text(y.resource);h(x)}else{q();$("#policy-message").text("No component specific administrators.");$("#add-local-admin-message").show()}}else{q();$("#policy-message").text("No component specific administrators.");$("#add-local-admin-message").show()}w.resolve()}).fail(function(z,x,y){if(z.status===404){q();$("#policy-message").text("No component specific administrators.");$("#add-local-admin-message").show();w.resolve()}else{if(z.status===403){q();$("#policy-message").text("Not authorized to access the policy for the specified resource.");w.resolve()}else{q();w.reject();nf.Common.handleAjaxError(z,x,y)}}})}).promise()}else{$("#admin-policy-message").hide();v=$.Deferred(function(w){$.ajax({type:"GET",url:"../nifi-api/policies/"+u.action+u.resource,dataType:"json"}).done(function(x){$("#policy-last-refreshed").text(x.generated);if(x.permissions.canRead===true){var y=x.component;$("#policy-message").text(y.resource);h(x)}else{q();$("#policy-message").text("Not authorized to view the policy.");$("#override-policy-message").show()}w.resolve()}).fail(function(z,x,y){if(z.status===404){q();$("#policy-message").text("No policy for the specified resource.");$("#new-policy-message").show();w.resolve()}else{if(z.status===403){q();$("#policy-message").text("Not authorized to access the policy for the specified resource.");w.resolve()}else{q();w.reject();nf.Common.handleAjaxError(z,x,y)}}})}).promise()}return v};var g=function(){var v=l();var u={revision:nf.Client.getRevision({revision:{version:0}}),component:{action:v.action,resource:v.resource}};$.ajax({type:"POST",url:"../nifi-api/policies",data:JSON.stringify(u),dataType:"json",contentType:"application/json"}).done(function(w){if(w.permissions.canRead===true){var x=w.component;$("#policy-message").text(x.resource);h(w)}else{q();a()}}).fail(nf.Common.handleAjaxError)};var t=function(){var A=$("#policy-table").data("gridInstance");var y=A.getData();var z=[];var x=[];var w=y.getItems();$.each(w,function(B,C){if(C.type==="user"){z.push(C)}else{x.push(C)}delete C.type});var u=$("#policy-table").data("policy");if(nf.Common.isDefinedAndNotNull(u)){var v={revision:nf.Client.getRevision(u),component:{id:u.id,users:z,userGroups:x}};$.ajax({type:"PUT",url:u.uri,data:JSON.stringify(v),dataType:"json",contentType:"application/json"}).done(function(B){if(B.permissions.canRead===true){var C=B.component;$("#policy-message").text(C.resource);h(B)}else{q();a()}}).fail(function(D,B,C){nf.Common.handleAjaxError(D,B,C);q();a()}).always(function(){nf.Canvas.reload({transition:true})})}else{nf.Dialog.showOkDialog({headerText:"Update Policy",dialogContent:"No policy selected"})}};var i=function(){nf.Shell.showContent("#policy-management").always(function(){r()});nf.PolicyManagement.resetTableSize()};var b=function(){$("#policy-message").text("");$("#new-policy-message").hide();$("#override-policy-message").hide();$("#add-local-admin-message").hide()};var q=function(){b();$("#delete-policy-button").prop("disabled",true);$("#new-policy-user-button").prop("disabled",true);$("#policy-table").removeData("policy");d([],[])};var r=function(){q();$("#selected-policy-type").text("");$("#selected-policy-action").text("");$("#selected-policy-component-id").text("");$("#selected-policy-component-type").text("");$("div.policy-selected-component-container").hide()};return{init:function(){c();o();$("#policy-refresh-button").on("click",function(){a()});q();f=true},resetTableSize:function(){var u=$("#policy-table");if(u.is(":visible")){var v=u.data("gridInstance");if(nf.Common.isDefinedAndNotNull(v)){v.resizeCanvas()}}},showControllerServicePolicy:function(u){b();$("#component-policy-controls").show();$("#global-policy-controls").hide();if(u.permissions.canRead===true){$("#policy-selected-controller-service-container div.policy-selected-component-name").text(u.component.name)}else{$("#policy-selected-controller-service-container div.policy-selected-component-name").text(u.id)}$("#policy-selected-controller-service-container").show();$("#selected-policy-component-id").text(u.id);$("#selected-policy-component-type").text("controller-services");$("#component-policy-target").combo("setOptionEnabled",{value:"write-receive-data"},false).combo("setOptionEnabled",{value:"write-send-data"},false).combo("setOptionEnabled",{value:"read-data"},false).combo("setOptionEnabled",{value:"write-data"},false).combo("setSelectedOption",{value:"read-component"});return a().always(i)},showReportingTaskPolicy:function(u){b();$("#component-policy-controls").show();$("#global-policy-controls").hide();if(u.permissions.canRead===true){$("#policy-selected-reporting-task-container div.policy-selected-component-name").text(u.component.name)}else{$("#policy-selected-reporting-task-container div.policy-selected-component-name").text(u.id)}$("#policy-selected-reporting-task-container").show();$("#selected-policy-component-id").text(u.id);$("#selected-policy-component-type").text("reporting-tasks");$("#component-policy-target").combo("setOptionEnabled",{value:"write-receive-data"},false).combo("setOptionEnabled",{value:"write-send-data"},false).combo("setOptionEnabled",{value:"read-data"},false).combo("setOptionEnabled",{value:"write-data"},false).combo("setSelectedOption",{value:"read-component"});return a().always(i)},showTemplatePolicy:function(u){b();$("#component-policy-controls").show();$("#global-policy-controls").hide();if(u.permissions.canRead===true){$("#policy-selected-template-container div.policy-selected-component-name").text(u.template.name)}else{$("#policy-selected-template-container div.policy-selected-component-name").text(u.id)}$("#policy-selected-template-container").show();$("#selected-policy-component-id").text(u.id);$("#selected-policy-component-type").text("templates");$("#component-policy-target").combo("setOptionEnabled",{value:"write-receive-data"},false).combo("setOptionEnabled",{value:"write-send-data"},false).combo("setOptionEnabled",{value:"read-data"},false).combo("setOptionEnabled",{value:"write-data"},false).combo("setSelectedOption",{value:"read-component"});return a().always(i)},showComponentPolicy:function(u){b();$("#component-policy-controls").show();$("#global-policy-controls").hide();$("#policy-selected-component-container").show();var v;if(u.empty()){$("#selected-policy-component-id").text(nf.Canvas.getGroupId());v="process-groups";$("#component-policy-target").combo("setOptionEnabled",{value:"write-receive-data"},false).combo("setOptionEnabled",{value:"write-send-data"},false).combo("setOptionEnabled",{value:"read-data"},true).combo("setOptionEnabled",{value:"write-data"},true)}else{var w=u.datum();$("#selected-policy-component-id").text(w.id);if(nf.CanvasUtils.isProcessor(u)){v="processors"}else{if(nf.CanvasUtils.isProcessGroup(u)){v="process-groups"}else{if(nf.CanvasUtils.isInputPort(u)){v="input-ports"}else{if(nf.CanvasUtils.isOutputPort(u)){v="output-ports"}else{if(nf.CanvasUtils.isRemoteProcessGroup(u)){v="remote-process-groups"}else{if(nf.CanvasUtils.isLabel(u)){v="labels"}else{if(nf.CanvasUtils.isFunnel(u)){v="funnels"}}}}}}}$("#component-policy-target").combo("setOptionEnabled",{value:"write-receive-data"},nf.CanvasUtils.isInputPort(u)&&nf.Canvas.getParentGroupId()===null).combo("setOptionEnabled",{value:"write-send-data"},nf.CanvasUtils.isOutputPort(u)&&nf.Canvas.getParentGroupId()===null).combo("setOptionEnabled",{value:"read-data"},!nf.CanvasUtils.isLabel(u)).combo("setOptionEnabled",{value:"write-data"},!nf.CanvasUtils.isLabel(u))}$("#selected-policy-component-type").text(v);$("#component-policy-target").combo("setSelectedOption",{value:"read-component"});return a().always(i)},showGlobalPolicies:function(){b();$("#component-policy-controls").hide();$("#global-policy-controls").show();var u=$("#policy-type-list").combo("getSelectedOption").value;$("#selected-policy-type").text(u);if(u==="controller"){$("#selected-policy-action").text($("#controller-policy-target").combo("getSelectedOption").value)}else{if(u==="proxy"){$("#selected-policy-action").text("write")}else{$("#selected-policy-action").text("read")}}return a().always(i)}}}());
nf.RemoteProcessGroupConfiguration=(function(){return{init:function(){$("#remote-process-group-configuration").modal({headerText:"Configure Remote Process Group",scrollableContentStyle:"scrollable",buttons:[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){var a=$("#remote-process-group-id").text();var b=d3.select("#id-"+a).datum();var c={revision:nf.Client.getRevision(b),component:{id:a,communicationsTimeout:$("#remote-process-group-timeout").val(),yieldDuration:$("#remote-process-group-yield-duration").val(),transportProtocol:$("#remote-process-group-transport-protocol-combo").combo("getSelectedOption").value,proxyHost:$("#remote-process-group-proxy-host").val(),proxyPort:$("#remote-process-group-proxy-port").val(),proxyUser:$("#remote-process-group-proxy-user").val(),proxyPassword:$("#remote-process-group-proxy-password").val()}};$.ajax({type:"PUT",data:JSON.stringify(c),url:b.uri,dataType:"json",contentType:"application/json"}).done(function(d){nf.RemoteProcessGroup.set(d);nf.ng.Bridge.digest();$("#remote-process-group-configuration").modal("hide")}).fail(function(g,d,e){if(g.status===400){var h=g.responseText.split("\n");var f;if(h.length===1){f=$("<span></span>").text(h[0])}else{f=nf.Common.formatUnorderedList(h)}nf.Dialog.showOkDialog({dialogContent:f,headerText:"Remote Process Group Configuration"})}else{nf.Common.handleAjaxError(g,d,e)}})}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){$("#remote-process-group-configuration").modal("hide")}}}],handler:{close:function(){$("#remote-process-group-id").text("");$("#remote-process-group-name").text("");$("#remote-process-group-url").text("");$("#remote-process-group-timeout").val("");$("#remote-process-group-yield-duration").val("");$("#remote-process-group-transport-protocol-combo").combo("setSelectedOption",{value:"RAW"});$("#remote-process-group-proxy-host").val("");$("#remote-process-group-proxy-port").val("");$("#remote-process-group-proxy-user").val("");$("#remote-process-group-proxy-password").val("")}}});$("#remote-process-group-transport-protocol-combo").combo({options:[{text:"RAW",value:"RAW"},{text:"HTTP",value:"HTTP"}]})},showConfiguration:function(a){if(nf.CanvasUtils.isRemoteProcessGroup(a)){var b=a.datum();$("#remote-process-group-id").text(b.id);$("#remote-process-group-name").text(b.component.name);$("#remote-process-group-url").text(b.component.targetUri);$("#remote-process-group-timeout").val(b.component.communicationsTimeout);$("#remote-process-group-yield-duration").val(b.component.yieldDuration);$("#remote-process-group-proxy-host").val(b.component.proxyHost);$("#remote-process-group-proxy-port").val(b.component.proxyPort);$("#remote-process-group-proxy-user").val(b.component.proxyUser);$("#remote-process-group-proxy-password").val(b.component.proxyPassword);$("#remote-process-group-transport-protocol-combo").combo("setSelectedOption",{value:b.component.transportProtocol});$("#remote-process-group-configuration").modal("show")}}}}());
nf.RemoteProcessGroupDetails=(function(){return{init:function(){$("#remote-process-group-details").modal({headerText:"Remote Process Group Details",scrollableContentStyle:"scrollable",buttons:[{buttonText:"Ok",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){$("#remote-process-group-details").modal("hide")}}}],handler:{close:function(){nf.Common.clearField("read-only-remote-process-group-id");nf.Common.clearField("read-only-remote-process-group-name");nf.Common.clearField("read-only-remote-process-group-url");nf.Common.clearField("read-only-remote-process-group-timeout");nf.Common.clearField("read-only-remote-process-group-yield-duration");nf.Common.clearField("read-only-remote-process-group-transport-protocol");nf.Common.clearField("read-only-remote-process-group-proxy-host");nf.Common.clearField("read-only-remote-process-group-proxy-port");nf.Common.clearField("read-only-remote-process-group-proxy-user");nf.Common.clearField("read-only-remote-process-group-proxy-password")}}})},showDetails:function(a){if(nf.CanvasUtils.isRemoteProcessGroup(a)){var b=a.datum();nf.Common.populateField("read-only-remote-process-group-id",b.id);nf.Common.populateField("read-only-remote-process-group-name",b.component.name);nf.Common.populateField("read-only-remote-process-group-url",b.component.targetUri);nf.Common.populateField("read-only-remote-process-group-timeout",b.component.communicationsTimeout);nf.Common.populateField("read-only-remote-process-group-yield-duration",b.component.yieldDuration);nf.Common.populateField("read-only-remote-process-group-transport-protocol",b.component.transportProtocol);nf.Common.populateField("read-only-remote-process-group-proxy-host",b.component.proxyHost);nf.Common.populateField("read-only-remote-process-group-proxy-port",b.component.proxyPort);nf.Common.populateField("read-only-remote-process-group-proxy-user",b.component.proxyUser);nf.Common.populateField("read-only-remote-process-group-proxy-password",b.component.proxyPassword);$("#remote-process-group-details").modal("show")}}}}());
nf.RemoteProcessGroupPorts=(function(){var b=function(){$("#remote-port-configuration").modal({headerText:"Configure Remote Port",scrollableContentStyle:"scrollable",buttons:[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){var f=$("#remote-port-concurrent-tasks").val();if($.isNumeric(f)){var e=$("#remote-process-group-ports-id").text();var j=d3.select("#id-"+e).datum();var i=$("#remote-port-id").text();var h={revision:nf.Client.getRevision(j),remoteProcessGroupPort:{id:i,groupId:e,useCompression:$("#remote-port-use-compression").hasClass("checkbox-checked"),concurrentlySchedulableTaskCount:f}};var g="/output-ports/";if($("#remote-port-type").text()==="input"){g="/input-ports/"}$.ajax({type:"PUT",data:JSON.stringify(h),url:j.uri+g+encodeURIComponent(i),dataType:"json",contentType:"application/json"}).done(function(k){var l=k.remoteProcessGroupPort;var m="No";if(l.useCompression===true){m="Yes"}$("#"+i+"-concurrent-tasks").text(l.concurrentlySchedulableTaskCount);$("#"+i+"-compression").text(m)}).fail(function(n,k,l){if(n.status===400){var o=n.responseText.split("\n");var m;if(o.length===1){m=$("<span></span>").text(o[0])}else{m=nf.Common.formatUnorderedList(o)}nf.Dialog.showOkDialog({dialogContent:m,headerText:"Remote Process Group Ports"})}else{nf.Common.handleAjaxError(n,k,l)}}).always(function(){$("#remote-port-configuration").modal("hide")})}else{nf.Dialog.showOkDialog({headerText:"Remote Process Group Ports",dialogContent:"Concurrent tasks must be an integer value."});$("#remote-port-configuration").modal("hide")}}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){$("#remote-port-configuration").modal("hide")}}}],handler:{close:function(){$("#remote-port-id").text("");$("#remote-port-name").text("");$("#remote-port-concurrent-tasks").val("");$("#remote-port-use-compression").removeClass("checkbox-checked checkbox-unchecked")}}})};var a=function(){$("#remote-process-group-ports").modal({scrollableContentStyle:"scrollable",headerText:"Remote Process Group Ports",buttons:[{buttonText:"Close",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){var e=$("#remote-process-group-ports-id").text();var g=d3.select("#id-"+e);var f=g.datum();if(nf.CanvasUtils.canModify(g)){nf.RemoteProcessGroup.reload(f.id)}$("#remote-process-group-ports").modal("hide")}}}],handler:{close:function(){$("#remote-process-group-ports-id").text("");$("#remote-process-group-ports-name").text("");$("#remote-process-group-ports-url").text("");var e=$("#remote-process-group-ports");nf.Common.cleanUpTooltips(e,"div.remote-port-removed");nf.Common.cleanUpTooltips(e,"div.concurrent-tasks-info");$("#remote-process-group-input-ports-container").empty();$("#remote-process-group-output-ports-container").empty()}}})};var c=function(h,k,i){var m=nf.Common.escapeHtml(k.id);var f=$('<div class="remote-port-container"></div>').appendTo(h);var s=$('<div class="remote-port-edit-container"></div>').appendTo(f);var g=$('<div class="remote-port-details-container"></div>').appendTo(f);var l=$("#remote-process-group-ports-id").text();var o=d3.select("#id-"+l);if(nf.CanvasUtils.canModify(o)){var e;if(k.connected===true){if(k.transmitting===true){e=(nf.ng.Bridge.injector.get("$compile")($('<md-switch style="margin:0px" class="md-primary enabled-active-transmission" aria-label="Toggle port transmission"></md-switch>'))(nf.ng.Bridge.rootScope)).appendTo(s);e.click()}else{if(k.exists===true){e=(nf.ng.Bridge.injector.get("$compile")($('<md-switch style="margin:0px" class="md-primary enabled-inactive-transmission" aria-label="Toggle port transmission"></md-switch>'))(nf.ng.Bridge.rootScope)).appendTo(s)}else{(nf.ng.Bridge.injector.get("$compile")($('<md-switch style="margin:0px" class="md-primary disabled-inactive-transmission" aria-label="Toggle port transmission"></md-switch>'))(nf.ng.Bridge.rootScope)).appendTo(s)}}}else{if(k.transmitting===true){(nf.ng.Bridge.injector.get("$compile")($('<md-switch style="margin:0px" class="md-primary disabled-active-transmission" aria-label="Toggle port transmission"></md-switch>'))(nf.ng.Bridge.rootScope)).appendTo(s)}else{(nf.ng.Bridge.injector.get("$compile")($('<md-switch style="margin:0px" class="md-primary disabled-inactive-transmission" aria-label="Toggle port transmission"></md-switch>'))(nf.ng.Bridge.rootScope)).appendTo(s)}}if(k.exists===true&&k.connected===true){var j=$('<button class="button edit-remote-port fa fa-pencil"></button>').click(function(){var v=$("#"+m+"-name").text();var u=$("#"+m+"-concurrent-tasks").text();var t=$("#"+m+"-compression").text()==="Yes";d(k.id,v,u,t,i)}).appendTo(s);if(k.transmitting===true){j.hide()}else{j.show()}}else{if(k.exists===false){$('<div class="remote-port-removed"/>').appendTo(s).qtip($.extend({},nf.Common.config.tooltipConfig,{content:"This port has been removed."}))}}if(nf.Common.isDefinedAndNotNull(e)){e.click(function(){var t=$("#remote-process-group-ports-id").text();var w=d3.select("#id-"+t).datum();var x=false;if(e.hasClass("enabled-inactive-transmission")){x=true}var v={revision:nf.Client.getRevision(w),remoteProcessGroupPort:{id:k.id,groupId:t,transmitting:x}};var u="/output-ports/";if(i==="input"){u="/input-ports/"}$.ajax({type:"PUT",data:JSON.stringify(v),url:w.uri+u+encodeURIComponent(k.id),dataType:"json",contentType:"application/json"}).done(function(y){var z=y.remoteProcessGroupPort;if(z.exists===false){e.removeClass("enabled-active-transmission enabled-inactive-transmission").addClass("disabled-inactive-transmission").off("click");if(nf.Common.isDefinedAndNotNull(j)){j.hide()}}else{if(z.transmitting===true){e.removeClass("enabled-active-transmission enabled-inactive-transmission").addClass("enabled-active-transmission");if(nf.Common.isDefinedAndNotNull(j)){j.hide()}}else{e.removeClass("enabled-active-transmission enabled-inactive-transmission").addClass("enabled-inactive-transmission");if(nf.Common.isDefinedAndNotNull(j)){j.show()}}}}).fail(function(B,y,z){if(B.status===400){var C=B.responseText.split("\n");var A;if(C.length===1){A=$("<span></span>").text(C[0])}else{A=nf.Common.formatUnorderedList(C)}nf.Dialog.showOkDialog({headerText:"Remote Process Group Ports",dialogContent:A})}else{nf.Common.handleAjaxError(B,y,z)}})})}}else{if(k.transmitting===true){(nf.ng.Bridge.injector.get("$compile")($('<md-switch style="margin:0px" class="md-primary disabled-active-transmission" aria-label="Toggle port transmission"></md-switch>'))(nf.ng.Bridge.rootScope)).appendTo(s)}else{(nf.ng.Bridge.injector.get("$compile")($('<md-switch style="margin:0px" class="md-primary disabled-inactive-transmission" aria-label="Toggle port transmission"></md-switch>'))(nf.ng.Bridge.rootScope)).appendTo(s)}}$('<div id="'+m+'-id" class="remote-port-id hidden"></div>').text(k.id).appendTo(g);$('<div id="'+m+'-name" class="remote-port-name ellipsis"></div>').text(k.name).appendTo(g);$('<div class="clear"></div>').appendTo(g);if(nf.Common.isBlank(k.comments)){$('<div class="remote-port-description unset">No description specified.</div>').appendTo(g)}else{$('<div class="remote-port-description"></div>').text(k.comments).appendTo(g)}$('<div class="clear"></div>').appendTo(g);var n=$('<div class="concurrent-task-container"></div>').appendTo(g);var p=$('<div class="setting-value"></div>').append($('<div id="'+m+'-concurrent-tasks"></div>').text(k.concurrentlySchedulableTaskCount));$('<div><div class="setting-name">Concurrent tasks<div class="processor-setting concurrent-tasks-info fa fa-question-circle"></div></div></div>').append(p).appendTo(n).find("div.concurrent-tasks-info").qtip($.extend({},nf.Common.config.tooltipConfig,{content:"The number of tasks that should be concurrently scheduled for this port."}));var q=$('<div class="compression-container"></div>').appendTo(g);var r="No";if(k.useCompression===true){r="Yes"}$('<div><div class="setting-name">Compressed</div><div class="setting-value"><div id="'+m+'-compression">'+r+"</div></div></div>").appendTo(q);$('<div class="clear"></div>').appendTo(f);f.find(".ellipsis").ellipsis()};var d=function(g,j,i,f,e){$("#remote-port-id").text(g);$("#remote-port-type").text(e);var h="checkbox-unchecked";if(f===true){h="checkbox-checked"}$("#remote-port-use-compression").addClass(h);$("#remote-port-concurrent-tasks").val(i);$("#remote-port-name").text(j).ellipsis();$("#remote-port-configuration").modal("show")};return{init:function(){b();a()},showPorts:function(e){if(nf.CanvasUtils.isRemoteProcessGroup(e)){var f=e.datum();$.ajax({type:"GET",url:f.uri,dataType:"json"}).done(function(h){var k=h.component;nf.RemoteProcessGroup.set(h);$("#remote-process-group-ports-id").text(k.id);$("#remote-process-group-ports-name").text(k.name);$("#remote-process-group-ports-url").text(k.targetUri);var g=k.contents;if(nf.Common.isDefinedAndNotNull(g)){var n=[];var i=[];var m=$("#remote-process-group-input-ports-container");$.each(g.inputPorts,function(q,p){if(p.connected===true){n.push(p)}else{i.push(p)}});$.each(n,function(q,p){c(m,p,"input")});$.each(i,function(q,p){c(m,p,"input")});var j=[];var o=[];var l=$("#remote-process-group-output-ports-container");$.each(g.outputPorts,function(p,q){if(q.connected===true){j.push(q)}else{o.push(q)}});$.each(j,function(p,q){c(l,q,"output")});$.each(o,function(p,q){c(l,q,"output")})}$("#remote-process-group-ports").modal("show")}).fail(nf.Common.handleAjaxError)}}}}());
nf.PortConfiguration=(function(){var a=function(){$("#port-configuration").modal({scrollableContentStyle:"scrollable",headerText:"Configure Port",buttons:[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){var e=$("#port-id").text();var c=d3.select("#id-"+e).datum();var b={id:e,name:$("#port-name").val(),comments:$("#port-comments").val()};if($("#port-concurrent-task-container").is(":visible")){b.concurrentlySchedulableTaskCount=$("#port-concurrent-tasks").val()}if($("#port-enabled").hasClass("checkbox-unchecked")){b.state="DISABLED"}else{if($("#port-enabled").hasClass("checkbox-checked")){b.state="STOPPED"}}var d={revision:nf.Client.getRevision(c),component:b};$.ajax({type:"PUT",data:JSON.stringify(d),url:c.uri,dataType:"json",contentType:"application/json"}).done(function(f){nf.Port.set(f);nf.ng.Bridge.digest();$("#port-configuration").modal("hide")}).fail(function(i,f,g){if(i.status===400){var j=i.responseText.split("\n");var h;if(j.length===1){h=$("<span></span>").text(j[0])}else{h=nf.Common.formatUnorderedList(j)}nf.Dialog.showOkDialog({dialogContent:h,headerText:"Port Configuration"})}else{$("#port-configuration").modal("hide");nf.Common.handleAjaxError(i,f,g)}})}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){$("#port-configuration").modal("hide")}}}],handler:{close:function(){$("#port-id").text("");$("#port-name").val("");$("#port-enabled").removeClass("checkbox-unchecked checkbox-checked");$("#port-concurrent-tasks").val("");$("#port-comments").val("")}}})};return{init:function(){a()},showConfiguration:function(c){if(nf.CanvasUtils.isInputPort(c)||nf.CanvasUtils.isOutputPort(c)){var d=c.datum();var b="checkbox-checked";if(d.component.state==="DISABLED"){b="checkbox-unchecked"}if(nf.Canvas.getParentGroupId()===null){$("#port-concurrent-task-container").show()}else{$("#port-concurrent-task-container").hide()}$("#port-id").text(d.id);$("#port-name").val(d.component.name);$("#port-enabled").removeClass("checkbox-unchecked checkbox-checked").addClass(b);$("#port-concurrent-tasks").val(d.component.concurrentlySchedulableTaskCount);$("#port-comments").val(d.component.comments);$("#port-configuration").modal("show")}}}}());
nf.PortDetails=(function(){return{init:function(){$("#port-details").modal({scrollableContentStyle:"scrollable",headerText:"Port Details",buttons:[{buttonText:"Ok",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){$("#port-details").modal("hide")}}}],handler:{close:function(){nf.Common.clearField("read-only-port-name");nf.Common.clearField("read-only-port-id");nf.Common.clearField("read-only-port-comments")}}})},showDetails:function(a){if(nf.CanvasUtils.isInputPort(a)||nf.CanvasUtils.isOutputPort(a)){var b=a.datum();nf.Common.populateField("read-only-port-name",b.component.name);nf.Common.populateField("read-only-port-id",b.id);nf.Common.populateField("read-only-port-comments",b.component.comments);$("#port-details").modal("show")}}}}());
nf.LabelConfiguration=(function(){var a="";return{init:function(){$("#label-configuration").modal({scrollableContentStyle:"scrollable",headerText:"Configure Label",buttons:[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){var f=d3.select("#id-"+a).datum();var e=$("#label-value").val();var g=$("#label-font-size").combo("getSelectedOption");var d={revision:nf.Client.getRevision(f),component:{id:a,label:e,style:{"font-size":g.value}}};$.ajax({type:"PUT",url:f.uri,data:JSON.stringify(d),dataType:"json",contentType:"application/json"}).done(function(h){nf.Label.set(h);nf.ng.Bridge.digest()}).fail(nf.Common.handleAjaxError);this.modal("hide")}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){this.modal("hide")}}}],handler:{close:function(){a=""}}});var c=[];for(var b=12;b<=24;b+=2){c.push({text:b+"px",value:b+"px"})}$("#label-font-size").combo({options:c,selectedOption:{value:"12px"},select:function(e){var d=$("#label-value");d.css({"font-size":e.value,"line-height":e.value}).val(d.val())}})},showConfiguration:function(c){if(nf.CanvasUtils.isLabel(c)){var e=c.datum();var b="";if(nf.Common.isDefinedAndNotNull(e.component.label)){b=e.component.label}var d="12px";if(nf.Common.isDefinedAndNotNull(e.component.style["font-size"])){d=e.component.style["font-size"]}a=e.id;$("#label-value").val(b);$("#label-font-size").combo("setSelectedOption",{value:d});$("#label-configuration").modal("show")}}}}());
nf.ConnectionConfiguration=(function(){var u=75;var f=200;var w={urls:{api:"../nifi-api",prioritizers:"../nifi-api/flow/prioritizers"}};var j=function(){d3.select("path.connector").remove()};var b=function(z){if(nf.CanvasUtils.isProcessor(z)){return $.Deferred(function(A){i(z).done(function(C){if(!nf.Common.isEmpty(C.relationships)){$.each(C.relationships,function(D,E){r(E.name)});var B=$("#relationship-names").children("div");if(B.length===1){B.children("div.available-relationship").removeClass("checkbox-unchecked").addClass("checkbox-checked")}$("#connection-configuration").modal("setButtonModel",[{buttonText:"Add",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){var D=l();if(D.length>0){o(D)}else{nf.Dialog.showOkDialog({headerText:"Connection Configuration",dialogContent:"The connection must have at least one relationship selected."})}$("#connection-configuration").modal("hide")}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){$("#connection-configuration").modal("hide")}}}]);A.resolve()}else{nf.Dialog.showOkDialog({headerText:"Connection Configuration",dialogContent:"'"+nf.Common.escapeHtml(C.name)+"' does not support any relationships."});e();A.reject()}}).fail(function(){A.reject()})}).promise()}else{return $.Deferred(function(B){var A;if(nf.CanvasUtils.isInputPort(z)){A=c(z)}else{if(nf.CanvasUtils.isRemoteProcessGroup(z)){A=k(z)}else{if(nf.CanvasUtils.isProcessGroup(z)){A=s(z)}else{A=g(z)}}}A.done(function(){$("#connection-configuration").modal("setButtonModel",[{buttonText:"Add",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){o();$("#connection-configuration").modal("hide")}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){$("#connection-configuration").modal("hide")}}}]);B.resolve()}).fail(function(){B.reject()})}).promise()}};var c=function(z){return $.Deferred(function(B){var A=z.datum();var C=A.permissions.canRead?A.component.name:A.id;$("#input-port-source").show();$("#input-port-source-name").text(C);$("#connection-source-id").val(A.id);$("#connection-source-component-id").val(A.id);$("#connection-source-group-id").val(nf.Canvas.getGroupId());$("#connection-source-group-name").text(nf.Canvas.getGroupName());B.resolve()}).promise()};var g=function(z){return $.Deferred(function(B){var A=z.datum();$("#funnel-source").show();$("#connection-source-id").val(A.id);$("#connection-source-component-id").val(A.id);$("#connection-source-group-id").val(nf.Canvas.getGroupId());$("#connection-source-group-name").text(nf.Canvas.getGroupName());B.resolve()}).promise()};var i=function(z){return $.Deferred(function(B){var A=z.datum();var C=A.permissions.canRead?A.component.name:A.id;var D=A.permissions.canRead?nf.Common.substringAfterLast(A.component.type,"."):"Processor";$("#processor-source").show();$("#processor-source-name").text(C);$("#processor-source-type").text(D);$("#connection-source-id").val(A.id);$("#connection-source-component-id").val(A.id);$("#connection-source-group-id").val(nf.Canvas.getGroupId());$("#connection-source-group-name").text(nf.Canvas.getGroupName());$("#relationship-names-container").show();B.resolve(A.component)})};var s=function(z){return $.Deferred(function(A){var B=z.datum();$.ajax({type:"GET",url:w.urls.api+"/flow/process-groups/"+encodeURIComponent(B.id),dataType:"json"}).done(function(C){var G=C.processGroupFlow;var F=C.permissions.canRead?G.breadcrumb.breadcrumb.name:G.id;var H=G.flow;var D=[];$.each(H.outputPorts,function(J,K){if(K.permissions.canRead&&K.permissions.canWrite){var I=K.component;D.push({text:I.name,value:I.id,description:nf.Common.escapeHtml(I.comments)})}});if(!nf.Common.isEmpty(D)){$("#output-port-source").show();D.sort(function(J,I){return J.text.localeCompare(I.text)});$("#output-port-options").combo({options:D,maxHeight:300,select:function(I){$("#connection-source-id").val(I.value)}});$("#connection-source-component-id").val(G.id);$("#connection-source-group-id").val(G.id);$("#connection-source-group-name").text(F);A.resolve()}else{var E="'"+nf.Common.escapeHtml(F)+"' does not have any output ports.";if(nf.Common.isEmpty(H.outputPorts)===false){E="Not authorized for any output ports in '"+nf.Common.escapeHtml(F)+"'."}nf.Dialog.showOkDialog({headerText:"Connection Configuration",dialogContent:E});e();A.reject()}}).fail(function(E,C,D){nf.Common.handleAjaxError(E,C,D);A.reject()})}).promise()};var k=function(z){return $.Deferred(function(A){var B=z.datum();$.ajax({type:"GET",url:B.uri,dataType:"json"}).done(function(C){var E=C.component;var F=E.contents;if(!nf.Common.isEmpty(F.outputPorts)){$("#output-port-source").show();var D=[];$.each(F.outputPorts,function(G,H){D.push({text:H.name,value:H.id,disabled:H.exists===false,description:nf.Common.escapeHtml(H.comments)})});D.sort(function(H,G){return H.text.localeCompare(G.text)});$("#output-port-options").combo({options:D,maxHeight:300,select:function(G){$("#connection-source-id").val(G.value)}});$("#connection-source-component-id").val(E.id);$("#connection-source-group-id").val(E.id);$("#connection-source-group-name").text(E.name);A.resolve()}else{nf.Dialog.showOkDialog({headerText:"Connection Configuration",dialogContent:"'"+nf.Common.escapeHtml(E.name)+"' does not have any output ports."});e();A.reject()}}).fail(function(E,C,D){nf.Common.handleAjaxError(E,C,D);A.reject()})}).promise()};var q=function(z){if(nf.CanvasUtils.isOutputPort(z)){return n(z)}else{if(nf.CanvasUtils.isProcessor(z)){return v(z)}else{if(nf.CanvasUtils.isRemoteProcessGroup(z)){return t(z)}else{if(nf.CanvasUtils.isFunnel(z)){return d(z)}else{return m(z)}}}}};var n=function(z){return $.Deferred(function(A){var C=z.datum();var B=C.permissions.canRead?C.component.name:C.id;$("#output-port-destination").show();$("#output-port-destination-name").text(B);$("#connection-destination-id").val(C.id);$("#connection-destination-component-id").val(C.id);$("#connection-destination-group-id").val(nf.Canvas.getGroupId());$("#connection-destination-group-name").text(nf.Canvas.getGroupName());A.resolve()}).promise()};var d=function(z){return $.Deferred(function(B){var A=z.datum();$("#funnel-destination").show();$("#connection-destination-id").val(A.id);$("#connection-destination-component-id").val(A.id);$("#connection-destination-group-id").val(nf.Canvas.getGroupId());$("#connection-destination-group-name").text(nf.Canvas.getGroupName());B.resolve()}).promise()};var v=function(z){return $.Deferred(function(B){var A=z.datum();var C=A.permissions.canRead?A.component.name:A.id;var D=A.permissions.canRead?nf.Common.substringAfterLast(A.component.type,"."):"Processor";$("#processor-destination").show();$("#processor-destination-name").text(C);$("#processor-destination-type").text(D);$("#connection-destination-id").val(A.id);$("#connection-destination-component-id").val(A.id);$("#connection-destination-group-id").val(nf.Canvas.getGroupId());$("#connection-destination-group-name").text(nf.Canvas.getGroupName());B.resolve()}).promise()};var m=function(z){return $.Deferred(function(A){var B=z.datum();$.ajax({type:"GET",url:w.urls.api+"/flow/process-groups/"+encodeURIComponent(B.id),dataType:"json"}).done(function(C){var F=C.processGroupFlow;var E=C.permissions.canRead?F.breadcrumb.breadcrumb.name:F.id;var G=F.flow;var D=[];$.each(G.inputPorts,function(I,H){D.push({text:H.permissions.canRead?H.component.name:H.id,value:H.id,description:H.permissions.canRead?nf.Common.escapeHtml(H.component.comments):null})});if(!nf.Common.isEmpty(D)){$("#input-port-destination").show();D.sort(function(I,H){return I.text.localeCompare(H.text)});$("#input-port-options").combo({options:D,maxHeight:300,select:function(H){$("#connection-destination-id").val(H.value)}});$("#connection-destination-component-id").val(F.id);$("#connection-destination-group-id").val(F.id);$("#connection-destination-group-name").text(E);A.resolve()}else{nf.Dialog.showOkDialog({headerText:"Connection Configuration",dialogContent:"'"+nf.Common.escapeHtml(E)+"' does not have any input ports."});e();A.reject()}}).fail(function(E,C,D){nf.Common.handleAjaxError(E,C,D);A.reject()})}).promise()};var t=function(z,A){return $.Deferred(function(B){var C=z.datum();$.ajax({type:"GET",url:C.uri,dataType:"json"}).done(function(D){var F=D.component;var G=F.contents;if(!nf.Common.isEmpty(G.inputPorts)){$("#input-port-destination").show();var E=[];$.each(G.inputPorts,function(I,H){E.push({text:H.name,value:H.id,disabled:H.exists===false,description:nf.Common.escapeHtml(H.comments)})});E.sort(function(I,H){return I.text.localeCompare(H.text)});$("#input-port-options").combo({options:E,maxHeight:300,select:function(H){$("#connection-destination-id").val(H.value)}});$("#connection-destination-component-id").val(F.id);$("#connection-destination-group-id").val(F.id);$("#connection-destination-group-name").text(F.name);B.resolve()}else{nf.Dialog.showOkDialog({headerText:"Connection Configuration",dialogContent:"'"+nf.Common.escapeHtml(F.name)+"' does not have any input ports."});e();B.reject()}}).fail(function(F,D,E){nf.Common.handleAjaxError(F,D,E);B.reject()})}).promise()};var a=function(z){return $.Deferred(function(B){var C=z.datum();var A=C.permissions.canRead?C.component.name:C.id;$("#read-only-output-port-source").show();$("#connection-source-component-id").val(C.id);$("#connection-source-group-id").val(C.id);$("#connection-source-group-name").text(A);B.resolve()}).promise()};var p=function(z){if(nf.CanvasUtils.isProcessor(z)){return i(z)}else{if(nf.CanvasUtils.isInputPort(z)){return c(z)}else{if(nf.CanvasUtils.isFunnel(z)){return g(z)}else{return a(z)}}}};var h=function(z,A){if(nf.CanvasUtils.isProcessor(z)){return v(z)}else{if(nf.CanvasUtils.isOutputPort(z)){return n(z)}else{if(nf.CanvasUtils.isRemoteProcessGroup(z)){return t(z,A)}else{if(nf.CanvasUtils.isFunnel(z)){return d(z)}else{return m(z)}}}}};var r=function(A){var z=$('<div class="relationship-name ellipsis"></div>').text(A);var B=$('<span class="relationship-name-value hidden"></span>').text(A);return $('<div class="available-relationship-container"><div class="available-relationship nf-checkbox checkbox-unchecked"></div></div>').append(z).append(B).appendTo("#relationship-names")};var o=function(B){var V=$("#connection-source-id").val();var S=$("#connection-destination-id").val();var Z=$("#connection-source-component-id").val();var P=d3.select("#id-"+Z);var T=$("#connection-destination-component-id").val();var I=d3.select("#id-"+T);var ag=P.datum();var J=I.datum();var C=[];if(Z===T){var O={x:ag.position.x+(ag.dimensions.width),y:ag.position.y+(ag.dimensions.height/2)};var U=nf.Connection.config.selfLoopXOffset;var W=nf.Connection.config.selfLoopYOffset;C.push({x:(O.x+U),y:(O.y-W)});C.push({x:(O.x+U),y:(O.y+W)})}else{var ae=[];var Y=nf.Connection.getComponentConnections(Z);$.each(Y,function(aj,am){var ak=nf.CanvasUtils.getConnectionSourceComponentId(am);var al=nf.CanvasUtils.getConnectionDestinationComponentId(am);if((ak===Z&&al===T)||(al===Z&&ak===T)){ae.push(am)}});if(ae.length>0){var D=false;$.each(ae,function(aj,ak){if(nf.Common.isEmpty(ak.bends)){D=true;return false}});if(D===true){var Q=[ag.position.x+(ag.dimensions.width/2),ag.position.y+(ag.dimensions.height/2)];var A=[J.position.x+(J.dimensions.width/2),J.position.y+(J.dimensions.height/2)];var N=((Q[1]-A[1])/(Q[0]-A[0]));var ac=N<=1&&N>=-1;var X=function(aj,al){var ak=false;$.each(ae,function(am,an){if(!nf.Common.isEmpty(an.bends)){if(ac){if(an.bends[0].y===al){ak=true;return false}}else{if(an.bends[0].x===aj){ak=true;return false}}}});return ak};var G=(Q[0]+A[0])/2;var K=(Q[1]+A[1])/2;var ab=ac?0:f;var M=ac?u:0;var ad=false;while(ad===false){if(X(G-ab,K-M)===false){C.push({x:(G-ab),y:(K-M)});ad=true}else{if(X(G+ab,K+M)===false){C.push({x:(G+ab),y:(K+M)});ad=true}}if(ac){M+=u}else{ab+=f}}}}}var F=$("#connection-source-group-id").val();var z=$("#connection-destination-group-id").val();var ah=nf.CanvasUtils.getConnectableTypeForSource(P);var L=nf.CanvasUtils.getConnectableTypeForDestination(I);var H=$("#connection-name").val();var E=$("#flow-file-expiration").val();var af=$("#back-pressure-object-threshold").val();var ai=$("#back-pressure-data-size-threshold").val();var R=$("#prioritizer-selected").sortable("toArray");if(x()){var aa={revision:nf.Client.getRevision({revision:{version:0}}),component:{name:H,source:{id:V,groupId:F,type:ah},destination:{id:S,groupId:z,type:L},selectedRelationships:B,flowFileExpiration:E,backPressureDataSizeThreshold:ai,backPressureObjectThreshold:af,bends:C,prioritizers:R}};$.ajax({type:"POST",url:w.urls.api+"/process-groups/"+encodeURIComponent(nf.Canvas.getGroupId())+"/connections",data:JSON.stringify(aa),dataType:"json",contentType:"application/json"}).done(function(aj){nf.Graph.add({connections:[aj]},{selectAll:true});nf.CanvasUtils.reloadConnectionSourceAndDestination(Z,T);nf.Canvas.View.updateVisibility();nf.Birdseye.refresh()}).fail(function(al,aj,ak){nf.Common.handleAjaxError(al,aj,ak)})}};var y=function(F){var G=$("#connection-id").text();var B=$("#connection-uri").val();var O=$("#connection-source-component-id").val();var J=$("#connection-destination-component-id").val();var L=d3.select("#id-"+J);var H=nf.CanvasUtils.getConnectableTypeForDestination(L);var z=$("#connection-destination-id").val();var I=$("#connection-destination-group-id").val();var E=$("#connection-name").val();var C=$("#flow-file-expiration").val();var N=$("#back-pressure-object-threshold").val();var D=$("#back-pressure-data-size-threshold").val();var M=$("#prioritizer-selected").sortable("toArray");if(x()){var K=nf.Connection.get(G);var A={revision:nf.Client.getRevision(K),component:{id:G,name:E,destination:{id:z,groupId:I,type:H},selectedRelationships:F,flowFileExpiration:C,backPressureDataSizeThreshold:D,backPressureObjectThreshold:N,prioritizers:M}};return $.ajax({type:"PUT",url:B,data:JSON.stringify(A),dataType:"json",contentType:"application/json"}).done(function(P){nf.Connection.set(P);nf.CanvasUtils.reloadConnectionSourceAndDestination(O,J)}).fail(function(R,P,Q){if(R.status===400||R.status===404||R.status===409){nf.Dialog.showOkDialog({headerText:"Connection Configuration",dialogContent:nf.Common.escapeHtml(R.responseText),})}else{nf.Common.handleAjaxError(R,P,Q)}})}else{return $.Deferred(function(P){P.reject()}).promise()}};var l=function(){var A=$("#relationship-names");var z=[];$.each(A.children(),function(B,E){var D=$(E);var C=D.children("div.available-relationship");if(C.hasClass("checkbox-checked")){z.push(D.children("span.relationship-name-value").text())}});return z};var x=function(){var z=[];if(nf.Common.isBlank($("#flow-file-expiration").val())){z.push("File expiration must be specified")}if(!$.isNumeric($("#back-pressure-object-threshold").val())){z.push("Back pressure object threshold must be an integer value")}if(nf.Common.isBlank($("#back-pressure-data-size-threshold").val())){z.push("Back pressure data size threshold must be specified")}if(z.length>0){nf.Dialog.showOkDialog({headerText:"Connection Configuration",dialogContent:nf.Common.formatUnorderedList(z)});return false}else{return true}};var e=function(){var B=$("#prioritizer-selected");var z=$("#prioritizer-available");B.children().detach().appendTo(z);var A=z.children("li").get();A.sort(function(D,C){var F=$(D).text().toUpperCase();var E=$(C).text().toUpperCase();return(F<E)?-1:(F>E)?1:0});$.each(A,function(){$(this).detach()});$.each(A,function(){$(this).appendTo(z)});$("#connection-name").val("");$("#relationship-names").css("border-width","0").empty();$("#relationship-names-container").hide();nf.Common.clearField("connection-id");$("#processor-source").hide();$("#input-port-source").hide();$("#output-port-source").hide();$("#read-only-output-port-source").hide();$("#funnel-source").hide();$("#processor-destination").hide();$("#input-port-destination").hide();$("#output-port-destination").hide();$("#funnel-destination").hide();$("#connection-source-id").val("");$("#connection-source-component-id").val("");$("#connection-source-group-id").val("");$("#connection-destination-id").val("");$("#connection-destination-component-id").val("");$("#connection-destination-group-id").val("");$("#output-port-options").empty();$("#input-port-options").empty();j()};return{init:function(){$("#relationship-names-container").hide();$("#connection-configuration").modal({scrollableContentStyle:"scrollable",headerText:"Configure Connection",handler:{close:function(){e()},open:function(){nf.Common.toggleScrollable($("#"+this.find(".tab-container").attr("id")+"-content").get(0))}}});$("#connection-configuration-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",scrollableTabContentStyle:"scrollable",tabs:[{name:"Details",tabContentId:"connection-details-tab-content"},{name:"Settings",tabContentId:"connection-settings-tab-content"}]});$.ajax({type:"GET",url:w.urls.prioritizers,dataType:"json"}).done(function(z){$.each(z.prioritizerTypes,function(A,B){nf.ConnectionConfiguration.addAvailablePrioritizer("#prioritizer-available",B)});$("#prioritizer-available, #prioritizer-selected").sortable({connectWith:"ul",placeholder:"ui-state-highlight",scroll:true,opacity:0.6});$("#prioritizer-available, #prioritizer-selected").disableSelection()}).fail(nf.Common.handleAjaxError)},addAvailablePrioritizer:function(E,C){var B=C.type;var A=nf.Common.substringAfterLast(B,".");var D=$(E);var z=$("<li></li>").append($('<span style="float: left;"></span>').text(A)).attr("id",B).addClass("ui-state-default").appendTo(D);if(nf.Common.isDefinedAndNotNull(C.description)){$('<div class="fa fa-question-circle" style="float: right; margin-right: 5px;""></div>').appendTo(z).qtip($.extend({content:nf.Common.escapeHtml(C.description)},nf.Common.config.tooltipConfig))}},createConnection:function(B,C){var A=d3.select("#id-"+B);var z=d3.select("#id-"+C);if(A.empty()||z.empty()){return}$.when(b(A),q(z)).done(function(){$("#flow-file-expiration").val("0 sec");$("#back-pressure-object-threshold").val("10000");$("#back-pressure-data-size-threshold").val("1 GB");$("#connection-configuration-tabs").find("li:first").click();$("#connection-configuration").modal("setHeaderText","Create Connection").modal("show");$("#connection-configuration div.relationship-name").ellipsis();nf.Common.populateField("connection-id",null);var D=$("#relationship-names");if(D.is(":visible")&&D.get(0).scrollHeight>D.innerHeight()){D.css("border-width","1px")}}).fail(function(){j()})},showConfiguration:function(A,z){return $.Deferred(function(C){var D=A.datum();var B=D.component;var G=nf.CanvasUtils.getConnectionSourceComponentId(D);var E=d3.select("#id-"+G);if(nf.Common.isUndefinedOrNull(z)){var F=nf.CanvasUtils.getConnectionDestinationComponentId(D);z=d3.select("#id-"+F)}$.when(p(E),h(z,B.destination)).done(function(){var J=B.availableRelationships;var I=B.selectedRelationships;if(nf.Common.isDefinedAndNotNull(J)||nf.Common.isDefinedAndNotNull(I)){$.each(J,function(M,L){r(L)});$.each(I,function(N,L){if($.inArray(L,J)===-1){var O=r(L);$(O).children("div.relationship-name").addClass("undefined")}var M=$("#relationship-names").children("div");$.each(M,function(P,R){var Q=$(R).children("span.relationship-name-value");if(Q.text()===L){$(R).children("div.available-relationship").removeClass("checkbox-unchecked").addClass("checkbox-checked")}})})}if(nf.CanvasUtils.isProcessGroup(E)||nf.CanvasUtils.isRemoteProcessGroup(E)){$("#connection-source-id").val(B.source.id);$("#read-only-output-port-name").text(B.source.name)}if(nf.CanvasUtils.isProcessGroup(z)||nf.CanvasUtils.isRemoteProcessGroup(z)){var H=z.datum();if(B.destination.groupId===H.id){$("#input-port-options").combo("setSelectedOption",{value:B.destination.id})}}$("#connection-name").val(B.name);$("#flow-file-expiration").val(B.flowFileExpiration);$("#back-pressure-object-threshold").val(B.backPressureObjectThreshold);$("#back-pressure-data-size-threshold").val(B.backPressureDataSizeThreshold);nf.Common.populateField("connection-id",B.id);$.each(B.prioritizers,function(L,M){$("#prioritizer-available").children('li[id="'+M+'"]').detach().appendTo("#prioritizer-selected")});$("#connection-uri").val(D.uri);$("#connection-configuration").modal("setButtonModel",[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){var L=l();if(nf.CanvasUtils.isProcessor(E)){if(L.length>0){y(L).done(function(){C.resolve()}).fail(function(){C.reject()})}else{nf.Dialog.showOkDialog({headerText:"Connection Configuration",dialogContent:"The connection must have at least one relationship selected."});C.reject()}}else{y(undefined).done(function(){C.resolve()}).fail(function(){C.reject()})}$("#connection-configuration").modal("hide")}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){$("#connection-configuration").modal("hide");C.reject()}}}]);$("#connection-configuration-tabs").find("li:first").click();$("#connection-configuration").modal("setHeaderText","Configure Connection").modal("show");$("#connection-configuration div.relationship-name").ellipsis();var K=$("#relationship-names");if(K.is(":visible")&&K.get(0).scrollHeight>K.innerHeight()){K.css("border-width","1px")}}).fail(function(){C.reject()})}).promise()}}}());
nf.ConnectionDetails=(function(){var g=function(l,n,m){if(m.type==="PROCESSOR"){return h(l,n,m)}else{if(m.type==="FUNNEL"){return i(l,n,m)}else{if(m.type==="REMOTE_OUTPUT_PORT"){return d(l,n,m)}else{return k(l,n,m)}}}};var h=function(l,n,m){return $.Deferred(function(o){$.ajax({type:"GET",url:"../nifi-api/processors/"+encodeURIComponent(m.id),dataType:"json"}).done(function(p){var q=p.component;var r=$('<div class="label"></div>').text(q.name);var s=$("<div></div>").text(nf.Common.substringAfterLast(q.type,"."));$("#read-only-connection-source-label").text("From processor");$("#read-only-connection-source").append(r).append(s);$("#read-only-connection-source-group-name").text(n);o.resolve()}).fail(function(t,p,q){if(t.status===403){var r=$('<div class="label"></div>').text(m.name);var s=$("<div></div>").text("Processor");$("#read-only-connection-source-label").text("From processor");$("#read-only-connection-source").append(r).append(s);$("#read-only-connection-source-group-name").text(n);o.resolve()}else{o.reject(t,p,q)}})}).promise()};var i=function(l,n,m){return $.Deferred(function(o){$("#read-only-connection-source-label").text("From funnel");$("#read-only-connection-source").append("funnel");$("#read-only-connection-source-group-name").text(n);o.resolve()}).promise()};var d=function(l,n,m){return $.Deferred(function(o){$.ajax({type:"GET",url:"../nifi-api/remote-process-groups/"+encodeURIComponent(m.groupId),dataType:"json"}).done(function(p){var q=p.component;$("#read-only-connection-source-label").text("From output");$("#read-only-connection-source").text(m.name);$("#read-only-connection-source-group-name").text(q.name)}).fail(function(r,p,q){if(r.status===403){$("#read-only-connection-source-label").text("From output");$("#read-only-connection-source").append(m.name);$("#read-only-connection-source-group-name").text(m.groupId);o.resolve()}else{o.reject(r,p,q)}})}).promise()};var k=function(l,n,m){return $.Deferred(function(o){if(l===m.groupId){$("#read-only-connection-source-label").text("From input");$("#read-only-connection-source").text(m.name);$("#read-only-connection-source-group-name").text(n);o.resolve()}else{$.ajax({type:"GET",url:"../nifi-api/process-groups/"+encodeURIComponent(m.groupId),dataType:"json"}).done(function(p){var q=p.component;$("#read-only-connection-source-label").text("From output");$("#read-only-connection-source").text(m.name);$("#read-only-connection-source-group-name").text(q.name);o.resolve()}).fail(function(r,p,q){if(r.status===403){$("#read-only-connection-source-label").text("From output");$("#read-only-connection-source").append(m.name);$("#read-only-connection-source-group-name").text(m.groupId);o.resolve()}else{o.reject(r,p,q)}})}}).promise()};var c=function(m,n,l){if(l.type==="PROCESSOR"){return a(m,n,l)}else{if(l.type==="FUNNEL"){return j(m,n,l)}else{if(l.type==="REMOTE_INPUT_PORT"){return f(m,n,l)}else{return b(m,n,l)}}}};var a=function(m,n,l){return $.Deferred(function(o){$.ajax({type:"GET",url:"../nifi-api/processors/"+encodeURIComponent(l.id),dataType:"json"}).done(function(p){var q=p.component;var r=$('<div class="label"></div>').text(q.name);var s=$("<div></div>").text(nf.Common.substringAfterLast(q.type,"."));$("#read-only-connection-target-label").text("To processor");$("#read-only-connection-target").append(r).append(s);$("#read-only-connection-target-group-name").text(n);o.resolve()}).fail(function(t,p,q){if(t.status===403){var r=$('<div class="label"></div>').text(l.name);var s=$("<div></div>").text("Processor");$("#read-only-connection-target-label").text("To processor");$("#read-only-connection-target").append(r).append(s);$("#read-only-connection-target-group-name").text(n);o.resolve()}else{o.reject(t,p,q)}})}).promise()};var j=function(m,n,l){return $.Deferred(function(o){$("#read-only-connection-target-label").text("To funnel");$("#read-only-connection-target").append("funnel");$("#read-only-connection-target-group-name").text(n);o.resolve()}).promise()};var f=function(m,n,l){return $.Deferred(function(o){$.ajax({type:"GET",url:"../nifi-api/remote-process-groups/"+encodeURIComponent(l.groupId),dataType:"json"}).done(function(p){var q=p.component;$("#read-only-connection-target-label").text("To input");$("#read-only-connection-target").text(l.name);$("#read-only-connection-target-group-name").text(q.name);o.resolve()}).fail(function(r,p,q){if(r.status===403){$("#read-only-connection-target-label").text("To input");$("#read-only-connection-target").append(l.name);$("#read-only-connection-target-group-name").text(l.groupId);o.resolve()}else{o.reject(r,p,q)}})}).promise()};var b=function(m,n,l){return $.Deferred(function(o){if(m===l.groupId){$("#read-only-connection-target-label").text("To output");$("#read-only-connection-target").text(l.name);$("#read-only-connection-target-group-name").text(n);o.resolve()}else{$.ajax({type:"GET",url:"../nifi-api/process-groups/"+encodeURIComponent(l.groupId),dataType:"json"}).done(function(p){var q=p.component;$("#read-only-connection-target-label").text("To input");$("#read-only-connection-target").text(l.name);$("#read-only-connection-target-group-name").text(q.name);o.resolve()}).fail(function(r,p,q){if(r.status===403){$("#read-only-connection-target-label").text("To input");$("#read-only-connection-target").append(l.name);$("#read-only-connection-target-group-name").text(l.groupId);o.resolve()}else{o.reject(r,p,q)}})}}).promise()};var e=function(l){$('<div class="available-relationship-container"></div>').append($('<div class="relationship-name"></div>').text(l)).appendTo("#read-only-relationship-names")};return{init:function(){$("#connection-details-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",scrollableTabContentStyle:"scrollable",tabs:[{name:"Details",tabContentId:"read-only-connection-details-tab-content"},{name:"Settings",tabContentId:"read-only-connection-settings-tab-content"}]});$("#connection-details").modal({headerText:"Connection Details",scrollableContentStyle:"scrollable",buttons:[{buttonText:"Ok",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){$("#connection-details").modal("hide")}}}],handler:{close:function(){$("#read-only-relationship-names").empty();nf.Common.clearField("read-only-connection-name");nf.Common.clearField("read-only-connection-id");$("#read-only-connection-source-label").text("");$("#read-only-connection-source").empty();$("#read-only-connection-source-group-name").text("");$("#read-only-connection-target-label").text("");$("#read-only-connection-target").empty();$("#read-only-connection-target-group-name").text("");$("#read-only-relationship-names").css("border-width","0").empty();$("#read-only-flow-file-expiration").text("");$("#read-only-back-pressure-object-threshold").text("");$("#read-only-back-pressure-data-size-threshold").text("");$("#read-only-prioritizers").empty()},open:function(){nf.Common.toggleScrollable($("#"+this.find(".tab-container").attr("id")+"-content").get(0))}}})},showDetails:function(m,o){var n=$.ajax({type:"GET",url:"../nifi-api/flow/process-groups/"+encodeURIComponent(m),dataType:"json"});var l=$.ajax({type:"GET",url:"../nifi-api/connections/"+encodeURIComponent(o),dataType:"json"});$.when(n,l).done(function(t,r){var s=t[0];var u=r[0];if(u.permissions.canRead){var q=u.component;var w=s.permissions.canRead?s.processGroupFlow.breadcrumb.breadcrumb.name:s.processGroupFlow.id;var v=g(s.id,w,q.source);var p=c(s.id,w,q.destination);$.when(v,p).done(function(){var y=q.availableRelationships;var x=q.selectedRelationships;if(nf.Common.isDefinedAndNotNull(y)||nf.Common.isDefinedAndNotNull(x)){$.each(y,function(D,C){e(C)});$.each(x,function(E,C){if($.inArray(C,y)===-1){var F=e(C);$(F).children("div.relationship-name").addClass("undefined")}var D=$("#read-only-relationship-names").children("div");$.each(D.children("div.relationship-name"),function(H,G){var I=$(G);if(I.text()===C){I.css("font-weight","bold")}})});$("#selected-relationship-text").show();$("#read-only-relationship-names-container").show()}else{$("#selected-relationship-text").hide();$("#read-only-relationship-names-container").hide()}nf.Common.populateField("read-only-connection-name",q.name);nf.Common.populateField("read-only-connection-id",q.id);nf.Common.populateField("read-only-flow-file-expiration",q.flowFileExpiration);nf.Common.populateField("read-only-back-pressure-object-threshold",q.backPressureObjectThreshold);nf.Common.populateField("read-only-back-pressure-data-size-threshold",q.backPressureDataSizeThreshold);if(nf.Common.isDefinedAndNotNull(q.prioritizers)&&q.prioritizers.length>0){var B=$("<ol></ol>").css("list-style","decimal inside none");$.each(q.prioritizers,function(C,D){B.append($("<li></li>").text(nf.Common.substringAfterLast(D,".")))});$("#read-only-prioritizers").append(B)}else{var z=$('<span class="unset">No value set</span>');$("#read-only-prioritizers").append(z)}$("#connection-details-tabs").find("li:first").click();$("#connection-details").modal("show");var A=$("#read-only-relationship-names");if(A.is(":visible")&&A.get(0).scrollHeight>A.innerHeight()){A.css("border-width","1px")}}).fail(nf.Common.handleAjaxError)}}).fail(nf.Common.handleAjaxError)}}}());
nf.Graph=(function(){var b=function(c){if(nf.Common.isDefinedAndNotNull(c.inputPorts)&&nf.Common.isDefinedAndNotNull(c.outputPorts)){return c.inputPorts.concat(c.outputPorts)}else{if(nf.Common.isDefinedAndNotNull(c.inputPorts)){return c.inputPorts}else{if(nf.Common.isDefinedAndNotNull(c.outputPorts)){return c.outputPorts}else{return[]}}}};var a=function(c){if(nf.Common.isDefinedAndNotNull(c.inputPortStatusSnapshots)&&nf.Common.isDefinedAndNotNull(c.outputPortStatusSnapshots)){return c.inputPortStatusSnapshots.concat(c.outputPortStatusSnapshots)}else{if(nf.Common.isDefinedAndNotNull(c.inputPortStatusSnapshots)){return c.inputPortStatusSnapshots}else{if(nf.Common.isDefinedAndNotNull(c.outputPortStatusSnapshots)){return c.outputPortStatusSnapshots}else{return[]}}}};return{init:function(){nf.Label.init();nf.Funnel.init();nf.Port.init();nf.RemoteProcessGroup.init();nf.ProcessGroup.init();nf.Processor.init();nf.Connection.init();return nf.CanvasUtils.enterGroup(nf.Canvas.getGroupId())},add:function(e,c){var d=false;if(nf.Common.isDefinedAndNotNull(c)){d=nf.Common.isDefinedAndNotNull(c.selectAll)?c.selectAll:d}if(d){nf.CanvasUtils.getSelection().classed("selected",false)}var f=b(e);nf.Label.add(e.labels,c);nf.Funnel.add(e.funnels,c);nf.RemoteProcessGroup.add(e.remoteProcessGroups,c);nf.Port.add(f,c);nf.ProcessGroup.add(e.processGroups,c);nf.Processor.add(e.processors,c);nf.Connection.add(e.connections,c);if(d){nf.ng.Bridge.digest()}},set:function(e,c){var d=false;if(nf.Common.isDefinedAndNotNull(c)){d=nf.Common.isDefinedAndNotNull(c.selectAll)?c.selectAll:d}if(d){nf.CanvasUtils.getSelection().classed("selected",false)}var f=b(e);nf.Label.set(e.labels,c);nf.Funnel.set(e.funnels,c);nf.RemoteProcessGroup.set(e.remoteProcessGroups,c);nf.Port.set(f,c);nf.ProcessGroup.set(e.processGroups,c);nf.Processor.set(e.processors,c);nf.Connection.set(e.connections,c);if(d){nf.ng.Bridge.digest()}},get:function(){return{labels:nf.Label.get(),funnels:nf.Funnel.get(),ports:nf.Port.get(),remoteProcessGroups:nf.RemoteProcessGroup.get(),processGroups:nf.ProcessGroup.get(),processors:nf.Processor.get(),connections:nf.Connection.get()}},removeAll:function(){nf.Label.removeAll();nf.Funnel.removeAll();nf.Port.removeAll();nf.RemoteProcessGroup.removeAll();nf.ProcessGroup.removeAll();nf.Processor.removeAll();nf.Connection.removeAll()},pan:function(){nf.Port.pan();nf.RemoteProcessGroup.pan();nf.ProcessGroup.pan();nf.Processor.pan();nf.Connection.pan()}}}());
nf.Processor=(function(){var h=25;var a={width:350,height:130};var i;var b;var f=function(){return b.selectAll("g.processor").data(i.values(),function(k){return k.id})};var d=function(m,l){if(m.empty()){return}var k=m.append("g").attr({id:function(n){return"id-"+n.id},"class":"processor component"}).classed("selected",l).call(nf.CanvasUtils.position);k.append("rect").attr({"class":"border",width:function(n){return n.dimensions.width},height:function(n){return n.dimensions.height},fill:"transparent",stroke:"transparent"});k.append("rect").attr({"class":"body",width:function(n){return n.dimensions.width},height:function(n){return n.dimensions.height},filter:"url(#component-drop-shadow)","stroke-width":0});k.append("text").attr({x:62,y:20,width:220,height:16,"class":"processor-name"});k.append("text").attr({x:6,y:32,"class":"processor-icon"}).text("\ue807");k.append("image").call(nf.CanvasUtils.disableImageHref).attr({width:294,height:58,x:8,y:35,"class":"processor-stats-preview"});k.call(nf.Selectable.activate).call(nf.ContextMenu.activate)};var e=function(k){if(k.empty()){return}k.select("rect.border").classed("unauthorized",function(l){return l.permissions.canRead===false});k.select("rect.body").classed("unauthorized",function(l){return l.permissions.canRead===false});k.each(function(l){var q=d3.select(this);var o=q.select("g.processor-canvas-details");nf.CanvasUtils.editable(q);if(q.classed("visible")){if(o.empty()){o=q.append("g").attr("class","processor-canvas-details");o.append("text").attr({"class":"run-status-icon",x:42,y:20});o.append("text").attr({"class":"processor-type",x:62,y:35,width:246,height:16});o.append("rect").attr({width:function(){return l.dimensions.width},height:19,x:0,y:50,fill:"#f4f6f7"});o.append("rect").attr({width:function(){return l.dimensions.width},height:1,x:0,y:68,fill:"#c7d2d7"});o.append("rect").attr({width:function(){return l.dimensions.width},height:19,x:0,y:69,fill:"#ffffff"});o.append("rect").attr({width:function(){return l.dimensions.width},height:1,x:0,y:87,fill:"#c7d2d7"});o.append("rect").attr({width:function(){return l.dimensions.width},height:20,x:0,y:88,fill:"#f4f6f7"});o.append("rect").attr({width:function(){return l.dimensions.width},height:1,x:0,y:106,fill:"#c7d2d7"});o.append("rect").attr({width:function(){return l.dimensions.width},height:19,x:0,y:107,fill:"#ffffff"});var r=o.append("g").attr({transform:"translate(10, 55)"});r.append("text").attr({width:73,height:10,y:9,"class":"stats-label"}).text("In");r.append("text").attr({width:73,height:10,y:27,"class":"stats-label"}).text("Read/Write");r.append("text").attr({width:73,height:10,y:46,"class":"stats-label"}).text("Out");r.append("text").attr({width:73,height:10,y:65,"class":"stats-label"}).text("Tasks/Time");var n=o.append("g").attr({transform:"translate(85, 55)"});var m=n.append("text").attr({width:180,height:9,y:9,"class":"processor-in stats-value"});m.append("tspan").attr({"class":"count"});m.append("tspan").attr({"class":"size"});n.append("text").attr({width:180,height:10,y:27,"class":"processor-read-write stats-value"});var s=n.append("text").attr({width:180,height:10,y:46,"class":"processor-out stats-value"});s.append("tspan").attr({"class":"count"});s.append("tspan").attr({"class":"size"});n.append("text").attr({width:180,height:10,y:65,"class":"processor-tasks-time stats-value"});var p=o.append("g").attr("transform","translate(305, 55)");p.append("text").attr({width:25,height:10,y:9,"class":"stats-info"}).text("5 min");p.append("text").attr({width:25,height:10,y:27,"class":"stats-info"}).text("5 min");p.append("text").attr({width:25,height:10,y:46,"class":"stats-info"}).text("5 min");p.append("text").attr({width:25,height:10,y:65,"class":"stats-info"}).text("5 min");o.append("text").attr({"class":"active-thread-count-icon",y:42}).text("\ue83f");o.append("text").attr({"class":"active-thread-count",y:42});o.append("rect").attr({"class":"bulletin-background",x:function(t){return l.dimensions.width-24},width:24,height:24});o.append("text").attr({"class":"bulletin-icon",x:function(t){return l.dimensions.width-17},y:17}).text("\uf24a")}if(l.permissions.canRead){q.select("text.processor-name").each(function(u){var t=d3.select(this);t.text(null).selectAll("title").remove();nf.CanvasUtils.ellipsis(t,u.component.name)}).append("title").text(function(t){return t.component.name});q.select("text.processor-type").each(function(u){var t=d3.select(this);t.text(null).selectAll("title").remove();nf.CanvasUtils.ellipsis(t,nf.Common.substringAfterLast(u.component.type,"."))}).append("title").text(function(t){return nf.Common.substringAfterLast(t.component.type,".")})}else{q.select("text.processor-name").text(null);q.select("text.processor-type").text(null)}q.select("image.processor-stats-preview").style("display","none");q.call(c)}else{if(l.permissions.canRead){q.select("text.processor-name").text(function(u){var t=u.component.name;if(t.length>h){return t.substring(0,h)+String.fromCharCode(8230)}else{return t}})}q.select("image.processor-stats-preview").style("display","block");q.call(g);if(!o.empty()){o.remove()}}});k.select("text.processor-icon").style("fill",function(m){var l=nf.Processor.defaultColor();if(!m.permissions.canRead){return l}if(nf.Common.isDefinedAndNotNull(m.component.style["background-color"])){l=m.component.style["background-color"]}return l})};var c=function(k){if(k.empty()){return}k.select("text.run-status-icon").attr({fill:function(m){var l="#728e9b";if(m.status.aggregateSnapshot.runStatus==="Invalid"){l="#ba554a"}return l},"font-family":function(m){var l="FontAwesome";if(m.status.aggregateSnapshot.runStatus==="Disabled"){l="flowfont"}return l}}).text(function(m){var l="";if(m.status.aggregateSnapshot.runStatus==="Disabled"){l="\ue802"}else{if(m.status.aggregateSnapshot.runStatus==="Invalid"){l="\uf071"}else{if(m.status.aggregateSnapshot.runStatus==="Running"){l="\uf04b"}else{if(m.status.aggregateSnapshot.runStatus==="Stopped"){l="\uf04d"}}}}return l}).each(function(m){var l=d3.select("#run-status-tip-"+m.id);if(m.permissions.canRead&&!nf.Common.isEmpty(m.component.validationErrors)){if(l.empty()){l=d3.select("#processor-tooltips").append("div").attr("id",function(){return"run-status-tip-"+m.id}).attr("class","tooltip nifi-tooltip")}l.html(function(){var n=nf.Common.formatUnorderedList(m.component.validationErrors);if(n===null||n.length===0){return""}else{return $("<div></div>").append(n).html()}});nf.CanvasUtils.canvasTooltip(l,d3.select(this))}else{if(!l.empty()){l.remove()}}});k.select("text.processor-in tspan.count").text(function(l){return nf.Common.substringBeforeFirst(l.status.aggregateSnapshot.input," ")});k.select("text.processor-in tspan.size").text(function(l){return" "+nf.Common.substringAfterFirst(l.status.aggregateSnapshot.input," ")});k.select("text.processor-read-write").text(function(l){return l.status.aggregateSnapshot.read+" / "+l.status.aggregateSnapshot.written});k.select("text.processor-out tspan.count").text(function(l){return nf.Common.substringBeforeFirst(l.status.aggregateSnapshot.output," ")});k.select("text.processor-out tspan.size").text(function(l){return" "+nf.Common.substringAfterFirst(l.status.aggregateSnapshot.output," ")});k.select("text.processor-tasks-time").text(function(l){return l.status.aggregateSnapshot.tasks+" / "+l.status.aggregateSnapshot.tasksDuration});k.each(function(m){var l=d3.select(this);nf.CanvasUtils.activeThreadCount(l,m);l.select("rect.bulletin-background").classed("has-bulletins",function(){return !nf.Common.isEmpty(m.status.aggregateSnapshot.bulletins)});nf.CanvasUtils.bulletins(l,m,function(){return d3.select("#processor-tooltips")},286)})};var j=function(k){if(k.empty()){return}k.call(g).remove()};var g=function(k){k.each(function(l){$("#run-status-tip-"+l.id).remove();$("#bulletin-tip-"+l.id).remove()})};return{init:function(){i=d3.map();b=d3.select("#canvas").append("g").attr({"pointer-events":"all","class":"processors"})},add:function(k,l){var n=false;if(nf.Common.isDefinedAndNotNull(l)){n=nf.Common.isDefinedAndNotNull(l.selectAll)?l.selectAll:n}var o=function(p){i.set(p.id,$.extend({type:"Processor",dimensions:a},p))};if($.isArray(k)){$.each(k,function(p,q){o(q)})}else{if(nf.Common.isDefinedAndNotNull(k)){o(k)}}var m=f();m.enter().call(d,n);m.call(e)},set:function(k,l){var n=false;var o=false;if(nf.Common.isDefinedAndNotNull(l)){n=nf.Common.isDefinedAndNotNull(l.selectAll)?l.selectAll:n;o=nf.Common.isDefinedAndNotNull(l.transition)?l.transition:o}var p=function(q){i.set(q.id,$.extend({type:"Processor",dimensions:a},q))};if($.isArray(k)){$.each(i.keys(),function(q,r){i.remove(r)});$.each(k,function(q,r){p(r)})}else{if(nf.Common.isDefinedAndNotNull(k)){p(k)}}var m=f();m.enter().call(d,n);m.call(e).call(nf.CanvasUtils.position,o);m.exit().call(j)},get:function(k){if(nf.Common.isUndefined(k)){return i.values()}else{return i.get(k)}},refresh:function(k){if(nf.Common.isDefinedAndNotNull(k)){d3.select("#id-"+k).call(e)}else{d3.selectAll("g.processor").call(e)}},position:function(k){d3.select("#id-"+k).call(nf.CanvasUtils.position)},pan:function(){d3.selectAll("g.processor.entering, g.processor.leaving").call(e)},reload:function(l){if(i.has(l)){var k=i.get(l);return $.ajax({type:"GET",url:k.uri,dataType:"json"}).done(function(m){nf.Processor.set(m)})}},remove:function(k){if($.isArray(k)){$.each(k,function(l,m){i.remove(m)})}else{i.remove(k)}f().exit().call(j)},removeAll:function(){nf.Processor.remove(i.keys())},defaultColor:function(){return"#ad9897"}}}());
nf.Label=(function(){var a={width:150,height:150};var f=20;var b=64;var e;var i;var g;var h=function(){return i.selectAll("g.label").data(e.values(),function(k){return k.id})};var c=function(m,l){if(m.empty()){return}var k=m.append("g").attr({id:function(n){return"id-"+n.id},"class":"label component"}).classed("selected",l).call(nf.CanvasUtils.position);k.append("rect").attr({"class":"border",fill:"transparent",stroke:"transparent"});k.append("rect").attr({"class":"body",filter:"url(#component-drop-shadow)","stroke-width":0});k.append("text").attr({"xml:space":"preserve","font-weight":"bold",fill:"black","class":"label-value"});k.call(nf.Selectable.activate).call(nf.ContextMenu.activate)};var j=function(k){if(k.empty()){return}k.select("rect.border").attr({width:function(l){return l.dimensions.width},height:function(l){return l.dimensions.height}}).classed("unauthorized",function(l){return l.permissions.canRead===false});k.select("rect.body").attr({width:function(l){return l.dimensions.width},height:function(l){return l.dimensions.height}}).style("fill",function(m){if(!m.permissions.canRead){return null}var l=nf.Label.defaultColor();if(nf.Common.isDefinedAndNotNull(m.component.style["background-color"])){l=m.component.style["background-color"]}return l}).classed("unauthorized",function(l){return l.permissions.canRead===false});k.each(function(r){var n=d3.select(this);nf.CanvasUtils.editable(n);var q=n.select("text.label-value");var p=n.selectAll("rect.labelpoint");if(r.permissions.canRead){q.attr("font-size",function(){var s="12px";if(nf.Common.isDefinedAndNotNull(r.component.style["font-size"])){s=r.component.style["font-size"]}return s});q.selectAll("tspan").remove();var m=[];if(nf.Common.isDefinedAndNotNull(r.component.label)){m=r.component.label.split("\n")}else{m.push("")}$.each(m,function(t,s){q.append("tspan").attr("x","0.4em").attr("dy","1.2em").text(function(){return s})});if(r.permissions.canWrite){var l=[{x:r.dimensions.width,y:r.dimensions.height}];var o=p.data(l);o.enter().append("rect").attr({"class":"labelpoint",width:10,height:10}).call(g);o.attr("transform",function(s){return"translate("+(s.x-10)+", "+(s.y-10)+")"});o.exit().remove()}}else{q.selectAll("tspan").remove();p.remove()}})};var d=function(k){k.remove()};return{config:{width:a.width,height:a.height},init:function(){e=d3.map();i=d3.select("#canvas").append("g").attr({"pointer-events":"all","class":"labels"});g=d3.behavior.drag().on("dragstart",function(){d3.event.sourceEvent.stopPropagation()}).on("drag",function(){var k=d3.select(this.parentNode);var l=k.datum();l.dimensions.width=Math.max(b,d3.event.x);l.dimensions.height=Math.max(f,d3.event.y);j(k)}).on("dragend",function(){var l=d3.select(this.parentNode);var m=l.datum();var n=false;if(nf.Common.isDefinedAndNotNull(m.component.width)||m.dimensions.width!==m.component.width){n=true}if(!n&&nf.Common.isDefinedAndNotNull(m.component.height)||m.dimensions.height!==m.component.height){n=true}if(n){var k={revision:nf.Client.getRevision(m),component:{id:m.id,width:m.dimensions.width,height:m.dimensions.height}};$.ajax({type:"PUT",url:m.uri,data:JSON.stringify(k),dataType:"json",contentType:"application/json"}).done(function(o){nf.Label.set(o)}).fail(function(){var p=a.width;if(nf.Common.isDefinedAndNotNull(m.component.width)){p=m.component.width}var o=a.height;if(nf.Common.isDefinedAndNotNull(m.component.height)){o=m.component.height}m.dimensions={width:p,height:o};l.call(j)})}d3.event.sourceEvent.stopPropagation()})},add:function(m,k){var n=false;if(nf.Common.isDefinedAndNotNull(k)){n=nf.Common.isDefinedAndNotNull(k.selectAll)?k.selectAll:n}var o=function(p){e.set(p.id,$.extend({type:"Label"},p))};if($.isArray(m)){$.each(m,function(q,p){o(p)})}else{if(nf.Common.isDefinedAndNotNull(m)){o(m)}}var l=h();l.enter().call(c,n);l.call(j)},set:function(m,k){var n=false;var o=false;if(nf.Common.isDefinedAndNotNull(k)){n=nf.Common.isDefinedAndNotNull(k.selectAll)?k.selectAll:n;o=nf.Common.isDefinedAndNotNull(k.transition)?k.transition:o}var p=function(q){e.set(q.id,$.extend({type:"Label"},q))};if($.isArray(m)){$.each(e.keys(),function(q,r){e.remove(r)});$.each(m,function(r,q){p(q)})}else{if(nf.Common.isDefinedAndNotNull(m)){p(m)}}var l=h();l.enter().call(c,n);l.call(j).call(nf.CanvasUtils.position,o);l.exit().call(d)},get:function(k){if(nf.Common.isUndefined(k)){return e.values()}else{return e.get(k)}},refresh:function(k){if(nf.Common.isDefinedAndNotNull(k)){d3.select("#id-"+k).call(j)}else{d3.selectAll("g.label").call(j)}},reload:function(l){if(e.has(l)){var k=e.get(l);return $.ajax({type:"GET",url:k.uri,dataType:"json"}).done(function(m){nf.Label.set(m)})}},position:function(k){d3.select("#id-"+k).call(nf.CanvasUtils.position)},remove:function(k){if($.isArray(k)){$.each(k,function(m,l){e.remove(l)})}else{e.remove(k)}h().exit().call(d)},removeAll:function(){nf.Label.remove(e.keys())},defaultColor:function(){return"#fff7d7"}}}());
nf.Port=(function(){var k=15;var l=25;var d={width:240,height:50};var h={width:240,height:75};var g;var a;var i=function(){return a.selectAll("g.input-port, g.output-port").data(g.values(),function(m){return m.id})};var f=function(o,n){if(o.empty()){return}var m=o.append("g").attr({id:function(q){return"id-"+q.id},"class":function(q){if(q.portType==="INPUT_PORT"){return"input-port component"}else{return"output-port component"}}}).classed("selected",n).call(nf.CanvasUtils.position);m.append("rect").attr({"class":"border",width:function(q){return q.dimensions.width},height:function(q){return q.dimensions.height},fill:"transparent",stroke:"transparent"});m.append("rect").attr({"class":"body",width:function(q){return q.dimensions.width},height:function(q){return q.dimensions.height},filter:"url(#component-drop-shadow)","stroke-width":0});var p=0;if(nf.Canvas.getParentGroupId()===null){p=l;m.append("rect").attr({"class":"remote-banner",width:function(q){return q.dimensions.width},height:p,fill:"#e3e8eb"})}m.append("text").attr({"class":"port-icon",x:10,y:38+p}).text(function(q){if(q.portType==="INPUT_PORT"){return"\ue832"}else{return"\ue833"}});m.append("text").attr({x:70,y:25+p,width:95,height:30,"class":"port-name"});m.call(nf.Selectable.activate).call(nf.ContextMenu.activate);m.filter(function(q){return q.permissions.canWrite&&q.permissions.canRead}).call(nf.Draggable.activate).call(nf.Connectable.activate)};var e=function(m){if(m.empty()){return}m.select("rect.border").classed("unauthorized",function(n){return n.permissions.canRead===false});m.select("rect.body").classed("unauthorized",function(n){return n.permissions.canRead===false});m.each(function(o){var n=d3.select(this);var p=n.select("g.port-details");nf.CanvasUtils.editable(n);if(n.classed("visible")){if(p.empty()){p=n.append("g").attr("class","port-details");var q=0;if(nf.Canvas.getParentGroupId()===null){q=l;p.append("text").attr({"class":"port-transmission-icon",x:10,y:15});p.append("rect").attr({"class":"bulletin-background",x:function(r){return o.dimensions.width-q},width:q,height:q});p.append("text").attr({"class":"bulletin-icon",x:function(r){return o.dimensions.width-18},y:18}).text("\uf24a")}p.append("text").attr({"class":"run-status-icon",x:50,y:function(){return 25+q}});p.append("text").attr({"class":"active-thread-count-icon",y:43+q}).text("\ue83f");p.append("text").attr({"class":"active-thread-count",y:43+q})}if(o.permissions.canRead){n.select("text.port-name").each(function(u){var t=d3.select(this);var r=u.component.name;var s=r.split(/\s+/);t.text(null).selectAll("tspan, title").remove();if(s.length===1){nf.CanvasUtils.ellipsis(t,r)}else{nf.CanvasUtils.multilineEllipsis(t,2,r)}}).append("title").text(function(r){return r.component.name})}else{n.select("text.port-name").text(null)}n.call(b)}else{if(o.permissions.canRead){n.select("text.port-name").text(function(s){var r=s.component.name;if(r.length>k){return r.substring(0,k)+String.fromCharCode(8230)}else{return r}})}n.call(j);if(!p.empty()){p.remove()}}})};var b=function(m){if(m.empty()){return}m.select("text.run-status-icon").attr({fill:function(o){var n="#728e9b";if(o.status.aggregateSnapshot.runStatus==="Invalid"){n="#ba554a"}return n},"font-family":function(o){var n="FontAwesome";if(o.status.aggregateSnapshot.runStatus==="Disabled"){n="flowfont"}return n}}).text(function(o){var n="";if(o.status.aggregateSnapshot.runStatus==="Disabled"){n="\ue802"}else{if(o.status.aggregateSnapshot.runStatus==="Invalid"){n="\uf071"}else{if(o.status.aggregateSnapshot.runStatus==="Running"){n="\uf04b"}else{if(o.status.aggregateSnapshot.runStatus==="Stopped"){n="\uf04d"}}}}return n}).each(function(o){var n=d3.select("#run-status-tip-"+o.id);if(o.permissions.canRead&&!nf.Common.isEmpty(o.component.validationErrors)){if(n.empty()){n=d3.select("#port-tooltips").append("div").attr("id",function(){return"run-status-tip-"+o.id}).attr("class","tooltip nifi-tooltip")}n.html(function(){var p=nf.Common.formatUnorderedList(o.component.validationErrors);if(p===null||p.length===0){return""}else{return $("<div></div>").append(p).html()}});nf.CanvasUtils.canvasTooltip(n,d3.select(this))}else{if(!n.empty()){n.remove()}}});m.select("text.port-transmission-icon").attr({"font-family":function(n){if(n.status.aggregateSnapshot.transmitting===true){return"FontAwesome"}else{return"flowfont"}}}).text(function(n){if(n.status.aggregateSnapshot.transmitting===true){return"\uf140"}else{return"\ue80a"}});m.each(function(p){var n=d3.select(this);var o=0;nf.CanvasUtils.activeThreadCount(n,p,function(q){o=q});n.select("rect.bulletin-background").classed("has-bulletins",function(){return !nf.Common.isEmpty(p.status.aggregateSnapshot.bulletins)});nf.CanvasUtils.bulletins(n,p,function(){return d3.select("#port-tooltips")},o)})};var c=function(m){if(m.empty()){return}m.call(j).remove()};var j=function(m){m.each(function(n){$("#run-status-tip-"+n.id).remove();$("#bulletin-tip-"+n.id).remove()})};return{init:function(){g=d3.map();a=d3.select("#canvas").append("g").attr({"pointer-events":"all","class":"ports"})},add:function(p,m){var q=false;if(nf.Common.isDefinedAndNotNull(m)){q=nf.Common.isDefinedAndNotNull(m.selectAll)?m.selectAll:q}var o=d;if(nf.Canvas.getParentGroupId()===null){o=h}var r=function(s){g.set(s.id,$.extend({type:"Port",dimensions:o,status:{activeThreadCount:0}},s))};if($.isArray(p)){$.each(p,function(t,s){r(s)})}else{if(nf.Common.isDefinedAndNotNull(p)){r(p)}}var n=i();n.enter().call(f,q);n.call(e)},set:function(p,m){var q=false;var r=false;if(nf.Common.isDefinedAndNotNull(m)){q=nf.Common.isDefinedAndNotNull(m.selectAll)?m.selectAll:q;r=nf.Common.isDefinedAndNotNull(m.transition)?m.transition:r}var o=d;if(nf.Canvas.getParentGroupId()===null){o=h}var s=function(t){g.set(t.id,$.extend({type:"Port",dimensions:o,status:{activeThreadCount:0}},t))};if($.isArray(p)){$.each(g.keys(),function(t,u){g.remove(u)});$.each(p,function(u,t){s(t)})}else{if(nf.Common.isDefinedAndNotNull(p)){s(p)}}var n=i();n.enter().call(f,q);n.call(e).call(nf.CanvasUtils.position,r);n.exit().call(c)},get:function(m){if(nf.Common.isUndefined(m)){return g.values()}else{return g.get(m)}},refresh:function(m){if(nf.Common.isDefinedAndNotNull(m)){d3.select("#id-"+m).call(e)}else{d3.selectAll("g.input-port, g.output-port").call(e)}},pan:function(){d3.selectAll("g.input-port.entering, g.output-port.entering, g.input-port.leaving, g.output-port.leaving").call(e)},reload:function(n){if(g.has(n)){var m=g.get(n);return $.ajax({type:"GET",url:m.uri,dataType:"json"}).done(function(o){nf.Port.set(o)})}},position:function(m){d3.select("#id-"+m).call(nf.CanvasUtils.position)},remove:function(m){if($.isArray(m)){$.each(m,function(o,n){g.remove(n)})}else{g.remove(m)}i().exit().call(c)},removeAll:function(){nf.Port.remove(g.keys())}}}());
nf.ProcessGroup=(function(){var l=30;var a={width:380,height:172};var g;var f;var i=function(m){if(nf.Common.isBlank(m.component.comments)){return"No comments specified"}else{return m.component.comments}};var j=function(){return f.selectAll("g.process-group").data(g.values(),function(m){return m.id})};var h=function(o,m){if(o.empty()){return}var n=o.append("g").attr({id:function(p){return"id-"+p.id},"class":"process-group component"}).classed("selected",m).call(nf.CanvasUtils.position);n.append("rect").attr({"class":"border",width:function(p){return p.dimensions.width},height:function(p){return p.dimensions.height},fill:"transparent",stroke:"transparent"});n.append("rect").attr({"class":"body",width:function(p){return p.dimensions.width},height:function(p){return p.dimensions.height},filter:"url(#component-drop-shadow)","stroke-width":0});n.append("rect").attr({width:function(p){return p.dimensions.width},height:32,fill:"#b8c6cd"});n.append("text").attr({x:10,y:20,width:316,height:16,"class":"process-group-name"});n.append("image").call(nf.CanvasUtils.disableImageHref).attr({width:352,height:113,x:6,y:22,"class":"process-group-preview"});n.on("dblclick",function(p){nf.CanvasUtils.enterGroup(p.id)}).call(nf.Selectable.activate).call(nf.ContextMenu.activate);n.filter(function(p){return p.permissions.canWrite&&p.permissions.canRead}).on("mouseover.drop",function(t){var r=d3.select(this);if(!r.classed("drop")){var s=r.datum();var q=d3.select("rect.drag-selection");if(!q.empty()){var p=nf.CanvasUtils.getSelection().filter(function(u){return s.id===u.id});if(p.empty()){r.classed("drop",function(){return nf.CanvasUtils.isDisconnected(nf.CanvasUtils.getSelection())})}}}}).on("mouseout.drop",function(p){d3.select(this).classed("drop",false)}).call(nf.Draggable.activate).call(nf.Connectable.activate)};var e=10;var c=function(m){if(m.empty()){return}m.select("rect.border").classed("unauthorized",function(n){return n.permissions.canRead===false});m.select("rect.body").classed("unauthorized",function(n){return n.permissions.canRead===false});m.each(function(s){var C=d3.select(this);var A=C.select("g.process-group-details");nf.CanvasUtils.editable(C);if(C.classed("visible")){if(A.empty()){A=C.append("g").attr("class","process-group-details");A.append("rect").attr({x:0,y:32,width:function(){return s.dimensions.width},height:24,fill:"#e3e8eb"});A.append("text").attr({x:10,y:49,"class":"process-group-transmitting process-group-contents-icon","font-family":"FontAwesome"}).text("\uf140");A.append("text").attr({x:28,y:49,"class":"process-group-transmitting-count process-group-contents-count"});A.append("text").attr({y:49,"class":"process-group-not-transmitting process-group-contents-icon","font-family":"flowfont"}).text("\ue80a");A.append("text").attr({y:49,"class":"process-group-not-transmitting-count process-group-contents-count"});A.append("text").attr({y:49,"class":"process-group-running process-group-contents-icon","font-family":"FontAwesome"}).text("\uf04b");A.append("text").attr({y:49,"class":"process-group-running-count process-group-contents-count"});A.append("text").attr({y:49,"class":"process-group-stopped process-group-contents-icon","font-family":"FontAwesome"}).text("\uf04d");A.append("text").attr({y:49,"class":"process-group-stopped-count process-group-contents-count"});A.append("text").attr({y:49,"class":"process-group-invalid process-group-contents-icon","font-family":"FontAwesome"}).text("\uf071");A.append("text").attr({y:49,"class":"process-group-invalid-count process-group-contents-count"});A.append("text").attr({y:49,"class":"process-group-disabled process-group-contents-icon","font-family":"flowfont"}).text("\ue802");A.append("text").attr({y:49,"class":"process-group-disabled-count process-group-contents-count"});A.append("rect").attr({width:function(){return s.dimensions.width},height:19,x:0,y:66,fill:"#f4f6f7"});A.append("rect").attr({width:function(){return s.dimensions.width},height:1,x:0,y:84,fill:"#c7d2d7"});A.append("rect").attr({width:function(){return s.dimensions.width},height:19,x:0,y:85,fill:"#ffffff"});A.append("rect").attr({width:function(){return s.dimensions.width},height:1,x:0,y:103,fill:"#c7d2d7"});A.append("rect").attr({width:function(){return s.dimensions.width},height:19,x:0,y:104,fill:"#f4f6f7"});A.append("rect").attr({width:function(){return s.dimensions.width},height:1,x:0,y:122,fill:"#c7d2d7"});A.append("rect").attr({width:function(){return s.dimensions.width},height:19,x:0,y:123,fill:"#ffffff"});var z=A.append("g").attr({transform:"translate(6, 75)"});z.append("text").attr({width:73,height:10,x:4,y:5,"class":"stats-label"}).text("Queued");z.append("text").attr({width:73,height:10,x:4,y:24,"class":"stats-label"}).text("In");z.append("text").attr({width:73,height:10,x:4,y:42,"class":"stats-label"}).text("Read/Write");z.append("text").attr({width:73,height:10,x:4,y:60,"class":"stats-label"}).text("Out");var o=A.append("g").attr({transform:"translate(95, 75)"});var y=o.append("text").attr({width:180,height:10,x:4,y:5,"class":"process-group-queued stats-value"});y.append("tspan").attr({"class":"count"});y.append("tspan").attr({"class":"size"});var v=o.append("text").attr({width:180,height:10,x:4,y:24,"class":"process-group-in stats-value"});v.append("tspan").attr({"class":"count"});v.append("tspan").attr({"class":"size"});v.append("tspan").attr({"class":"ports"});o.append("text").attr({width:180,height:10,x:4,y:42,"class":"process-group-read-write stats-value"});var x=o.append("text").attr({width:180,height:10,x:4,y:60,"class":"process-group-out stats-value"});x.append("tspan").attr({"class":"ports"});x.append("tspan").attr({"class":"count"});x.append("tspan").attr({"class":"size"});var u=A.append("g").attr({transform:"translate(335, 75)"});u.append("text").attr({width:25,height:10,x:4,y:24,"class":"stats-info"}).text("5 min");u.append("text").attr({width:25,height:10,x:4,y:42,"class":"stats-info"}).text("5 min");u.append("text").attr({width:25,height:10,x:4,y:60,"class":"stats-info"}).text("5 min");A.append("text").attr({x:10,y:160,width:342,height:22,"class":"process-group-comments"});A.append("text").attr({"class":"active-thread-count-icon",y:20}).text("\ue83f");A.append("text").attr({"class":"active-thread-count",y:20});A.append("rect").attr({"class":"bulletin-background",x:function(){return s.dimensions.width-24},y:32,width:24,height:24});A.append("text").attr({"class":"bulletin-icon",x:function(){return s.dimensions.width-17},y:49}).text("\uf24a")}var F=A.select("text.process-group-transmitting-count").text(function(G){return G.activeRemotePortCount});var n=A.select("text.process-group-not-transmitting").attr("x",function(){var G=parseInt(F.attr("x"),10);return G+F.node().getComputedTextLength()+e});var D=A.select("text.process-group-not-transmitting-count").attr("x",function(){var G=parseInt(n.attr("x"),10);return G+n.node().getComputedTextLength()+e}).text(function(G){return G.inactiveRemotePortCount});var p=A.select("text.process-group-running").attr("x",function(){var G=parseInt(D.attr("x"),10);return G+D.node().getComputedTextLength()+e});var t=A.select("text.process-group-running-count").attr("x",function(){var G=parseInt(p.attr("x"),10);return G+p.node().getComputedTextLength()+e}).text(function(G){return G.runningCount});var q=A.select("text.process-group-stopped").attr("x",function(){var G=parseInt(t.attr("x"),10);return G+t.node().getComputedTextLength()+e});var E=A.select("text.process-group-stopped-count").attr("x",function(){var G=parseInt(q.attr("x"),10);return G+q.node().getComputedTextLength()+e}).text(function(G){return G.stoppedCount});var B=A.select("text.process-group-invalid").attr("x",function(){var G=parseInt(E.attr("x"),10);return G+E.node().getComputedTextLength()+e}).classed("has-validation-errors",function(G){return G.permissions.canRead&&G.component.invalidCount>0});var w=A.select("text.process-group-invalid-count").attr("x",function(){var G=parseInt(B.attr("x"),10);return G+B.node().getComputedTextLength()+e}).text(function(G){return G.invalidCount});var r=A.select("text.process-group-disabled").attr("x",function(){var G=parseInt(w.attr("x"),10);return G+w.node().getComputedTextLength()+e});A.select("text.process-group-disabled-count").attr("x",function(){var G=parseInt(r.attr("x"),10);return G+r.node().getComputedTextLength()+e}).text(function(G){return G.disabledCount});if(s.permissions.canRead){A.select("text.process-group-comments").each(function(H){var G=d3.select(this);G.text(null).selectAll("tspan, title").remove();nf.CanvasUtils.ellipsis(G,i(H))}).classed("unset",function(G){return nf.Common.isBlank(G.component.comments)}).append("title").text(function(G){return i(G)});C.select("text.process-group-name").each(function(H){var G=d3.select(this);G.text(null).selectAll("title").remove();nf.CanvasUtils.ellipsis(G,H.component.name)}).append("title").text(function(G){return G.component.name})}else{A.select("text.process-group-comments").text(null);C.select("text.process-group-name").text(null)}C.select("image.process-group-preview").style("display","none");C.call(d)}else{if(s.permissions.canRead){C.select("text.process-group-name").text(function(H){var G=H.component.name;if(G.length>l){return G.substring(0,l)+String.fromCharCode(8230)}else{return G}})}C.select("image.process-group-preview").style("display","block");C.call(k);if(!A.empty()){A.remove()}}})};var d=function(m){if(m.empty()){return}m.select("text.process-group-queued tspan.count").text(function(n){return nf.Common.substringBeforeFirst(n.status.aggregateSnapshot.queued," ")});m.select("text.process-group-queued tspan.size").text(function(n){return" "+nf.Common.substringAfterFirst(n.status.aggregateSnapshot.queued," ")});m.select("text.process-group-in tspan.count").text(function(n){return nf.Common.substringBeforeFirst(n.status.aggregateSnapshot.input," ")});m.select("text.process-group-in tspan.size").text(function(n){return" "+nf.Common.substringAfterFirst(n.status.aggregateSnapshot.input," ")});m.select("text.process-group-in tspan.ports").text(function(n){return" "+String.fromCharCode(8594)+" "+n.inputPortCount});m.select("text.process-group-read-write").text(function(n){return n.status.aggregateSnapshot.read+" / "+n.status.aggregateSnapshot.written});m.select("text.process-group-out tspan.ports").text(function(n){return n.outputPortCount+" "+String.fromCharCode(8594)+" "});m.select("text.process-group-out tspan.count").text(function(n){return nf.Common.substringBeforeFirst(n.status.aggregateSnapshot.output," ")});m.select("text.process-group-out tspan.size").text(function(n){return" "+nf.Common.substringAfterFirst(n.status.aggregateSnapshot.output," ")});m.each(function(p){var n=d3.select(this);var o=0;nf.CanvasUtils.activeThreadCount(n,p,function(q){o=q});n.select("rect.bulletin-background").classed("has-bulletins",function(){return !nf.Common.isEmpty(p.status.aggregateSnapshot.bulletins)});nf.CanvasUtils.bulletins(n,p,function(){return d3.select("#process-group-tooltips")},o)})};var b=function(m){if(m.empty()){return}m.call(k).remove()};var k=function(m){m.each(function(n){$("#bulletin-tip-"+n.id).remove()})};return{init:function(){g=d3.map();f=d3.select("#canvas").append("g").attr({"pointer-events":"all","class":"process-groups"})},add:function(q,m){var o=false;if(nf.Common.isDefinedAndNotNull(m)){o=nf.Common.isDefinedAndNotNull(m.selectAll)?m.selectAll:o}var p=function(r){g.set(r.id,$.extend({type:"ProcessGroup",dimensions:a},r))};if($.isArray(q)){$.each(q,function(r,s){p(s)})}else{if(nf.Common.isDefinedAndNotNull(q)){p(q)}}var n=j();n.enter().call(h,o);n.call(c)},set:function(r,m){var o=false;var p=false;if(nf.Common.isDefinedAndNotNull(m)){o=nf.Common.isDefinedAndNotNull(m.selectAll)?m.selectAll:o;p=nf.Common.isDefinedAndNotNull(m.transition)?m.transition:p}var q=function(s){g.set(s.id,$.extend({type:"ProcessGroup",dimensions:a},s))};if($.isArray(r)){$.each(g.keys(),function(s,t){g.remove(t)});$.each(r,function(s,t){q(t)})}else{if(nf.Common.isDefinedAndNotNull(r)){q(r)}}var n=j();n.enter().call(h,o);n.call(c).call(nf.CanvasUtils.position,p);n.exit().call(b)},get:function(m){if(nf.Common.isUndefined(m)){return g.values()}else{return g.get(m)}},refresh:function(m){if(nf.Common.isDefinedAndNotNull(m)){d3.select("#id-"+m).call(c)}else{d3.selectAll("g.process-group").call(c)}},pan:function(){d3.selectAll("g.process-group.entering, g.process-group.leaving").call(c)},reload:function(n){if(g.has(n)){var m=g.get(n);return $.ajax({type:"GET",url:m.uri,dataType:"json"}).done(function(o){nf.ProcessGroup.set(o)})}},position:function(m){d3.select("#id-"+m).call(nf.CanvasUtils.position)},remove:function(m){if($.isArray(m)){$.each(m,function(n,o){g.remove(o)})}else{g.remove(m)}j().exit().call(b)},removeAll:function(){nf.ProcessGroup.remove(g.keys())}}}());
nf.RemoteProcessGroup=(function(){var l=30;var a={width:380,height:158};var j;var b;var g=function(m){if(nf.Common.isBlank(m.component.comments)){return"No comments specified"}else{return m.component.comments}};var h=function(){return b.selectAll("g.remote-process-group").data(j.values(),function(m){return m.id})};var k=function(o,m){if(o.empty()){return}var n=o.append("g").attr({id:function(p){return"id-"+p.id},"class":"remote-process-group component"}).classed("selected",m).call(nf.CanvasUtils.position);n.append("rect").attr({"class":"border",width:function(p){return p.dimensions.width},height:function(p){return p.dimensions.height},fill:"transparent",stroke:"transparent"});n.append("rect").attr({"class":"body",width:function(p){return p.dimensions.width},height:function(p){return p.dimensions.height},filter:"url(#component-drop-shadow)","stroke-width":0});n.append("rect").attr({width:function(p){return p.dimensions.width},height:32,fill:"#b8c6cd"});n.append("text").attr({x:30,y:20,width:305,height:16,"class":"remote-process-group-name"});n.append("image").call(nf.CanvasUtils.disableImageHref).attr({width:352,height:89,x:6,y:38,"class":"remote-process-group-preview"});n.call(nf.Selectable.activate).call(nf.ContextMenu.activate)};var d=5;var f=function(m){if(m.empty()){return}m.select("rect.border").classed("unauthorized",function(n){return n.permissions.canRead===false});m.select("rect.body").classed("unauthorized",function(n){return n.permissions.canRead===false});m.each(function(s){var t=d3.select(this);var q=t.select("g.remote-process-group-details");nf.CanvasUtils.editable(t);if(t.classed("visible")){if(q.empty()){q=t.append("g").attr("class","remote-process-group-details");q.append("text").attr({"class":"remote-process-group-transmission-status",x:10,y:20});q.append("rect").attr({x:0,y:32,width:function(){return s.dimensions.width},height:24,fill:"#e3e8eb"});q.append("text").attr({"class":"remote-process-group-transmission-secure",x:10,y:48});q.append("text").attr({x:30,y:48,width:305,height:12,"class":"remote-process-group-uri"});q.append("rect").attr({width:function(){return s.dimensions.width},height:19,x:0,y:66,fill:"#f4f6f7"});q.append("rect").attr({width:function(){return s.dimensions.width},height:1,x:0,y:84,fill:"#c7d2d7"});q.append("rect").attr({width:function(){return s.dimensions.width},height:19,x:0,y:85,fill:"#ffffff"});q.append("rect").attr({width:function(){return s.dimensions.width},height:1,x:0,y:103,fill:"#c7d2d7"});var r=q.append("g").attr({transform:"translate(6, 75)"});r.append("text").attr({width:73,height:10,x:4,y:5,"class":"stats-label"}).text("Sent");r.append("text").attr({width:73,height:10,x:4,y:23,"class":"stats-label"}).text("Received");var u=q.append("g").attr({transform:"translate(95, 75)"});var n=u.append("text").attr({width:180,height:10,x:4,y:5,"class":"remote-process-group-sent stats-value"});n.append("tspan").attr({"class":"count"});n.append("tspan").attr({"class":"size"});n.append("tspan").attr({"class":"ports"});var o=u.append("text").attr({width:180,height:10,x:4,y:23,"class":"remote-process-group-received stats-value"});o.append("tspan").attr({"class":"ports"});o.append("tspan").attr({"class":"count"});o.append("tspan").attr({"class":"size"});var p=q.append("g").attr({transform:"translate(335, 75)"});p.append("text").attr({width:25,height:10,x:4,y:5,"class":"stats-info"}).text("5 min");p.append("text").attr({width:25,height:10,x:4,y:23,"class":"stats-info"}).text("5 min");q.append("text").attr({x:10,y:121,width:342,height:22,"class":"remote-process-group-comments"});q.append("rect").attr({x:0,y:function(){return s.dimensions.height-24},width:function(){return s.dimensions.width},height:24,fill:"#e3e8eb"});q.append("text").attr({x:370,y:150,"class":"remote-process-group-last-refresh"});q.append("text").attr({"class":"active-thread-count-icon",y:20}).text("\ue83f");q.append("text").attr({"class":"active-thread-count",y:20});q.append("rect").attr({"class":"bulletin-background",x:function(){return s.dimensions.width-24},y:32,width:24,height:24});q.append("text").attr({"class":"bulletin-icon",x:function(){return s.dimensions.width-17},y:50}).text("\uf24a")}if(s.permissions.canRead){q.select("text.remote-process-group-uri").each(function(w){var v=d3.select(this);v.text(null).selectAll("title").remove();nf.CanvasUtils.ellipsis(v,w.component.targetUri)}).append("title").text(function(v){return v.component.name});q.select("text.remote-process-group-transmission-secure").text(function(w){var v="";if(w.component.targetSecure===true){v="\uf023"}else{v="\uf09c"}return v}).each(function(w){var v=d3.select("#transmission-secure-"+w.id);if(v.empty()){v=d3.select("#remote-process-group-tooltips").append("div").attr("id",function(){return"transmission-secure-"+w.id}).attr("class","tooltip nifi-tooltip")}v.text(function(){if(w.component.targetSecure===true){return"Site-to-Site is secure."}else{return"Site-to-Site is NOT secure."}});nf.CanvasUtils.canvasTooltip(v,d3.select(this))});q.select("text.remote-process-group-comments").each(function(w){var v=d3.select(this);v.text(null).selectAll("tspan, title").remove();nf.CanvasUtils.ellipsis(v,g(w))}).classed("unset",function(v){return nf.Common.isBlank(v.component.comments)}).append("title").text(function(v){return g(v)});q.select("text.remote-process-group-last-refresh").text(function(v){if(nf.Common.isDefinedAndNotNull(v.component.flowRefreshed)){return v.component.flowRefreshed}else{return"Remote flow not current"}});t.select("text.remote-process-group-name").each(function(w){var v=d3.select(this);v.text(null).selectAll("title").remove();nf.CanvasUtils.ellipsis(v,w.component.name)}).append("title").text(function(v){return v.component.name})}else{q.select("text.remote-process-group-uri").text(null);q.select("text.remote-process-group-transmission-secure").text(null);q.select("text.remote-process-group-comments").text(null);q.select("text.remote-process-group-last-refresh").text(null);t.select("text.remote-process-group-name").text(null)}t.select("image.remote-process-group-preview").style("display","none");t.call(c)}else{if(s.permissions.canRead){t.select("text.remote-process-group-name").text(function(w){var v=w.component.name;if(v.length>l){return v.substring(0,l)+String.fromCharCode(8230)}else{return v}})}t.select("image.remote-process-group-preview").style("display","block");t.call(i);if(!q.empty()){q.remove()}}})};var c=function(m){if(m.empty()){return}m.select("text.remote-process-group-sent tspan.count").text(function(n){return nf.Common.substringBeforeFirst(n.status.aggregateSnapshot.sent," ")});m.select("text.remote-process-group-sent tspan.size").text(function(n){return" "+nf.Common.substringAfterFirst(n.status.aggregateSnapshot.sent," ")});m.select("text.remote-process-group-sent tspan.ports").text(function(n){return" "+String.fromCharCode(8594)+" "+n.inputPortCount});m.select("text.remote-process-group-received tspan.ports").text(function(n){return n.outputPortCount+" "+String.fromCharCode(8594)+" "});m.select("text.remote-process-group-received tspan.count").text(function(n){return nf.Common.substringBeforeFirst(n.status.aggregateSnapshot.received," ")});m.select("text.remote-process-group-received tspan.size").text(function(n){return" "+nf.Common.substringAfterFirst(n.status.aggregateSnapshot.received," ")});m.select("text.remote-process-group-transmission-status").text(function(o){var n="";if(o.permissions.canRead){if(!nf.Common.isEmpty(o.component.authorizationIssues)){n="\uf071"}else{if(o.component.transmitting===true){n="\uf140"}else{n="\ue80a"}}}return n}).attr("font-family",function(o){var n="";if(o.permissions.canRead){if(!nf.Common.isEmpty(o.component.authorizationIssues)||o.component.transmitting){n="FontAwesome"}else{n="flowfont"}}return n}).classed("has-authorization-errors",function(n){return n.permissions.canRead&&!nf.Common.isEmpty(n.component.authorizationIssues)}).each(function(o){var n=d3.select("#authorization-issues-"+o.id);if(o.permissions.canRead&&!nf.Common.isEmpty(o.component.authorizationIssues)){if(n.empty()){n=d3.select("#remote-process-group-tooltips").append("div").attr("id",function(){return"authorization-issues-"+o.id}).attr("class","tooltip nifi-tooltip")}n.html(function(){var p=nf.Common.formatUnorderedList(o.component.authorizationIssues);if(p===null||p.length===0){return""}else{return $("<div></div>").append(p).html()}});nf.CanvasUtils.canvasTooltip(n,d3.select(this))}else{if(!n.empty()){n.remove()}}});m.each(function(p){var n=d3.select(this);var o=0;nf.CanvasUtils.activeThreadCount(n,p,function(q){o=q});n.select("rect.bulletin-background").classed("has-bulletins",function(){return !nf.Common.isEmpty(p.status.aggregateSnapshot.bulletins)});nf.CanvasUtils.bulletins(n,p,function(){return d3.select("#remote-process-group-tooltips")},o)})};var e=function(m){if(m.empty()){return}m.call(i).remove()};var i=function(m){m.each(function(n){$("#bulletin-tip-"+n.id).remove();$("#authorization-issues-"+n.id).remove();$("#transmission-secure-"+n.id).remove()})};return{init:function(){j=d3.map();b=d3.select("#canvas").append("g").attr({"pointer-events":"all","class":"remote-process-groups"})},add:function(q,m){var o=false;if(nf.Common.isDefinedAndNotNull(m)){o=nf.Common.isDefinedAndNotNull(m.selectAll)?m.selectAll:o}var p=function(r){j.set(r.id,$.extend({type:"RemoteProcessGroup",dimensions:a},r))};if($.isArray(q)){$.each(q,function(r,s){p(s)})}else{if(nf.Common.isDefinedAndNotNull(q)){p(q)}}var n=h();n.enter().call(k,o);n.call(f)},set:function(r,m){var o=false;var p=false;if(nf.Common.isDefinedAndNotNull(m)){o=nf.Common.isDefinedAndNotNull(m.selectAll)?m.selectAll:o;p=nf.Common.isDefinedAndNotNull(m.transition)?m.transition:p}var q=function(s){j.set(s.id,$.extend({type:"RemoteProcessGroup",dimensions:a},s))};if($.isArray(r)){$.each(j.keys(),function(s,t){j.remove(t)});$.each(r,function(s,t){q(t)})}else{if(nf.Common.isDefinedAndNotNull(r)){q(r)}}var n=h();n.enter().call(k,o);n.call(f).call(nf.CanvasUtils.position,p);n.exit().call(e)},get:function(m){if(nf.Common.isUndefined(m)){return j.values()}else{return j.get(m)}},refresh:function(m){if(nf.Common.isDefinedAndNotNull(m)){d3.select("#id-"+m).call(f)}else{d3.selectAll("g.remote-process-group").call(f)}},pan:function(){d3.selectAll("g.remote-process-group.entering, g.remote-process-group.leaving").call(f)},reload:function(n){if(j.has(n)){var m=j.get(n);return $.ajax({type:"GET",url:m.uri,dataType:"json"}).done(function(o){nf.RemoteProcessGroup.set(o);var p=nf.Connection.getComponentConnections(n);$.each(p,function(r,q){if(q.permissions.canRead){nf.Connection.reload(q.id)}})})}},position:function(m){d3.select("#id-"+m).call(nf.CanvasUtils.position)},remove:function(m){if($.isArray(m)){$.each(m,function(n,o){j.remove(o)})}else{j.remove(m)}h().exit().call(e)},removeAll:function(){nf.RemoteProcessGroup.remove(j.keys())}}}());
nf.Funnel=(function(){var e={width:48,height:48};var c;var f;var b=function(){return f.selectAll("g.funnel").data(c.values(),function(h){return h.id})};var a=function(j,i){if(j.empty()){return j}var h=j.append("g").attr({id:function(k){return"id-"+k.id},"class":"funnel component"}).classed("selected",i).call(nf.CanvasUtils.position);h.append("rect").attr({rx:2,ry:2,"class":"border",width:function(k){return k.dimensions.width},height:function(k){return k.dimensions.height},fill:"transparent",stroke:"transparent"});h.append("rect").attr({rx:2,ry:2,"class":"body",width:function(k){return k.dimensions.width},height:function(k){return k.dimensions.height},filter:"url(#component-drop-shadow)","stroke-width":0});h.append("text").attr({"class":"funnel-icon",x:9,y:34}).text("\ue803");h.call(nf.Selectable.activate).call(nf.ContextMenu.activate)};var d=function(h){if(h.empty()){return}h.select("rect.border").classed("unauthorized",function(i){return i.permissions.canRead===false});h.select("rect.body").classed("unauthorized",function(i){return i.permissions.canRead===false});h.each(function(){var i=d3.select(this);nf.CanvasUtils.editable(i)})};var g=function(h){h.remove()};return{init:function(){c=d3.map();f=d3.select("#canvas").append("g").attr({"pointer-events":"all","class":"funnels"})},add:function(i,h){var k=false;if(nf.Common.isDefinedAndNotNull(h)){k=nf.Common.isDefinedAndNotNull(h.selectAll)?h.selectAll:k}var l=function(m){c.set(m.id,$.extend({type:"Funnel",dimensions:e},m))};if($.isArray(i)){$.each(i,function(n,m){l(m)})}else{if(nf.Common.isDefinedAndNotNull(i)){l(i)}}var j=b();j.enter().call(a,k);j.call(d)},set:function(i,h){var k=false;var l=false;if(nf.Common.isDefinedAndNotNull(h)){k=nf.Common.isDefinedAndNotNull(h.selectAll)?h.selectAll:k;l=nf.Common.isDefinedAndNotNull(h.transition)?h.transition:l}var m=function(n){c.set(n.id,$.extend({type:"Funnel",dimensions:e},n))};if($.isArray(i)){$.each(c.keys(),function(n,o){c.remove(o)});$.each(i,function(o,n){m(n)})}else{if(nf.Common.isDefinedAndNotNull(i)){m(i)}}var j=b();j.enter().call(a,k);j.call(d).call(nf.CanvasUtils.position,l);j.exit().call(g)},get:function(h){if(nf.Common.isUndefined(h)){return c.values()}else{return c.get(h)}},refresh:function(h){if(nf.Common.isDefinedAndNotNull(h)){d3.select("#id-"+h).call(d)}else{d3.selectAll("g.funnel").call(d)}},reload:function(i){if(c.has(i)){var h=c.get(i);return $.ajax({type:"GET",url:h.uri,dataType:"json"}).done(function(j){nf.Funnel.set(j)})}},position:function(h){d3.select("#id-"+h).call(nf.CanvasUtils.position)},remove:function(h){if($.isArray(h)){$.each(h,function(j,i){c.remove(i)})}else{c.remove(h)}b().exit().call(g)},removeAll:function(){nf.Funnel.remove(c.keys())}}}());
nf.Connection=(function(){var e={width:200};var j=function(A){var C=A.datum();var z,D;if(C.bends.length>0){var B=Math.min(Math.max(0,C.labelIndex),C.bends.length-1);z=C.bends[B].x;D=C.bends[B].y}else{z=(C.start.x+C.end.x)/2;D=(C.start.y+C.end.y)/2}z-=(e.width/2);D-=(A.attr("height")/2);return{x:z,y:D}};var r;var b;var w;var x;var n;var d;var m=function(z,y){return Math.pow(z.x-y.x,2)+Math.pow(z.y-y.y,2)};var i=function(z,y){return Math.sqrt(m(z,y))};var c=function(C,B,z){var y=m(B,z);if(y===0){return Math.sqrt(m(C,B))}var A=((C.x-B.x)*(z.x-B.x)+(C.y-B.y)*(z.y-B.y))/y;if(A<0){return Math.sqrt(m(C,B))}if(A>1){return Math.sqrt(m(C,z))}return Math.sqrt(m(C,{x:B.x+A*(z.x-B.x),y:B.y+A*(z.y-B.y)}))};var u=function(C,E){if(E.bends.length===0){return 0}var A;var z;var y=[E.start].concat(E.bends,[E.end]);for(var B=0;B<y.length;B++){if(B+1<y.length){var D=c(C,y[B],y[B+1]);if(nf.Common.isUndefined(A)||D<A){A=D;z=B}}}return z};var o=function(y){return y.indexOf("INPUT_PORT")>=0};var a=function(y){return y.indexOf("OUTPUT_PORT")>=0};var l=function(y){return y.groupId!==nf.Canvas.getGroupId()&&(o(y.type)||a(y.type))};var g=function(y){if(nf.Common.isDefinedAndNotNull(y.flowFileExpiration)){var z=y.flowFileExpiration.match(/^(\d+).*/);if(z!==null&&z.length>0){if(parseInt(z[0],10)>0){return true}}}return false};var t=function(y){y.sort(function(A,z){return A.zIndex===z.zIndex?0:A.zIndex>z.zIndex?1:-1})};var p=function(){return b.selectAll("g.connection").data(r.values(),function(y){return y.id})};var v=function(A,z){if(A.empty()){return}var y=A.append("g").attr({id:function(B){return"id-"+B.id},"class":"connection"}).classed("selected",z);y.append("path").attr({"class":"connection-path","pointer-events":"none"});y.append("path").attr({"class":"connection-selection-path","pointer-events":"none"});y.append("path").attr({"class":"connection-path-selectable","pointer-events":"stroke"}).on("mousedown.selection",function(){nf.Selectable.select(d3.select(this.parentNode))}).call(nf.ContextMenu.activate)};var h=function(z){var y=false;if(nf.Common.isDefinedAndNotNull(z.component.selectedRelationships)&&nf.Common.isDefinedAndNotNull(z.component.availableRelationships)){$.each(z.component.selectedRelationships,function(A,B){if($.inArray(B,z.component.availableRelationships)===-1){y=true;return false}})}return y};var q=function(y,z){if(y.empty()){return}var A=true;var B=true;var C=false;if(nf.Common.isDefinedAndNotNull(z)){A=nf.Common.isDefinedAndNotNull(z.updatePath)?z.updatePath:A;B=nf.Common.isDefinedAndNotNull(z.updateLabel)?z.updateLabel:B;C=nf.Common.isDefinedAndNotNull(z.transition)?z.transition:C}if(A===true){y.classed("grouped",function(E){var D=false;if(E.permissions.canRead){if(nf.Common.isDefinedAndNotNull(E.component.selectedRelationships)&&E.component.selectedRelationships.length>1){D=true}}return D}).classed("ghost",function(E){var D=false;if(E.permissions.canRead){if(h(E)){D=true}}return D});y.select("path.connection-path").classed("unauthorized",function(D){return D.permissions.canRead===false});y.select("path.connection-path-selectable").on("dblclick",function(I){if(I.permissions.canWrite&&I.permissions.canRead){var D=d3.mouse(this.parentNode);var G=u({x:D[0],y:D[1]},I);var F=I.component.bends.slice();F.splice(G,0,{x:D[0],y:D[1]});var E={id:I.id,bends:F};var H=I.component.labelIndex;if(F.length===1){E.labelIndex=0}else{if(G<=H){E.labelIndex=H+1}}s(I,E);d3.event.stopPropagation()}else{return null}})}y.each(function(aa){var S=d3.select(this);if(A===true){var Z=nf.CanvasUtils.getConnectionSourceComponentId(aa);var I=d3.select("#id-"+Z).datum();var J;var P;if(aa.bends.length>0){P=aa.bends[aa.bends.length-1]}else{P={x:I.position.x+(I.dimensions.width/2),y:I.position.y+(I.dimensions.height/2)}}if(nf.Common.isDefinedAndNotNull(aa.end)&&aa.end.dragging===true){J=aa.end;var ab=d3.select("g.hover.connectable-destination");if(!ab.empty()){var W=ab.datum();var D=nf.CanvasUtils.getPerimeterPoint(P,{x:W.position.x,y:W.position.y,width:W.dimensions.width,height:W.dimensions.height});J.x=D.x;J.y=D.y}}else{var F=nf.CanvasUtils.getConnectionDestinationComponentId(aa);var ad=d3.select("#id-"+F).datum();J=nf.CanvasUtils.getPerimeterPoint(P,{x:ad.position.x,y:ad.position.y,width:ad.dimensions.width,height:ad.dimensions.height})}var Q;if(aa.bends.length>0){Q=aa.bends[0]}else{Q=J}var M=nf.CanvasUtils.getPerimeterPoint(Q,{x:I.position.x,y:I.position.y,width:I.dimensions.width,height:I.dimensions.height});aa.start=M;aa.end=J;nf.CanvasUtils.transition(S.select("path.connection-path"),C).attr({d:function(){var ae=[aa.start].concat(aa.bends,[aa.end]);return d(ae)},"marker-end":function(){var ae="normal";if(aa.permissions.canRead){if(h(aa)){ae="ghost"}}else{ae="unauthorized"}return"url(#"+ae+")"}});nf.CanvasUtils.transition(S.select("path.connection-selection-path"),C).attr({d:function(){var ae=[aa.start].concat(aa.bends,[aa.end]);return d(ae)}});nf.CanvasUtils.transition(S.select("path.connection-path-selectable"),C).attr({d:function(){var ae=[aa.start].concat(aa.bends,[aa.end]);return d(ae)}});var O=S.selectAll("rect.startpoint");var N=S.selectAll("rect.endpoint");var U=S.selectAll("rect.midpoint");if(aa.permissions.canWrite&&aa.permissions.canRead){O=O.data([aa.start]);O.enter().append("rect").attr({"class":"startpoint linepoint","pointer-events":"all",width:8,height:8}).on("mousedown.selection",function(){nf.Selectable.select(d3.select(this.parentNode))}).call(nf.ContextMenu.activate);nf.CanvasUtils.transition(O,C).attr("transform",function(ae){return"translate("+(ae.x-4)+", "+(ae.y-4)+")"});O.exit().remove();var N=N.data([aa.end]);N.enter().append("rect").call(x).attr({"class":"endpoint linepoint","pointer-events":"all",width:8,height:8}).on("mousedown.selection",function(){nf.Selectable.select(d3.select(this.parentNode))}).call(nf.ContextMenu.activate);nf.CanvasUtils.transition(N,C).attr("transform",function(ae){return"translate("+(ae.x-4)+", "+(ae.y-4)+")"});N.exit().remove();var U=U.data(aa.bends);U.enter().append("rect").attr({"class":"midpoint linepoint","pointer-events":"all",width:8,height:8}).call(w).on("dblclick",function(ah){d3.event.stopPropagation();var ae=d3.select(this.parentNode);var al=ae.datum();var ak=nf.CanvasUtils.getConnectionSourceComponentId(al);var aj=nf.CanvasUtils.getConnectionDestinationComponentId(al);if(ak===aj&&aa.component.bends.length<=2){nf.Dialog.showOkDialog({headerText:"Connection",dialogContent:"Looping connections must have at least two bend points."});return}var ag=[];var af=-1;$.each(al.component.bends,function(an,am){if(ah.x!==am.x&&ah.y!==am.y){ag.push(am)}else{af=an}});if(af<0){return}var ae={id:al.id,bends:ag};var ai=al.component.labelIndex;if(ag.length<=1){ae.labelIndex=0}else{if(af<=ai){ae.labelIndex=Math.max(0,ai-1)}}s(al,ae)}).on("mousedown.selection",function(){nf.Selectable.select(d3.select(this.parentNode))}).call(nf.ContextMenu.activate);nf.CanvasUtils.transition(U,C).attr("transform",function(ae){return"translate("+(ae.x-4)+", "+(ae.y-4)+")"});U.exit().remove()}else{O.remove();N.remove();U.remove()}}if(B===true){var K=S.select("g.connection-label-container");if(S.classed("visible")){if(K.empty()){K=S.insert("g","rect.startpoint").attr({"class":"connection-label-container","pointer-events":"all"}).on("mousedown.selection",function(){nf.Selectable.select(d3.select(this.parentNode))}).call(nf.ContextMenu.activate);K.append("rect").attr({"class":"body",width:e.width,x:0,y:0,filter:"url(#component-drop-shadow)"});K.append("rect").attr({"class":"border",width:e.width,fill:"transparent",stroke:"transparent"})}var T=0;var G=19;var Y=[];var L=[];var R=K.select("g.connection-from-container");var ac=K.select("g.connection-to-container");var V=K.select("g.connection-name-container");if(aa.permissions.canRead){if(l(aa.component.source)){if(R.empty()){R=K.append("g").attr({"class":"connection-from-container"});Y.push(R.append("rect").attr({"class":"connection-label-background",width:e.width,height:G}));L.push(R.append("rect").attr({"class":"connection-label-border",width:e.width,height:1}));R.append("text").attr({"class":"stats-label",x:5,y:14}).text("From");R.append("text").attr({"class":"stats-value connection-from",x:43,y:14,width:130});R.append("text").attr({"class":"connection-from-run-status",x:185,y:14})}else{Y.push(R.select("rect.connection-label-background"));L.push(R.select("rect.connection-label-border"))}R.attr("transform",function(){var ae=(G*T++);return"translate(0, "+ae+")"});R.select("text.connection-from").each(function(){var ae=d3.select(this);ae.text(null).selectAll("title").remove();nf.CanvasUtils.ellipsis(ae,aa.component.source.name)}).append("title").text(function(){return aa.component.source.name});R.select("text.connection-from-run-status").text(function(){if(aa.component.source.exists===false){return"\uf071"}else{if(aa.component.source.running===true){return"\uf04b"}else{return"\uf04d"}}}).classed("is-missing-port",function(){return aa.component.source.exists===false})}else{R.remove()}if(l(aa.component.destination)){if(ac.empty()){ac=K.append("g").attr({"class":"connection-to-container"});Y.push(ac.append("rect").attr({"class":"connection-label-background",width:e.width,height:G}));L.push(ac.append("rect").attr({"class":"connection-label-border",width:e.width,height:1}));ac.append("text").attr({"class":"stats-label",x:5,y:14}).text("To");ac.append("text").attr({"class":"stats-value connection-to",x:25,y:14,width:145});ac.append("text").attr({"class":"connection-to-run-status",x:185,y:14})}else{Y.push(ac.select("rect.connection-label-background"));L.push(ac.select("rect.connection-label-border"))}ac.attr("transform",function(){var ae=(G*T++);return"translate(0, "+ae+")"});ac.select("text.connection-to").each(function(af){var ae=d3.select(this);ae.text(null).selectAll("title").remove();nf.CanvasUtils.ellipsis(ae,af.component.destination.name)}).append("title").text(function(ae){return ae.component.destination.name});ac.select("text.connection-to-run-status").text(function(){if(aa.component.destination.exists===false){return"\uf071"}else{if(aa.component.destination.running===true){return"\uf04b"}else{return"\uf04d"}}}).classed("is-missing-port",function(){return aa.component.destination.exists===false})}else{ac.remove()}var H=nf.CanvasUtils.formatConnectionName(aa.component);if(!nf.Common.isBlank(H)){if(V.empty()){V=K.append("g").attr({"class":"connection-name-container"});Y.push(V.append("rect").attr({"class":"connection-label-background",width:e.width,height:G}));L.push(V.append("rect").attr({"class":"connection-label-border",width:e.width,height:1}));V.append("text").attr({"class":"stats-label",x:5,y:14}).text("Name");V.append("text").attr({"class":"stats-value connection-name",x:45,y:14,width:142})}else{Y.push(V.select("rect.connection-label-background"));L.push(V.select("rect.connection-label-border"))}V.attr("transform",function(){var ae=(G*T++);return"translate(0, "+ae+")"});V.select("text.connection-name").each(function(){var ae=d3.select(this);ae.text(null).selectAll("title").remove();nf.CanvasUtils.ellipsis(ae,H)}).append("title").text(function(){return H})}else{V.remove()}}else{R.remove();ac.remove();V.remove()}var E=K.select("g.queued-container");if(E.empty()){E=K.append("g").attr({"class":"queued-container"});Y.push(E.append("rect").attr({"class":"connection-label-background",width:e.width,height:G}));L.push(E.append("rect").attr({"class":"connection-label-border",width:e.width,height:1}));E.append("text").attr({"class":"stats-label",x:5,y:14}).text("Queued");var X=E.append("text").attr({"class":"stats-value queued",x:55,y:14});X.append("tspan").attr({"class":"count"});X.append("tspan").attr({"class":"size"});E.append("text").attr({"class":"expiration-icon",x:185,y:14}).append("title")}else{Y.push(E.select("rect.connection-label-background"));L.push(E.select("rect.connection-label-border"))}E.attr("transform",function(){var ae=(G*T++);return"translate(0, "+ae+")"});K.select("rect.body").attr("height",function(){return(G*T)}).classed("unauthorized",function(){return aa.permissions.canRead===false});K.select("rect.border").attr("height",function(){return(G*T)}).classed("unauthorized",function(){return aa.permissions.canRead===false});$.each(Y,function(af,ae){if(af%2===0){ae.attr("fill","#f4f6f7")}else{ae.attr("fill","#ffffff")}});$.each(L,function(af,ae){if(af>0){ae.attr("fill","#c7d2d7")}else{ae.attr("fill","transparent")}});K.select("text.expiration-icon").classed("hidden",function(){if(aa.permissions.canRead){return !g(aa.component)}else{return true}}).text(function(){return"\uf017"}).select("title",function(){if(aa.permissions.canRead){return"Expires FlowFiles older than "+aa.component.flowFileExpiration}else{return""}});if(aa.permissions.canWrite){K.call(n)}S.call(k)}else{if(!K.empty()){K.remove()}}}nf.CanvasUtils.transition(S.select("g.connection-label-container"),C).attr("transform",function(){var af=d3.select(this).select("rect.body");var ae=j(af);return"translate("+ae.x+", "+ae.y+")"})})};var k=function(y){if(y.empty()){return}y.select("text.queued tspan.count").text(function(z){return nf.Common.substringBeforeFirst(z.status.aggregateSnapshot.queued," ")});y.select("text.queued tspan.size").text(function(z){return" "+nf.Common.substringAfterFirst(z.status.aggregateSnapshot.queued," ")})};var s=function(A,z){var y={revision:nf.Client.getRevision(A),component:z};return $.ajax({type:"PUT",url:A.uri,data:JSON.stringify(y),dataType:"json",contentType:"application/json"}).done(function(B){nf.Connection.set(B)}).fail(function(D,B,C){if(D.status===400||D.status===404||D.status===409){nf.Dialog.showOkDialog({headerText:"Connection",dialogContent:nf.Common.escapeHtml(D.responseText)})}else{nf.Common.handleAjaxError(D,B,C)}})};var f=function(y){y.each(function(z){nf.CanvasUtils.reloadConnectionSourceAndDestination(z.sourceId,z.destinationId)});y.remove()};return{config:{selfLoopXOffset:(e.width/2)+5,selfLoopYOffset:25},init:function(){r=d3.map();b=d3.select("#canvas").append("g").attr({"pointer-events":"stroke","class":"connections"});d=d3.svg.line().x(function(y){return y.x}).y(function(y){return y.y}).interpolate("linear");w=d3.behavior.drag().on("dragstart",function(){d3.event.sourceEvent.stopPropagation()}).on("drag",function(y){y.x=d3.event.x;y.y=d3.event.y;d3.select(this.parentNode).call(q,{updatePath:true,updateLabel:false})}).on("dragend",function(){var y=d3.select(this.parentNode);var C=y.datum();var A=y.selectAll("rect.midpoint").data();if(A.length===C.component.bends.length){var B=false;for(var z=0;z<A.length&&!B;z++){if(A[z].x!==C.component.bends[z].x||A[z].y!==C.component.bends[z].y){B=true}}if(B){s(C,{id:C.id,bends:A}).fail(function(){C.bends=$.map(C.component.bends,function(D){return{x:D.x,y:D.y}});y.call(q,{updatePath:true,updateLabel:false})})}}d3.event.sourceEvent.stopPropagation()});x=d3.behavior.drag().on("dragstart",function(y){y.dragging=true;d3.event.sourceEvent.stopPropagation()}).on("drag",function(y){y.x=d3.event.x-8;y.y=d3.event.y-8;d3.select("g.hover").classed("connectable-destination",function(){return nf.CanvasUtils.isValidConnectionDestination(d3.select(this))});d3.select(this.parentNode).call(q,{updatePath:true,updateLabel:false})}).on("dragend",function(G){G.dragging=false;var z=d3.select(this.parentNode);var I=z.datum();var y=I.destinationId;var H=d3.select("g.connectable-destination");if(H.empty()){z.call(q,{updatePath:true,updateLabel:false})}else{if(nf.CanvasUtils.isProcessGroup(H)||nf.CanvasUtils.isRemoteProcessGroup(H)){nf.ConnectionConfiguration.showConfiguration(z,H).done(function(){nf.CanvasUtils.reloadConnectionSourceAndDestination(null,y)}).fail(function(){z.call(q,{updatePath:true,updateLabel:false})})}else{var C=H.datum();var E=nf.CanvasUtils.getConnectableTypeForDestination(H);var D={revision:nf.Client.getRevision(I),component:{id:I.id,destination:{id:C.id,groupId:nf.Canvas.getGroupId(),type:E}}};if(I.bends.length<2&&I.sourceId===C.id){var A={x:C.position.x+(C.dimensions.width),y:C.position.y+(C.dimensions.height/2)};var F=nf.Connection.config.selfLoopXOffset;var B=nf.Connection.config.selfLoopYOffset;D.component.bends=[];D.component.bends.push({x:(A.x+F),y:(A.y-B)});D.component.bends.push({x:(A.x+F),y:(A.y+B)})}$.ajax({type:"PUT",url:I.uri,data:JSON.stringify(D),dataType:"json",contentType:"application/json"}).done(function(K){var J=K.component;nf.Connection.set(K);nf.CanvasUtils.reloadConnectionSourceAndDestination(null,y);nf.CanvasUtils.reloadConnectionSourceAndDestination(K.sourceId,K.destinationId)}).fail(function(L,J,K){if(L.status===400||L.status===404||L.status===409){nf.Dialog.showOkDialog({headerText:"Connection",dialogContent:nf.Common.escapeHtml(L.responseText)});z.call(q,{updatePath:true,updateLabel:false})}else{nf.Common.handleAjaxError(L,J,K)}})}}d3.event.sourceEvent.stopPropagation()});n=d3.behavior.drag().on("dragstart",function(y){d3.event.sourceEvent.stopPropagation()}).on("drag",function(D){if(D.bends.length>1){var A=d3.select("rect.label-drag");if(A.empty()){var C=d3.select(this).select("rect.body");var B=j(C);var y=e.width;var H=C.attr("height");A=d3.select("#canvas").append("rect").attr("x",B.x).attr("y",B.y).attr("class","label-drag").attr("width",y).attr("height",H).attr("stroke-width",function(){return 1/nf.Canvas.View.scale()}).attr("stroke-dasharray",function(){return 4/nf.Canvas.View.scale()}).datum({x:B.x,y:B.y,width:y,height:H})}else{A.attr("x",function(I){I.x+=d3.event.dx;return I.x}).attr("y",function(I){I.y+=d3.event.dy;return I.y})}var E=A.datum();var G={x:E.x+(E.width/2),y:E.y+(E.height/2)};var z=-1;var F;$.each(D.bends,function(K,J){var I={x:J.x,y:J.y};var L=i(G,I);if(z===-1||L<F){z=K;F=L}});D.labelIndex=z;d3.select(this.parentNode).call(q,{updatePath:true,updateLabel:false})}}).on("dragend",function(A){if(A.bends.length>1){var z=d3.select("rect.label-drag");if(!z.empty()){z.remove()}if(A.labelIndex!==A.component.labelIndex){var y=d3.select(this.parentNode);s(A,{id:A.id,labelIndex:A.labelIndex}).fail(function(){A.labelIndex=A.component.labelIndex;y.call(q,{updatePath:true,updateLabel:false})})}}d3.event.sourceEvent.stopPropagation()})},add:function(y,z){var B=false;if(nf.Common.isDefinedAndNotNull(z)){B=nf.Common.isDefinedAndNotNull(z.selectAll)?z.selectAll:B}var C=function(D){r.set(D.id,$.extend({type:"Connection"},D))};if($.isArray(y)){$.each(y,function(D,E){C(E)})}else{if(nf.Common.isDefinedAndNotNull(y)){C(y)}}var A=p();A.enter().call(v,B);A.call(q,{updatePath:true,updateLabel:false})},set:function(y,z){var B=false;var C=false;if(nf.Common.isDefinedAndNotNull(z)){B=nf.Common.isDefinedAndNotNull(z.selectAll)?z.selectAll:B;C=nf.Common.isDefinedAndNotNull(z.transition)?z.transition:C}var D=function(E){r.set(E.id,$.extend({type:"Connection"},E))};if($.isArray(y)){$.each(r.keys(),function(E,F){r.remove(F)});$.each(y,function(E,F){D(F)})}else{if(nf.Common.isDefinedAndNotNull(y)){D(y)}}var A=p();A.enter().call(v,B);A.call(q,{updatePath:true,updateLabel:true,transition:C});A.exit().call(f)},reorder:function(){d3.selectAll("g.connection").call(t)},refresh:function(y){if(nf.Common.isDefinedAndNotNull(y)){d3.select("#id-"+y).call(q,{updatePath:true,updateLabel:true})}else{d3.selectAll("g.connection").call(q,{updatePath:true,updateLabel:true})}},pan:function(){d3.selectAll("g.connection.entering, g.connection.leaving").call(q,{updatePath:false,updateLabel:true})},remove:function(y){if($.isArray(y)){$.each(y,function(A,z){r.remove(z)})}else{r.remove(y)}p().exit().call(f)},removeAll:function(){nf.Connection.remove(r.keys())},reload:function(z){if(r.has(z)){var y=r.get(z);return $.ajax({type:"GET",url:y.uri,dataType:"json"}).done(function(A){nf.Connection.set(A)})}},getComponentConnections:function(z){var y=[];r.forEach(function(A,B){if(nf.CanvasUtils.getConnectionSourceComponentId(B)===z||nf.CanvasUtils.getConnectionDestinationComponentId(B)===z){y.push(B)}});return y},get:function(y){if(nf.Common.isUndefined(y)){return r.values()}else{return r.get(y)}}}}());
nf.Draggable=(function(){var a;var b=function(f){var i=d3.map();var h=f.datum();var k={x:h.x-h.original.x,y:h.y-h.original.y};if(k.x===0&&k.y===0){return}var j=function(n){var m={x:n.position.x+k.x,y:n.position.y+k.y};var l={revision:nf.Client.getRevision(n),component:{id:n.id,position:m}};return $.Deferred(function(o){$.ajax({type:"PUT",url:n.uri,data:JSON.stringify(l),dataType:"json",contentType:"application/json"}).done(function(p){nf[n.type].set(p);o.resolve({type:n.type,id:n.id})}).fail(function(r,p,q){if(r.status===400||r.status===404||r.status===409){nf.Dialog.showOkDialog({headerText:"Component Position",dialogContent:nf.Common.escapeHtml(r.responseText)})}else{nf.Common.handleAjaxError(r,p,q)}o.reject()})}).promise()};var e=function(n){if(n.bends.length===0){return null}var m=$.map(n.bends,function(o){return{x:o.x+k.x,y:o.y+k.y}});var l={revision:nf.Client.getRevision(n),component:{id:n.id,bends:m}};return $.Deferred(function(o){$.ajax({type:"PUT",url:n.uri,data:JSON.stringify(l),dataType:"json",contentType:"application/json"}).done(function(p){nf.Connection.set(p);o.resolve({type:n.type,id:n.id})}).fail(function(r,p,q){if(r.status===400||r.status===404||r.status===409){nf.Dialog.showOkDialog({headerText:"Component Position",dialogContent:nf.Common.escapeHtml(r.responseText)})}else{nf.Common.handleAjaxError(r,p,q)}o.reject()})}).promise()};var d=d3.selectAll("g.connection.selected");var g=d3.selectAll("g.component.selected");if(nf.CanvasUtils.canModify(d)===false||nf.CanvasUtils.canModify(g)===false){nf.Dialog.showOkDialog({headerText:"Component Position",dialogContent:"Must be authorized to modify every component selected."});return}d.each(function(m){var l=e(m);if(l!==null){i.set(m.id,l)}});g.each(function(m){var l=nf.Connection.getComponentConnections(m.id);$.each(l,function(p,o){if(!i.has(o.id)&&nf.CanvasUtils.getConnectionSourceComponentId(o)===nf.CanvasUtils.getConnectionDestinationComponentId(o)){var n=e(nf.Connection.get(o.id));if(n!==null){i.set(o.id,n)}}});i.set(m.id,j(m))});$.when.apply(window,i.values()).done(function(){var l=$.makeArray(arguments);var m=d3.set();$.each(l,function(p,o){if(o.type==="Connection"){m.add(o.id)}else{var n=nf.Connection.getComponentConnections(o.id);$.each(n,function(r,q){m.add(q.id)})}});m.forEach(function(n){nf.Connection.refresh(n)})}).always(function(){nf.Birdseye.refresh()})};var c=function(){var d=d3.selectAll("g.component.selected, g.connection.selected");var e=d3.select("g.drop");if(nf.CanvasUtils.canModify(d)===false){nf.Dialog.showOkDialog({headerText:"Component Position",dialogContent:"Must be authorized to modify every component selected."});return}if(nf.CanvasUtils.canModify(e)===false){nf.Dialog.showOkDialog({headerText:"Component Position",dialogContent:"Not authorized to modify the destination group."});return}nf.CanvasUtils.moveComponents(d,e)};return{init:function(){a=d3.behavior.drag().on("dragstart",function(){d3.event.sourceEvent.stopPropagation()}).on("drag",function(){var e=d3.select("rect.drag-selection");if(e.empty()){var f=d3.selectAll("g.component.selected");var d=null,h=null,i=null,g=null;f.each(function(l){if(d===null||l.position.x<d){d=l.position.x}if(i===null||l.position.y<i){i=l.position.y}var k=l.position.x+l.dimensions.width;var j=l.position.y+l.dimensions.height;if(h===null||k>h){h=k}if(g===null||j>g){g=j}});d3.select("#canvas").append("rect").attr("rx",6).attr("ry",6).attr("x",d).attr("y",i).attr("class","drag-selection").attr("pointer-events","none").attr("width",h-d).attr("height",g-i).attr("stroke-width",function(){return 1/nf.Canvas.View.scale()}).attr("stroke-dasharray",function(){return 4/nf.Canvas.View.scale()}).datum({original:{x:d,y:i},x:d,y:i})}else{e.attr("x",function(j){j.x+=d3.event.dx;return j.x}).attr("y",function(j){j.y+=d3.event.dy;return j.y})}}).on("dragend",function(){d3.event.sourceEvent.stopPropagation();var d=d3.select("rect.drag-selection");if(d.empty()){return}if(d3.select("g.drop").empty()){b(d)}else{c()}d.remove()})},activate:function(d){d.classed("moveable",true).call(a)},deactivate:function(d){d.classed("moveable",false).on(".drag",null)}}}());
nf.Selectable=(function(){return{init:function(){},select:function(a){nf.ContextMenu.hide();if(!a.classed("selected")){if(!d3.event.shiftKey){d3.selectAll("g.selected").classed("selected",false)}a.classed("selected",true)}else{if(d3.event.shiftKey){a.classed("selected",false)}}nf.ng.Bridge.digest();d3.event.stopPropagation()},activate:function(a){a.on("mousedown.selection",function(){nf.Selectable.select(d3.select(this))})}}}());
nf.Connectable=(function(){var c;var d;var b;var a=function(){return !d3.event.shiftKey&&d3.select("rect.drag-selection").empty()&&d3.select("rect.selection").empty()};return{init:function(){d=d3.select("#canvas");c=d3.behavior.drag().origin(function(e){b=d3.mouse(d.node());return{x:b[0],y:b[1]}}).on("dragstart",function(h){d3.event.sourceEvent.stopPropagation();nf.CanvasUtils.getSelection().classed("selected",false);var g=d3.select(this.parentNode).classed("selected",true);d3.select(this).classed("dragging",true);var f=g.datum();var e=d3.mouse(d.node());d.insert("path",":first-child").datum({sourceId:f.id,sourceWidth:f.dimensions.width,x:e[0],y:e[1]}).attr({"class":"connector",d:function(i){return"M"+i.x+" "+i.y+"L"+i.x+" "+i.y}});d3.select(this).attr("transform",function(){return"translate("+e[0]+", "+(e[1]+20)+")"});d.node().appendChild(this)}).on("drag",function(f){d3.select(this).attr("transform",function(){return"translate("+d3.event.x+", "+(d3.event.y+50)+")"});var e=d3.select("g.hover").classed("connectable-destination",function(){return(Math.abs(b[0]-d3.event.x)>10||Math.abs(b[1]-d3.event.y)>10)&&nf.CanvasUtils.isValidConnectionDestination(d3.select(this))});d3.select("path.connector").classed("connectable",function(){if(e.empty()){return false}return e.classed("connectable-destination")}).attr("d",function(n){if(!e.empty()&&e.classed("connectable-destination")){var i=e.datum();if(n.sourceId===i.id){var g=n.x;var m=n.y;var k=n.sourceWidth/2;var j=nf.Connection.config.selfLoopXOffset;var l=nf.Connection.config.selfLoopYOffset;return"M"+g+" "+m+"L"+(g+k+j)+" "+(m-l)+"L"+(g+k+j)+" "+(m+l)+"Z"}else{var h=nf.CanvasUtils.getPerimeterPoint(n,{x:i.position.x,y:i.position.y,width:i.dimensions.width,height:i.dimensions.height});return"M"+n.x+" "+n.y+"L"+h.x+" "+h.y}}else{return"M"+n.x+" "+n.y+"L"+d3.event.x+" "+d3.event.y}})}).on("dragend",function(k){d3.event.sourceEvent.stopPropagation();var m=d3.select(this);var h=d3.select("path.connector");var f=h.datum();var l=d3.select("g.connectable-destination");if(l.empty()){var e=d3.select("#id-"+f.sourceId);var i=e.datum();var j=d3.mouse(e.node());if(j[0]<0||j[0]>i.dimensions.width||j[1]<0||j[1]>i.dimensions.height){m.remove()}else{m.classed("dragging",false).attr("transform",function(){return"translate("+k.origX+", "+k.origY+")"});e.node().appendChild(this)}h.remove()}else{m.remove();var g=l.datum();nf.ConnectionConfiguration.createConnection(f.sourceId,g.id)}})},activate:function(e){e.classed("connectable",true).on("mouseenter.connectable",function(i){if(a()){var g=d3.select(this);if(nf.CanvasUtils.isValidConnectionSource(g)){var h=d3.select("text.add-connect");if(h.empty()){var f=(i.dimensions.width/2)-14;var j=(i.dimensions.height/2)+14;g.append("text").datum({origX:f,origY:j}).call(c).attr({"class":"add-connect",transform:"translate("+f+", "+j+")"}).text("\ue834")}}}}).on("mouseleave.connectable",function(){var f=d3.select(this).select("text.add-connect");if(!f.empty()&&!f.classed("dragging")){f.remove()}}).on("mouseover.connectable",function(){d3.select(this).classed("hover",function(){return a()})}).on("mouseout.connection",function(){d3.select(this).classed("hover connectable-destination",false)})},deactivate:function(e){e.classed("connectable",false).on("mouseenter.connectable",null).on("mouseleave.connectable",null).on("mouseover.connectable",null).on("mouseout.connectable",null)}}}());
nf.Birdseye=(function(){var d;var b;var a=function(x){var v=nf.Canvas.View.translate();var M=nf.Canvas.View.scale();v=[v[0]/M,v[1]/M];var p=d3.select("#canvas").node().getBoundingClientRect();var e=(p.left/M)-v[0];var r=((p.top-nf.Canvas.CANVAS_OFFSET)/M)-v[1];var w=(p.right/M)-v[0];var k=(p.bottom/M)-v[1];var z=$("#canvas-container");var A=z.width()/M;var K=z.height()/M;var q=-v[0];var E=-v[1];var L=q+A;var n=E+K;var C=Math.min(e,q);var F=Math.min(r,E);var h=Math.max(w,L);var I=Math.max(k,n);var J=h-C;var f=I-F;var u=$("#birdseye");var t=u.width();var m=u.height();var D=t/J;var l=m/f;var B=Math.min(D,l);var j=[0,0];var g=[0,0];if(v[0]<0&&v[1]<0){j=[0,0];g=[-v[0],-v[1]]}else{if(v[0]>=0&&v[1]<0){j=[v[0],0];g=[0,-v[1]]}else{if(v[0]<0&&v[1]>=0){j=[0,v[1]];g=[-v[0],0]}else{j=[v[0],v[1]];g=[0,0]}}}var H=0;var o=-e;if(v[0]<0){if(v[0]<o){H=o}else{H=o-(o-v[0])}}else{if(v[0]<o){H=o-v[0]}}var G=0;var y=-r;if(v[1]<0){if(v[1]<y){G=y}else{G=y-(y-v[1])}}else{if(v[1]<y){G=y-v[1]}}j=[j[0]+H,j[1]+G];g=[g[0]+H,g[1]+G];d.attr("transform","scale("+B+")");b.attr("transform","translate("+j+")");d3.select("rect.birdseye-brush").attr({width:A,height:K,"stroke-width":(2/B),transform:function(N){N.x=g[0];N.y=g[1];return"translate("+g+")"}});var s=d3.select("#birdseye-canvas").node();var i=s.getContext("2d");i.save();i.setTransform(1,0,0,1,0,0);i.clearRect(0,0,s.width,s.height);i.restore();i.save();i.translate(j[0]*B,j[1]*B);i.scale(B,B);$.each(x.labels,function(O,P){var N=nf.Label.defaultColor();if(P.permissions.canRead){if(nf.Common.isDefinedAndNotNull(P.component.style["background-color"])){N=P.component.style["background-color"]}}i.fillStyle=N;i.fillRect(P.position.x,P.position.y,P.dimensions.width,P.dimensions.height)});i.fillStyle="#ad9897";$.each(x.funnels,function(N,O){i.fillRect(O.position.x,O.position.y,O.dimensions.width,O.dimensions.height)});i.fillStyle="#bbdcde";$.each(x.ports,function(N,O){i.fillRect(O.position.x,O.position.y,O.dimensions.width,O.dimensions.height)});i.fillStyle="#728e9b";$.each(x.remoteProcessGroups,function(N,O){i.fillRect(O.position.x,O.position.y,O.dimensions.width,O.dimensions.height)});$.each(x.processGroups,function(N,O){i.fillRect(O.position.x,O.position.y,O.dimensions.width,O.dimensions.height)});$.each(x.processors,function(O,P){var N="#dde4eb";if(P.permissions.canRead){if(nf.Common.isDefinedAndNotNull(P.component.style["background-color"])){N=P.component.style["background-color"]}}i.fillStyle=N;i.fillRect(P.position.x,P.position.y,P.dimensions.width,P.dimensions.height)});i.restore()};var c=true;return{init:function(){var g=$("#birdseye");d3.select("#birdseye").append("canvas").attr("id","birdseye-canvas").attr("width",g.width()).attr("height",g.height());var f=d3.select("#birdseye").append("svg").attr("width",g.width()).attr("height",g.height());d=f.append("g").attr("class","birdseye");b=d.append("g").attr("pointer-events","none");var e=d3.behavior.drag().origin(function(h){return{x:h.x,y:h.y}}).on("dragstart",function(){nf.ContextMenu.hide()}).on("drag",function(j){j.x+=d3.event.dx;j.y+=d3.event.dy;d3.select(this).attr("transform",function(){return"translate("+j.x+", "+j.y+")"});var i=nf.Canvas.View.scale();var h=nf.Canvas.View.translate();h=[(-d3.event.dx*i)+h[0],(-d3.event.dy*i)+h[1]];nf.Canvas.View.translate(h);nf.Canvas.View.refresh({persist:false,transition:false,refreshComponents:false,refreshBirdseye:false})}).on("dragend",function(){nf.Canvas.View.updateVisibility();nf.CanvasUtils.persistUserView();nf.Birdseye.refresh()});d.append("g").attr({"pointer-events":"all","class":"birdseye-brush-container"}).append("rect").attr("class","birdseye-brush moveable").datum({x:0,y:0}).call(e)},refresh:function(){if(c){a(nf.Graph.get())}},updateBirdseyeVisibility:function(e){var f=$("#birdseye");if(e){f.show();c=true;a(nf.Graph.get())}else{f.hide();c=false}}}}());
nf.Settings=(function(){var v={urls:{api:"../nifi-api",controllerConfig:"../nifi-api/controller/config",reportingTaskTypes:"../nifi-api/flow/reporting-task-types",createReportingTask:"../nifi-api/controller/reporting-tasks",reportingTasks:"../nifi-api/flow/reporting-tasks"}};var k={forceFitColumns:true,enableTextSelectionOnCells:true,enableCellNavigation:true,enableColumnReorder:false,autoEdit:false,multiSelect:false,rowHeight:24};var a=function(){return $("#controller-services-table")};var l=function(y){var A=u();var z={revision:nf.Client.getRevision({revision:{version:y}}),component:A};$.ajax({type:"PUT",url:v.urls.controllerConfig,data:JSON.stringify(z),dataType:"json",contentType:"application/json"}).done(function(B){nf.Dialog.showOkDialog({headerText:"Settings",dialogContent:"Settings successfully applied."});$("#settings-save").off("click").on("click",function(){l(B.revision.version)})}).fail(nf.Common.handleAjaxError)};var j=function(){};var u=function(){var y={};y.maxTimerDrivenThreadCount=$("#maximum-timer-driven-thread-count-field").val();y.maxEventDrivenThreadCount=$("#maximum-event-driven-thread-count-field").val();return y};var x=function(A,z){if(z.searchString===""){return true}try{var D=new RegExp(z.searchString,"i")}catch(C){return false}var B=A.label.search(D)>=0;var y=A.tags.search(D)>=0;return B||y};var g=function(A,y){var z=[];$.each(A,function(D,E){z.push(E)});var B=y.toLowerCase();var C=true;$.each(z,function(D,E){if(B.indexOf(E)===-1){C=false;return false}});return C};var o=function(C,z,B,A,y){if(!y.permissions.canRead){return'<span class="blank">'+y.id+"</span>"}return y.component.name};var t=function(C,z,B,A,y){if(!y.permissions.canRead){return""}return nf.Common.substringAfterLast(y.component.type,".")};var r=function(y,A){var z=function(I,H){if(I.permissions.canRead&&H.permissions.canRead){if(y.columnId==="moreDetails"){var E=0;if(!nf.Common.isEmpty(I.bulletins)){E=I.bulletins.length}var B=0;if(!nf.Common.isEmpty(H.bulletins)){B=H.bulletins.length}return E-B}else{if(y.columnId==="type"){var F=nf.Common.isDefinedAndNotNull(I.component[y.columnId])?nf.Common.substringAfterLast(I.component[y.columnId],"."):"";var D=nf.Common.isDefinedAndNotNull(H.component[y.columnId])?nf.Common.substringAfterLast(H.component[y.columnId],"."):"";return F===D?0:F>D?1:-1}else{if(y.columnId==="state"){var G="Invalid";if(nf.Common.isEmpty(I.component.validationErrors)){G=nf.Common.isDefinedAndNotNull(I.component[y.columnId])?I.component[y.columnId]:""}var K="Invalid";if(nf.Common.isEmpty(H.component.validationErrors)){K=nf.Common.isDefinedAndNotNull(H.component[y.columnId])?H.component[y.columnId]:""}return G===K?0:G>K?1:-1}else{var C=nf.Common.isDefinedAndNotNull(I.component[y.columnId])?I.component[y.columnId]:"";var J=nf.Common.isDefinedAndNotNull(H.component[y.columnId])?H.component[y.columnId]:"";return C===J?0:C>J?1:-1}}}}else{if(!I.permissions.canRead&&!H.permissions.canRead){return 0}if(I.permissions.canRead){return 1}else{return -1}}};A.sort(z,y.sortAsc)};var b=function(){return $("#reporting-task-type-filter").val()};var h=function(){var z=$("#reporting-task-types-table").data("gridInstance");if(nf.Common.isDefinedAndNotNull(z)){var y=z.getData();y.setFilterArgs({searchString:b()});y.refresh();if(y.getLength()>0){z.setSelectedRows([0])}}};var d=function(){$("#reporting-task-type-description").text("");$("#reporting-task-type-name").text("");$("#selected-reporting-task-name").text("");$("#selected-reporting-task-type").text("");$("#reporting-task-description-container").hide()};var m=function(){d();var y=$("#reporting-task-types-table").data("gridInstance");y.resetActiveCell()};var p=function(D,A){var z=x(D,A);var y=true;if(z){var B=$("#reporting-task-tag-cloud").tagcloud("getSelectedTags");var C=B.length>0;if(C){y=g(B,D.tags)}}var E=z&&y;if(E===false&&$("#selected-reporting-task-type").text()===D.type){m()}return E};var q=function(){var y=$("#selected-reporting-task-type").text();if(y===""){nf.Dialog.showOkDialog({headerText:"Settings",dialogContent:"The type of reporting task to create must be selected."})}else{i(y)}};var i=function(y){var A={revision:nf.Client.getRevision({revision:{version:0}}),component:{type:y}};var z=$.ajax({type:"POST",url:v.urls.createReportingTask,data:JSON.stringify(A),dataType:"json",contentType:"application/json"}).done(function(C){var E=$("#reporting-tasks-table").data("gridInstance");var B=E.getData();B.addItem(C);B.reSort();E.invalidate();var D=B.getRowById(C.id);E.setSelectedRows([D]);E.scrollRowIntoView(D)}).fail(nf.Common.handleAjaxError);$("#new-reporting-task-dialog").modal("hide");return z};var f=function(){$("#reporting-task-type-filter").on("keyup",function(C){var B=C.keyCode?C.keyCode:C.which;if(B===$.ui.keyCode.ENTER){q()}else{h()}});var z=[{id:"type",name:"Type",field:"label",sortable:false,resizable:true},{id:"tags",name:"Tags",field:"tags",sortable:false,resizable:true}];var y=new Slick.Data.DataView({inlineFilters:false});y.setItems([]);y.setFilterArgs({searchString:b()});y.setFilter(p);var A=new Slick.Grid("#reporting-task-types-table",y,z,k);A.setSelectionModel(new Slick.RowSelectionModel());A.registerPlugin(new Slick.AutoTooltips());A.setSortColumn("type",true);A.onSelectedRowsChanged.subscribe(function(E,C){if($.isArray(C.rows)&&C.rows.length===1){var D=C.rows[0];var B=A.getDataItem(D);if(nf.Common.isDefinedAndNotNull(B)){if(nf.Common.isBlank(B.description)){$("#reporting-task-type-description").attr("title","").html('<span class="unset">No description specified</span>')}else{$("#reporting-task-type-description").html(B.description).ellipsis()}$("#reporting-task-type-name").text(B.label).ellipsis();$("#selected-reporting-task-name").text(B.label);$("#selected-reporting-task-type").text(B.type);$("#reporting-task-description-container").show()}}});A.onDblClick.subscribe(function(D,C){var B=A.getDataItem(C.row);i(B.type)});y.onRowCountChanged.subscribe(function(C,B){A.updateRowCount();A.render();$("#displayed-reporting-task-types").text(B.current)});y.onRowsChanged.subscribe(function(C,B){A.invalidateRows(B.rows);A.render()});y.syncGridSelection(A,true);$("#reporting-task-types-table").data("gridInstance",A);$.ajax({type:"GET",url:v.urls.reportingTaskTypes,dataType:"json"}).done(function(B){var D=0;var C=[];y.beginUpdate();$.each(B.reportingTaskTypes,function(E,F){y.addItem({id:D++,label:nf.Common.substringAfterLast(F.type,"."),type:F.type,description:nf.Common.escapeHtml(F.description),tags:F.tags.join(", ")});$.each(F.tags,function(H,G){C.push(G.toLowerCase())})});y.endUpdate();$("#total-reporting-task-types, #displayed-reporting-task-types").text(B.reportingTaskTypes.length);$("#reporting-task-tag-cloud").tagcloud({tags:C,select:h,remove:h})}).fail(nf.Common.handleAjaxError);$("#new-reporting-task-dialog").modal({scrollableContentStyle:"scrollable",headerText:"Add Reporting Task",buttons:[{buttonText:"Add",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){q()}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){$(this).modal("hide")}}}],handler:{close:function(){d();$("#reporting-task-type-filter").val("");$("#reporting-task-tag-cloud").tagcloud("clearSelectedTags");h();var B=$("#reporting-task-types-table").data("gridInstance");B.setSelectedRows([]);B.resetActiveCell()}}})};var e=function(){f();var C=function(L,F,K,H,E){if(!E.permissions.canRead){return""}var G='<div title="View Details" class="pointer view-reporting-task fa fa-info-circle" style="margin-top: 5px; float: left;" ></div>';G+='<div title="Usage" class="pointer reporting-task-usage fa fa-book" style="margin-left: 6px; margin-top: 5px; float: left;"></div>';var I=!nf.Common.isEmpty(E.component.validationErrors);var J=!nf.Common.isEmpty(E.bulletins);if(I){G+='<div class="pointer has-errors fa fa-warning" style="margin-top: 4px; margin-left: 3px; float: left;" ></div>'}if(J){G+='<div class="has-bulletins fa fa-sticky-note-o" style="margin-top: 5px; margin-left: 5px; float: left;"></div>'}if(I||J){G+='<span class="hidden row-id">'+nf.Common.escapeHtml(E.component.id)+"</span>"}return G};var D=function(M,L,K,G,E){if(!E.permissions.canRead){return""}var I="",J="";if(!nf.Common.isEmpty(E.component.validationErrors)){J="Invalid";I="invalid fa fa-warning"}else{if(E.component.state==="STOPPED"){J="Stopped";I="fa fa-stop"}else{if(E.component.state==="RUNNING"){J="Running";I="fa fa-play"}else{J="Disabled";I="icon icon-enable-false"}}}var H="";if(nf.Common.isDefinedAndNotNull(E.component.activeThreadCount)&&E.component.activeThreadCount>0){H="("+E.component.activeThreadCount+")"}var F='<div layout="row"><div class="'+I+'" style="margin-top: 3px;"></div>';return F+'<div class="status-text" style="margin-top: 4px;">'+nf.Common.escapeHtml(J)+'</div><div style="float: left; margin-left: 4px;">'+nf.Common.escapeHtml(H)+"</div></div>"};var B=function(J,F,I,H,E){var G="";if(E.permissions.canRead&&E.permissions.canWrite){if(E.component.state==="RUNNING"){G+='<div title="Stop" class="pointer stop-reporting-task fa fa-stop" style="margin-top: 2px; margin-right: 3px;" ></div>'}else{if(E.component.state==="STOPPED"||E.component.state==="DISABLED"){G+='<div title="Edit" class="pointer edit-reporting-task fa fa-pencil" style="margin-top: 2px; margin-right: 3px;" ></div>';if(E.component.state==="STOPPED"&&nf.Common.isEmpty(E.component.validationErrors)){G+='<div title="Start" class="pointer start-reporting-task fa fa-play" style="margin-top: 2px; margin-right: 3px;"></div>'}}}if(E.component.persistsState===true){G+='<div title="View State" class="pointer view-state-reporting-task fa fa-tasks" style="margin-top: 2px; margin-right: 3px;" ></div>'}}if(E.permissions.canWrite){G+='<div title="Remove" class="pointer delete-reporting-task fa fa-trash" style="margin-top: 2px; margin-right: 3px;" ></div>'}if(nf.Canvas.isConfigurableAuthorizer()&&nf.Common.canAccessTenants()){G+='<div title="Access Policies" class="pointer edit-access-policies fa fa-key" style="margin-top: 2px;"></div>'}return G};var y=[{id:"moreDetails",name:"&nbsp;",resizable:false,formatter:C,sortable:true,width:90,maxWidth:90,toolTip:"Sorts based on presence of bulletins"},{id:"name",name:"Name",sortable:true,resizable:true,formatter:o},{id:"type",name:"Type",sortable:true,resizable:true,formatter:t},{id:"state",name:"Run Status",sortable:true,resizeable:true,formatter:D}];y.push({id:"actions",name:"&nbsp;",resizable:false,formatter:B,sortable:false,width:90,maxWidth:90});var A=new Slick.Data.DataView({inlineFilters:false});A.setItems([]);r({columnId:"name",sortAsc:true},A);var z=new Slick.Grid("#reporting-tasks-table",A,y,k);z.setSelectionModel(new Slick.RowSelectionModel());z.registerPlugin(new Slick.AutoTooltips());z.setSortColumn("name",true);z.onSort.subscribe(function(F,E){r({columnId:E.sortCol.id,sortAsc:E.sortAsc},A)});z.onClick.subscribe(function(I,F){var H=$(I.target);var G=A.getItem(F.row);if(z.getColumns()[F.cell].id==="actions"){if(H.hasClass("edit-reporting-task")){nf.ReportingTask.showConfiguration(G)}else{if(H.hasClass("start-reporting-task")){nf.ReportingTask.start(G)}else{if(H.hasClass("stop-reporting-task")){nf.ReportingTask.stop(G)}else{if(H.hasClass("delete-reporting-task")){nf.ReportingTask.remove(G)}else{if(H.hasClass("view-state-reporting-task")){var E=G.component.state==="STOPPED"&&G.component.activeThreadCount===0;nf.ComponentState.showState(G,E)}else{if(H.hasClass("edit-access-policies")){nf.PolicyManagement.showReportingTaskPolicy(G);$("#shell-close-button").click()}}}}}}}else{if(z.getColumns()[F.cell].id==="moreDetails"){if(H.hasClass("view-reporting-task")){nf.ReportingTask.showDetails(G)}else{if(H.hasClass("reporting-task-usage")){$("#shell-close-button").click();nf.Shell.showPage("../nifi-docs/documentation?"+$.param({select:nf.Common.substringAfterLast(G.component.type,".")})).done(function(){nf.Settings.showSettings()})}}}}});A.onRowCountChanged.subscribe(function(F,E){z.updateRowCount();z.render()});A.onRowsChanged.subscribe(function(F,E){z.invalidateRows(E.rows);z.render()});A.syncGridSelection(z,true);$("#reporting-tasks-table").data("gridInstance",z).on("mouseenter","div.slick-cell",function(K){var I=$(this).find("div.has-errors");if(I.length&&!I.data("qtip")){var E=$(this).find("span.row-id").text();var G=A.getItemById(E);var H=nf.Common.formatUnorderedList(G.component.validationErrors);if(nf.Common.isDefinedAndNotNull(H)){I.qtip($.extend({},nf.Common.config.tooltipConfig,{content:H,position:{target:"mouse",viewport:$(window),adjust:{x:8,y:8,method:"flipinvert flipinvert"}}}))}}var F=$(this).find("div.has-bulletins");if(F.length&&!F.data("qtip")){var E=$(this).find("span.row-id").text();var G=A.getItemById(E);var J=nf.Common.getFormattedBulletins(G.bulletins);var H=nf.Common.formatUnorderedList(J);if(nf.Common.isDefinedAndNotNull(H)){F.qtip($.extend({},nf.Common.config.tooltipConfig,{content:H,position:{target:"mouse",viewport:$(window),adjust:{x:8,y:8,method:"flipinvert flipinvert"}}}))}}})};var w=function(){var D=function(){$("#read-only-maximum-timer-driven-thread-count-field").addClass("unset").text("Unauthorized");$("#read-only-maximum-event-driven-thread-count-field").addClass("unset").text("Unauthorized")};var B=function(E){if(E){$("#general-settings div.editable").show();$("#general-settings div.read-only").hide();$("#settings-save").show()}else{$("#general-settings div.editable").hide();$("#general-settings div.read-only").show();$("#settings-save").hide()}};var A=$.Deferred(function(E){$.ajax({type:"GET",url:v.urls.controllerConfig,dataType:"json"}).done(function(F){if(F.permissions.canWrite){$("#maximum-timer-driven-thread-count-field").removeClass("unset").val(F.component.maxTimerDrivenThreadCount);$("#maximum-event-driven-thread-count-field").removeClass("unset").val(F.component.maxEventDrivenThreadCount);B(true);$("#settings-save").off("click").on("click",function(){l(F.revision.version)})}else{if(F.permissions.canRead){$("#read-only-maximum-timer-driven-thread-count-field").removeClass("unset").text(F.component.maxTimerDrivenThreadCount);$("#read-only-maximum-event-driven-thread-count-field").removeClass("unset").text(F.component.maxEventDrivenThreadCount)}else{D()}B(false)}E.resolve()}).fail(function(H,F,G){if(H.status===403){D();B(false);E.resolve()}else{E.reject(H,F,G)}})}).promise();var y=v.urls.api+"/flow/controller/controller-services";var z=nf.ControllerServices.loadControllerServices(y,a());var C=n();return $.when(A,z,C).done(function(G,F){var E=F[0];$("#settings-last-refreshed").text(E.currentTime)}).fail(nf.Common.handleAjaxError)};var n=function(){return $.ajax({type:"GET",url:v.urls.reportingTasks,dataType:"json"}).done(function(y){var C=[];$.each(y.reportingTasks,function(E,D){C.push($.extend({bulletins:[]},D))});var A=$("#reporting-tasks-table");nf.Common.cleanUpTooltips(A,"div.has-errors");nf.Common.cleanUpTooltips(A,"div.has-bulletins");var z=A.data("gridInstance");var B=z.getData();B.setItems(C);B.reSort();z.invalidate()})};var c=function(){nf.Shell.showContent("#settings").done(function(){s()});$("#settings-tabs").find(".selected-tab").click();nf.Settings.resetTableSize()};var s=function(){$("#settings-save").mouseout()};return{init:function(){$("#settings-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",scrollableTabContentStyle:"scrollable",tabs:[{name:"General",tabContentId:"general-settings-tab-content"},{name:"Controller Services",tabContentId:"controller-services-tab-content"},{name:"Reporting Tasks",tabContentId:"reporting-tasks-tab-content"}],select:function(){var y=$(this).text();if(y==="General"){$("#new-service-or-task").hide();$("#settings-save").show()}else{var z=false;if(nf.Common.isDefinedAndNotNull(nf.Common.currentUser)){z=nf.Common.currentUser.controllerPermissions.canWrite===true}if(z){$("#new-service-or-task").show();$("div.controller-settings-table").css("top","32px");$("#new-service-or-task").attr("title",function(){if(y==="Controller Services"){$("#settings-save").hide();return"Create a new controller service"}else{if(y==="Reporting Tasks"){$("#settings-save").hide();return"Create a new reporting task"}}})}else{$("#new-service-or-task").hide();$("div.controller-settings-table").css("top","0")}nf.Settings.resetTableSize()}}});$("#settings-refresh-button").click(function(){w()});$("#new-service-or-task").on("click",function(){var z=$("#settings-tabs li.selected-tab").text();if(z==="Controller Services"){var y=v.urls.api+"/controller/controller-services";nf.ControllerServices.promptNewControllerService(y,a())}else{if(z==="Reporting Tasks"){$("#new-reporting-task-dialog").modal("show");var A=$("#reporting-task-types-table").data("gridInstance");if(nf.Common.isDefinedAndNotNull(A)){A.setSelectedRows([0]);A.resizeCanvas()}$("#reporting-task-type-filter").focus()}}});j();nf.ControllerServices.init(a());e()},resetTableSize:function(){nf.ControllerServices.resetTableSize(a());var y=$("#reporting-tasks-table").data("gridInstance");if(nf.Common.isDefinedAndNotNull(y)){y.resizeCanvas()}},showSettings:function(){return w().done(c)},loadSettings:function(){return w()},selectControllerService:function(y){var z=a().data("gridInstance");var A=z.getData();var B=A.getRowById(y);z.setSelectedRows([B]);z.scrollRowIntoView(B);$("#settings-tabs").find("li:eq(1)").click()},setBulletins:function(A,y){if($("#controller-services-table").data("gridInstance")){nf.ControllerServices.setBulletins(a(),A)}var z=$("#reporting-tasks-table").data("gridInstance");var C=z.getData();C.beginUpdate();if(!nf.Common.isEmpty(y)){var D=d3.nest().key(function(E){return E.sourceId}).map(y,d3.map);D.forEach(function(F,E){var G=C.getItemById(F);if(nf.Common.isDefinedAndNotNull(G)){C.updateItem(F,$.extend(G,{bulletins:E}))}})}else{var B=C.getItems();$.each(B,function(E,F){C.updateItem(F.id,$.extend(F,{bulletins:[]}))})}C.endUpdate()}}}());
nf.GoTo=(function(){var a={urls:{api:"../nifi-api",processGroups:"../nifi-api/process-groups/"}};var f=function(k){return $.ajax({type:"GET",url:a.urls.processGroups+encodeURIComponent(k),dataType:"json"})};var j=function(k,l){return $.ajax({type:"GET",url:a.urls.processGroups+encodeURIComponent(k)+"/remote-process-groups/"+encodeURIComponent(l),dataType:"json"})};var b=function(l){var k=$('<div class="source-destination-connection"></div>').appendTo("#connections-container");var m;if(l.source.type==="OUTPUT_PORT"){m=c(k,l)}else{if(l.source.type==="REMOTE_OUTPUT_PORT"){m=e(k,l)}else{m=d(k,l)}}m.done(function(){var p=$('<div class="connection-entry"></div>').appendTo(k);var o="";var q=nf.CanvasUtils.formatConnectionName(l);if(q===""){o="unset";q="Connection"}$('<div class="search-result-icon connection-small-icon"></div>').appendTo(p);$('<div class="connection-entry-name go-to-link"></div>').attr("title",q).addClass(o).text(q).on("click",function(){nf.CanvasUtils.showComponent(l.parentGroupId,l.id);$("#connections-dialog").modal("hide")}).appendTo(p);$('<div class="clear"></div>').appendTo(p);var n;if(l.destination.type==="INPUT_PORT"){n=i(k,l)}else{if(l.destination.type==="REMOTE_INPUT_PORT"){n=g(k,l)}else{n=h(k,l)}}n.done(function(){$('<div class="clear"></div>').appendTo(k)})})};var h=function(k,l){return $.Deferred(function(m){var n="";if(l.destination.type==="PROCESSOR"){n="processor-small-icon"}else{if(l.destination.type==="OUTPUT_PORT"){n="output-port-small-icon"}}var o=$('<div class="destination-component"></div>').appendTo(k);$('<div class="search-result-icon"></div>').addClass(n).appendTo(o);$('<div class="destination-component-name go-to-link"></div>').attr("title",l.destination.name).text(l.destination.name).on("click",function(){nf.CanvasUtils.showComponent(l.destination.groupId,l.destination.id);$("#connections-dialog").modal("hide")}).appendTo(o);$('<div class="clear"></div>').appendTo(o);m.resolve()}).promise()};var i=function(k,l){return f(l.destination.groupId).done(function(m){var n=m.component;var p=$('<div class="destination-component"></div>').appendTo(k);$('<div class="search-result-icon process-group-small-icon"></div>').appendTo(p);$('<div class="destination-component-name go-to-link"></div>').attr("title",n.name).text(n.name).on("click",function(){nf.CanvasUtils.showComponent(n.parentGroupId,n.id);$("#connections-dialog").modal("hide")}).appendTo(p);$('<div class="clear"></div>').appendTo(p);var o=$('<div class="destination-input-port"></div>').appendTo(p);$('<div class="search-result-icon input-port-small-icon"></div>').appendTo(o);$('<div class="destination-input-port-name go-to-link"></div>').attr("title",l.destination.name).text(l.destination.name).on("click",function(){nf.CanvasUtils.showComponent(l.destination.groupId,l.destination.id);$("#connections-dialog").modal("hide")}).appendTo(o);$('<div class="clear"></div>').appendTo(p)})};var g=function(k,l){return j(l.parentGroupId,l.destination.groupId).done(function(m){var n=m.remoteProcessGroup;var p=$('<div class="destination-component"></div>').appendTo(k);$('<div class="search-result-icon remote-process-group-small-icon"></div>').appendTo(p);$('<div class="destination-component-name go-to-link"></div>').attr("title",n.name).text(n.name).on("click",function(){nf.CanvasUtils.showComponent(n.parentGroupId,n.id);$("#connections-dialog").modal("hide")}).appendTo(p);$('<div class="clear"></div>').appendTo(p);var o=$('<div class="destination-input-port"></div>').appendTo(p);$('<div class="search-result-icon input-port-small-icon"></div>').appendTo(o);$('<div class="destination-input-port-name"></div>').attr("title",l.destination.name).text(l.destination.name).appendTo(o);$('<div class="clear"></div>').appendTo(p)})};var d=function(k,l){return $.Deferred(function(m){var o="";if(l.source.type==="PROCESSOR"){o="processor-small-icon"}else{if(l.source.type==="INPUT_PORT"){o="input-port-small-icon"}}var n=$('<div class="source-component"></div>').appendTo(k);$('<div class="search-result-icon"></div>').addClass(o).appendTo(n);$('<div class="source-component-name go-to-link"></div>').attr("title",l.source.name).text(l.source.name).on("click",function(){nf.CanvasUtils.showComponent(l.source.groupId,l.source.id);$("#connections-dialog").modal("hide")}).appendTo(n);m.resolve()}).promise()};var c=function(k,l){return f(l.source.groupId).done(function(m){var o=m.component;var n=$('<div class="source-component"></div>').appendTo(k);$('<div class="search-result-icon process-group-small-icon"></div>').appendTo(n);$('<div class="source-component-name go-to-link"></div>').attr("title",o.name).text(o.name).on("click",function(){nf.CanvasUtils.showComponent(o.parentGroupId,o.id);$("#connections-dialog").modal("hide")}).appendTo(n);$('<div class="clear"></div>').appendTo(n);var p=$('<div class="source-output-port"></div>').appendTo(n);$('<div class="search-result-icon output-port-small-icon"></div>').appendTo(p);$('<div class="source-output-port-name go-to-link"></div>').attr("title",l.source.name).text(l.source.name).on("click",function(){nf.CanvasUtils.showComponent(l.source.groupId,l.source.id);$("#connections-dialog").modal("hide")}).appendTo(p)})};var e=function(k,l){return j(l.parentGroupId,l.source.groupId).done(function(m){var o=m.remoteProcessGroup;var n=$('<div class="source-component"></div>').appendTo(k);$('<div class="search-result-icon remote-process-group-small-icon"></div>').appendTo(n);$('<div class="source-component-name go-to-link"></div>').attr("title",o.name).text(o.name).on("click",function(){nf.CanvasUtils.showComponent(o.parentGroupId,o.id);$("#connections-dialog").modal("hide")}).appendTo(n);$('<div class="clear"></div>').appendTo(n);var p=$('<div class="source-output-port"></div>').appendTo(n);$('<div class="search-result-icon output-port-small-icon"></div>').appendTo(p);$('<div class="source-output-port-name"></div>').attr("title",l.source.name).text(l.source.name).appendTo(p)})};return{init:function(){$("#connections-dialog").modal({scrollableContentStyle:"scrollable",buttons:[{buttonText:"Close",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){$("#connections-dialog").modal("hide")}}}],handler:{close:function(){$("#connections-context").empty();$("#connections-container").empty()}}})},showDownstreamFromProcessor:function(k){var l=k.datum();$.ajax({type:"GET",url:a.urls.api+"/process-groups/"+encodeURIComponent(l.component.parentGroupId)+"/connections",dataType:"json"}).done(function(m){var n=m.connections;$("#connections-context").append('<div class="search-result-icon processor-small-icon"></div>').append($('<div class="connections-component-name"></div>').text(l.component.name)).append('<div class="clear"></div>');$.each(n,function(p,o){if(o.source.id===l.id){b(o)}});if($("#connections-container").is(":empty")){$("#connections-container").html('<span class="unset">No downstream components</span>')}$("#connections-dialog").modal("setHeaderText","Downstream Connections").modal("show")}).fail(nf.Common.handleAjaxError)},showUpstreamFromProcessor:function(k){var l=k.datum();$.ajax({type:"GET",url:a.urls.api+"/process-groups/"+encodeURIComponent(l.component.parentGroupId)+"/connections",dataType:"json"}).done(function(m){var n=m.connections;$("#connections-context").append('<div class="search-result-icon processor-small-icon"></div>').append($('<div class="connections-component-name"></div>').text(l.component.name)).append('<div class="clear"></div>');$.each(n,function(p,o){if(o.destination.id===l.id){b(o)}});if($("#connections-container").is(":empty")){$("#connections-container").html('<span class="unset">No upstream components</span>')}$("#connections-dialog").modal("setHeaderText","Upstream Connections").modal("show")}).fail(nf.Common.handleAjaxError)},showDownstreamFromGroup:function(k){var l=k.datum();$.ajax({type:"GET",url:a.urls.api+"/process-groups/"+encodeURIComponent(l.component.parentGroupId)+"/connections",dataType:"json"}).done(function(m){var n=m.connections;$("#connections-context").append('<div class="search-result-icon process-group-small-icon"></div>').append($('<div class="connections-component-name"></div>').text(l.component.name)).append('<div class="clear"></div>');$.each(n,function(p,o){if(o.source.groupId===l.id){b(o)}});if($("#connections-container").is(":empty")){$("#connections-container").html('<span class="unset">No downstream components</span>')}$("#connections-dialog").modal("setHeaderText","Downstream Connections").modal("show")}).fail(nf.Common.handleAjaxError)},showUpstreamFromGroup:function(k){var l=k.datum();$.ajax({type:"GET",url:a.urls.api+"/process-groups/"+encodeURIComponent(l.component.parentGroupId)+"/connections",dataType:"json"}).done(function(m){var n=m.connections;$("#connections-context").append('<div class="search-result-icon process-group-small-icon"></div>').append($('<div class="connections-component-name"></div>').text(l.component.name)).append('<div class="clear"></div>');$.each(n,function(p,o){if(o.destination.groupId===l.id){b(o)}});if($("#connections-container").is(":empty")){$("#connections-container").html('<span class="unset">No upstream components</span>')}$("#connections-dialog").modal("setHeaderText","Upstream Connections").modal("show")}).fail(nf.Common.handleAjaxError)},showDownstreamFromInputPort:function(k){var l=k.datum();$.ajax({type:"GET",url:a.urls.api+"/process-groups/"+encodeURIComponent(l.component.parentGroupId)+"/connections",dataType:"json"}).done(function(m){var n=m.connections;$("#connections-context").append('<div class="search-result-icon input-port-small-icon"></div>').append($('<div class="connections-component-name"></div>').text(l.component.name)).append('<div class="clear"></div>');$.each(n,function(p,o){if(o.source.id===l.id){b(o)}});if($("#connections-container").is(":empty")){$("#connections-container").html('<span class="unset">No downstream components</span>')}$("#connections-dialog").modal("setHeaderText","Downstream Connections").modal("show")}).fail(nf.Common.handleAjaxError)},showUpstreamFromInputPort:function(k){var l=k.datum();$.ajax({type:"GET",url:a.urls.api+"/process-groups/"+encodeURIComponent(nf.Canvas.getParentGroupId())+"/connections",dataType:"json"}).done(function(m){var n=m.connections;$("#connections-context").append('<div class="search-result-icon process-group-small-icon"></div>').append($('<div class="connections-component-name"></div>').text(nf.Canvas.getGroupName())).append('<div class="clear"></div>').append('<div class="search-result-icon input-port-small-icon" style="margin-left: 20px;"></div>').append($('<div class="connections-component-name"></div>').text(l.component.name)).append('<div class="clear"></div>');$.each(n,function(p,o){if(o.destination.id===l.id){b(o)}});if($("#connections-container").is(":empty")){$("#connections-container").html('<span class="unset">No upstream components</span>')}$("#connections-dialog").modal("setHeaderText","Upstream Connections").modal("show")}).fail(nf.Common.handleAjaxError)},showDownstreamFromOutputPort:function(k){var l=k.datum();$.ajax({type:"GET",url:a.urls.api+"/process-groups/"+encodeURIComponent(nf.Canvas.getParentGroupId())+"/connections",dataType:"json"}).done(function(m){var n=m.connections;$("#connections-context").append('<div class="search-result-icon process-group-small-icon"></div>').append($('<div class="connections-component-name"></div>').text(nf.Canvas.getGroupName())).append('<div class="clear"></div>').append('<div class="search-result-icon output-port-small-icon" style="margin-left: 20px;"></div>').append($('<div class="connections-component-name"></div>').text(l.component.name)).append('<div class="clear"></div>');$.each(n,function(p,o){if(o.source.id===l.id){b(o)}});if($("#connections-container").is(":empty")){$("#connections-container").html('<span class="unset">No downstream components</span>')}$("#connections-dialog").modal("setHeaderText","Downstream Connections").modal("show")}).fail(nf.Common.handleAjaxError)},showUpstreamFromOutputPort:function(k){var l=k.datum();$.ajax({type:"GET",url:a.urls.api+"/process-groups/"+encodeURIComponent(l.component.parentGroupId)+"/connections",dataType:"json"}).done(function(m){var n=m.connections;$("#connections-context").append('<div class="search-result-icon input-port-small-icon"></div>').append($('<div class="connections-component-name"></div>').text(l.component.name)).append('<div class="clear"></div>');$.each(n,function(p,o){if(o.destination.id===l.id){b(o)}});if($("#connections-container").is(":empty")){$("#connections-container").html('<span class="unset">No upstream components</span>')}$("#connections-dialog").modal("setHeaderText","Upstream Connections").modal("show")}).fail(nf.Common.handleAjaxError)},showDownstreamFromFunnel:function(k){var l=k.datum();$.ajax({type:"GET",url:a.urls.api+"/process-groups/"+encodeURIComponent(l.component.parentGroupId)+"/connections",dataType:"json"}).done(function(m){var n=m.connections;$("#connections-context").append($('<div class="connections-component-name"></div>').text("Funnel"));$.each(n,function(p,o){if(o.source.id===l.id){b(o)}});if($("#connections-container").is(":empty")){$("#connections-container").html('<span class="unset">No downstream components</span>')}$("#connections-dialog").modal("setHeaderText","Downstream Connections").modal("show")}).fail(nf.Common.handleAjaxError)},showUpstreamFromFunnel:function(k){var l=k.datum();$.ajax({type:"GET",url:a.urls.api+"/process-groups/"+encodeURIComponent(l.component.parentGroupId)+"/connections",dataType:"json"}).done(function(m){var n=m.connections;$("#connections-context").append($('<div class="upstream-destination-name"></div>').text("Funnel"));$.each(n,function(p,o){if(o.destination.id===l.id){b(o)}});if($("#connections-container").is(":empty")){$("#connections-container").html('<span class="unset">No upstream components</span>')}$("#connections-dialog").modal("setHeaderText","Upstream Connections").modal("show")}).fail(nf.Common.handleAjaxError)}}}());
nf.Actions=(function(){var c={urls:{api:"../nifi-api",controller:"../nifi-api/controller"}};var b=function(){$("#drop-request-status-dialog").modal({scrollableContentStyle:"scrollable",handler:{close:function(){$("#drop-request-status-dialog").modal("setButtonModel",[])}}})};var d=function(f,e){return $.ajax({type:"PUT",url:f,data:JSON.stringify(e),dataType:"json",contentType:"application/json"}).fail(function(i,g,h){nf.Dialog.showOkDialog({headerText:"Update Resource",dialogContent:nf.Common.escapeHtml(i.responseText)})})};var a=function(e){$.ajax({type:"GET",url:c.urls.api+"/flow/process-groups/"+encodeURIComponent(e.id),dataType:"json"}).done(function(f){nf.Graph.set(f.processGroupFlow.flow)})};return{init:function(){b()},enterGroup:function(e){if(e.size()===1&&nf.CanvasUtils.isProcessGroup(e)){var f=e.datum();nf.CanvasUtils.enterGroup(f.id)}},leaveGroup:function(){nf.CanvasUtils.enterGroup(nf.Canvas.getParentGroupId())},refreshRemoteFlow:function(f){if(f.size()===1&&nf.CanvasUtils.isRemoteProcessGroup(f)){var i=f.datum();var j=i.component.flowRefreshed;var e=function(k){i.component.flowRefreshed=k;if(f.classed("visible")){f.select("text.remote-process-group-last-refresh").text(function(){return k})}};var h=function(k){$.ajax({type:"GET",url:i.uri,dataType:"json"}).done(function(l){var n=l.component;if(j===n.flowRefreshed){g(k)}else{nf.RemoteProcessGroup.set(l);var m=nf.Connection.getComponentConnections(n.id);$.each(m,function(p,o){if(o.permissions.canRead){nf.Connection.reload(o.id)}})}})};var g=function(k){if(k<=32){setTimeout(function(){h(k*2)},k*1000)}else{e(j)}};e("Refreshing...");h(1)}},openUri:function(e){if(e.size()===1&&nf.CanvasUtils.isRemoteProcessGroup(e)){var g=e.datum();var f=g.component.targetUri;if(!nf.Common.isBlank(f)){window.open(encodeURI(f))}else{nf.Dialog.showOkDialog({headerText:"Remote Process Group",dialogContent:"No target URI defined."})}}},showSource:function(e){if(e.size()===1&&nf.CanvasUtils.isConnection(e)){var g=e.datum();if(g.sourceGroupId===nf.Canvas.getGroupId()){var f=d3.select("#id-"+g.sourceId);nf.Actions.show(f)}else{if(g.sourceType==="REMOTE_OUTPUT_PORT"){var h=d3.select("#id-"+g.sourceGroupId);nf.Actions.show(h)}else{nf.CanvasUtils.showComponent(g.sourceGroupId,g.sourceId)}}}},showDestination:function(g){if(g.size()===1&&nf.CanvasUtils.isConnection(g)){var h=g.datum();if(h.destinationGroupId===nf.Canvas.getGroupId()){var e=d3.select("#id-"+h.destinationId);nf.Actions.show(e)}else{if(h.destinationType==="REMOTE_INPUT_PORT"){var f=d3.select("#id-"+h.destinationGroupId);nf.Actions.show(f)}else{nf.CanvasUtils.showComponent(h.destinationGroupId,h.destinationId)}}}},showDownstream:function(e){if(e.size()===1&&!nf.CanvasUtils.isConnection(e)){if(nf.CanvasUtils.isProcessor(e)){nf.GoTo.showDownstreamFromProcessor(e)}else{if(nf.CanvasUtils.isFunnel(e)){nf.GoTo.showDownstreamFromFunnel(e)}else{if(nf.CanvasUtils.isInputPort(e)){nf.GoTo.showDownstreamFromInputPort(e)}else{if(nf.CanvasUtils.isOutputPort(e)){nf.GoTo.showDownstreamFromOutputPort(e)}else{if(nf.CanvasUtils.isProcessGroup(e)||nf.CanvasUtils.isRemoteProcessGroup(e)){nf.GoTo.showDownstreamFromGroup(e)}}}}}}},showUpstream:function(e){if(e.size()===1&&!nf.CanvasUtils.isConnection(e)){if(nf.CanvasUtils.isProcessor(e)){nf.GoTo.showUpstreamFromProcessor(e)}else{if(nf.CanvasUtils.isFunnel(e)){nf.GoTo.showUpstreamFromFunnel(e)}else{if(nf.CanvasUtils.isInputPort(e)){nf.GoTo.showUpstreamFromInputPort(e)}else{if(nf.CanvasUtils.isOutputPort(e)){nf.GoTo.showUpstreamFromOutputPort(e)}else{if(nf.CanvasUtils.isProcessGroup(e)||nf.CanvasUtils.isRemoteProcessGroup(e)){nf.GoTo.showUpstreamFromGroup(e)}}}}}}},show:function(e){if(e.size()===1){var f=nf.CanvasUtils.getSelection();f.classed("selected",false);e.classed("selected",true);nf.Actions.center(e)}},select:function(e){e.classed("selected",true)},selectAll:function(){nf.Actions.select(d3.selectAll("g.component, g.connection"))},center:function(g){if(g.size()===1){var h;if(nf.CanvasUtils.isConnection(g)){var e,m;var l=g.datum();if(l.bends.length>0){var f=Math.min(Math.max(0,l.labelIndex),l.bends.length-1);e=l.bends[f].x;m=l.bends[f].y}else{e=(l.start.x+l.end.x)/2;m=(l.start.y+l.end.y)/2}h={x:e,y:m,width:1,height:1}}else{var j=g.datum();var k=j.position;h={x:k.x,y:k.y,width:j.dimensions.width,height:j.dimensions.height}}nf.CanvasUtils.centerBoundingBox(h);nf.Canvas.View.refresh({transition:true})}},enable:function(e){var g=nf.CanvasUtils.filterEnable(e);if(g.empty()){nf.Dialog.showOkDialog({headerText:"Enable Components",dialogContent:"No eligible components are selected. Please select the components to be enabled and ensure they are no longer running."})}else{var f=[];g.each(function(j){var i=d3.select(this);var h={revision:nf.Client.getRevision(j),component:{id:j.id,state:"STOPPED"}};f.push(d(j.uri,h).done(function(k){nf[j.type].set(k)}))});if(f.length>0){$.when.apply(window,f).always(function(){nf.ng.Bridge.digest()})}}},disable:function(f){var e=nf.CanvasUtils.filterDisable(f);if(e.empty()){nf.Dialog.showOkDialog({headerText:"Disable Components",dialogContent:"No eligible components are selected. Please select the components to be disabled and ensure they are no longer running."})}else{var g=[];e.each(function(j){var i=d3.select(this);var h={revision:nf.Client.getRevision(j),component:{id:j.id,state:"DISABLED"}};g.push(d(j.uri,h).done(function(k){nf[j.type].set(k)}))});if(g.length>0){$.when.apply(window,g).always(function(){nf.ng.Bridge.digest()})}}},openProvenance:function(e){if(e.size()===1){var f=e.datum();nf.Shell.showPage("provenance?"+$.param({componentId:f.id}))}},start:function(g){if(g.empty()){var e={id:nf.Canvas.getGroupId(),state:"RUNNING"};d(c.urls.api+"/flow/process-groups/"+encodeURIComponent(nf.Canvas.getGroupId()),e).done(a)}else{var h=g.filter(function(i){return nf.CanvasUtils.isRunnable(d3.select(this))});if(h.empty()){nf.Dialog.showOkDialog({headerText:"Start Components",dialogContent:"No eligible components are selected. Please select the components to be started and ensure they are no longer running."})}else{var f=[];h.each(function(l){var j=d3.select(this);var k,i;if(nf.CanvasUtils.isProcessGroup(j)){k=c.urls.api+"/flow/process-groups/"+encodeURIComponent(l.id);i={id:l.id,state:"RUNNING"}}else{k=l.uri;i={revision:nf.Client.getRevision(l),component:{id:l.id,state:"RUNNING"}}}f.push(d(k,i).done(function(m){if(nf.CanvasUtils.isProcessGroup(j)){nf.ProcessGroup.reload(l.id)}else{nf[l.type].set(m)}}))});if(f.length>0){$.when.apply(window,f).always(function(){nf.ng.Bridge.digest()})}}}},stop:function(f){if(f.empty()){var e={id:nf.Canvas.getGroupId(),state:"STOPPED"};d(c.urls.api+"/flow/process-groups/"+encodeURIComponent(nf.Canvas.getGroupId()),e).done(a)}else{var h=f.filter(function(i){return nf.CanvasUtils.isStoppable(d3.select(this))});if(h.empty()){nf.Dialog.showOkDialog({headerText:"Stop Components",dialogContent:"No eligible components are selected. Please select the components to be stopped."})}else{var g=[];h.each(function(l){var j=d3.select(this);var k,i;if(nf.CanvasUtils.isProcessGroup(j)){k=c.urls.api+"/flow/process-groups/"+encodeURIComponent(l.id);i={id:l.id,state:"STOPPED"}}else{k=l.uri;i={revision:nf.Client.getRevision(l),component:{id:l.id,state:"STOPPED"}}}g.push(d(k,i).done(function(m){if(nf.CanvasUtils.isProcessGroup(j)){nf.ProcessGroup.reload(l.id)}else{nf[l.type].set(m)}}))});if(g.length>0){$.when.apply(window,g).always(function(){nf.ng.Bridge.digest()})}}}},enableTransmission:function(e){var f=e.filter(function(g){return nf.CanvasUtils.canStartTransmitting(d3.select(this))});f.each(function(h){var g={revision:nf.Client.getRevision(h),component:{id:h.id,transmitting:true}};d(h.uri,g).done(function(i){nf.RemoteProcessGroup.set(i)})})},disableTransmission:function(f){var e=f.filter(function(g){return nf.CanvasUtils.canStopTransmitting(d3.select(this))});e.each(function(h){var g={revision:nf.Client.getRevision(h),component:{id:h.id,transmitting:false}};d(h.uri,g).done(function(i){nf.RemoteProcessGroup.set(i)})})},showConfiguration:function(e){if(e.empty()){nf.ProcessGroupConfiguration.showConfiguration(nf.Canvas.getGroupId())}else{if(e.size()===1){var f=e.datum();if(nf.CanvasUtils.isProcessor(e)){nf.ProcessorConfiguration.showConfiguration(e)}else{if(nf.CanvasUtils.isLabel(e)){nf.LabelConfiguration.showConfiguration(e)}else{if(nf.CanvasUtils.isProcessGroup(e)){nf.ProcessGroupConfiguration.showConfiguration(f.id)}else{if(nf.CanvasUtils.isRemoteProcessGroup(e)){nf.RemoteProcessGroupConfiguration.showConfiguration(e)}else{if(nf.CanvasUtils.isInputPort(e)||nf.CanvasUtils.isOutputPort(e)){nf.PortConfiguration.showConfiguration(e)}else{if(nf.CanvasUtils.isConnection(e)){nf.ConnectionConfiguration.showConfiguration(e)}}}}}}}}},managePolicies:function(e){if(e.size()<=1){nf.PolicyManagement.showComponentPolicy(e)}},showDetails:function(e){if(e.empty()){nf.ProcessGroupConfiguration.showConfiguration(nf.Canvas.getGroupId())}else{if(e.size()===1){var f=e.datum();if(nf.CanvasUtils.isProcessor(e)){nf.ProcessorDetails.showDetails(nf.Canvas.getGroupId(),f.id)}else{if(nf.CanvasUtils.isProcessGroup(e)){nf.ProcessGroupConfiguration.showConfiguration(f.id)}else{if(nf.CanvasUtils.isRemoteProcessGroup(e)){nf.RemoteProcessGroupDetails.showDetails(e)}else{if(nf.CanvasUtils.isInputPort(e)||nf.CanvasUtils.isOutputPort(e)){nf.PortDetails.showDetails(e)}else{if(nf.CanvasUtils.isConnection(e)){nf.ConnectionDetails.showDetails(nf.Canvas.getGroupId(),f.id)}}}}}}}},showUsage:function(e){if(e.size()===1&&nf.CanvasUtils.isProcessor(e)){var f=e.datum();nf.Shell.showPage("../nifi-docs/documentation?"+$.param({select:nf.Common.substringAfterLast(f.component.type,".")}))}},showStats:function(e){if(e.size()===1){var f=e.datum();if(nf.CanvasUtils.isProcessor(e)){nf.StatusHistory.showProcessorChart(nf.Canvas.getGroupId(),f.id)}else{if(nf.CanvasUtils.isProcessGroup(e)){nf.StatusHistory.showProcessGroupChart(nf.Canvas.getGroupId(),f.id)}else{if(nf.CanvasUtils.isRemoteProcessGroup(e)){nf.StatusHistory.showRemoteProcessGroupChart(nf.Canvas.getGroupId(),f.id)}else{if(nf.CanvasUtils.isConnection(e)){nf.StatusHistory.showConnectionChart(nf.Canvas.getGroupId(),f.id)}}}}}},remotePorts:function(e){if(e.size()===1&&nf.CanvasUtils.isRemoteProcessGroup(e)){nf.RemoteProcessGroupPorts.showPorts(e)}},reload:function(){nf.Canvas.reload({transition:true})},"delete":function(f){if(nf.Common.isUndefined(f)||f.empty()){nf.Dialog.showOkDialog({headerText:"Reload",dialogContent:"No eligible components are selected. Please select the components to be deleted."})}else{if(f.size()===1){var h=f.datum();var e=nf.Client.getRevision(h);$.ajax({type:"DELETE",url:h.uri+"?"+$.param({version:e.version,clientId:e.clientId}),dataType:"json"}).done(function(i){nf[h.type].remove(h.id);if(nf.CanvasUtils.isConnection(f)===false){var j=nf.Connection.getComponentConnections(h.id);if(j.length>0){var k=[];$.each(j,function(m,l){k.push(l.id)});nf.Connection.remove(k)}}nf.Birdseye.refresh();nf.ng.Bridge.digest()}).fail(nf.Common.handleAjaxError)}else{var g=nf.Snippet.marshal(f);nf.Snippet.create(g).done(function(i){nf.Snippet.remove(i.snippet.id).done(function(){var k=d3.map();var j=function(l,m){if(!k.has(l)){k.set(l,[])}k.get(l).push(m)};f.each(function(m){j(m.type,m.id);if(m.type!=="Connection"){var l=nf.Connection.getComponentConnections(m.id);if(l.length>0){$.each(l,function(o,n){j("Connection",n.id)})}}});k.forEach(function(m,l){if(m!=="Connection"){nf[m].remove(l)}});if(k.has("Connection")){nf.Connection.remove(k.get("Connection"))}nf.Birdseye.refresh();nf.ng.Bridge.digest()}).fail(nf.Common.handleAjaxError)}).fail(nf.Common.handleAjaxError)}}},emptyQueue:function(e){if(e.size()!==1||!nf.CanvasUtils.isConnection(e)){return}nf.Dialog.showYesNoDialog({headerText:"Empty Queue",dialogContent:"Are you sure you want to empty this queue? All FlowFiles waiting at the time of the request will be removed.",noText:"Cancel",yesText:"Empty",yesHandler:function(){var i=e.datum();var m=4;var k=false;var l=null;var h=null;var g=function(p){var q=$("#drop-request-percent-complete");q.find("div.progress-label").remove();q.find("md-progress-linear").remove();var o=$('<div class="progress-label"></div>').text(p+"%");(nf.ng.Bridge.injector.get("$compile")($('<md-progress-linear ng-cloak ng-value="'+p+'" class="md-hue-2" md-mode="determinate" aria-label="Drop request percent complete"></md-progress-linear>'))(nf.ng.Bridge.rootScope)).appendTo(q);q.append(o)};$("#drop-request-status-dialog").modal("setButtonModel",[{buttonText:"Stop",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){k=true;if(h!==null){clearTimeout(h);f()}}}}]);var f=function(){if(nf.Common.isDefinedAndNotNull(l)){$.ajax({type:"DELETE",url:l.uri,dataType:"json"}).done(function(o){l=o.dropRequest;var r=l.dropped.split(/ \/ /);var q=$("<div></div>");$('<span class="label"></span>').text(r[0]).appendTo(q);$("<span></span>").text(" FlowFiles ("+r[1]+")").appendTo(q);if(l.percentCompleted<100){var p=l.original.split(/ \/ /);$('<span class="label"></span>').text(" out of "+p[0]).appendTo(q);$("<span></span>").text(" ("+p[1]+")").appendTo(q)}$("<span></span>").text(" were removed from the queue.").appendTo(q);if(nf.Common.isDefinedAndNotNull(l.failureReason)){$("<br/><br/><span></span>").text(l.failureReason).appendTo(q)}nf.Dialog.showOkDialog({headerText:"Empty Queue",dialogContent:q})}).always(function(){$("#drop-request-status-dialog").modal("hide")})}else{nf.Dialog.showOkDialog({headerText:"Empty Queue",dialogContent:"No FlowFiles were removed."});$("#drop-request-status-dialog").modal("hide")}};var n=function(o){g(l.percentCompleted);$("#drop-request-status-message").text(l.state);if(nf.Common.isDefinedAndNotNull(l.currentCount)){i.status.queued=l.current;i.status.aggregateSnapshot.queued=l.current;nf.Connection.refresh(i.id)}if(l.finished===true||k===true){f()}else{h=setTimeout(function(){h=null;j(Math.min(m,o*2))},o*1000)}};var j=function(o){$.ajax({type:"GET",url:l.uri,dataType:"json"}).done(function(p){l=p.dropRequest;n(o)}).fail(function(r,p,q){if(r.status===403){nf.Common.handleAjaxError(r,p,q)}else{f()}})};$.ajax({type:"POST",url:"../nifi-api/flowfile-queues/"+encodeURIComponent(i.id)+"/drop-requests",dataType:"json",contentType:"application/json"}).done(function(o){g(0);$("#drop-request-status-dialog").modal("show");l=o.dropRequest;n(1)}).fail(function(q,o,p){if(q.status===403){nf.Common.handleAjaxError(q,o,p)}else{f()}})}})},listQueue:function(f){if(f.size()!==1||!nf.CanvasUtils.isConnection(f)){return}var e=f.datum();nf.QueueListing.listQueue(e)},viewState:function(f){if(f.size()!==1||!nf.CanvasUtils.isProcessor(f)){return}var e=f.datum();nf.ComponentState.showState(e,nf.CanvasUtils.isConfigurable(f))},fillColor:function(g){if(nf.CanvasUtils.isColorable(g)){var e=nf.CanvasUtils.isProcessor(g);var f;if(e){f=nf.Processor.defaultColor()}else{f=nf.Label.defaultColor()}if(g.size()===1){var h=g.datum();if(nf.Common.isDefinedAndNotNull(h.component.style["background-color"])){f=h.component.style["background-color"]}}$("#fill-color").minicolors("value",f);if(e){$("#fill-color-processor-preview").show();$("#fill-color-label-preview").hide()}else{$("#fill-color-processor-preview").hide();$("#fill-color-label-preview").show()}$("#fill-color-dialog").modal("show")}},group:function(){var f=nf.CanvasUtils.getSelection();if(f.empty()){return}var e=nf.CanvasUtils.getOrigin(f);var g={x:e.x,y:e.y};$.when(nf.ng.Bridge.injector.get("groupComponent").promptForGroupName(g)).done(function(h){var i=d3.select("#id-"+h.id);nf.CanvasUtils.moveComponents(f,i)})},moveIntoParent:function(){var e=nf.CanvasUtils.getSelection();if(e.empty()){return}nf.CanvasUtils.moveComponentsToParent(e)},uploadTemplate:function(){$("#upload-template-dialog").modal("show")},template:function(){var e=nf.CanvasUtils.getSelection();if(e.empty()){e=d3.selectAll("g.component, g.connection")}if(e.empty()){nf.Dialog.showOkDialog({headerText:"Create Template",dialogContent:"The current selection is not valid to create a template."});return}e=nf.CanvasUtils.trimDanglingEdges(e);if(e.empty()){nf.Dialog.showOkDialog({headerText:"Create Template",dialogContent:"The current selection is not valid to create a template."});return}$("#new-template-dialog").modal("setButtonModel",[{buttonText:"Create",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){var f=$("#new-template-name").val();if(nf.Common.isBlank(f)){nf.Dialog.showOkDialog({headerText:"Create Template",dialogContent:"The template name cannot be blank."});return}$("#new-template-dialog").modal("hide");var h=$("#new-template-description").val();var g=nf.Snippet.marshal(e);nf.Snippet.create(g).done(function(i){var j={name:f,description:h,snippetId:i.snippet.id};$.ajax({type:"POST",url:c.urls.api+"/process-groups/"+encodeURIComponent(nf.Canvas.getGroupId())+"/templates",data:JSON.stringify(j),dataType:"json",contentType:"application/json"}).done(function(){nf.Dialog.showOkDialog({headerText:"Create Template",dialogContent:"Template '"+nf.Common.escapeHtml(f)+"' was successfully created."})}).always(function(){$("#new-template-name").val("");$("#new-template-description").val("")}).fail(nf.Common.handleAjaxError)}).fail(nf.Common.handleAjaxError)}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){$("#new-template-name").val("");$("#new-template-description").val("");$("#new-template-dialog").modal("hide")}}}]).modal("show");$("#new-template-name").focus()},copy:function(f){if(f.empty()){return}var e=nf.CanvasUtils.getOrigin(f);nf.Clipboard.copy({snippet:nf.Snippet.marshal(f),origin:e})},paste:function(l,m){if(nf.Common.isDefinedAndNotNull(m)){var g=nf.Canvas.View.scale();var e=nf.Canvas.View.translate();var h=m.pageX;var f=m.pageY-nf.Canvas.CANVAS_OFFSET;var k=(h/g)-(e[0]/g);var j=(f/g)-(e[1]/g);var i={x:k,y:j}}nf.Clipboard.paste().done(function(o){var n=$.Deferred(function(p){var q=function(t,r,s){p.reject(t.responseText)};nf.Snippet.create(o.snippet).done(function(t){var s=i;var r=o.origin;if(!nf.Common.isDefinedAndNotNull(s)){r.x+=25;r.y+=25;s=r}nf.Snippet.copy(t.snippet.id,s).done(function(v){var u=v.flow;nf.Graph.add(u,{selectAll:true});nf.Canvas.View.updateVisibility();nf.Birdseye.refresh()}).fail(function(){nf.Canvas.reload().done(function(){nf.Canvas.View.updateVisibility();nf.Birdseye.refresh()})}).fail(q)}).fail(q)}).promise();n.fail(function(q){var p="An error occurred while attempting to copy and paste.";if($.trim(q)!==""){p=q}nf.Dialog.showOkDialog({headerText:"Paste Error",dialogContent:nf.Common.escapeHtml(p)})})})},toFront:function(h){if(h.size()!==1||!nf.CanvasUtils.isConnection(h)){return}var e=h.datum();var g=-1;$.each(nf.Connection.get(),function(j,k){if(e.id!==k.id&&k.zIndex>g){g=k.zIndex}});if(g>=0){var i=g+1;var f={revision:nf.Client.getRevision(e),component:{id:e.id,zIndex:i}};$.ajax({type:"PUT",url:e.uri,data:JSON.stringify(f),dataType:"json",contentType:"application/json"}).done(function(j){nf.Connection.set(j);nf.Connection.reorder()})}}}}());
nf.ContextMenu=(function(){var n=function(E){return nf.Canvas.getParentGroupId()!==null&&E.empty()};var y=function(E){return nf.CanvasUtils.isConfigurable(E)};var b=function(E){return nf.CanvasUtils.hasDetails(E)};var e=function(E){return nf.CanvasUtils.areDeletable(E)};var i=function(E){return nf.CanvasUtils.areRunnable(E)};var d=function(E){return nf.CanvasUtils.areStoppable(E)};var z=function(E){if(E.size()!==1){return false}return nf.CanvasUtils.isProcessor(E)||nf.CanvasUtils.isProcessGroup(E)||nf.CanvasUtils.isRemoteProcessGroup(E)||nf.CanvasUtils.isConnection(E)};var k=function(E){if(E.size()!==1){return false}if(nf.CanvasUtils.canRead(E)===false){return false}return nf.CanvasUtils.isProcessor(E)};var t=function(E){return E.size()===1&&!nf.CanvasUtils.isConnection(E)};var h=function(E){return nf.CanvasUtils.isCopyable(E)};var x=function(E){return nf.CanvasUtils.isPastable()};var p=function(E){return E.empty()};var g=function(E){if(E.size()!==1){return false}if(nf.CanvasUtils.canModify(E)===false){return false}return nf.CanvasUtils.isConnection(E)};var r=function(E){return nf.CanvasUtils.isColorable(E)};var A=function(E){if(E.size()!==1){return false}return nf.CanvasUtils.isConnection(E)};var C=function(E){return false};var B=function(E){return false};var c=function(F){if(F.size()!==1){return false}if(nf.CanvasUtils.canRead(F)===false||nf.CanvasUtils.canModify(F)===false){return false}if(nf.CanvasUtils.isProcessor(F)){var E=F.datum();return E.component.persistsState===true}else{return false}};var q=function(E){if(E.size()!==1){return false}return nf.CanvasUtils.isProcessGroup(E)};var j=function(E){if(E.size()!==1){return false}return !nf.CanvasUtils.isLabel(E)&&!nf.CanvasUtils.isConnection(E)&&!nf.CanvasUtils.isProcessGroup(E)&&!nf.CanvasUtils.isRemoteProcessGroup(E)&&nf.Common.canAccessProvenance()};var D=function(E){if(E.size()!==1){return false}if(nf.CanvasUtils.canRead(E)===false){return false}return nf.CanvasUtils.isRemoteProcessGroup(E)};var u=function(E){if(nf.CanvasUtils.canModify(E)===false){return false}return nf.CanvasUtils.canAllStartTransmitting(E)};var o=function(E){if(nf.CanvasUtils.canModify(E)===false){return false}return nf.CanvasUtils.canAllStopTransmitting(E)};var w=function(E){return A(E)};var a=function(E){return A(E)};var f=function(E){if(nf.CanvasUtils.canModify(E)===false){return false}return !E.empty()&&nf.CanvasUtils.isDisconnected(E)&&nf.Canvas.getParentGroupId()!==null};var m=function(F,H){if(typeof H.click==="function"){var G=$('<div class="context-menu-item"></div>').on("click",H.click).on("contextmenu",function(I){H.click(I);I.preventDefault();I.stopPropagation()}).on("mouseenter",function(){$(this).addClass("hover")}).on("mouseleave",function(){$(this).removeClass("hover")}).appendTo(F);var E=$('<div class="context-menu-item-img"></div>').addClass(H.clazz).appendTo(G);if(nf.Common.isDefinedAndNotNull(H.imgStyle)){E.addClass(H.imgStyle)}$('<div class="context-menu-item-text"></div>').text(H.text).appendTo(G);$('<div class="clear"></div>').appendTo(G)}};var v=function(F,E){F.css({left:E.x+"px",top:E.y+"px"}).show()};var s=function(G,F,E){nf.Actions[G](F,E);nf.ContextMenu.hide()};var l=[{condition:p,menuItem:{clazz:"fa fa-refresh",text:"Refresh",action:"reload"}},{condition:n,menuItem:{clazz:"fa fa-level-up",text:"Leave group",action:"leaveGroup"}},{condition:y,menuItem:{clazz:"fa fa-gear",text:"Configure",action:"showConfiguration"}},{condition:b,menuItem:{clazz:"fa fa-gear",text:"View configuration",action:"showDetails"}},{condition:q,menuItem:{clazz:"fa fa-sign-in",text:"Enter group",action:"enterGroup"}},{condition:i,menuItem:{clazz:"fa fa-play",text:"Start",action:"start"}},{condition:d,menuItem:{clazz:"fa fa-stop",text:"Stop",action:"stop"}},{condition:D,menuItem:{clazz:"fa fa-cloud",text:"Remote ports",action:"remotePorts"}},{condition:u,menuItem:{clazz:"fa fa-bullseye",text:"Enable transmission",action:"enableTransmission"}},{condition:o,menuItem:{clazz:"icon icon-transmit-false",text:"Disable transmission",action:"disableTransmission"}},{condition:z,menuItem:{clazz:"fa fa-area-chart",text:"Status History",action:"showStats"}},{condition:j,menuItem:{clazz:"icon icon-provenance",imgStyle:"context-menu-provenance",text:"Data provenance",action:"openProvenance"}},{condition:c,menuItem:{clazz:"fa fa-tasks",text:"View state",action:"viewState"}},{condition:g,menuItem:{clazz:"fa fa-clone",text:"Bring to front",action:"toFront"}},{condition:A,menuItem:{clazz:"fa fa-long-arrow-left",text:"Go to source",action:"showSource"}},{condition:A,menuItem:{clazz:"fa fa-long-arrow-right",text:"Go to destination",action:"showDestination"}},{condition:B,menuItem:{clazz:"icon icon-connect",text:"Upstream connections",action:"showUpstream"}},{condition:C,menuItem:{clazz:"icon icon-connect",text:"Downstream connections",action:"showDownstream"}},{condition:k,menuItem:{clazz:"fa fa-book",text:"Usage",action:"showUsage"}},{condition:D,menuItem:{clazz:"fa fa-refresh",text:"Refresh",action:"refreshRemoteFlow"}},{condition:D,menuItem:{clazz:"fa fa-external-link",text:"Go to",action:"openUri"}},{condition:r,menuItem:{clazz:"fa fa-paint-brush",text:"Change color",action:"fillColor"}},{condition:t,menuItem:{clazz:"fa fa-crosshairs",text:"Center in view",action:"center"}},{condition:h,menuItem:{clazz:"fa fa-copy",text:"Copy",action:"copy"}},{condition:x,menuItem:{clazz:"fa fa-paste",text:"Paste",action:"paste"}},{condition:f,menuItem:{clazz:"fa fa-arrows",text:"Move to parent group",action:"moveIntoParent"}},{condition:a,menuItem:{clazz:"fa fa-list",text:"List queue",action:"listQueue"}},{condition:w,menuItem:{clazz:"fa fa-minus-circle",text:"Empty queue",action:"emptyQueue"}},{condition:e,menuItem:{clazz:"fa fa-trash",text:"Delete",action:"delete"}}];return{init:function(){$("#context-menu").on("contextmenu",function(E){E.preventDefault();E.stopPropagation()})},show:function(){var G=$("#context-menu").empty();var J=$("#canvas-body").get(0);var F=$("#banner-footer").get(0);var I=$("#breadcrumbs").get(0);var H=nf.CanvasUtils.getSelection();$.each(l,function(K,M){if(M.condition(H)){var L=M.menuItem;m(G,{clazz:L.clazz,imgStyle:L.imgStyle,text:L.text,click:function(N){s(L.action,H,N)}})}});var E=d3.mouse(J);if(E[0]+G.width()>J.clientWidth){E[0]=J.clientWidth-G.width()-2}if(E[1]+G.height()>(J.clientHeight-I.clientHeight-F.clientHeight)){E[1]=J.clientHeight-I.clientHeight-F.clientHeight-G.height()-3}v(G,{x:E[0],y:E[1]});nf.ng.Bridge.digest()},hide:function(){$("#context-menu").hide()},activate:function(E){E.on("contextmenu.selection",function(){nf.ContextMenu.show();d3.event.preventDefault();d3.event.stopPropagation()})}}}());
nf.StatusHistory=(function(){var r={nifiInstanceId:"nifi-instance-id",nifiInstanceLabel:"NiFi",type:{processor:"Processor",inputPort:"Input Port",outputPort:"Output Port",processGroup:"Process Group",remoteProcessGroup:"Remote Process Group",connection:"Connection",funnel:"Funnel",template:"Template",label:"Label"},urls:{api:"../nifi-api"}};var q={DURATION:function(t){return nf.Common.formatDuration(t)},COUNT:function(t){if(t%1===0){return nf.Common.formatInteger(t)}else{return nf.Common.formatFloat(t)}},DATA_SIZE:function(t){return nf.Common.formatDataSize(t)}};var i=null;var j=null;var m=null;var b=null;var f=function(v,z,x,u,y){$("#status-history-last-refreshed").text(x.generated);var t={groupId:v,id:z,type:u,instances:[]};var w=x.fieldDescriptors;t.details=x.componentDetails;t.selectedDescriptor=nf.Common.isUndefined(y)?w[0]:y;if(nf.Common.isDefinedAndNotNull(x.aggregateSnapshots)&&x.aggregateSnapshots.length>1){t.instances.push({id:r.nifiInstanceId,label:r.nifiInstanceLabel,snapshots:x.aggregateSnapshots})}else{e();return}$.each(x.nodeSnapshots,function(B,A){if(nf.Common.isDefinedAndNotNull(A.statusSnapshots)&&A.statusSnapshots.length>1){t.instances.push({id:A.nodeId,label:A.address+":"+A.apiPort,snapshots:A.statusSnapshots})}});if(t.instances.length>0){$("#status-history-dialog").data("status-history",t);n(t,w)}else{e()}};var e=function(){nf.Dialog.showOkDialog({headerText:"Status History",dialogContent:"Insufficient history, please try again later."})};var n=function(t,u){if(b===null){b={}}$.each(t.instances,function(w,v){v.snapshots.forEach(function(z){var y=new Date();var x=y.getTimezoneOffset()*60*1000;z.timestamp=new Date(z.timestamp+x+i)})});g(u,t.selectedDescriptor)};var g=function(v,u){var t=[];$.each(v,function(w,x){t.push({text:x.label,value:x.field,description:nf.Common.escapeHtml(x.description)})});$("#status-history-metric-combo").combo({selectedOption:{value:u.field},options:t,select:function(x){var y=null;$.each(v,function(z,A){if(x.value===A.field){y=A;return false}});if(y!==null){if(m===null||m.field!==y.field){j=null}m=y;var w=$("#status-history-dialog").data("status-history");w.selectedDescriptor=y;$("#status-history-dialog").data("status-history",w);h()}}});$("#status-history-dialog").modal("show")};var a=function(){return $("#status-history-chart-container").parent().outerHeight()-$("#status-history-chart-control-container").outerHeight()-parseInt($("#status-history-chart-control-container").css("margin-top"),10)};var s=function(){return $("body").height()-$("#status-history-chart-control-container").outerHeight()-$("#status-history-refresh-container").outerHeight()-parseInt($("#status-history-chart-control-container").css("margin-top"),10)-parseInt($(".dialog-content").css("top"))-parseInt($(".dialog-content").css("bottom"))};var p=function(){return $("body").width()-$("#status-history-details").innerWidth()-parseInt($("#status-history-dialog").css("left"),10)-parseInt($(".dialog-content").css("left"))-parseInt($(".dialog-content").css("right"))};var h=function(){var ae=$("#status-history-dialog");if(ae.is(":visible")){var X=ae.data("status-history");var ad=X.selectedDescriptor;$("#status-history-details").empty();var w=k("Status History");d3.map(X.details).forEach(function(x,y){d(w,x,y)});var A={top:15,right:20,bottom:25,left:75};var U=d3.scale.category10();var v=[];$.each(X.instances,function(y,x){v.push(x.label)});U.domain(v);var ao=[];$.each(X.instances,function(y,x){if(nf.Common.isUndefinedOrNull(b[x.id])){b[x.id]=true}ao.push({id:x.id,label:x.label,values:$.map(x.snapshots,function(ar){return{timestamp:ar.timestamp,value:ar.statusMetrics[ad.field]}}),visible:b[x.id]===true})});var K=d3.time.format.multi([[":%S.%L",function(x){return x.getMilliseconds()}],[":%S",function(x){return x.getSeconds()}],["%H:%M",function(x){return x.getMinutes()}],["%H:%M",function(x){return x.getHours()}],["%a %d",function(x){return x.getDay()&&x.getDate()!==1}],["%b %d",function(x){return x.getDate()!==1}],["%B",function(x){return x.getMonth()}],["%Y",function(){return true}]]);var J=$("#status-history-chart-container").empty();if(J.hasClass("ui-resizable")){J.resizable("destroy");J.removeAttr("style")}J.height(a());var t=J.outerWidth()-A.left-A.right;var u=J.outerHeight()-A.top-A.bottom;Q=$("#status-history-container").width();if(t>Q){t=Q}aj=s();if(u>aj){u=aj}var ab=d3.time.scale().range([0,t]);var P=d3.svg.axis().scale(ab).ticks(5).tickFormat(K).orient("bottom");var aa=d3.scale.linear().range([u,0]);var B=d3.svg.axis().scale(aa).tickFormat(q[ad.formatter]).orient("left");var C=d3.svg.line().interpolate("monotone").x(function(x){return ab(x.timestamp)}).y(function(x){return aa(x.value)});var I=d3.select("#status-history-chart-container").append("svg").attr("style","pointer-events: none;").attr("width",J.parent().width()).attr("height",J.innerHeight());var D=I.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",t).attr("height",u);var aq=I.append("g").attr("transform","translate("+A.left+", "+A.top+")");var z=d3.min(ao,function(x){return d3.min(x.values,function(y){return y.timestamp})});var G=d3.max(ao,function(x){return d3.max(x.values,function(y){return y.timestamp})});d(w,"Start",nf.Common.formatDateTime(z));d(w,"End",nf.Common.formatDateTime(G));ab.domain([z,G]);aa.domain([l(ao),o(ao)]);aq.append("g").attr("class","x axis").attr("transform","translate(0, "+u+")").call(P);aq.append("g").attr("class","y axis").call(B).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").attr("text-anchor","end").text(ad.label);var Y=aq.selectAll(".status").data(ao).enter().append("g").attr("clip-path","url(#clip)").attr("class","status");Y.append("path").attr("class",function(x){return"chart-line chart-line-"+x.id}).attr("d",function(x){return C(x.values)}).attr("stroke",function(x){return U(x.label)}).classed("hidden",function(x){return x.visible===false}).append("title").text(function(x){return x.label});Y.each(function(x){var y=d3.select(this).append("g").attr("class",function(){return"mark-group mark-group-"+x.id}).classed("hidden",function(ar){return ar.visible===false});y.selectAll("circle.mark").data(x.values).enter().append("circle").attr("style","pointer-events: all;").attr("class","mark").attr("cx",function(ar){return ab(ar.timestamp)}).attr("cy",function(ar){return aa(ar.value)}).attr("fill",function(){return U(x.label)}).attr("r",1.5).append("title").text(function(ar){return x.label+" -- "+q[ad.formatter](ar.value)})});I.attr("width",J.parent().width()).attr("height",J.innerHeight());D.attr("width",t).attr("height",u);aq.select(".x.axis").attr("transform","translate(0, "+u+")");var O=$("#status-history-chart-control-container").empty();var M=O.innerHeight()-A.top-A.bottom;var ah=d3.time.scale().range([0,t]);var F=d3.svg.axis().scale(ah).ticks(5).tickFormat(K).orient("bottom");var al=d3.scale.linear().range([M,0]);var af=d3.svg.axis().scale(al).tickValues(aa.domain()).tickFormat(q[ad.formatter]).orient("left");var L=d3.svg.line().interpolate("monotone").x(function(x){return ah(x.timestamp)}).y(function(x){return al(x.value)});var ac=d3.select("#status-history-chart-control-container").append("svg").attr("width",J.parent().width()).attr("height",M+A.top+A.bottom);var S=ac.append("g").attr("transform","translate("+A.left+", "+A.top+")");var R=aa.domain();R[1]*=1.04;ah.domain(ab.domain());al.domain(R);S.append("g").attr("class","x axis").attr("transform","translate(0, "+M+")").call(F);S.append("g").attr("class","y axis").call(af);var ap=S.selectAll(".status").data(ao).enter().append("g").attr("class","status");ap.append("path").attr("class",function(x){return"chart-line chart-line-"+x.id}).attr("d",function(x){return L(x.values)}).attr("stroke",function(x){return U(x.label)}).classed("hidden",function(x){return b[x.id]===false}).append("title").text(function(x){return x.label});var an=function(x,y){ab.domain(x);aa.domain(y);Y.selectAll(".chart-line").attr("d",function(ar){return C(ar.values)});Y.selectAll("circle.mark").attr("cx",function(ar){return ab(ar.timestamp)}).attr("cy",function(ar){return aa(ar.value)}).attr("r",function(){return ai.empty()?1.5:4});aq.select(".x.axis").call(P);aq.select(".y.axis").call(B)};var E=function(){var y,x;if(ai.empty()){var at=$.grep(ao,function(au){return au.visible});if(at.length===0){x=al.domain()}else{x=[d3.min(at,function(au){return d3.min(au.values,function(av){return av.value})}),d3.max(at,function(au){return d3.max(au.values,function(av){return av.value})})]}y=ah.domain();j=null}else{var ar=ai.extent();y=[ar[0][0],ar[1][0]];x=[ar[0][1],ar[1][1]];j=ar}an(y,x);H()};var ai=d3.svg.brush().x(ah).y(al).on("brush",E);if(nf.Common.isDefinedAndNotNull(j)){ai=ai.extent(j)}S.append("g").attr("class","brush").call(ai);S.select("rect.extent").attr("style","pointer-events: all;").on("dblclick",function(){if(!ai.empty()){var x=ai.extent();var y=al.domain();ai.extent([[x[0][0],y[0]],[x[1][0],y[1]]]);S.select(".brush").call(ai);E()}});var H=function(){var av=$.map(ao,function(aB){var az=ab.domain();var aA=aa.domain();var aC=$.extend({},aB);return $.extend(aC,{values:$.grep(aB.values,function(aD){return aD.timestamp.getTime()>=az[0].getTime()&&aD.timestamp.getTime()<=az[1].getTime()&&aD.value>=aA[0]&&aD.value<=aA[1]})})});var x=$.grep(av,function(az){return az.id!==r.nifiInstanceId&&az.visible&&az.values.length>0});var au=x.length===0?"NA":q[ad.formatter](l(x));var at=x.length===0?"NA":q[ad.formatter](c(x));var y=x.length===0?"NA":q[ad.formatter](o(x));$("#node-aggregate-statistics").text(au+" / "+y+" / "+at);var ax=$.grep(av,function(az){return az.id===r.nifiInstanceId&&az.visible&&az.values.length>0});var ay=ax.length===0?"NA":q[ad.formatter](l(ax));var aw=ax.length===0?"NA":q[ad.formatter](c(ax));var ar=ax.length===0?"NA":q[ad.formatter](o(ax));$("#cluster-aggregate-statistics").text(ay+" / "+ar+" / "+aw)};var Z=$.grep(ao,function(x){return x.id!==r.nifiInstanceId}).sort(function(y,x){return y.label<x.label?-1:y.label>x.label?1:0});var am=function(y,x){var at=$("<div></div>").addClass("legend-label").css("color",U(x.label)).text(x.label).ellipsis();var ar=$('<div class="nf-checkbox"></div>').on("click",function(){var au=d3.selectAll("path.chart-line-"+x.id);var aw=d3.select("g.mark-group-"+x.id);var av=aw.classed("hidden");au.classed("hidden",function(){return !av});aw.classed("hidden",function(){return !av});x.visible=av;b[x.id]=x.visible;E()}).addClass(x.visible?"checkbox-checked":"checkbox-unchecked");$('<div class="legend-entry"></div>').append(ar).append(at).on("mouseenter",function(){d3.selectAll("path.chart-line-"+x.id).classed("over",true)}).on("mouseleave",function(){d3.selectAll("path.chart-line-"+x.id).classed("over",false)}).appendTo(y)};var W=$.grep(ao,function(x){return x.id===r.nifiInstanceId});var ag=k("NiFi");d(ag,"Min / Max / Mean","","cluster-aggregate-statistics");am(ag,W[0]);if(Z.length>0){var V=k("Nodes");d(V,"Min / Max / Mean","","node-aggregate-statistics");$.each(Z,function(y,x){am(V,x)})}E();var Q,aj,N,T,ak;J.append('<div class="ui-resizable-handle ui-resizable-se"></div>').resizable({minWidth:425,minHeight:150,handles:{se:".ui-resizable-se"},start:function(y,x){if(!ai.empty()){T=ai.extent()}},resize:function(ar,y){ak=$("#status-history-dialog");var x={};if(nf.Common.isDefinedAndNotNull(ak.data("nf-dialog"))){x=ak.data("nf-dialog")}x["min-width"]=(ak.width()/$(window).width())*100+"%";x["min-height"]=(ak.height()/$(window).height())*100+"%";x.responsive["fullscreen-width"]=ak.outerWidth()+"px";x.responsive["fullscreen-height"]=ak.outerHeight()+"px";Q=p();if(y.helper.width()>Q){y.helper.width(Q);x.responsive["fullscreen-width"]=$(window).width()+"px";x["min-width"]="100%"}aj=s();if(y.helper.height()>aj){y.helper.height(aj);x.responsive["fullscreen-height"]=$(window).height()+"px";x["min-height"]="100%"}N=a();if(y.helper.height()<N){y.helper.height(N)}x["min-width"]=(parseInt(x["min-width"],10)>=100)?"100%":x["min-width"];x["min-height"]=(parseInt(x["min-height"],10)>=100)?"100%":x["min-height"];ak.data("nfDialog",x);ak.css("min-width",(J.outerWidth()+$("#status-history-details").outerWidth()+40));ak.css("min-height",(J.outerHeight()+$("#status-history-refresh-container").outerHeight()+$("#status-history-chart-control-container").outerHeight()+$(".dialog-buttons").outerHeight()+$(".dialog-header").outerHeight()+40+5));ak.center()},stop:h})}};var l=function(t){return d3.min(t,function(u){return d3.min(u.values,function(v){return v.value})})};var o=function(t){return d3.max(t,function(u){return d3.max(u.values,function(v){return v.value})})};var c=function(u){var v=0;var t=d3.sum(u,function(w){v+=w.values.length;return d3.sum(w.values,function(x){return x.value})});return t/v};var k=function(u){var t=$('<div class="status-history-detail"></div>').appendTo("#status-history-details");$('<div class="detail-container-label"></div>').text(u).appendTo(t);return $("<div></div>").appendTo(t)};var d=function(u,w,x,y){var v=$('<div class="detail-item"></div>').appendTo(u);$('<div class="setting-name"></div>').text(w).appendTo(v);var t=$('<div class="setting-field"></div>').text(x).appendTo(v);if(nf.Common.isDefinedAndNotNull(y)){t.attr("id",y)}};return{init:function(t){i=t;$("#status-history-refresh-button").click(function(){var u=$("#status-history-dialog").data("status-history");if(u!==null){if(u.type===r.type.processor){nf.StatusHistory.showProcessorChart(u.groupId,u.id,u.selectedDescriptor)}else{if(u.type===r.type.processGroup){nf.StatusHistory.showProcessGroupChart(u.groupId,u.id,u.selectedDescriptor)}else{if(u.type===r.type.remoteProcessGroup){nf.StatusHistory.showRemoteProcessGroupChart(u.groupId,u.id,u.selectedDescriptor)}else{nf.StatusHistory.showConnectionChart(u.groupId,u.id,u.selectedDescriptor)}}}}});$("#status-history-dialog").modal({scrollableContentStyle:"scrollable",headerText:"Status History",buttons:[{buttonText:"Close",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){this.modal("hide")}}}],handler:{close:function(){$("#status-history-dialog").removeData("status-history");$("#status-history-chart-container").empty();$("#status-history-chart-control-container").empty();$("#status-history-details").empty();j=null;m=null;b=null},open:h}});$(window).on("resize",function(u){if(u.target===window){h()}nf.Common.toggleScrollable($("#status-history-details").get(0))})},showConnectionChart:function(t,u,v){$.ajax({type:"GET",url:r.urls.api+"/flow/connections/"+encodeURIComponent(u)+"/status/history",dataType:"json"}).done(function(w){f(t,u,w.statusHistory,r.type.connection,v)}).fail(nf.Common.handleAjaxError)},showProcessorChart:function(t,v,u){$.ajax({type:"GET",url:r.urls.api+"/flow/processors/"+encodeURIComponent(v)+"/status/history",dataType:"json"}).done(function(w){f(t,v,w.statusHistory,r.type.processor,u)}).fail(nf.Common.handleAjaxError)},showProcessGroupChart:function(u,t,v){$.ajax({type:"GET",url:r.urls.api+"/flow/process-groups/"+encodeURIComponent(t)+"/status/history",dataType:"json"}).done(function(w){f(u,t,w.statusHistory,r.type.processGroup,v)}).fail(nf.Common.handleAjaxError)},showRemoteProcessGroupChart:function(u,t,v){$.ajax({type:"GET",url:r.urls.api+"/flow/remote-process-groups/"+encodeURIComponent(t)+"/status/history",dataType:"json"}).done(function(w){f(u,t,w.statusHistory,r.type.remoteProcessGroup,v)}).fail(nf.Common.handleAjaxError)}}}());
$(document).ready(function(){if(nf.Canvas.SUPPORTS_SVG){var a=angular.module("ngCanvasApp",["ngResource","ngRoute","ngMaterial","ngMessages"]);nf.ng.AppConfig.$inject=["$mdThemingProvider","$compileProvider"];nf.ng.AppCtrl.$inject=["$scope","serviceProvider","$compile","headerCtrl","graphControlsCtrl"];nf.ng.ServiceProvider.$inject=[];nf.ng.BreadcrumbsCtrl.$inject=["serviceProvider"];nf.ng.Canvas.HeaderCtrl.$inject=["serviceProvider","toolboxCtrl","globalMenuCtrl","flowStatusCtrl"];nf.ng.Canvas.FlowStatusCtrl.$inject=["serviceProvider"];nf.ng.Canvas.GlobalMenuCtrl.$inject=["serviceProvider"];nf.ng.Canvas.ToolboxCtrl.$inject=["processorComponent","inputPortComponent","outputPortComponent","groupComponent","remoteGroupComponent","funnelComponent","templateComponent","labelComponent"];nf.ng.ProcessorComponent.$inject=["serviceProvider"];nf.ng.InputPortComponent.$inject=["serviceProvider"];nf.ng.OutputPortComponent.$inject=["serviceProvider"];nf.ng.GroupComponent.$inject=["serviceProvider"];nf.ng.RemoteProcessGroupComponent.$inject=["serviceProvider"];nf.ng.FunnelComponent.$inject=["serviceProvider"];nf.ng.TemplateComponent.$inject=["serviceProvider"];nf.ng.LabelComponent.$inject=["serviceProvider"];nf.ng.Canvas.GraphControlsCtrl.$inject=["serviceProvider","navigateCtrl","operateCtrl"];nf.ng.Canvas.NavigateCtrl.$inject=[];nf.ng.Canvas.OperateCtrl.$inject=[];nf.ng.BreadcrumbsDirective.$inject=["breadcrumbsCtrl"];nf.ng.DraggableDirective.$inject=[];a.config(nf.ng.AppConfig);a.controller("ngCanvasAppCtrl",nf.ng.AppCtrl);a.service("serviceProvider",nf.ng.ServiceProvider);a.service("breadcrumbsCtrl",nf.ng.BreadcrumbsCtrl);a.service("headerCtrl",nf.ng.Canvas.HeaderCtrl);a.service("globalMenuCtrl",nf.ng.Canvas.GlobalMenuCtrl);a.service("toolboxCtrl",nf.ng.Canvas.ToolboxCtrl);a.service("flowStatusCtrl",nf.ng.Canvas.FlowStatusCtrl);a.service("processorComponent",nf.ng.ProcessorComponent);a.service("inputPortComponent",nf.ng.InputPortComponent);a.service("outputPortComponent",nf.ng.OutputPortComponent);a.service("groupComponent",nf.ng.GroupComponent);a.service("remoteGroupComponent",nf.ng.RemoteProcessGroupComponent);a.service("funnelComponent",nf.ng.FunnelComponent);a.service("templateComponent",nf.ng.TemplateComponent);a.service("labelComponent",nf.ng.LabelComponent);a.service("graphControlsCtrl",nf.ng.Canvas.GraphControlsCtrl);a.service("navigateCtrl",nf.ng.Canvas.NavigateCtrl);a.service("operateCtrl",nf.ng.Canvas.OperateCtrl);a.directive("nfBreadcrumbs",nf.ng.BreadcrumbsDirective);a.directive("nfDraggable",nf.ng.DraggableDirective);nf.ng.Bridge.injector=angular.bootstrap($("body"),["ngCanvasApp"],{strictDi:true});nf.Canvas.init();$(".component-button").qtip($.extend({},nf.Common.config.tooltipConfig))}else{$("#message-title").text("Unsupported Browser");$("#message-content").text("Flow graphs are shown using SVG. Please use a browser that supports rendering SVG.");$("#message-pane").show();nf.Canvas.hideSplash()}});nf.Canvas=(function(){var o=1;var f=[0,0];var v=1.2;var y=8;var r=0.2;var c=0.6;var l=false;var j="root";var m=null;var i=null;var p=null;var a=false;var t=false;var g=false;var q=null;var d=null;var s=false;var e=false;var x={urls:{api:"../nifi-api",currentUser:"../nifi-api/flow/current-user",controllerBulletins:"../nifi-api/flow/controller/bulletins",kerberos:"../nifi-api/access/kerberos",revision:"../nifi-api/flow/revision",banners:"../nifi-api/flow/banners",flowConfig:"../nifi-api/flow/config",clusterSummary:"../nifi-api/flow/cluster/summary",cluster:"../nifi-api/controller/cluster"}};var h=function(z){l=true;n(z)};var n=function(z){if(l){nf.Canvas.reload({transition:true}).done(function(){setTimeout(function(){n(z)},z*1000)})}};var k=function(){var F=$("#canvas-container");q=d3.select("#canvas-container").append("svg").on("contextmenu",function(){s=false;nf.CanvasUtils.getSelection().classed("selected",false);nf.ContextMenu.show();d3.event.preventDefault()});var z=q.append("defs");z.selectAll("marker").data(["normal","ghost","unauthorized"]).enter().append("marker").attr({id:function(G){return G},viewBox:"0 0 6 6",refX:5,refY:3,markerWidth:6,markerHeight:6,orient:"auto",fill:function(G){if(G==="ghost"){return"#aaaaaa"}else{if(G==="unauthorized"){return"#ba554a"}else{return"#000000"}}}}).append("path").attr("d","M2,3 L0,6 L6,3 L0,0 z");var A=z.append("filter").attr({id:"component-drop-shadow",height:"140%",y:"-20%"});A.append("feGaussianBlur").attr({"in":"SourceAlpha",stdDeviation:3,result:"blur"});A.append("feOffset").attr({"in":"blur",dx:0,dy:1,result:"offsetBlur"});A.append("feFlood").attr({"flood-color":"#000000","flood-opacity":0.4,result:"offsetColor"});A.append("feComposite").attr({"in":"offsetColor",in2:"offsetBlur",operator:"in",result:"offsetColorBlur"});var D=A.append("feMerge");D.append("feMergeNode").attr("in","offsetColorBlur");D.append("feMergeNode").attr("in","SourceGraphic");var C=z.append("linearGradient").attr({id:"expiration",x1:"0%",y1:"0%",x2:"0%",y2:"100%"});C.append("stop").attr({offset:"0%","stop-color":"#aeafb1"});C.append("stop").attr({offset:"100%","stop-color":"#87888a"});d=q.append("g").attr({transform:"translate("+f+") scale("+o+")","pointer-events":"all",id:"canvas"});q.on("mousedown.selection",function(){s=true;if(d3.event.button!==0){d3.event.stopImmediatePropagation();return}if(d3.event.shiftKey){var G=d3.mouse(d.node());d.append("rect").attr("rx",6).attr("ry",6).attr("x",G[0]).attr("y",G[1]).attr("class","selection").attr("width",0).attr("height",0).attr("stroke-width",function(){return 1/nf.Canvas.View.scale()}).attr("stroke-dasharray",function(){return 4/nf.Canvas.View.scale()}).datum(G);d3.event.stopImmediatePropagation();d3.event.preventDefault()}}).on("mousemove.selection",function(){if(d3.event.shiftKey){var H=d3.select("rect.selection");if(!H.empty()){var I=H.datum();var G=d3.mouse(d.node());var J={};if(I[0]<G[0]){J.x=I[0];J.width=G[0]-I[0]}else{J.x=G[0];J.width=I[0]-G[0]}if(I[1]<G[1]){J.y=I[1];J.height=G[1]-I[1]}else{J.y=G[1];J.height=I[1]-G[1]}H.attr(J);d3.event.stopPropagation()}}}).on("mouseup.selection",function(){if(s===false){return}s=false;var G=d3.select("rect.selection");if(!G.empty()){var H={x:parseInt(G.attr("x"),10),y:parseInt(G.attr("y"),10),width:parseInt(G.attr("width"),10),height:parseInt(G.attr("height"),10)};d3.selectAll("g.component").classed("selected",function(I){return d3.select(this).classed("selected")||I.position.x>=H.x&&(I.position.x+I.dimensions.width)<=(H.x+H.width)&&I.position.y>=H.y&&(I.position.y+I.dimensions.height)<=(H.y+H.height)});d3.selectAll("g.connection").classed("selected",function(K){var J=[K.start].concat(K.bends,[K.end]);var I=d3.extent(J,function(M){return M.x});var L=d3.extent(J,function(M){return M.y});return d3.select(this).classed("selected")||I[0]>=H.x&&I[1]<=(H.x+H.width)&&L[0]>=H.y&&L[1]<=(H.y+H.height)});G.remove()}else{if(e===false){nf.CanvasUtils.getSelection().classed("selected",false)}}nf.ng.Bridge.digest()});var B=function(){var K=$("#banner-footer");var G=0;if(K.is(":visible")){G=K.height()}var I=parseInt(F.css("top"),10);var J=$(window).height();var H=(J-(G+I));F.css({height:H+"px",bottom:G+"px"});q.attr({height:F.height(),width:$(window).width()});nf.ng.Bridge.injector.get("breadcrumbsCtrl").updateBreadcrumbsCss({bottom:G+"px"});$("#canvas-body").css({height:J+"px",width:$(window).width()+"px"})};var E=function(){$("#flow-status-container").css({width:((($("#nifi-logo").width()+$("#component-container").width())/$(window).width())*100)*2+"%"})};E();$(window).on("resize",function(O){if(O.target===window){B();E();var M=$("#shell-dialog");if(M.is(":visible")){setTimeout(function(Q){nf.Shell.resizeContent(Q);if(Q.find("#shell-iframe").is(":visible")){nf.Shell.resizeIframe(Q)}},50,M)}var G=$(".dialog");for(var L=0,N=G.length;L<N;L++){if($(G[L]).is(":visible")){setTimeout(function(Q){Q.modal("resize")},50,$(G[L]))}}var P=$('*[class*="slickgrid_"]');for(var K=0,N=P.length;K<N;K++){if($(P[K]).is(":visible")){setTimeout(function(Q){Q.data("gridInstance").resizeCanvas()},50,$(P[K]))}}var I=$(".tab-container");var H=[];for(var J=0,N=I.length;J<N;J++){if($(I[J]).is(":visible")){H.push($("#"+$(I[J]).attr("id")+"-content"))}}$.each(H,function(Q,R){nf.Common.toggleScrollable(R.get(0))})}}).on("keydown",function(G){if($(".dialog").is(":visible")||$("#search-field").is(":focus")){return}var H=nf.CanvasUtils.getSelection();var I=G.ctrlKey||G.metaKey;if(I){if(G.keyCode===82){nf.Actions.reload()}else{if(G.keyCode===65){nf.Actions.selectAll();nf.ng.Bridge.digest();G.preventDefault()}else{if(G.keyCode===67){if(nf.Canvas.canWrite()&&nf.CanvasUtils.isCopyable(H)){nf.Actions.copy(H)}}else{if(G.keyCode===86){if(nf.Canvas.canWrite()&&nf.CanvasUtils.isPastable()){nf.Actions.paste(H);G.preventDefault()}}}}}}else{if(G.keyCode===8||G.keyCode===46){if(nf.Canvas.canWrite()&&nf.CanvasUtils.areDeletable(H)){nf.Actions["delete"](H)}}}});$.ajax({type:"GET",url:x.urls.banners,dataType:"json"}).done(function(I){if(nf.Common.isDefinedAndNotNull(I.banners)){if(nf.Common.isDefinedAndNotNull(I.banners.headerText)&&I.banners.headerText!==""){$("#banner-header").addClass("banner-header-background").text(I.banners.headerText).show();$("#canvas-container").css("top","98px")}if(nf.Common.isDefinedAndNotNull(I.banners.footerText)&&I.banners.footerText!==""){var G=$("#banner-footer").text(I.banners.footerText).show();var H=function(J){var K=$("#"+J);K.css("bottom",parseInt(G.css("height"),10)+"px")};H("graph")}}B()}).fail(nf.Common.handleAjaxError)};var u=function(z,A){return $.ajax({type:"GET",url:x.urls.api+"/flow/process-groups/"+encodeURIComponent(z),dataType:"json"}).done(function(B){var C=B.processGroupFlow;nf.Canvas.setGroupId(C.id);var D=C.breadcrumb;if(D.permissions.canRead){nf.Canvas.setGroupName(D.breadcrumb.name)}else{nf.Canvas.setGroupName(D.id)}i=B.permissions;nf.ng.Bridge.injector.get("breadcrumbsCtrl").resetBreadcrumbs();nf.ng.Bridge.injector.get("breadcrumbsCtrl").generateBreadcrumbs(D);nf.ng.Bridge.injector.get("breadcrumbsCtrl").resetScrollPosition();$("#stats-last-refreshed").text(C.lastRefreshed);if(nf.Common.isDefinedAndNotNull(C.parentGroupId)){nf.Canvas.setParentGroupId(C.parentGroupId)}else{nf.Canvas.setParentGroupId(null)}nf.Graph.set(C.flow,$.extend({selectAll:false},A));nf.Canvas.View.updateVisibility();nf.Birdseye.refresh()}).fail(nf.Common.handleAjaxError)};var b=function(){return $.ajax({type:"GET",url:x.urls.currentUser,dataType:"json"}).done(function(z){nf.Common.setCurrentUser(z)})};var w=function(){return $.ajax({type:"GET",url:x.urls.clusterSummary,dataType:"json"})};return{CANVAS_OFFSET:0,SUPPORTS_SVG:!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,hideSplash:function(){$("#splash").fadeOut()},stopPolling:function(){l=false},reload:function(z){return $.Deferred(function(C){var B=u(nf.Canvas.getGroupId(),z);var E=nf.ng.Bridge.injector.get("flowStatusCtrl").reloadFlowStatus();var D=b();var A=$.ajax({type:"GET",url:x.urls.controllerBulletins,dataType:"json"}).done(function(G){nf.ng.Bridge.injector.get("flowStatusCtrl").updateBulletins(G)});var F=w().done(function(G){var H=G.clusterSummary;nf.ng.Bridge.injector.get("flowStatusCtrl").updateClusterSummary(H);a=H.clustered;t=H.connectedToCluster});$.when(B,E,D,A,F).done(function(G){nf.ng.Bridge.digest();C.resolve(G)}).fail(function(I,G,H){C.reject(I,G,H)})}).promise()},showDisconnectedFromClusterMessage:function(){nf.Dialog.showOkDialog({headerText:"Cluster Connection",dialogContent:"This node is currently not connected to the cluster. Any modifications to the data flow made here will not replicate across the cluster."})},showConnectedToClusterMessage:function(){nf.Dialog.showOkDialog({headerText:"Cluster Connection",dialogContent:"This node just joined the cluster. Any modifications to the data flow made here will replicate across the cluster."})},init:function(){var A=$.Deferred(function(B){if(nf.Storage.hasItem("jwt")){B.resolve()}else{$.ajax({type:"POST",url:x.urls.kerberos,dataType:"text"}).done(function(E){var D=nf.Common.getJwtPayload(E);var C=parseInt(D.exp,10)*nf.Common.MILLIS_PER_SECOND;nf.Storage.setItem("jwt",E,C);B.resolve()}).fail(function(){B.reject()})}}).promise();var z=$.Deferred(function(B){A.always(function(){b().done(function(C){if(C.anonymous===false){$("#current-user").text(C.identity).show();if(nf.Storage.getItem("jwt")!==null){$("#logout-link-container").show()}}else{nf.Common.setAnonymousUserLabel()}B.resolve()}).fail(function(E,C,D){if(E.status===401){window.location="/nifi/login"}else{B.reject(E,C,D)}})})}).promise();z.done(function(){var B=nf.Client.init();var D=$.ajax({type:"GET",url:x.urls.flowConfig,dataType:"json"});var C=w();$.when(D,C,z,B).done(function(I,E){var J=I[0];var H=E[0];var L=$("#canvas-container");nf.Canvas.CANVAS_OFFSET=L.offset().top;var G=J.flowConfiguration;var K=H.clusterSummary;if(K.clustered&&!K.connectedToCluster){nf.Canvas.showDisconnectedFromClusterMessage()}a=K.clustered;t=K.connectedToCluster;nf.ng.Bridge.injector.get("flowStatusCtrl").updateClusterSummary(K);var F=parseInt(G.autoRefreshIntervalSeconds,10);g=G.supportsConfigurableAuthorizer;nf.Storage.init();k();nf.Canvas.View.init();nf.ContextMenu.init();nf.ng.Bridge.injector.get("headerCtrl").init();nf.Settings.init();nf.Actions.init();nf.QueueListing.init();nf.ComponentState.init();nf.Draggable.init();nf.Selectable.init();nf.Connectable.init();nf.StatusHistory.init(G.timeOffset);nf.Birdseye.init();nf.ConnectionConfiguration.init();nf.ControllerService.init();nf.ReportingTask.init();nf.PolicyManagement.init();nf.ProcessorConfiguration.init();nf.ProcessGroupConfiguration.init();nf.RemoteProcessGroupConfiguration.init();nf.RemoteProcessGroupPorts.init();nf.PortConfiguration.init();nf.LabelConfiguration.init();nf.ProcessorDetails.init();nf.PortDetails.init();nf.ConnectionDetails.init();nf.RemoteProcessGroupDetails.init();nf.GoTo.init();nf.Graph.init().done(function(){nf.ng.Bridge.injector.get("graphControlsCtrl").init();var M=F/2;setTimeout(function(){h(F)},M*1000);nf.Canvas.hideSplash()}).fail(nf.Common.handleAjaxError)}).fail(nf.Common.handleAjaxError)}).fail(nf.Common.handleAjaxError)},isClustered:function(){return a===true},isConnectedToCluster:function(){return t===true},setGroupId:function(z){j=z},getGroupId:function(){return j},setGroupName:function(z){m=z},getGroupName:function(){return m},setParentGroupId:function(z){p=z},getParentGroupId:function(){return p},isConfigurableAuthorizer:function(){return g},canRead:function(){if(i===null){return false}else{return i.canRead===true}},canWrite:function(){if(i===null){return false}else{return i.canWrite===true}},View:(function(){var A=function(){var J=$("#canvas-container");var E=nf.Canvas.View.translate();var F=nf.Canvas.View.scale();E=[E[0]/F,E[1]/F];var B=J.width()/F;var C=J.height()/F;var G=-E[0]-B;var D=-E[1]-C;var L=G+(B*3);var N=D+(C*3);var I=function(S){if(!nf.Canvas.View.shouldRenderPerScale()){return false}var R=S.position.x;var Q=S.position.y;var P=R+S.dimensions.width;var O=Q+S.dimensions.height;return G<P&&L>R&&D<O&&N>Q};var K=function(Q){if(!nf.Canvas.View.shouldRenderPerScale()){return false}var O,R;if(Q.bends.length>0){var P=Math.min(Math.max(0,Q.labelIndex),Q.bends.length-1);O=Q.bends[P].x;R=Q.bends[P].y}else{O=(Q.start.x+Q.end.x)/2;R=(Q.start.y+Q.end.y)/2}return G<O&&L>O&&D<R&&N>R};var H=function(S,O){var Q=d3.select("#id-"+S.id);var R=O(S);var P=Q.classed("visible");Q.classed("visible",R).classed("entering",function(){return R&&!P}).classed("leaving",function(){return !R&&P})};var M=nf.Graph.get();$.each(M.processors,function(O,P){H(P,I)});$.each(M.ports,function(O,P){H(P,I)});$.each(M.processGroups,function(O,P){H(P,I)});$.each(M.remoteProcessGroups,function(O,P){H(P,I)});$.each(M.connections,function(O,P){H(P,K)})};var z;return{init:function(){var B;var C=false;z=d3.behavior.zoom().scaleExtent([r,y]).translate(f).scale(o).on("zoomstart",function(){nf.ContextMenu.hide()}).on("zoom",function(){if(C){e=true}else{C=true}var D=d3.event.sourceEvent.type==="wheel"||d3.event.sourceEvent.type==="mousewheel";B=nf.Canvas.View.refresh({persist:false,transition:D,refreshComponents:false,refreshBirdseye:false})}).on("zoomend",function(){if(nf.Common.isDefinedAndNotNull(B)){nf.Canvas.View.updateVisibility();B.done(function(){nf.Birdseye.refresh()});nf.CanvasUtils.persistUserView();B=null}e=false;C=false});q.call(z).on("dblclick.zoom",null)},shouldRenderPerScale:function(){return nf.Canvas.View.scale()>=c},updateVisibility:function(){A();nf.Graph.pan()},translate:function(B){if(nf.Common.isUndefined(B)){return z.translate()}else{z.translate(B)}},scale:function(B){if(nf.Common.isUndefined(B)){return z.scale()}else{z.scale(B)}},zoomIn:function(){var D=nf.Canvas.View.translate();var C=nf.Canvas.View.scale();var G=Math.min(C*v,y);var F=$("#canvas-container");var B=F.width()/C;var E=F.height()/C;nf.Canvas.View.scale(G);nf.CanvasUtils.centerBoundingBox({x:(B/2)-(D[0]/C),y:(E/2)-(D[1]/C),width:1,height:1})},zoomOut:function(){var D=nf.Canvas.View.translate();var C=nf.Canvas.View.scale();var G=Math.max(C/v,r);var F=$("#canvas-container");var B=F.width()/C;var E=F.height()/C;nf.Canvas.View.scale(G);nf.CanvasUtils.centerBoundingBox({x:(B/2)-(D[0]/C),y:(E/2)-(D[1]/C),width:1,height:1})},fit:function(){var D=nf.Canvas.View.translate();var F=nf.Canvas.View.scale();var I;var H=$("#canvas-container");var E=H.width();var G=H.height();var K=d3.select("#canvas").node().getBoundingClientRect();var L=K.width/F;var C=K.height/F;var J=K.left/F;var B=(K.top-nf.Canvas.CANVAS_OFFSET)/F;if(L>E||C>G){I=Math.min(E/L,G/C);I=Math.min(Math.max(I,r),y)}else{I=1;J-=100;B-=50}nf.Canvas.View.scale(I);nf.CanvasUtils.centerBoundingBox({x:J-(D[0]/F),y:B-(D[1]/F),width:E/I,height:G/I})},actualSize:function(){var G=nf.Canvas.View.translate();var F=nf.Canvas.View.scale();var C=nf.CanvasUtils.getSelection();nf.Canvas.View.scale(1);var D;if(!C.empty()){var B=C.node().getBoundingClientRect();D={x:(B.left/F)-(G[0]/F),y:((B.top-nf.Canvas.CANVAS_OFFSET)/F)-(G[1]/F),width:B.width/F,height:B.height/F}}else{var I=$("#canvas-container");var E=I.width()/F;var H=I.height()/F;D={x:(E/2)-(G[0]/F),y:(H/2)-(G[1]/F),width:1,height:1}}nf.CanvasUtils.centerBoundingBox(D)},refresh:function(B){return $.Deferred(function(C){var D=true;var F=false;var E=true;var G=true;if(nf.Common.isDefinedAndNotNull(B)){D=nf.Common.isDefinedAndNotNull(B.persist)?B.persist:D;F=nf.Common.isDefinedAndNotNull(B.transition)?B.transition:F;E=nf.Common.isDefinedAndNotNull(B.refreshComponents)?B.refreshComponents:E;G=nf.Common.isDefinedAndNotNull(B.refreshBirdseye)?B.refreshBirdseye:G}if(E){nf.Canvas.View.updateVisibility()}if(D===true){nf.CanvasUtils.persistUserView()}if(F===true){d.transition().duration(500).attr("transform",function(){return"translate("+z.translate()+") scale("+z.scale()+")"}).each("end",function(){if(G===true){nf.Birdseye.refresh()}C.resolve()})}else{d.attr("transform",function(){return"translate("+z.translate()+") scale("+z.scale()+")"});if(G===true){nf.Birdseye.refresh()}C.resolve()}}).promise()}}}())}}());
nf.Clipboard=(function(){var a="copy";var d="paste";var c=null;var b={};return{addListener:function(f,e){b[f]=e},removeListener:function(e){if(nf.Common.isDefinedAndNotNull(b[e])){delete b[e]}},copy:function(f){c=f;for(var e in b){b[e].call(e,a,c)}},isCopied:function(){return nf.Common.isDefinedAndNotNull(c)},paste:function(){return $.Deferred(function(e){if(nf.Common.isDefinedAndNotNull(c)){var g=c;e.resolve(g);c=null;for(var f in b){b[f].call(f,d,g)}}else{e.reject()}}).promise()}}}());
nf.ng.AppConfig=function(a,b){b.debugInfoEnabled(false);a.definePalette("basePalette",{"50":"728E9B","100":"728E9B","200":"004849","300":"775351","400":"728E9B","500":"728E9B","600":"728E9B","700":"728E9B","800":"728E9B","900":"rgba(249,250,251,0.97)",A100:"728E9B",A200:"728E9B",A400:"728E9B",A700:"728E9B",contrastDefaultColor:"light",contrastDarkColors:["A100"],contrastLightColors:undefined});a.definePalette("tintPalette",{"50":"728E9B","100":"728E9B","200":"CCDADB","300":"728E9B","400":"AABBC3","500":"728E9B","600":"C7D2D7","700":"728E9B","800":"E3E8EB","900":"728E9B",A100:"728E9B",A200:"728E9B",A400:"728E9B",A700:"728E9B",contrastDefaultColor:"light",contrastDarkColors:["A100"],contrastLightColors:undefined});a.definePalette("warnPalette",{"50":"BA554A","100":"BA554A","200":"BA554A","300":"BA554A","400":"BA554A","500":"BA554A","600":"BA554A","700":"BA554A","800":"BA554A","900":"BA554A",A100:"BA554A",A200:"BA554A",A400:"BA554A",A700:"BA554A",contrastDefaultColor:"light",contrastDarkColors:["A100"],contrastLightColors:undefined});a.theme("default").primaryPalette("basePalette",{"default":"500","hue-1":"200","hue-2":"300","hue-3":"900"}).accentPalette("tintPalette",{"default":"200","hue-1":"400","hue-2":"600","hue-3":"800"}).warnPalette("warnPalette",{"default":"500"})};
nf.ng.AppCtrl=function(b,d){function a(e){this.nf=nf;this.serviceProvider=e}a.prototype={constructor:a};var c=new a(d);b.appCtrl=c;nf.ng.Bridge.rootScope=b};
nf.ng.BreadcrumbsCtrl=function(c){function b(){this.breadcrumbs=[]}b.prototype={constructor:b,register:function(){if(c.breadcrumbsCtrl===undefined){c.register("breadcrumbsCtrl",a)}},generateBreadcrumbs:function(e){var d=e.id;if(e.permissions.canRead){d=e.breadcrumb.name}this.breadcrumbs.unshift($.extend({label:d},e));if(nf.Common.isDefinedAndNotNull(e.parentBreadcrumb)){this.generateBreadcrumbs(e.parentBreadcrumb)}},resetBreadcrumbs:function(){this.breadcrumbs=[]},getBreadcrumbs:function(){return this.breadcrumbs},updateBreadcrumbsCss:function(d){$("#breadcrumbs").css(d)},resetScrollPosition:function(){var j=$("#data-flow-title-container");var g=j.position();var k=j.outerWidth();var i=g.left+k;var h=$("#breadcrumbs-right-border").width();var e=$("#data-flow-title-viewport");var f=e.width();var d=f-h;if(i>d){j.css("left",(g.left-(i-d))+"px")}else{j.css("left","10px")}},registerMouseWheelEvent:function(d){d.on("DOMMouseScroll mousewheel",function(q,j){if(nf.Common.isUndefinedOrNull(q.originalEvent)){return}var k=$("#data-flow-title-container");var e=k.position();var o=k.outerWidth();var h=e.left+o;var l=$("#breadcrumbs-right-border").width();var i=$("#data-flow-title-viewport");var g=i.width();var f=g-l;if(o>g){var n=false;var p=0;if(nf.Common.isDefinedAndNotNull(q.originalEvent.wheelDelta)){p=q.originalEvent.wheelDelta}else{if(nf.Common.isDefinedAndNotNull(q.originalEvent.detail)){p=-q.originalEvent.detail}}if(p>0&&h>f){var m=-25;n=true}else{if(p<0&&(e.left-l)<0){m=25;if(e.left+m>l){m=l-e.left}n=true}}if(n){k.css("left",(e.left+m)+"px")}}})}};var a=new b();a.register();return a};
nf.ng.Canvas.HeaderCtrl=function(f,h,a,d){var e=640;var c={urls:{accessConfig:"../nifi-api/access/config"}};function g(k,i,j){this.toolboxCtrl=k;this.globalMenuCtrl=i;this.flowStatusCtrl=j;this.loginCtrl={init:function(){var l=this;if($("#current-user").text()!==nf.Common.ANONYMOUS_USER_TEXT||location.protocol==="http:"){$("#login-link-container").css("display","none")}if(location.protocol==="http:"){$("#current-user-container").css("display","none")}var m=$.ajax({type:"GET",url:c.urls.accessConfig,dataType:"json"});$.when(m).done(function(n){l.supportsLogin=n.config.supportsLogin}).fail(nf.Common.handleAjaxError)},supportsLogin:undefined,shell:{launch:function(){nf.Shell.showPage("login",false)}}};this.logoutCtrl={logout:function(){nf.Storage.removeItem("jwt");window.location="/nifi"}}}g.prototype={constructor:g,register:function(){if(f.headerCtrl===undefined){f.register("headerCtrl",b)}},init:function(){this.toolboxCtrl.init();this.globalMenuCtrl.init();this.flowStatusCtrl.init();this.loginCtrl.init()}};var b=new g(h,a,d);b.register();return b};
nf.ng.Canvas.ToolboxCtrl=function(j,c,f,a,h,i,e,g){function d(k,n,p,o,l,r,q,m){this.processorComponent=k;this.inputPortComponent=n;this.outputPortComponent=p;this.groupComponent=o;this.remoteGroupComponent=l;this.funnelComponent=r;this.templateComponent=q;this.labelComponent=m;this.config={type:{processor:"Processor",inputPort:"Input Port",outputPort:"Output Port",processGroup:"Process Group",remoteProcessGroup:"Remote Process Group",connection:"Connection",funnel:"Funnel",template:"Template",label:"Label"},urls:{api:"../nifi-api",controller:"../nifi-api/controller",processorTypes:"../nifi-api/flow/processor-types"}}}d.prototype={constructor:d,init:function(){j.modal.init();c.modal.init();f.modal.init();a.modal.init();h.modal.init();e.modal.init()},draggableComponentConfig:function(k){k.getElement().hover(function(){k.getElement().removeClass(k.icon).addClass(k.hoverIcon)},function(){k.getElement().removeClass(k.hoverIcon).addClass(k.icon)});return{zIndex:1011,revert:true,revertDuration:0,cancel:false,containment:"body",cursor:"-webkit-grabbing",start:function(m,l){nf.ContextMenu.hide()},stop:function(p,o){var r=nf.Canvas.View.translate();var q=nf.Canvas.View.scale();var n=p.originalEvent.pageX;var m=p.originalEvent.pageY-nf.Canvas.CANVAS_OFFSET;if(n>=0&&m>=0){var l=(n/q)-(r[0]/q);var s=(m/q)-(r[1]/q);k.dropHandler.apply(k,[{x:l,y:s}])}},helper:k.dragIcon}}};var b=new d(j,c,f,a,h,i,e,g);return b};
nf.ng.Canvas.FlowStatusCtrl=function(d){var a={search:"Search",urls:{search:"../nifi-api/flow/search-results",status:"../nifi-api/flow/status"}};function c(){this.connectedNodesCount="-";this.activeThreadCount="-";this.totalQueued="-";this.controllerTransmittingCount="-";this.controllerNotTransmittingCount="-";this.controllerRunningCount="-";this.controllerStoppedCount="-";this.controllerInvalidCount="-";this.controllerDisabledCount="-";this.statsLastRefreshed="-";this.search={getInputElement:function(){return $("#search-field")},getButtonElement:function(){return $("#search-button")},getSearchContainerElement:function(){return $("#search-container")},init:function(){var e=this;$.widget("nf.searchAutocomplete",$.ui.autocomplete,{reset:function(){this.term=null},_resizeMenu:function(){var f=this.menu.element;f.width(399)},_normalize:function(g){var f=[];f.push(g);return f},_renderMenu:function(h,g){var f=this;var i=g[0];if(!nf.Common.isEmpty(i.processorResults)){h.append('<li class="search-header"><div class="search-result-icon icon icon-processor"></div>Processors</li>');$.each(i.processorResults,function(k,j){f._renderItem(h,j)})}if(!nf.Common.isEmpty(i.processGroupResults)){h.append('<li class="search-header"><div class="search-result-icon icon icon-group"></div>Process Groups</li>');$.each(i.processGroupResults,function(k,j){f._renderItem(h,j)})}if(!nf.Common.isEmpty(i.remoteProcessGroupResults)){h.append('<li class="search-header"><div class="search-result-icon icon icon-group-remote"></div>Remote Process Groups</li>');$.each(i.remoteProcessGroupResults,function(j,k){f._renderItem(h,k)})}if(!nf.Common.isEmpty(i.connectionResults)){h.append('<li class="search-header"><div class="search-result-icon icon icon-connect"></div>Connections</li>');$.each(i.connectionResults,function(k,j){f._renderItem(h,j)})}if(!nf.Common.isEmpty(i.inputPortResults)){h.append('<li class="search-header"><div class="search-result-icon icon icon-port-in"></div>Input Ports</li>');$.each(i.inputPortResults,function(j,k){f._renderItem(h,k)})}if(!nf.Common.isEmpty(i.outputPortResults)){h.append('<li class="search-header"><div class="search-result-icon icon icon-port-out"></div>Output Ports</li>');$.each(i.outputPortResults,function(j,k){f._renderItem(h,k)})}if(!nf.Common.isEmpty(i.funnelResults)){h.append('<li class="search-header"><div class="search-result-icon icon icon-funnel"></div>Funnels</li>');$.each(i.funnelResults,function(k,j){f._renderItem(h,j)})}if(h.children().length===0){h.append('<li class="unset search-no-matches">No results matched the search terms</li>')}},_renderItem:function(g,f){var h=$("<a></a>").append($('<div class="search-match-header"></div>').text(f.name));$.each(f.matches,function(k,j){h.append($('<div class="search-match"></div>').text(j))});return $("<li></li>").data("ui-autocomplete-item",f).append(h).appendTo(g)}});this.getInputElement().searchAutocomplete({appendTo:"#search-flow-results",position:{my:"right top",at:"right bottom",offset:"1 1"},source:function(g,f){$.ajax({type:"GET",data:{q:g.term},dataType:"json",url:a.urls.search}).done(function(h){f(h.searchResultsDTO)})},select:function(g,h){var f=h.item;nf.CanvasUtils.showComponent(f.groupId,f.id);e.getInputElement().val("").blur();return false},open:function(f,g){var h=$(this);$('<div class="search-glass-pane"></div>').one("click",function(){}).appendTo("body")},close:function(f,g){$(this).searchAutocomplete("reset");e.getInputElement().val("");$("div.search-glass-pane").remove()}});e.toggleSearchField()},toggleSearchField:function(){var h=this;nf.ContextMenu.hide();var e=h.getInputElement().is(":visible");var i="none";var g="search-container-opened";var f="search-container-closed";if(!e){h.getButtonElement().css("background-color","#FFFFFF");i="inline-block";g="search-container-closed";f="search-container-opened"}else{h.getInputElement().css("display",i)}this.getSearchContainerElement().switchClass(g,f,500,function(){h.getInputElement().css("display",i);if(!e){h.getButtonElement().css("background-color","#FFFFFF");h.getInputElement().focus()}else{h.getButtonElement().css("background-color","#E3E8EB")}})}};this.bulletins={update:function(e){var g=$("#bulletin-button");var i=g.data("bulletins");if(nf.Common.doBulletinsDiffer(i,e.bulletins)){g.data("bulletins",e.bulletins);var h=nf.Common.getFormattedBulletins(e.bulletins);if(h.length===0){if(g.data("qtip")){g.removeClass("has-bulletins").qtip("api").destroy(true)}}else{var f=nf.Common.formatUnorderedList(h);if(g.data("qtip")){g.qtip("option","content.text",f)}else{g.addClass("has-bulletins").qtip($.extend({},nf.CanvasUtils.config.systemTooltipConfig,{content:f,position:{at:"bottom left",my:"top right",adjust:{x:4}}}))}}}nf.Settings.setBulletins(e.controllerServiceBulletins,e.reportingTaskBulletins)}}}c.prototype={constructor:c,init:function(){this.search.init()},reloadFlowStatus:function(){var e=this;return $.ajax({type:"GET",url:a.urls.status,dataType:"json"}).done(function(f){if(nf.Common.isDefinedAndNotNull(f.controllerStatus)){e.update(f.controllerStatus)}}).fail(nf.Common.handleAjaxError)},updateClusterSummary:function(g){if(nf.Canvas.isConnectedToCluster()!==g.connectedToCluster){if(g.connectedToCluster){nf.Canvas.showConnectedToClusterMessage()}else{nf.Canvas.showDisconnectedFromClusterMessage()}}var f="#728E9B";if(g.connectedToCluster){if(nf.Common.isDefinedAndNotNull(g.connectedNodes)){var e=g.connectedNodes.split(" / ");if(e.length===2&&e[0]!==e[1]){this.clusterConnectionWarning=true;f="#BA554A"}}this.connectedNodesCount=nf.Common.isDefinedAndNotNull(g.connectedNodes)?g.connectedNodes:"-"}else{this.connectedNodesCount="Disconnected";f="#BA554A"}$("#connected-nodes-count").closest("div.fa-cubes").css("color",f)},update:function(e){var f=(nf.Common.isDefinedAndNotNull(e.invalidCount)&&(e.invalidCount>0))?"#BA554A":"#728E9B";$("#controller-invalid-count").parent().css("color",f);this.activeThreadCount=e.activeThreadCount;this.totalQueued=e.queued;this.controllerTransmittingCount=nf.Common.isDefinedAndNotNull(e.activeRemotePortCount)?e.activeRemotePortCount:"-";this.controllerNotTransmittingCount=nf.Common.isDefinedAndNotNull(e.inactiveRemotePortCount)?e.inactiveRemotePortCount:"-";this.controllerRunningCount=nf.Common.isDefinedAndNotNull(e.runningCount)?e.runningCount:"-";this.controllerStoppedCount=nf.Common.isDefinedAndNotNull(e.stoppedCount)?e.stoppedCount:"-";this.controllerInvalidCount=nf.Common.isDefinedAndNotNull(e.invalidCount)?e.invalidCount:"-";this.controllerDisabledCount=nf.Common.isDefinedAndNotNull(e.disabledCount)?e.disabledCount:"-"},updateBulletins:function(e){this.bulletins.update(e)}};var b=new c();return b};
nf.ng.Canvas.GlobalMenuCtrl=function(d){var b={urls:{helpDocument:"../nifi-docs/documentation",controllerAbout:"../nifi-api/flow/about"}};function c(e){this.summary={shell:{launch:function(){nf.Shell.showPage("summary")}}};this.counters={shell:{launch:function(){if(nf.Common.canAccessCounters()){nf.Shell.showPage("counters")}}}};this.bulletinBoard={shell:{launch:function(){nf.Shell.showPage("bulletin-board")}}};this.dataProvenance={shell:{launch:function(){if(nf.Common.canAccessProvenance()){nf.Shell.showPage("provenance")}}}};this.controllerSettings={shell:{launch:function(){nf.Settings.showSettings()}}};this.cluster={visible:function(){return nf.Canvas.isConnectedToCluster()},shell:{launch:function(){if(nf.Common.canAccessController()){nf.Shell.showPage("cluster")}}}};this.flowConfigHistory={shell:{launch:function(){nf.Shell.showPage("history")}}};this.users={shell:{launch:function(){if(nf.Common.canAccessTenants()){nf.Shell.showPage("users")}}}};this.policies={shell:{launch:function(){if(nf.Common.canModifyPolicies()&&nf.Common.canAccessTenants()){nf.PolicyManagement.showGlobalPolicies()}}}};this.templates={shell:{launch:function(){nf.Shell.showPage("templates?"+$.param({groupId:nf.Canvas.getGroupId()}))}}};this.help={shell:{launch:function(){nf.Shell.showPage(b.urls.helpDocument)}}};this.about={init:function(){$.ajax({type:"GET",url:b.urls.controllerAbout,dataType:"json"}).done(function(g){var f=g.about;document.title=f.title;$("#nf-version").text(f.version);if(!nf.Common.isBlank(f.contentViewerUrl)){$("#nifi-content-viewer-url").text(f.contentViewerUrl);nf.QueueListing.initFlowFileDetailsDialog()}}).fail(nf.Common.handleAjaxError);this.modal.init()},modal:{getElement:function(){return $("#nf-about")},init:function(){var f=this;var g=function(){var h=$(this);var i=$("#nf-about-pic-container").height()+$(".dialog-header").height()+10;h.find(".dialog-content").css("top",i)};this.getElement().modal({scrollableContentStyle:"scrollable",headerText:"About Apache NiFi",handler:{resize:g},buttons:[{buttonText:"Ok",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){f.hide()}}}]})},update:function(g,f){this.getElement().modal(g,f)},show:function(){this.getElement().modal("show")},hide:function(){this.getElement().modal("hide")}}}}c.prototype={constructor:c,init:function(){this.about.init()}};var a=new c();return a};
nf.ng.Canvas.GraphControlsCtrl=function(g,c,f){var e=function(h){if($("div.graph-control-content").is(":visible")===false){$("#graph-controls div.graph-control-docked").hide();$("#graph-controls div.graph-control-header-container").show();$(".graph-control").removeClass("docked")}h.children("div.graph-control-content").show();h.find("div.graph-control-expansion").removeClass("fa-plus-square-o").addClass("fa-minus-square-o");if(h.attr("id")==="navigation-control"){nf.Birdseye.updateBirdseyeVisibility(true)}var i=nf.Storage.getItem("graph-control-visibility");if(i===null){i={}}var j=h.attr("id");i[j]=true;nf.Storage.setItem("graph-control-visibility",i)};var d=function(h){h.children("div.graph-control-content").hide();h.find("div.graph-control-expansion").removeClass("fa-minus-square-o").addClass("fa-plus-square-o");if($("div.graph-control-content").is(":visible")===false){$("#graph-controls div.graph-control-header-container").hide();$("#graph-controls div.graph-control-docked").show();$(".graph-control").addClass("docked")}if(h.attr("id")==="navigation-control"){nf.Birdseye.updateBirdseyeVisibility(false)}var i=nf.Storage.getItem("graph-control-visibility");if(i===null){i={}}var j=h.attr("id");i[j]=false;nf.Storage.setItem("graph-control-visibility",i)};function b(h,i){this.navigateCtrl=h;this.operateCtrl=i}b.prototype={constructor:b,register:function(){if(g.graphControlsCtrl===undefined){g.register("graphControlsCtrl",a)}},init:function(){this.operateCtrl.init();var h=nf.Storage.getItem("graph-control-visibility");if(h!==null){$.each(h,function(k,i){var j=$("#"+k);if(j){if(i){e(j)}else{d(j)}}})}else{e($("#navigation-control"));e($("#operation-control"))}},undock:function(h){e($(h.target).parent())},expand:function(h){var i=$(h.target);if(i.find(".fa-plus-square-o").length>0||i.hasClass("fa-plus-square-o")||i.parent().children().find(".fa-plus-square-o").length>0){e(i.closest("div.graph-control"))}else{d(i.closest("div.graph-control"))}},getContextIcon:function(){var h=nf.CanvasUtils.getSelection();if(h.empty()){if(nf.Canvas.getParentGroupId()===null){return"icon-drop"}else{return"icon-group"}}else{if(h.size()===1){if(nf.CanvasUtils.isProcessor(h)){return"icon-processor"}else{if(nf.CanvasUtils.isProcessGroup(h)){return"icon-group"}else{if(nf.CanvasUtils.isInputPort(h)){return"icon-port-in"}else{if(nf.CanvasUtils.isOutputPort(h)){return"icon-port-out"}else{if(nf.CanvasUtils.isRemoteProcessGroup(h)){return"icon-group-remote"}else{if(nf.CanvasUtils.isFunnel(h)){return"icon-funnel"}else{if(nf.CanvasUtils.isLabel(h)){return"icon-label"}else{if(nf.CanvasUtils.isConnection(h)){return"icon-connect"}}}}}}}}}else{return"icon-drop"}}},hide:function(){var h=nf.CanvasUtils.getSelection();if(h.size()>1){return"invisible"}else{return""}},getContextName:function(){var i=nf.CanvasUtils.getSelection();var h=nf.Canvas.canRead();if(i.empty()){if(h){return nf.Canvas.getGroupName()}else{return nf.Canvas.getGroupId()}}else{if(i.size()===1){var j=i.datum();if(j.permissions.canRead){if(nf.CanvasUtils.isLabel(i)){if($.trim(j.component.label)!==""){return j.component.label}else{return""}}else{if(nf.CanvasUtils.isConnection(i)){return nf.CanvasUtils.formatConnectionName(j.component)}else{return j.component.name}}}else{return j.id}}else{return"Multiple components selected"}}},getContextType:function(){var h=nf.CanvasUtils.getSelection();if(h.empty()){return"Process Group"}else{if(h.size()===1){if(nf.CanvasUtils.isProcessor(h)){return"Processor"}else{if(nf.CanvasUtils.isProcessGroup(h)){return"Process Group"}else{if(nf.CanvasUtils.isInputPort(h)){return"Input Port"}else{if(nf.CanvasUtils.isOutputPort(h)){return"Output Port"}else{if(nf.CanvasUtils.isRemoteProcessGroup(h)){return"Remote Process Group"}else{if(nf.CanvasUtils.isFunnel(h)){return"Funnel"}else{if(nf.CanvasUtils.isLabel(h)){return"Label"}else{if(nf.CanvasUtils.isConnection(h)){return"Connection"}}}}}}}}}else{return"Multiple selected"}}},getContextId:function(){var h=nf.CanvasUtils.getSelection();if(h.empty()){return nf.Canvas.getGroupId()}else{if(h.size()===1){var i=h.datum();return i.id}else{return"Multiple selected"}}},canConfigureOrOpenDetails:function(){var h=nf.CanvasUtils.getSelection();if(h.empty()){return true}return nf.CanvasUtils.isConfigurable(h)||nf.CanvasUtils.hasDetails(h)},openConfigureOrDetailsView:function(){var h=nf.CanvasUtils.getSelection();if(h.empty()){nf.ProcessGroupConfiguration.showConfiguration(nf.Canvas.getGroupId())}if(nf.CanvasUtils.isConfigurable(h)){nf.Actions.showConfiguration(h)}else{if(nf.CanvasUtils.hasDetails(h)){nf.Actions.showDetails(h)}}},canManagePolicies:function(){var h=nf.CanvasUtils.getSelection();if(h.size()<=1){if(!h.empty()&&nf.CanvasUtils.isConnection(h)){return false}return nf.Common.canAccessTenants()}return false}};var a=new b(c,f);a.register();return a};
nf.ng.Canvas.NavigateCtrl=function(){function b(){this.zoomIn=function(){nf.Canvas.View.zoomIn();nf.ContextMenu.hide();nf.Canvas.View.refresh({transition:true})};this.zoomOut=function(){nf.Canvas.View.zoomOut();nf.ContextMenu.hide();nf.Canvas.View.refresh({transition:true})};this.zoomFit=function(){nf.Canvas.View.fit();nf.ContextMenu.hide();nf.Canvas.View.refresh({transition:true})};this.zoomActualSize=function(){nf.Canvas.View.actualSize();nf.ContextMenu.hide();nf.Canvas.View.refresh({transition:true})}}b.prototype={constructor:b};var a=new b();return a};
nf.ng.Canvas.OperateCtrl=function(){var b=function(){var d=$("#fill-color-value").val();if(/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(d)){$("#fill-color").minicolors("value",d)}};function a(){this.template={modal:{getElement:function(){return $("#new-template-dialog")},init:function(){this.getElement().modal({scrollableContentStyle:"scrollable",headerText:"Create Template"})},update:function(e,d){this.getElement().modal(e,d)},show:function(){this.getElement().modal("show")},hide:function(){this.getElement().modal("hide")}}};this.templateUpload={modal:{getElement:function(){return $("#upload-template-dialog")},init:function(){var d=$("#template-upload-form").ajaxForm({url:"../nifi-api/process-groups/"+encodeURIComponent(nf.Canvas.getGroupId())+"/templates/upload",dataType:"xml",success:function(f,i,j,h){if(f.documentElement.tagName==="templateEntity"){$("#upload-template-dialog").modal("hide");nf.Dialog.showOkDialog({headerText:"Success",dialogContent:"Template successfully imported."})}else{var e="Unable to import template. Please check the log for errors.";if(f.documentElement.tagName==="errorResponse"){var g=f.documentElement.getAttribute("statusText");if(!nf.Common.isBlank(g)){e=g}}$("#upload-template-status").text(e)}},error:function(g,f,e){$("#upload-template-status").text(g.responseText)}});this.getElement().modal({headerText:"Upload Template",buttons:[{buttonText:"Upload",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){var e=$("#selected-template-name").text();if(nf.Common.isBlank(e)){$("#upload-template-status").text("No template selected. Please browse to select a template.")}else{d.submit()}}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){$("#upload-template-dialog").modal("hide")}}}],handler:{close:function(){$("#selected-template-name").text("");$("#upload-template-status").text("");d.resetForm()}}});$("#template-file-field").on("change",function(g){var f=$(this).val();if(!nf.Common.isBlank(f)){f=f.replace(/^.*[\\\/]/,"")}$("#selected-template-name").text(f);$("#upload-template-status").text("")})},update:function(e,d){this.getElement().modal(e,d)},show:function(){this.getElement().modal("show")},hide:function(){this.getElement().modal("hide")}}};this.fillcolor={modal:{getElement:function(){return $("#fill-color-dialog")},init:function(){this.getElement().modal({scrollableContentStyle:"scrollable",headerText:"Change Color",buttons:[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){var d=nf.CanvasUtils.getSelection();d.each(function(i){var g=d3.select(this);var h=g.datum();var f=$("#fill-color").minicolors("value");if(f!==h.component.style["background-color"]){var e={revision:nf.Client.getRevision(h),component:{id:h.id,style:{"background-color":f}}};$.ajax({type:"PUT",url:h.uri,data:JSON.stringify(e),dataType:"json",contentType:"application/json"}).done(function(j){nf[h.type].set(j)}).fail(function(l,j,k){if(l.status===400||l.status===404||l.status===409){nf.Dialog.showOkDialog({headerText:"Error",dialogContent:nf.Common.escapeHtml(l.responseText)})}}).always(function(){nf.Birdseye.refresh()})}});$("#fill-color-dialog").modal("hide")}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){$("#fill-color-dialog").modal("hide")}}}],handler:{close:function(){$("#fill-color-value").val("");$("#fill-color").minicolors("value","")}}})},update:function(e,d){this.getElement().modal(e,d)},show:function(){this.getElement().modal("show")},hide:function(){this.getElement().modal("hide")},minicolors:{getElement:function(){return $("#fill-color")},init:function(){this.getElement().minicolors({inline:true,change:function(e,d){$("#fill-color-value").val(e);$("#fill-color-processor-preview").css("color",e);$("#fill-color-label-preview").css({"border-color":e,background:"linear-gradient(to bottom, #ffffff, "+e+")",filter:"progid:DXImageTransform.Microsoft.gradient(gradientType=0, startColorstr=#ffffff, endColorstr="+e+")"})}});$("#fill-color-value").on("blur",b).on("keyup",function(f){var d=f.keyCode?f.keyCode:f.which;if(d===$.ui.keyCode.ENTER){b()}})}}}}}a.prototype={constructor:a,init:function(){this.template.modal.init();this.templateUpload.modal.init();this.fillcolor.modal.init();this.fillcolor.modal.minicolors.init()}};var c=new a();return c};
nf.ng.ProcessorComponent=function(c){var f=function(){var l=$("#processor-types-table").data("gridInstance");if(nf.Common.isDefinedAndNotNull(l)){var m=l.getData();m.setFilterArgs({searchString:j()});m.refresh();if(m.getLength()>0){l.setSelectedRows([0])}}};var h=function(n,m){if(m.searchString===""){return true}try{var q=new RegExp(m.searchString,"i")}catch(p){return false}var o=n.label.search(q)>=0;var l=n.tags.search(q)>=0;return o||l};var a=function(q,n){var m=h(q,n);var l=true;if(m){var o=$("#processor-tag-cloud").tagcloud("getSelectedTags");var p=o.length>0;if(p){l=b(o,q.tags)}}var r=m&&l;if(r===false&&$("#selected-processor-type").text()===q.type){$("#processor-type-description").text("");$("#processor-type-name").text("");$("#selected-processor-name").text("");$("#selected-processor-type").text("");var s=$("#processor-types-table").data("gridInstance");s.resetActiveCell()}return r};var b=function(n,l){var m=[];$.each(n,function(q,r){m.push(r)});var o=l.toLowerCase();var p=true;$.each(m,function(q,r){if(o.indexOf(r)===-1){p=false;return false}});return p};var e=function(l,n){var m=function(q,o){var p=nf.Common.isDefinedAndNotNull(q[l.columnId])?q[l.columnId]:"";var r=nf.Common.isDefinedAndNotNull(o[l.columnId])?o[l.columnId]:"";return p===r?0:p>r?1:-1};n.sort(m,l.sortAsc)};var j=function(){return $("#processor-type-filter").val()};var d=function(){$("#processor-tag-cloud").tagcloud("clearSelectedTags");$("#processor-type-filter").val("");f();$("#processor-type-description").text("");$("#processor-type-name").text("");$("#selected-processor-name").text("");$("#selected-processor-type").text("");var l=$("#processor-types-table").data("gridInstance");l.setSelectedRows([]);l.resetActiveCell()};var g=function(l,o,m){var n={revision:nf.Client.getRevision({revision:{version:0}}),component:{type:o,name:l,position:{x:m.x,y:m.y}}};$.ajax({type:"POST",url:c.headerCtrl.toolboxCtrl.config.urls.api+"/process-groups/"+encodeURIComponent(nf.Canvas.getGroupId())+"/processors",data:JSON.stringify(n),dataType:"json",contentType:"application/json"}).done(function(p){nf.Graph.add({processors:[p]},{selectAll:true});nf.Canvas.View.updateVisibility();nf.Birdseye.refresh()}).fail(nf.Common.handleAjaxError)};function k(){this.icon="icon icon-processor";this.hoverIcon="icon icon-processor-add";this.modal={filter:{init:function(){var m=[{id:"type",name:"Type",field:"label",sortable:true,resizable:true},{id:"tags",name:"Tags",field:"tags",sortable:true,resizable:true}];var o={forceFitColumns:true,enableTextSelectionOnCells:true,enableCellNavigation:true,enableColumnReorder:false,autoEdit:false,multiSelect:false,rowHeight:24};var n=new Slick.Data.DataView({inlineFilters:false});n.setItems([]);n.setFilterArgs({searchString:j()});n.setFilter(a);e({columnId:"type",sortAsc:true},n);var l=new Slick.Grid("#processor-types-table",n,m,o);l.setSelectionModel(new Slick.RowSelectionModel());l.registerPlugin(new Slick.AutoTooltips());l.setSortColumn("type",true);l.onSort.subscribe(function(q,p){e({columnId:p.sortCol.field,sortAsc:p.sortAsc},n)});l.onSelectedRowsChanged.subscribe(function(r,q){if($.isArray(q.rows)&&q.rows.length===1){var p=q.rows[0];var s=l.getDataItem(p);if(nf.Common.isDefinedAndNotNull(s)){if(nf.Common.isBlank(s.description)){$("#processor-type-description").attr("title","").html('<span class="unset">No description specified</span>')}else{$("#processor-type-description").html(s.description).ellipsis()}$("#processor-type-name").text(s.label).ellipsis();$("#selected-processor-name").text(s.label);$("#selected-processor-type").text(s.type)}}});n.onRowCountChanged.subscribe(function(q,p){l.updateRowCount();l.render();$("#displayed-processor-types").text(p.current)});n.onRowsChanged.subscribe(function(q,p){l.invalidateRows(p.rows);l.render()});n.syncGridSelection(l,false);$("#processor-types-table").data("gridInstance",l);$.ajax({type:"GET",url:c.headerCtrl.toolboxCtrl.config.urls.processorTypes,dataType:"json"}).done(function(p){var q=[];n.beginUpdate();$.each(p.processorTypes,function(r,t){var s=t.type;n.addItem({id:r,label:nf.Common.substringAfterLast(s,"."),type:s,description:nf.Common.escapeHtml(t.description),tags:t.tags.join(", ")});$.each(t.tags,function(v,u){q.push(u.toLowerCase())})});n.endUpdate();$("#total-processor-types, #displayed-processor-types").text(p.processorTypes.length);$("#processor-tag-cloud").tagcloud({tags:q,select:f,remove:f})}).fail(nf.Common.handleAjaxError)}},getElement:function(){return $("#new-processor-dialog")},init:function(){var l=this;this.filter.init();this.getElement().modal({scrollableContentStyle:"scrollable",headerText:"Add Processor"})},update:function(m,l){this.getElement().modal(m,l)},show:function(){this.getElement().modal("show")},hide:function(){this.getElement().modal("hide")}}}k.prototype={constructor:k,getElement:function(){return $("#processor-component")},enabled:function(){this.getElement().attr("disabled",false)},disabled:function(){this.getElement().attr("disabled",true)},dropHandler:function(l){this.promptForProcessorType(l)},dragIcon:function(l){return $('<div class="icon icon-processor-add"></div>')},promptForProcessorType:function(p){var m=this;var o=function(){var q=$("#selected-processor-name").text();var r=$("#selected-processor-type").text();if(q===""||r===""){nf.Dialog.showOkDialog({headerText:"Add Processor",dialogContent:"The type of processor to create must be selected."})}else{g(q,r,p)}m.modal.hide()};var n=$("#processor-types-table").data("gridInstance");var l=function(r,q){var s=n.getDataItem(q.row);$("#selected-processor-name").text(s.label);$("#selected-processor-type").text(s.type);o()};n.onDblClick.subscribe(l);this.modal.update("setButtonModel",[{buttonText:"Add",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:o}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){$("#new-processor-dialog").modal("hide")}}}]);this.modal.update("setCloseHandler",function(){n.onDblClick.unsubscribe(l);d()});this.modal.show();$("#processor-type-filter").focus().off("keyup").on("keyup",function(r){var q=r.keyCode?r.keyCode:r.which;if(q===$.ui.keyCode.ENTER){o()}else{f()}});n.resizeCanvas();n.setSelectedRows([0])}};var i=new k();return i};
nf.ng.InputPortComponent=function(d){var c=function(g,f){var e={revision:nf.Client.getRevision({revision:{version:0}}),component:{name:g,position:{x:f.x,y:f.y}}};$.ajax({type:"POST",url:d.headerCtrl.toolboxCtrl.config.urls.api+"/process-groups/"+encodeURIComponent(nf.Canvas.getGroupId())+"/input-ports",data:JSON.stringify(e),dataType:"json",contentType:"application/json"}).done(function(h){nf.Graph.add({inputPorts:[h]},{selectAll:true});nf.Canvas.View.updateVisibility();nf.Birdseye.refresh()}).fail(nf.Common.handleAjaxError)};function a(){this.icon="icon icon-port-in";this.hoverIcon="icon icon-port-in-add";this.modal={getElement:function(){return $("#new-port-dialog")},init:function(){this.getElement().modal({scrollableContentStyle:"scrollable",headerText:"Add Port",handler:{close:function(){$("#new-port-name").val("")}}})},update:function(f,e){this.getElement().modal(f,e)},show:function(){this.getElement().modal("show")},hide:function(){this.getElement().modal("hide")}}}a.prototype={constructor:a,getElement:function(){return $("#port-in-component")},enabled:function(){this.getElement().attr("disabled",false)},disabled:function(){this.getElement().attr("disabled",true)},dropHandler:function(e){this.promptForInputPortName(e)},dragIcon:function(e){return $('<div class="icon icon-port-in-add"></div>')},promptForInputPortName:function(g){var f=this;var e=function(){var h=$("#new-port-name").val();f.modal.hide();c(h,g)};this.modal.update("setButtonModel",[{buttonText:"Add",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:e}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){f.modal.hide()}}}]);$("#new-port-type").text("Input");this.modal.show();$("#new-port-name").focus().off("keyup").on("keyup",function(i){var h=i.keyCode?i.keyCode:i.which;if(h===$.ui.keyCode.ENTER){e()}})}};var b=new a();return b};
nf.ng.OutputPortComponent=function(d){var b=function(g,f){var e={revision:nf.Client.getRevision({revision:{version:0}}),component:{name:g,position:{x:f.x,y:f.y}}};$.ajax({type:"POST",url:d.headerCtrl.toolboxCtrl.config.urls.api+"/process-groups/"+encodeURIComponent(nf.Canvas.getGroupId())+"/output-ports",data:JSON.stringify(e),dataType:"json",contentType:"application/json"}).done(function(h){nf.Graph.add({outputPorts:[h]},{selectAll:true});nf.Canvas.View.updateVisibility();nf.Birdseye.refresh()}).fail(nf.Common.handleAjaxError)};function a(){this.icon="icon icon-port-out";this.hoverIcon="icon icon-port-out-add";this.modal={getElement:function(){return $("#new-port-dialog")},init:function(){},update:function(f,e){this.getElement().modal(f,e)},show:function(){this.getElement().modal("show")},hide:function(){this.getElement().modal("hide")}}}a.prototype={constructor:a,getElement:function(){return $("#port-out-component")},enabled:function(){this.getElement().attr("disabled",false)},disabled:function(){this.getElement().attr("disabled",true)},dropHandler:function(e){this.promptForOutputPortName(e)},dragIcon:function(e){return $('<div class="icon icon-port-out-add"></div>')},promptForOutputPortName:function(g){var f=this;var e=function(){var h=$("#new-port-name").val();f.modal.hide();b(h,g)};this.modal.update("setButtonModel",[{buttonText:"Add",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:e}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){f.modal.hide()}}}]);$("#new-port-type").text("Output");this.modal.show();$("#new-port-name").focus().off("keyup").on("keyup",function(i){var h=i.keyCode?i.keyCode:i.which;if(h===$.ui.keyCode.ENTER){e()}})}};var c=new a();return c};
nf.ng.GroupComponent=function(d){var c=function(g,f){var e={revision:nf.Client.getRevision({revision:{version:0}}),component:{name:g,position:{x:f.x,y:f.y}}};return $.ajax({type:"POST",url:d.headerCtrl.toolboxCtrl.config.urls.api+"/process-groups/"+encodeURIComponent(nf.Canvas.getGroupId())+"/process-groups",data:JSON.stringify(e),dataType:"json",contentType:"application/json"}).done(function(h){nf.Graph.add({processGroups:[h]},{selectAll:true});nf.Canvas.View.updateVisibility();nf.Birdseye.refresh()}).fail(nf.Common.handleAjaxError)};function a(){this.icon="icon icon-group";this.hoverIcon="icon icon-group-add";this.modal={getElement:function(){return $("#new-process-group-dialog")},init:function(){this.getElement().modal({scrollableContentStyle:"scrollable",headerText:"Add Process Group",handler:{close:function(){$("#new-process-group-name").val("")}}})},update:function(f,e){this.getElement().modal(f,e)},show:function(){this.getElement().modal("show")},hide:function(){this.getElement().modal("hide")}}}a.prototype={constructor:a,getElement:function(){return $("#group-component")},enabled:function(){this.getElement().attr("disabled",false)},disabled:function(){this.getElement().attr("disabled",true)},dropHandler:function(e){this.promptForGroupName(e)},dragIcon:function(e){return $('<div class="icon icon-group-add"></div>')},promptForGroupName:function(f){var e=this;return $.Deferred(function(g){var h=function(){var i=$("#new-process-group-name").val();e.modal.hide();c(i,f).done(function(j){g.resolve(j.component)}).fail(function(){g.reject()})};e.modal.update("setButtonModel",[{buttonText:"Add",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:h}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){g.reject();e.modal.hide()}}}]);e.modal.show();$("#new-process-group-name").focus().off("keyup").on("keyup",function(j){var i=j.keyCode?j.keyCode:j.which;if(i===$.ui.keyCode.ENTER){h()}})}).promise()}};var b=new a();return b};
nf.ng.RemoteProcessGroupComponent=function(d){var c=function(f){var e={revision:nf.Client.getRevision({revision:{version:0}}),component:{targetUri:$("#new-remote-process-group-uri").val(),position:{x:f.x,y:f.y},communicationsTimeout:$("#new-remote-process-group-timeout").val(),yieldDuration:$("#new-remote-process-group-yield-duration").val(),transportProtocol:$("#new-remote-process-group-transport-protocol-combo").combo("getSelectedOption").value,proxyHost:$("#new-remote-process-group-proxy-host").val(),proxyPort:$("#new-remote-process-group-proxy-port").val(),proxyUser:$("#new-remote-process-group-proxy-user").val(),proxyPassword:$("#new-remote-process-group-proxy-password").val()}};$.ajax({type:"POST",url:d.headerCtrl.toolboxCtrl.config.urls.api+"/process-groups/"+encodeURIComponent(nf.Canvas.getGroupId())+"/remote-process-groups",data:JSON.stringify(e),dataType:"json",contentType:"application/json"}).done(function(g){nf.Graph.add({remoteProcessGroups:[g]},{selectAll:true});$("#new-remote-process-group-dialog").modal("hide");nf.Canvas.View.updateVisibility();nf.Birdseye.refresh()}).fail(function(j,g,h){if(j.status===400){var k=j.responseText.split("\n");var i;if(k.length===1){i=$("<span></span>").text(k[0])}else{i=nf.Common.formatUnorderedList(k)}nf.Dialog.showOkDialog({dialogContent:i,headerText:"Configuration Error"})}else{nf.Common.handleAjaxError(j,g,h)}})};function b(){this.icon="icon icon-group-remote";this.hoverIcon="icon icon-group-remote-add";this.modal={getElement:function(){return $("#new-remote-process-group-dialog")},init:function(){var e="30 sec";var f="10 sec";this.getElement().modal({scrollableContentStyle:"scrollable",headerText:"Add Remote Process Group",handler:{close:function(){$("#new-remote-process-group-uri").val("");$("#new-remote-process-group-timeout").val(e);$("#new-remote-process-group-yield-duration").val(f);$("#new-remote-process-group-transport-protocol-combo").combo("setSelectedOption",{value:"RAW"});$("#new-remote-process-group-proxy-host").val("");$("#new-remote-process-group-proxy-port").val("");$("#new-remote-process-group-proxy-user").val("");$("#new-remote-process-group-proxy-password").val("")}}});$("#new-remote-process-group-timeout").val(e);$("#new-remote-process-group-yield-duration").val(f);$("#new-remote-process-group-transport-protocol-combo").combo({options:[{text:"RAW",value:"RAW"},{text:"HTTP",value:"HTTP"}]})},update:function(f,e){this.getElement().modal(f,e)},show:function(){this.getElement().modal("show")},hide:function(){this.getElement().modal("hide")}}}b.prototype={constructor:b,getElement:function(){return $("#group-remote-component")},enabled:function(){this.getElement().attr("disabled",false)},disabled:function(){this.getElement().attr("disabled",true)},dropHandler:function(e){this.promptForRemoteProcessGroupUri(e)},dragIcon:function(e){return $('<div class="icon icon-group-remote-add"></div>')},promptForRemoteProcessGroupUri:function(g){var f=this;var e=function(){c(g)};this.modal.update("setButtonModel",[{buttonText:"Add",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:e}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){f.modal.hide()}}}]);this.modal.show();$("#new-remote-process-group-uri").focus().off("keyup").on("keyup",function(i){var h=i.keyCode?i.keyCode:i.which;if(h===$.ui.keyCode.ENTER){e()}})}};var a=new b();return a};
nf.ng.FunnelComponent=function(b){function a(){this.icon="icon icon-funnel";this.hoverIcon="icon icon-funnel-add"}a.prototype={constructor:a,getElement:function(){return $("#funnel-component")},enabled:function(){this.getElement().attr("disabled",false)},disabled:function(){this.getElement().attr("disabled",true)},dropHandler:function(d){this.createFunnel(d)},dragIcon:function(d){return $('<div class="icon icon-funnel-add"></div>')},createFunnel:function(e){var d={revision:nf.Client.getRevision({revision:{version:0}}),component:{position:{x:e.x,y:e.y}}};$.ajax({type:"POST",url:b.headerCtrl.toolboxCtrl.config.urls.api+"/process-groups/"+encodeURIComponent(nf.Canvas.getGroupId())+"/funnels",data:JSON.stringify(d),dataType:"json",contentType:"application/json"}).done(function(f){nf.Graph.add({funnels:[f]},{selectAll:true});nf.Birdseye.refresh()}).fail(nf.Common.handleAjaxError)}};var c=new a();return c};
nf.ng.TemplateComponent=function(c){var b=function(f,g){var e={templateId:f,originX:g.x,originY:g.y};$.ajax({type:"POST",url:c.headerCtrl.toolboxCtrl.config.urls.api+"/process-groups/"+encodeURIComponent(nf.Canvas.getGroupId())+"/template-instance",data:JSON.stringify(e),dataType:"json",contentType:"application/json"}).done(function(h){nf.Graph.add(h.flow,{selectAll:true});nf.Canvas.View.updateVisibility();nf.Birdseye.refresh()}).fail(nf.Common.handleAjaxError)};function a(){this.icon="icon icon-template";this.hoverIcon="icon icon-template-add";this.modal={getElement:function(){return $("#instantiate-template-dialog")},init:function(){this.getElement().modal({scrollableContentStyle:"scrollable",headerText:"Add Template",overlayBackgroud:false})},update:function(f,e){this.getElement().modal(f,e)},show:function(){this.getElement().modal("show")},hide:function(){this.getElement().modal("hide")}}}a.prototype={constructor:a,getElement:function(){return $("#template-component")},enabled:function(){this.getElement().attr("disabled",false)},disabled:function(){this.getElement().attr("disabled",true)},dropHandler:function(e){this.promptForTemplate(e)},dragIcon:function(e){return $('<div class="icon icon-template-add"></div>')},promptForTemplate:function(f){var e=this;$.ajax({type:"GET",url:c.headerCtrl.toolboxCtrl.config.urls.api+"/flow/templates",dataType:"json"}).done(function(g){var i=g.templates;if(nf.Common.isDefinedAndNotNull(i)&&i.length>0){var h=[];$.each(i,function(j,k){if(k.permissions.canRead===true){h.push({text:k.template.name,value:k.id,description:nf.Common.escapeHtml(k.template.description)})}});$("#available-templates").combo({maxHeight:300,options:h});e.modal.update("setButtonModel",[{buttonText:"Add",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){var k=$("#available-templates").combo("getSelectedOption");var j=k.value;e.modal.hide();b(j,f)}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){e.modal.hide()}}}]);e.modal.show()}else{nf.Dialog.showOkDialog({headerText:"Instantiate Template",dialogContent:"No templates have been loaded into this NiFi."})}}).fail(nf.Common.handleAjaxError)}};var d=new a();return d};
nf.ng.LabelComponent=function(c){function b(){this.icon="icon icon-label";this.hoverIcon="icon icon-label-add"}b.prototype={constructor:b,getElement:function(){return $("#label-component")},enabled:function(){this.getElement().attr("disabled",false)},disabled:function(){this.getElement().attr("disabled",true)},dropHandler:function(d){this.createLabel(d)},dragIcon:function(d){return $('<div class="icon icon-label-add"></div>')},createLabel:function(e){var d={revision:nf.Client.getRevision({revision:{version:0}}),component:{width:nf.Label.config.width,height:nf.Label.config.height,position:{x:e.x,y:e.y}}};$.ajax({type:"POST",url:c.headerCtrl.toolboxCtrl.config.urls.api+"/process-groups/"+encodeURIComponent(nf.Canvas.getGroupId())+"/labels",data:JSON.stringify(d),dataType:"json",contentType:"application/json"}).done(function(f){nf.Graph.add({labels:[f]},{selectAll:true});nf.Birdseye.refresh()}).fail(nf.Common.handleAjaxError)}};var a=new b();return a};
nf.ng.BreadcrumbsDirective=function(a){return{restrict:"E",templateUrl:"views/nf-ng-breadcrumbs-directive-view.html",scope:{breadcrumbs:"=",clickFunc:"=",highlightCrumbId:"=",separatorFunc:"="},link:function(d,c,b){a.registerMouseWheelEvent(c)}}};
nf.ng.DraggableDirective=function(){return{restrict:"AE",link:function(c,b,a){b.draggable(c.$eval(a.nfDraggable))}}};
nf.ng.Bridge=(function(){function b(){this.rootScope;this.injector}b.prototype={constructor:b,call:function(e,d){var h=e.split(".");var i=this.rootScope;angular.forEach(h,function(j){i=i[j]});var f=d.split(".");d=this.rootScope;angular.forEach(f,function(j){d=d[j]});var g=Array.prototype.slice.call(arguments,2);var c=d.apply(i,g);if(c){return c}},get:function(c){var d=c.split(".");var e=this.rootScope;angular.forEach(d,function(f){e=e[f]});return e},digest:function(){this.rootScope.$digest()}};var a=new b();return a}());
nf.ng.ServiceProvider=function(){function a(){}a.prototype={constructor:a,register:function(d,c){b[d]=c},remove:function(c){delete b[c]}};var b=new a();return b};
